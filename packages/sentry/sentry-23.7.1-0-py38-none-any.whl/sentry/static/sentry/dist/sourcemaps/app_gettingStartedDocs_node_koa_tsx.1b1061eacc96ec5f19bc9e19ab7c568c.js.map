{"version":3,"file":"chunks/app_gettingStartedDocs_node_koa_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"mZAcO,SAASA,EAAuBC,GAM7B,IAN8B,UACtCC,EAAS,aACTC,EAAY,YACZC,EAAW,UACXC,EAAS,OACTC,GACML,EACN,MAAO,CACLM,OAAOC,EAAAA,EAAAA,GAAE,sBACTC,aACEC,EAAAA,EAAAA,IAAA,KAAAC,UACGC,EAAAA,EAAAA,IACC,wKACA,CACEV,WAAWQ,EAAAA,EAAAA,IAACG,EAAAA,EAAY,CAACC,KAAMZ,QAKvCa,eAAgB,CACd,CACEC,SAAU,OACVC,KAAO,0CACPC,OAAQA,KACDf,GAAiBE,GAAcD,IAIpCe,EAAAA,EAAAA,IACEb,EACI,oDACA,0DACJ,CACEc,WAAYf,EACZgB,SAAUjB,EACVD,gBAEH,EAEHmB,gBAAiBA,KACVnB,GAAiBE,GAAcD,IAIpCe,EAAAA,EAAAA,IACEb,EACI,oDACA,0DACJ,CACEc,WAAYf,EACZgB,SAAUjB,EACVD,gBAEH,IAKX,C,mbCxDA,MAAMoB,EAAoC,CACvC,kIAIGC,EAA0B,+GAGnBC,EAAQ,eAAC,kBACpBC,KACGC,GACgBC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,CAAC,EAAC,MAA2B,CACnD,CACEG,KAAMC,EAAAA,GAASC,QACfxB,aAAaD,EAAAA,EAAAA,GAAE,4CACfO,eAAgB,CACd,CACEC,SAAU,OACVC,KAAO,iIAUb,CACEc,KAAMC,EAAAA,GAASE,UACfzB,aACEC,EAAAA,EAAAA,IAAA,KAAAC,UACGC,EAAAA,EAAAA,IACC,8HACA,CAACK,MAAMP,EAAAA,EAAAA,IAAA,eAIbK,eAAgB,CACd,CACEC,SAAU,aACVC,KAAO,sOAOHS,mxFAuFV1B,EAAAA,EAAAA,GAAwB,CACtBE,UAAW,kEACRyB,IAEL,CACEI,KAAMC,EAAAA,GAASG,OACf1B,aAAaD,EAAAA,EAAAA,GACX,4HAEFO,eAAgB,CACd,CACEC,SAAU,aACVC,KAAO,wHAQd,EAEM,SAASmB,EAAqBnC,GAMrB,IANsB,IACpCoC,EAAG,aACHlC,EAAY,OACZG,EAAM,YACNF,EAAW,UACXC,GACYJ,EACRyB,EAA8B,CAAE,SAAQW,OAE5C,MAAMC,EAAe,IAAIf,GACnBgB,EAAe,CAACf,GAUtB,OARIc,EAAaT,OAAS,IACxBH,EAAoBA,EAAkBc,OAAO,kBAAmBF,EAAc,OAG5EC,EAAaV,OAAS,IACxBH,EAAoBA,EAAkBc,OAAOD,KAI7C7B,EAAAA,EAAAA,IAAC+B,EAAAA,EAAM,CACLhB,MAAOA,EAAM,CACXC,kBAAmBA,EAAkBgB,KAAK,MAC1CvC,eACAG,SACAF,cACAC,cAEFC,OAAQA,EACRF,YAAaA,GAGnB,CAjCgBgC,EAAqBO,YAAA,wBAmCrC,S","sources":["webpack:///./app/components/onboarding/gettingStartedDoc/utils.tsx","webpack:///./app/gettingStartedDocs/node/koa.tsx"],"sourcesContent":["import ExternalLink from 'sentry/components/links/externalLink';\nimport {PlatformKey} from 'sentry/data/platformCategories';\nimport {t, tct} from 'sentry/locale';\nimport type {Organization} from 'sentry/types';\nimport {trackAnalytics} from 'sentry/utils/analytics';\n\ntype Props = {\n  guideLink: string;\n  newOrg?: boolean;\n  organization?: Organization;\n  platformKey?: PlatformKey;\n  projectId?: string;\n};\n\nexport function getUploadSourceMapsStep({\n  guideLink,\n  organization,\n  platformKey,\n  projectId,\n  newOrg,\n}: Props) {\n  return {\n    title: t('Upload Source Maps'),\n    description: (\n      <p>\n        {tct(\n          'Automatically upload your source maps to enable readable stack traces for Errors. If you prefer to manually set up source maps, please follow [guideLink:this guide].',\n          {\n            guideLink: <ExternalLink href={guideLink} />,\n          }\n        )}\n      </p>\n    ),\n    configurations: [\n      {\n        language: 'bash',\n        code: `npx @sentry/wizard@latest -i sourcemaps`,\n        onCopy: () => {\n          if (!organization || !projectId || !platformKey) {\n            return;\n          }\n\n          trackAnalytics(\n            newOrg\n              ? 'onboarding.source_maps_wizard_button_copy_clicked'\n              : 'project_creation.source_maps_wizard_button_copy_clicked',\n            {\n              project_id: projectId,\n              platform: platformKey,\n              organization,\n            }\n          );\n        },\n        onSelectAndCopy: () => {\n          if (!organization || !projectId || !platformKey) {\n            return;\n          }\n\n          trackAnalytics(\n            newOrg\n              ? 'onboarding.source_maps_wizard_selected_and_copied'\n              : 'project_creation.source_maps_wizard_selected_and_copied',\n            {\n              project_id: projectId,\n              platform: platformKey,\n              organization,\n            }\n          );\n        },\n      },\n    ],\n  };\n}\n","import {Layout, LayoutProps} from 'sentry/components/onboarding/gettingStartedDoc/layout';\nimport {ModuleProps} from 'sentry/components/onboarding/gettingStartedDoc/sdkDocumentation';\nimport {StepType} from 'sentry/components/onboarding/gettingStartedDoc/step';\nimport {getUploadSourceMapsStep} from 'sentry/components/onboarding/gettingStartedDoc/utils';\nimport {PlatformKey} from 'sentry/data/platformCategories';\nimport {t, tct} from 'sentry/locale';\nimport {Organization} from 'sentry/types';\n\ntype StepProps = {\n  newOrg: boolean;\n  organization: Organization;\n  platformKey: PlatformKey;\n  projectId: string;\n  sentryInitContent: string;\n};\n\nconst performanceIntegrations: string[] = [\n  `// Automatically instrument Node.js libraries and frameworks\n  ...Sentry.autoDiscoverNodePerformanceMonitoringIntegrations(),`,\n];\n\nconst performanceOtherConfig = `// Performance Monitoring\ntracesSampleRate: 1.0, // Capture 100% of the transactions, reduce in production!`;\n\nexport const steps = ({\n  sentryInitContent,\n  ...props\n}: Partial<StepProps> = {}): LayoutProps['steps'] => [\n  {\n    type: StepType.INSTALL,\n    description: t('Add the Sentry Node SDK as a dependency:'),\n    configurations: [\n      {\n        language: 'bash',\n        code: `\n# Using yarn\nyarn add @sentry/node @sentry/utils\n\n# Using npm\nnpm install --save @sentry/node @sentry/utils\n        `,\n      },\n    ],\n  },\n  {\n    type: StepType.CONFIGURE,\n    description: (\n      <p>\n        {tct(\n          \"Initialize Sentry as early as possible in your application's lifecycle, for example in your [code:index.ts/js] entry point:\",\n          {code: <code />}\n        )}\n      </p>\n    ),\n    configurations: [\n      {\n        language: 'javascript',\n        code: `\n        const Sentry = require(\"@sentry/node\");\n        const { stripUrlQueryAndFragment } = require(\"@sentry/utils\");\n        const Koa = require(\"koa\");\n        const app = new Koa();\n\n        Sentry.init({\n          ${sentryInitContent},\n        });\n\n        const requestHandler = (ctx, next) => {\n          return new Promise((resolve, reject) => {\n            Sentry.runWithAsyncContext(async () => {\n              const hub = Sentry.getCurrentHub();\n              hub.configureScope((scope) =>\n                scope.addEventProcessor((event) =>\n                  Sentry.addRequestDataToEvent(event, ctx.request, {\n                    include: {\n                      user: false,\n                    },\n                  })\n                )\n              );\n\n              try {\n                await next();\n              } catch (err) {\n                reject(err);\n              }\n              resolve();\n            });\n          });\n        };\n\n        // this tracing middleware creates a transaction per request\n        const tracingMiddleWare = async (ctx, next) => {\n          const reqMethod = (ctx.method || \"\").toUpperCase();\n          const reqUrl = ctx.url && stripUrlQueryAndFragment(ctx.url);\n\n          // connect to trace of upstream app\n          let traceparentData;\n          if (ctx.request.get(\"sentry-trace\")) {\n            traceparentData = Sentry.extractTraceparentData(\n              ctx.request.get(\"sentry-trace\")\n            );\n          }\n\n          const transaction = Sentry.startTransaction({\n            name: \\`\\${reqMethod} \\${reqUrl}\\`,\n            op: \"http.server\",\n            ...traceparentData,\n          });\n\n          ctx.__sentry_transaction = transaction;\n\n          // We put the transaction on the scope so users can attach children to it\n          Sentry.getCurrentHub().configureScope((scope) => {\n            scope.setSpan(transaction);\n          });\n\n          ctx.res.on(\"finish\", () => {\n            // Push \\`transaction.finish\\` to the next event loop so open spans have a chance to finish before the transaction closes\n            setImmediate(() => {\n              // if you're using koa router, set the matched route as transaction name\n              if (ctx._matchedRoute) {\n                const mountPath = ctx.mountPath || \"\";\n                transaction.setName(\\`\\${reqMethod} \\${mountPath}\\${ctx._matchedRoute}\\`);\n              }\n              transaction.setHttpStatus(ctx.status);\n              transaction.finish();\n            });\n          });\n\n          await next();\n        };\n\n        app.use(requestHandler);\n        app.use(tracingMiddleWare);\n\n        // usual error handler\n        app.on(\"error\", (err, ctx) => {\n          Sentry.withScope((scope) => {\n            scope.addEventProcessor((event) => {\n              return Sentry.addRequestDataToEvent(event, ctx.request);\n            });\n            Sentry.captureException(err);\n          });\n        });\n\n        app.listen(3000);\n        `,\n      },\n    ],\n  },\n  getUploadSourceMapsStep({\n    guideLink: 'https://docs.sentry.io/platforms/node/guides/koa/sourcemaps/',\n    ...props,\n  }),\n  {\n    type: StepType.VERIFY,\n    description: t(\n      \"This snippet contains an intentional error and can be used as a test to make sure that everything's working as expected.\"\n    ),\n    configurations: [\n      {\n        language: 'javascript',\n        code: `\n        app.use(async function () {\n          throw new Error(\"My first Sentry error!\");\n        });\n        `,\n      },\n    ],\n  },\n];\n\nexport function GettingStartedWithKoa({\n  dsn,\n  organization,\n  newOrg,\n  platformKey,\n  projectId,\n}: ModuleProps) {\n  let sentryInitContent: string[] = [`dsn: \"${dsn}\",`];\n\n  const integrations = [...performanceIntegrations];\n  const otherConfigs = [performanceOtherConfig];\n\n  if (integrations.length > 0) {\n    sentryInitContent = sentryInitContent.concat('integrations: [', integrations, '],');\n  }\n\n  if (otherConfigs.length > 0) {\n    sentryInitContent = sentryInitContent.concat(otherConfigs);\n  }\n\n  return (\n    <Layout\n      steps={steps({\n        sentryInitContent: sentryInitContent.join('\\n'),\n        organization,\n        newOrg,\n        platformKey,\n        projectId,\n      })}\n      newOrg={newOrg}\n      platformKey={platformKey}\n    />\n  );\n}\n\nexport default GettingStartedWithKoa;\n"],"names":["getUploadSourceMapsStep","_ref","guideLink","organization","platformKey","projectId","newOrg","title","t","description","_jsx","children","tct","ExternalLink","href","configurations","language","code","onCopy","trackAnalytics","project_id","platform","onSelectAndCopy","performanceIntegrations","performanceOtherConfig","steps","sentryInitContent","props","arguments","length","undefined","type","StepType","INSTALL","CONFIGURE","VERIFY","GettingStartedWithKoa","dsn","integrations","otherConfigs","concat","Layout","join","displayName"],"sourceRoot":""}