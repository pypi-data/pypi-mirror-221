{"version":3,"file":"chunks/app_views_discover_tags_tsx-node_modules_lodash_assign_js.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/views/discover/tags.tsx","webpack:///../node_modules/lodash/assign.js"],"sourcesContent":["import {Component, Fragment} from 'react';\nimport styled from '@emotion/styled';\nimport * as Sentry from '@sentry/react';\nimport {Location, LocationDescriptor} from 'history';\n\nimport {fetchTagFacets, Tag, TagSegment} from 'sentry/actionCreators/events';\nimport {Client} from 'sentry/api';\nimport {Button} from 'sentry/components/button';\nimport ErrorPanel from 'sentry/components/charts/errorPanel';\nimport {SectionHeading} from 'sentry/components/charts/styles';\nimport EmptyStateWarning from 'sentry/components/emptyStateWarning';\nimport {TagFacetsList} from 'sentry/components/group/tagFacets';\nimport TagFacetsDistributionMeter from 'sentry/components/group/tagFacets/tagFacetsDistributionMeter';\nimport Placeholder from 'sentry/components/placeholder';\nimport {IconWarning} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport {space} from 'sentry/styles/space';\nimport {Organization} from 'sentry/types';\nimport {trackAnalytics} from 'sentry/utils/analytics';\nimport EventView, {isAPIPayloadSimilar} from 'sentry/utils/discover/eventView';\nimport parseLinkHeader from 'sentry/utils/parseLinkHeader';\nimport withApi from 'sentry/utils/withApi';\n\ntype Props = {\n  api: Client;\n  eventView: EventView;\n  generateUrl: (key: string, value: string) => LocationDescriptor;\n  location: Location;\n  organization: Organization;\n  totalValues: null | number;\n  confirmedQuery?: boolean;\n};\n\ntype State = {\n  error: string;\n  hasLoaded: boolean;\n  hasMore: boolean;\n  loading: boolean;\n  tags: Tag[];\n  totalValues: null | number;\n  nextCursor?: string;\n  tagLinks?: string;\n};\n\nclass Tags extends Component<Props, State> {\n  state: State = {\n    loading: true,\n    tags: [],\n    totalValues: null,\n    error: '',\n    hasMore: false,\n    hasLoaded: false,\n  };\n\n  componentDidMount() {\n    this.fetchData(true);\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (\n      this.shouldRefetchData(prevProps) ||\n      prevProps.confirmedQuery !== this.props.confirmedQuery\n    ) {\n      this.fetchData();\n    }\n  }\n\n  shouldRefetchData = (prevProps: Props): boolean => {\n    const thisAPIPayload = this.props.eventView.getFacetsAPIPayload(this.props.location);\n    const otherAPIPayload = prevProps.eventView.getFacetsAPIPayload(prevProps.location);\n\n    return !isAPIPayloadSimilar(thisAPIPayload, otherAPIPayload);\n  };\n\n  fetchData = async (\n    forceFetchData = false,\n    nextCursor?: string,\n    appendTags?: boolean\n  ) => {\n    const {api, organization, eventView, location, confirmedQuery} = this.props;\n\n    this.setState({loading: true, error: ''});\n    if (!appendTags) {\n      this.setState({hasLoaded: false, tags: []});\n    }\n\n    // Fetch should be forced after mounting as confirmedQuery isn't guaranteed\n    // since this component can mount/unmount via show/hide tags separate from\n    // data being loaded for the rest of the page.\n    if (!forceFetchData && confirmedQuery === false) {\n      return;\n    }\n\n    try {\n      const [data, , resp] = await fetchTagFacets(api, organization.slug, {\n        ...eventView.getFacetsAPIPayload(location),\n        cursor: nextCursor,\n      });\n\n      const pageLinks = resp?.getResponseHeader('Link') ?? undefined;\n      let hasMore = false;\n      let cursor: string | undefined;\n      if (pageLinks) {\n        const paginationObject = parseLinkHeader(pageLinks);\n        hasMore = paginationObject?.next?.results ?? false;\n        cursor = paginationObject.next?.cursor;\n      }\n\n      let tags = data;\n      if (!organization.features.includes('device-classification')) {\n        tags = tags.filter(tag => tag.key !== 'device.class');\n      }\n      if (appendTags) {\n        tags = [...this.state.tags, ...tags];\n      }\n      this.setState({loading: false, hasLoaded: true, tags, hasMore, nextCursor: cursor});\n    } catch (err) {\n      if (\n        err.status !== 400 &&\n        err.responseJSON?.detail !==\n          'Invalid date range. Please try a more recent date range.'\n      ) {\n        Sentry.captureException(err);\n      }\n      this.setState({loading: false, error: err});\n    }\n  };\n\n  handleTagClick = (tag: string) => {\n    const {organization} = this.props;\n    // metrics\n    trackAnalytics('discover_v2.facet_map.clicked', {organization, tag});\n  };\n\n  renderTag(tag: Tag, index: number) {\n    const {generateUrl, totalValues} = this.props;\n\n    const segments: TagSegment[] = tag.topValues.map(segment => {\n      segment.url = generateUrl(tag.key, segment.value);\n\n      return segment;\n    });\n    // Ensure we don't show >100% if there's a slight mismatch between the facets\n    // endpoint and the totals endpoint\n    const maxTotalValues =\n      segments.length > 0\n        ? Math.max(Number(totalValues), segments[0].count)\n        : totalValues;\n    return (\n      <li key={tag.key} aria-label={tag.key}>\n        <TagFacetsDistributionMeter\n          title={tag.key}\n          segments={segments}\n          totalValues={Number(maxTotalValues)}\n          expandByDefault={index === 0}\n        />\n      </li>\n    );\n  }\n\n  renderPlaceholders() {\n    return (\n      <Fragment>\n        <StyledPlaceholderTitle key=\"title-1\" />\n        <StyledPlaceholder key=\"bar-1\" />\n        <StyledPlaceholderTitle key=\"title-2\" />\n        <StyledPlaceholder key=\"bar-2\" />\n        <StyledPlaceholderTitle key=\"title-3\" />\n        <StyledPlaceholder key=\"bar-3\" />\n      </Fragment>\n    );\n  }\n\n  renderBody = () => {\n    const {loading, hasLoaded, error, tags, hasMore, nextCursor} = this.state;\n    if (loading && !hasLoaded) {\n      return this.renderPlaceholders();\n    }\n    if (error) {\n      return (\n        <ErrorPanel height=\"132px\">\n          <IconWarning color=\"gray300\" size=\"lg\" />\n        </ErrorPanel>\n      );\n    }\n\n    if (tags.length > 0) {\n      return (\n        <Fragment>\n          <StyledTagFacetList>\n            {tags.map((tag, index) => this.renderTag(tag, index))}\n          </StyledTagFacetList>\n          {hasMore &&\n            (loading ? (\n              this.renderPlaceholders()\n            ) : (\n              <ButtonWrapper>\n                <Button\n                  size=\"xs\"\n                  priority=\"primary\"\n                  disabled={loading}\n                  aria-label={t('Show More')}\n                  onClick={() => {\n                    this.fetchData(true, nextCursor, true);\n                  }}\n                >\n                  {t('Show More')}\n                </Button>\n              </ButtonWrapper>\n            ))}\n        </Fragment>\n      );\n    }\n\n    return <StyledEmptyStateWarning small>{t('No tags found')}</StyledEmptyStateWarning>;\n  };\n\n  render() {\n    return (\n      <Fragment>\n        <SectionHeading>{t('Tag Summary')}</SectionHeading>\n        {this.renderBody()}\n      </Fragment>\n    );\n  }\n}\n\nconst StyledEmptyStateWarning = styled(EmptyStateWarning)`\n  height: 132px;\n  padding: 54px 15%;\n`;\n\nconst StyledPlaceholder = styled(Placeholder)`\n  border-radius: ${p => p.theme.borderRadius};\n  height: 16px;\n  margin-bottom: ${space(1.5)};\n`;\n\nconst StyledPlaceholderTitle = styled(Placeholder)`\n  width: 100px;\n  height: 12px;\n  margin-bottom: ${space(0.5)};\n`;\n\nconst StyledTagFacetList = styled(TagFacetsList)`\n  margin-bottom: 0;\n  width: 100%;\n`;\n\nconst ButtonWrapper = styled('div')`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`;\n\nexport {Tags};\nexport default withApi(Tags);\n","var assignValue = require('./_assignValue'),\n    copyObject = require('./_copyObject'),\n    createAssigner = require('./_createAssigner'),\n    isArrayLike = require('./isArrayLike'),\n    isPrototype = require('./_isPrototype'),\n    keys = require('./keys');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Assigns own enumerable string keyed properties of source objects to the\n * destination object. Source objects are applied from left to right.\n * Subsequent sources overwrite property assignments of previous sources.\n *\n * **Note:** This method mutates `object` and is loosely based on\n * [`Object.assign`](https://mdn.io/Object/assign).\n *\n * @static\n * @memberOf _\n * @since 0.10.0\n * @category Object\n * @param {Object} object The destination object.\n * @param {...Object} [sources] The source objects.\n * @returns {Object} Returns `object`.\n * @see _.assignIn\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n * }\n *\n * function Bar() {\n *   this.c = 3;\n * }\n *\n * Foo.prototype.b = 2;\n * Bar.prototype.d = 4;\n *\n * _.assign({ 'a': 0 }, new Foo, new Bar);\n * // => { 'a': 1, 'c': 3 }\n */\nvar assign = createAssigner(function(object, source) {\n  if (isPrototype(source) || isArrayLike(source)) {\n    copyObject(source, keys(source), object);\n    return;\n  }\n  for (var key in source) {\n    if (hasOwnProperty.call(source, key)) {\n      assignValue(object, key, source[key]);\n    }\n  }\n});\n\nmodule.exports = assign;\n"],"names":["Tags","Component","constructor","_this","arguments","this","_defineProperty","loading","tags","totalValues","error","hasMore","hasLoaded","prevProps","thisAPIPayload","props","eventView","getFacetsAPIPayload","location","otherAPIPayload","isAPIPayloadSimilar","async","forceFetchData","length","undefined","nextCursor","appendTags","api","organization","confirmedQuery","setState","data","resp","fetchTagFacets","slug","cursor","pageLinks","getResponseHeader","paginationObject","parseLinkHeader","next","results","features","includes","filter","tag","key","state","err","status","responseJSON","detail","Sentry","trackAnalytics","renderPlaceholders","_jsx","ErrorPanel","height","children","IconWarning","color","size","_jsxs","Fragment","StyledTagFacetList","map","index","renderTag","ButtonWrapper","Button","priority","disabled","t","onClick","fetchData","StyledEmptyStateWarning","small","componentDidMount","componentDidUpdate","shouldRefetchData","generateUrl","segments","topValues","segment","url","value","maxTotalValues","Math","max","Number","count","TagFacetsDistributionMeter","title","expandByDefault","StyledPlaceholderTitle","StyledPlaceholder","render","SectionHeading","renderBody","displayName","_styled","EmptyStateWarning","target","name","styles","Placeholder","p","theme","borderRadius","space","TagFacetsList","withApi","assignValue","copyObject","createAssigner","isArrayLike","isPrototype","keys","hasOwnProperty","Object","prototype","assign","object","source","call","module","exports"],"sourceRoot":""}