{"version":3,"file":"chunks/app_views_issueDetails_groupReplays_index_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/utils/useCleanQueryParamsOnRouteLeave.tsx","webpack:///./app/views/issueDetails/groupReplays/groupReplays.tsx","webpack:///./app/views/issueDetails/groupReplays/useReplaysFromIssue.tsx","webpack:///./app/views/issueDetails/groupReplays/index.tsx"],"sourcesContent":["import {useCallback, useEffect} from 'react';\nimport {browserHistory} from 'react-router';\nimport type {Location} from 'history';\n\nimport {useLocation} from 'sentry/utils/useLocation';\n\ntype Opts = {\n  fieldsToClean: string[];\n};\n\nexport function handleRouteLeave<Q extends object>({\n  fieldsToClean,\n  newLocation,\n  oldPathname,\n}: {\n  fieldsToClean: string[];\n  newLocation: Location<Q>;\n  oldPathname: string;\n}) {\n  const hasSomeValues = fieldsToClean.some(\n    field => newLocation.query[field] !== undefined\n  );\n\n  if (newLocation.pathname === oldPathname || !hasSomeValues) {\n    return;\n  }\n\n  // Removes fields from the URL on route leave so that the parameters will\n  // not interfere with other pages\n  const query = fieldsToClean.reduce(\n    (newQuery, field) => {\n      newQuery[field] = undefined;\n      return newQuery;\n    },\n    {...newLocation.query}\n  );\n\n  browserHistory.replace({\n    pathname: newLocation.pathname,\n    query,\n  });\n}\n\nfunction useCleanQueryParamsOnRouteLeave({fieldsToClean}: Opts) {\n  const location = useLocation();\n\n  const onRouteLeave = useCallback(\n    newLocation => {\n      handleRouteLeave({\n        fieldsToClean,\n        newLocation,\n        oldPathname: location.pathname,\n      });\n    },\n    [location.pathname, fieldsToClean]\n  );\n\n  useEffect(() => {\n    return browserHistory.listen(onRouteLeave);\n  }, [onRouteLeave]);\n}\n\nexport default useCleanQueryParamsOnRouteLeave;\n","import {useEffect, useMemo} from 'react';\nimport styled from '@emotion/styled';\nimport {Location} from 'history';\n\nimport * as Layout from 'sentry/components/layouts/thirds';\nimport type {Group, Organization} from 'sentry/types';\nimport {trackAnalytics} from 'sentry/utils/analytics';\nimport EventView from 'sentry/utils/discover/eventView';\nimport useReplayList from 'sentry/utils/replays/hooks/useReplayList';\nimport {useLocation} from 'sentry/utils/useLocation';\nimport useOrganization from 'sentry/utils/useOrganization';\nimport useReplaysFromIssue from 'sentry/views/issueDetails/groupReplays/useReplaysFromIssue';\nimport ReplayTable from 'sentry/views/replays/replayTable';\nimport {ReplayColumn} from 'sentry/views/replays/replayTable/types';\nimport type {ReplayListLocationQuery} from 'sentry/views/replays/types';\n\ntype Props = {\n  group: Group;\n};\n\nconst VISIBLE_COLUMNS = [\n  ReplayColumn.REPLAY,\n  ReplayColumn.OS,\n  ReplayColumn.BROWSER,\n  ReplayColumn.DURATION,\n  ReplayColumn.COUNT_ERRORS,\n  ReplayColumn.ACTIVITY,\n];\n\nfunction GroupReplays({group}: Props) {\n  const organization = useOrganization();\n  const location = useLocation<ReplayListLocationQuery>();\n\n  const {eventView, fetchError, pageLinks} = useReplaysFromIssue({\n    group,\n    location,\n    organization,\n  });\n\n  useEffect(() => {\n    trackAnalytics('replay.render-issues-group-list', {\n      project_id: group.project.id,\n      platform: group.project.platform,\n      organization,\n    });\n    // we only want to fire this event once\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  if (!eventView) {\n    return (\n      <StyledLayoutPage withPadding>\n        <ReplayTable\n          fetchError={fetchError}\n          isFetching\n          replays={[]}\n          sort={undefined}\n          visibleColumns={VISIBLE_COLUMNS}\n        />\n      </StyledLayoutPage>\n    );\n  }\n  return (\n    <GroupReplaysTable\n      eventView={eventView}\n      organization={organization}\n      pageLinks={pageLinks}\n      visibleColumns={VISIBLE_COLUMNS}\n    />\n  );\n}\n\nfunction GroupReplaysTable({\n  eventView,\n  organization,\n  visibleColumns,\n}: {\n  eventView: EventView;\n  organization: Organization;\n  pageLinks: string | null;\n  visibleColumns: ReplayColumn[];\n}) {\n  const location = useMemo(() => ({query: {}} as Location<ReplayListLocationQuery>), []);\n\n  const {replays, isFetching, fetchError} = useReplayList({\n    eventView,\n    location,\n    organization,\n    queryReferrer: 'issueReplays',\n  });\n\n  return (\n    <StyledLayoutPage withPadding>\n      <ReplayTable\n        fetchError={fetchError}\n        isFetching={isFetching}\n        replays={replays}\n        sort={undefined}\n        visibleColumns={visibleColumns}\n      />\n    </StyledLayoutPage>\n  );\n}\n\nconst StyledLayoutPage = styled(Layout.Page)`\n  box-shadow: 0px 0px 1px ${p => p.theme.gray200};\n  background-color: ${p => p.theme.background};\n`;\n\nexport default GroupReplays;\n","import {useCallback, useEffect, useMemo, useState} from 'react';\nimport * as Sentry from '@sentry/react';\nimport {Location} from 'history';\n\nimport {ALL_ACCESS_PROJECTS} from 'sentry/constants/pageFilters';\nimport type {Group, Organization} from 'sentry/types';\nimport EventView from 'sentry/utils/discover/eventView';\nimport {decodeScalar} from 'sentry/utils/queryString';\nimport {DEFAULT_SORT} from 'sentry/utils/replays/fetchReplayList';\nimport useApi from 'sentry/utils/useApi';\nimport useCleanQueryParamsOnRouteLeave from 'sentry/utils/useCleanQueryParamsOnRouteLeave';\nimport {getReplayListFields} from 'sentry/views/replays/types';\n\nfunction useReplayFromIssue({\n  group,\n  location,\n  organization,\n}: {\n  group: Group;\n  location: Location;\n  organization: Organization;\n}) {\n  const api = useApi();\n\n  const [replayIds, setReplayIds] = useState<string[]>();\n\n  const [fetchError, setFetchError] = useState();\n\n  const fetchReplayIds = useCallback(async () => {\n    try {\n      const response = await api.requestPromise(\n        `/organizations/${organization.slug}/replay-count/`,\n        {\n          query: {\n            returnIds: true,\n            query: `issue.id:[${group.id}]`,\n            statsPeriod: '14d',\n            project: ALL_ACCESS_PROJECTS,\n          },\n        }\n      );\n      setReplayIds(response[group.id] || []);\n    } catch (error) {\n      Sentry.captureException(error);\n      setFetchError(error);\n    }\n  }, [api, organization.slug, group.id]);\n\n  const eventView = useMemo(() => {\n    if (!replayIds) {\n      return null;\n    }\n    return EventView.fromSavedQuery({\n      id: '',\n      name: '',\n      version: 2,\n      fields: getReplayListFields(organization),\n      query: `id:[${String(replayIds)}]`,\n      range: '14d',\n      projects: [],\n      orderby: decodeScalar(location.query.sort, DEFAULT_SORT),\n    });\n  }, [location.query.sort, replayIds, organization]);\n\n  useCleanQueryParamsOnRouteLeave({fieldsToClean: ['cursor']});\n  useEffect(() => {\n    fetchReplayIds();\n  }, [fetchReplayIds]);\n\n  return {\n    eventView,\n    fetchError,\n    pageLinks: null,\n  };\n}\n\nexport default useReplayFromIssue;\n","import {ComponentProps} from 'react';\n\nimport Feature from 'sentry/components/acl/feature';\nimport {Alert} from 'sentry/components/alert';\nimport * as Layout from 'sentry/components/layouts/thirds';\nimport {t} from 'sentry/locale';\nimport useOrganization from 'sentry/utils/useOrganization';\n\nimport GroupReplays from './groupReplays';\n\ntype Props = ComponentProps<typeof GroupReplays>;\n\nfunction renderNoAccess() {\n  return (\n    <Layout.Page withPadding>\n      <Alert type=\"warning\">{t(\"You don't have access to this feature\")}</Alert>\n    </Layout.Page>\n  );\n}\n\nfunction GroupReplaysContainer(props: Props) {\n  const organization = useOrganization();\n\n  return (\n    <Feature\n      features={['session-replay']}\n      organization={organization}\n      renderDisabled={renderNoAccess}\n    >\n      <GroupReplays {...props} />\n    </Feature>\n  );\n}\n\nexport default GroupReplaysContainer;\n"],"names":["_ref2","fieldsToClean","location","useLocation","onRouteLeave","useCallback","newLocation","_ref","oldPathname","hasSomeValues","some","field","undefined","query","pathname","reduce","newQuery","browserHistory","replace","handleRouteLeave","useEffect","listen","VISIBLE_COLUMNS","ReplayColumn","REPLAY","OS","BROWSER","DURATION","COUNT_ERRORS","ACTIVITY","GroupReplays","group","organization","useOrganization","eventView","fetchError","pageLinks","api","useApi","replayIds","setReplayIds","useState","setFetchError","fetchReplayIds","async","response","requestPromise","slug","returnIds","id","statsPeriod","project","ALL_ACCESS_PROJECTS","error","Sentry","useMemo","EventView","fromSavedQuery","name","version","fields","getReplayListFields","String","range","projects","orderby","decodeScalar","sort","DEFAULT_SORT","useCleanQueryParamsOnRouteLeave","useReplaysFromIssue","trackAnalytics","project_id","platform","_jsx","GroupReplaysTable","visibleColumns","StyledLayoutPage","withPadding","children","ReplayTable","isFetching","replays","useReplayList","queryReferrer","displayName","_styled","Layout","target","p","theme","gray200","background","renderNoAccess","Alert","type","t","GroupReplaysContainer","props","Feature","features","renderDisabled"],"sourceRoot":""}