{"version":3,"file":"chunks/app_views_settings_account_accountClose_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/components/panels/panelHeader.tsx","webpack:///./app/views/deprecatedAsyncView.tsx","webpack:///./app/views/settings/account/confirmAccountClose.tsx","webpack:///./app/views/settings/account/accountClose.tsx"],"sourcesContent":["import {css} from '@emotion/react';\nimport styled from '@emotion/styled';\n\nimport {space} from 'sentry/styles/space';\n\ntype Props = {\n  /**\n   * Do not add padding to left and right of the header\n   */\n  disablePadding?: boolean;\n  /**\n   * Usually we place controls at the right of a panel header, to make the\n   * spacing between the edges correct we will want less padding on the right.\n   * Use this when the panel has something such as buttons living there.\n   */\n  hasButtons?: boolean;\n  /**\n   * Use light text\n   */\n  lightText?: boolean;\n};\n\nconst getPadding = ({disablePadding, hasButtons}: Props) => css`\n  padding: ${hasButtons ? space(1) : space(2)} ${disablePadding ? 0 : space(2)};\n`;\n\nconst PanelHeader = styled('div')<Props>`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  color: ${p => (p.lightText ? p.theme.gray300 : p.theme.gray400)};\n  font-size: ${p => p.theme.fontSizeSmall};\n  font-weight: 600;\n  text-transform: uppercase;\n  border-bottom: 1px solid ${p => p.theme.border};\n  border-radius: calc(${p => p.theme.panelBorderRadius} - 1px)\n    calc(${p => p.theme.panelBorderRadius} - 1px) 0 0;\n  background: ${p => p.theme.backgroundSecondary};\n  line-height: 1;\n  position: relative;\n  ${getPadding};\n`;\n\nexport default PanelHeader;\n","import DeprecatedAsyncComponent from 'sentry/components/deprecatedAsyncComponent';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\n\nexport type AsyncViewState = DeprecatedAsyncComponent['state'];\nexport type AsyncViewProps = DeprecatedAsyncComponent['props'];\n\n/**\n * @deprecated use useApiQuery instead.\n *\n * Read the dev docs page on network requests for more information [1].\n *\n * [1]: https://develop.sentry.dev/frontend/network-requests/\n */\nexport default class DeprecatedAsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends DeprecatedAsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    return (\n      <SentryDocumentTitle title={this.getTitle()}>\n        {this.renderComponent() as React.ReactChild}\n      </SentryDocumentTitle>\n    );\n  }\n}\n","import {Button} from 'sentry/components/button';\nimport Confirm from 'sentry/components/confirm';\nimport {t} from 'sentry/locale';\n\nexport function ConfirmAccountClose({\n  handleRemoveAccount,\n}: {\n  handleRemoveAccount: () => void;\n}) {\n  return (\n    <Confirm\n      priority=\"danger\"\n      message={t(\n        'This is permanent and cannot be undone, are you really sure you want to do this?'\n      )}\n      onConfirm={handleRemoveAccount}\n    >\n      <Button priority=\"danger\">{t('Close Account')}</Button>\n    </Confirm>\n  );\n}\n","import styled from '@emotion/styled';\n\nimport {addErrorMessage, addLoadingMessage} from 'sentry/actionCreators/indicator';\nimport {ModalRenderProps, openModal} from 'sentry/actionCreators/modal';\nimport {Alert} from 'sentry/components/alert';\nimport {Button} from 'sentry/components/button';\nimport HookOrDefault from 'sentry/components/hookOrDefault';\nimport Panel from 'sentry/components/panels/panel';\nimport PanelAlert from 'sentry/components/panels/panelAlert';\nimport PanelBody from 'sentry/components/panels/panelBody';\nimport PanelHeader from 'sentry/components/panels/panelHeader';\nimport PanelItem from 'sentry/components/panels/panelItem';\nimport {t, tct} from 'sentry/locale';\nimport {Organization} from 'sentry/types';\nimport DeprecatedAsyncView from 'sentry/views/deprecatedAsyncView';\nimport {ConfirmAccountClose} from 'sentry/views/settings/account/confirmAccountClose';\nimport SettingsPageHeader from 'sentry/views/settings/components/settingsPageHeader';\nimport TextBlock from 'sentry/views/settings/components/text/textBlock';\n\nconst BYE_URL = '/';\nconst leaveRedirect = () => (window.location.href = BYE_URL);\n\nconst Important = styled('div')`\n  font-weight: bold;\n  font-size: 1.2em;\n`;\n\nfunction GoodbyeModalContent({Header, Body, Footer}: ModalRenderProps) {\n  return (\n    <div>\n      <Header>{t('Closing Account')}</Header>\n      <Body>\n        <TextBlock>\n          {t('Your account has been deactivated and scheduled for removal.')}\n        </TextBlock>\n        <TextBlock>\n          {t('Thanks for using Sentry! We hope to see you again soon!')}\n        </TextBlock>\n      </Body>\n      <Footer>\n        <Button href={BYE_URL}>{t('Goodbye')}</Button>\n      </Footer>\n    </div>\n  );\n}\n\ntype OwnedOrg = {\n  organization: Organization;\n  singleOwner: boolean;\n};\n\ntype Props = DeprecatedAsyncView['props'];\n\ntype State = DeprecatedAsyncView['state'] & {\n  organizations: OwnedOrg[] | null;\n  /**\n   * Org slugs that will be removed\n   */\n  orgsToRemove: Set<string> | null;\n};\n\nclass AccountClose extends DeprecatedAsyncView<Props, State> {\n  leaveRedirectTimeout: number | undefined = undefined;\n\n  componentWillUnmount() {\n    window.clearTimeout(this.leaveRedirectTimeout);\n  }\n\n  getEndpoints(): ReturnType<DeprecatedAsyncView['getEndpoints']> {\n    return [['organizations', '/organizations/?owner=1']];\n  }\n\n  getDefaultState() {\n    return {\n      ...super.getDefaultState(),\n      orgsToRemove: null,\n    };\n  }\n\n  get singleOwnerOrgs() {\n    return this.state.organizations\n      ?.filter(({singleOwner}) => singleOwner)\n      ?.map(({organization}) => organization.slug);\n  }\n\n  getTitle() {\n    return t('Close Account');\n  }\n\n  handleChange = (\n    {slug}: Organization,\n    isSingle: boolean,\n    event: React.ChangeEvent<HTMLInputElement>\n  ) => {\n    const checked = event.target.checked;\n\n    // Can't unselect an org where you are the single owner\n    if (isSingle) {\n      return;\n    }\n\n    this.setState(state => {\n      const set = state.orgsToRemove || new Set(this.singleOwnerOrgs);\n      if (checked) {\n        set.add(slug);\n      } else {\n        set.delete(slug);\n      }\n\n      return {orgsToRemove: set};\n    });\n  };\n\n  get orgSlugsToRemove() {\n    const {orgsToRemove} = this.state;\n    return (\n      (orgsToRemove === null ? this.singleOwnerOrgs : Array.from(orgsToRemove)) || []\n    );\n  }\n\n  handleRemoveAccount = async () => {\n    const orgs = this.orgSlugsToRemove;\n\n    addLoadingMessage('Closing account\\u2026');\n\n    try {\n      await this.api.requestPromise('/users/me/', {\n        method: 'DELETE',\n        data: {organizations: orgs},\n      });\n\n      openModal(GoodbyeModalContent, {\n        onClose: leaveRedirect,\n      });\n\n      // Redirect after 10 seconds\n      window.clearTimeout(this.leaveRedirectTimeout);\n      this.leaveRedirectTimeout = window.setTimeout(leaveRedirect, 10000);\n    } catch {\n      addErrorMessage('Error closing account');\n    }\n  };\n\n  renderBody() {\n    const {organizations, orgsToRemove} = this.state;\n\n    const HookedCustomConfirmAccountClose = HookOrDefault({\n      hookName: 'component:confirm-account-close',\n      defaultComponent: props => <ConfirmAccountClose {...props} />,\n    });\n\n    return (\n      <div>\n        <SettingsPageHeader title={this.getTitle()} />\n\n        <TextBlock>\n          {t('This will permanently remove all associated data for your user')}.\n        </TextBlock>\n\n        <Alert type=\"error\" showIcon>\n          <Important>\n            {t('Closing your account is permanent and cannot be undone')}!\n          </Important>\n        </Alert>\n\n        <Panel>\n          <PanelHeader>{t('Remove the following organizations')}</PanelHeader>\n          <PanelBody>\n            <PanelAlert type=\"info\">\n              {t(\n                'Ownership will remain with other organization owners if an organization is not deleted.'\n              )}\n              <br />\n              {tct(\n                \"Boxes which can't be unchecked mean that you are the only organization owner and the organization [strong:will be deleted].\",\n                {strong: <strong />}\n              )}\n            </PanelAlert>\n\n            {organizations?.map(({organization, singleOwner}) => (\n              <PanelItem key={organization.slug}>\n                <label>\n                  <input\n                    style={{marginRight: 6}}\n                    type=\"checkbox\"\n                    value={organization.slug}\n                    onChange={this.handleChange.bind(this, organization, singleOwner)}\n                    name=\"organizations\"\n                    checked={\n                      orgsToRemove === null\n                        ? singleOwner\n                        : orgsToRemove.has(organization.slug)\n                    }\n                    disabled={singleOwner}\n                  />\n                  {organization.slug}\n                </label>\n              </PanelItem>\n            ))}\n          </PanelBody>\n        </Panel>\n        <HookedCustomConfirmAccountClose\n          handleRemoveAccount={this.handleRemoveAccount}\n          organizationSlugs={this.orgSlugsToRemove}\n        />\n      </div>\n    );\n  }\n}\n\nexport default AccountClose;\n"],"names":["getPadding","_ref","disablePadding","hasButtons","css","space","_styled","target","p","lightText","theme","gray300","gray400","fontSizeSmall","border","panelBorderRadius","backgroundSecondary","DeprecatedAsyncView","DeprecatedAsyncComponent","getTitle","render","_jsx","SentryDocumentTitle","title","this","children","renderComponent","displayName","ConfirmAccountClose","handleRemoveAccount","Confirm","priority","message","t","onConfirm","Button","leaveRedirect","window","location","href","Important","name","styles","GoodbyeModalContent","Header","Body","Footer","_jsxs","TextBlock","AccountClose","constructor","arguments","_defineProperty","undefined","_ref2","isSingle","event","slug","checked","setState","state","set","orgsToRemove","Set","singleOwnerOrgs","add","delete","async","orgs","orgSlugsToRemove","addLoadingMessage","api","requestPromise","method","data","organizations","openModal","onClose","clearTimeout","leaveRedirectTimeout","setTimeout","addErrorMessage","componentWillUnmount","getEndpoints","getDefaultState","super","filter","_ref3","singleOwner","map","_ref4","organization","Array","from","renderBody","HookedCustomConfirmAccountClose","HookOrDefault","hookName","defaultComponent","props","SettingsPageHeader","Alert","type","showIcon","Panel","PanelHeader","PanelBody","PanelAlert","tct","strong","_ref5","PanelItem","style","marginRight","value","onChange","handleChange","bind","has","disabled","organizationSlugs"],"sourceRoot":""}