{"version":3,"file":"chunks/app_components_modals_featureTourModal_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/components/modals/featureTourModal.tsx"],"sourcesContent":["import {Component, Fragment} from 'react';\nimport styled from '@emotion/styled';\n\nimport {ModalRenderProps, openModal} from 'sentry/actionCreators/modal';\nimport {Button} from 'sentry/components/button';\nimport ButtonBar from 'sentry/components/buttonBar';\nimport {IconClose} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport {space} from 'sentry/styles/space';\n\nexport type TourStep = {\n  body: React.ReactNode;\n  title: string;\n  actions?: React.ReactNode;\n  image?: React.ReactNode;\n};\n\ntype ChildProps = {\n  showModal: () => void;\n};\n\ntype Props = {\n  children: (props: ChildProps) => React.ReactNode;\n  /**\n   * The list of tour steps.\n   * The FeatureTourModal will manage state on the active step.\n   */\n  steps: TourStep[];\n  /**\n   * Customize the text shown on the done button.\n   */\n  doneText?: string;\n  /**\n   * Provide a URL for the done state to open in a new tab.\n   */\n  doneUrl?: string;\n  /**\n   * Triggered when the tour is advanced.\n   */\n  onAdvance?: (currentIndex: number, durationOpen: number) => void;\n  /**\n   * Triggered when the tour is closed by completion or IconClose\n   */\n  onCloseModal?: (currentIndex: number, durationOpen: number) => void;\n};\n\ntype State = {\n  /**\n   * The last known step\n   */\n  current: number;\n\n  /**\n   * The timestamp when the modal was shown.\n   * Used to calculate how long the modal was open\n   */\n  openedAt: number;\n};\n\nconst defaultProps = {\n  doneText: t('Done'),\n};\n\n/**\n * Provide a showModal action to the child function that lets\n * a tour be triggered.\n *\n * Once active this component will track when the tour was started and keep\n * a last known step state. Ideally the state would live entirely in this component.\n * However, once the modal has been opened state changes in this component don't\n * trigger re-renders in the modal contents. This requires a bit of duplicate state\n * to be managed around the current step.\n */\nclass FeatureTourModal extends Component<Props, State> {\n  static defaultProps = defaultProps;\n\n  state: State = {\n    openedAt: 0,\n    current: 0,\n  };\n\n  // Record the step change and call the callback this component was given.\n  handleAdvance = (current: number, duration: number) => {\n    this.setState({current});\n    this.props.onAdvance?.(current, duration);\n  };\n\n  handleShow = () => {\n    this.setState({openedAt: Date.now()}, () => {\n      const modalProps = {\n        steps: this.props.steps,\n        onAdvance: this.handleAdvance,\n        openedAt: this.state.openedAt,\n        doneText: this.props.doneText,\n        doneUrl: this.props.doneUrl,\n      };\n      openModal(deps => <ModalContents {...deps} {...modalProps} />, {\n        onClose: this.handleClose,\n      });\n    });\n  };\n\n  handleClose = () => {\n    // The bootstrap modal and modal store both call this callback.\n    // We use the state flag to deduplicate actions to upstream components.\n    if (this.state.openedAt === 0) {\n      return;\n    }\n    const {onCloseModal} = this.props;\n\n    const duration = Date.now() - this.state.openedAt;\n    onCloseModal?.(this.state.current, duration);\n\n    // Reset the state now that the modal is closed, used to deduplicate close actions.\n    this.setState({openedAt: 0, current: 0});\n  };\n\n  render() {\n    const {children} = this.props;\n    return <Fragment>{children({showModal: this.handleShow})}</Fragment>;\n  }\n}\n\nexport default FeatureTourModal;\n\ntype ContentsProps = ModalRenderProps &\n  Pick<Props, 'steps' | 'doneText' | 'doneUrl' | 'onAdvance'> &\n  Pick<State, 'openedAt'>;\n\ntype ContentsState = {\n  current: number;\n  openedAt: number;\n};\n\nclass ModalContents extends Component<ContentsProps, ContentsState> {\n  static defaultProps = defaultProps;\n\n  state: ContentsState = {\n    current: 0,\n    openedAt: Date.now(),\n  };\n\n  handleAdvance = () => {\n    const {onAdvance, openedAt} = this.props;\n    this.setState(\n      prevState => ({current: prevState.current + 1}),\n      () => {\n        const duration = Date.now() - openedAt;\n        onAdvance?.(this.state.current, duration);\n      }\n    );\n  };\n\n  render() {\n    const {Body, steps, doneText, doneUrl, closeModal} = this.props;\n    const {current} = this.state;\n\n    const step = steps[current] !== undefined ? steps[current] : steps[steps.length - 1];\n    const hasNext = steps[current + 1] !== undefined;\n\n    return (\n      <Body data-test-id=\"feature-tour\">\n        <CloseButton\n          borderless\n          size=\"zero\"\n          onClick={closeModal}\n          icon={<IconClose />}\n          aria-label={t('Close tour')}\n        />\n        <TourContent>\n          {step.image}\n          <TourHeader>{step.title}</TourHeader>\n          {step.body}\n          <TourButtonBar gap={1}>\n            {step.actions && step.actions}\n            {hasNext && (\n              <Button priority=\"primary\" onClick={this.handleAdvance}>\n                {t('Next')}\n              </Button>\n            )}\n            {!hasNext && (\n              <Button\n                external\n                href={doneUrl}\n                onClick={closeModal}\n                priority=\"primary\"\n                aria-label={t('Complete tour')}\n              >\n                {doneText}\n              </Button>\n            )}\n          </TourButtonBar>\n          <StepCounter>{t('%s of %s', current + 1, steps.length)}</StepCounter>\n        </TourContent>\n      </Body>\n    );\n  }\n}\n\nconst CloseButton = styled(Button)`\n  position: absolute;\n  top: -${space(2)};\n  right: -${space(1)};\n`;\n\nconst TourContent = styled('div')`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  margin: ${space(3)} ${space(4)} ${space(1)} ${space(4)};\n`;\n\nconst TourHeader = styled('h4')`\n  margin-bottom: ${space(1)};\n`;\n\nconst TourButtonBar = styled(ButtonBar)`\n  margin-bottom: ${space(3)};\n`;\n\nconst StepCounter = styled('div')`\n  text-transform: uppercase;\n  font-size: ${p => p.theme.fontSizeSmall};\n  font-weight: bold;\n  color: ${p => p.theme.gray300};\n`;\n\n// Styled components that can be used to build tour content.\nexport const TourText = styled('p')`\n  text-align: center;\n  margin-bottom: ${space(4)};\n`;\n\nexport const TourImage = styled('img')`\n  height: 200px;\n  margin-bottom: ${space(4)};\n\n  /** override styles in less files */\n  max-width: 380px !important;\n  box-shadow: none !important;\n  border: 0 !important;\n  border-radius: 0 !important;\n`;\n"],"names":["defaultProps","doneText","t","FeatureTourModal","Component","constructor","arguments","_defineProperty","openedAt","current","duration","this","setState","props","onAdvance","Date","now","modalProps","steps","handleAdvance","state","doneUrl","openModal","deps","_jsx","ModalContents","onClose","handleClose","onCloseModal","render","children","Fragment","showModal","handleShow","displayName","prevState","Body","closeModal","step","undefined","length","hasNext","_jsxs","CloseButton","borderless","size","onClick","icon","IconClose","TourContent","image","TourHeader","title","body","TourButtonBar","gap","actions","Button","priority","external","href","StepCounter","_styled","target","space","ButtonBar","p","theme","fontSizeSmall","gray300","TourText","TourImage"],"sourceRoot":""}