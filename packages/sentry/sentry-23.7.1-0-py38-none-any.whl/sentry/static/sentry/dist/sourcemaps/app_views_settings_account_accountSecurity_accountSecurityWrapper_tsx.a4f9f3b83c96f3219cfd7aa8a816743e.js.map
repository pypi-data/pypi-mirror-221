{"version":3,"file":"chunks/app_views_settings_account_accountSecurity_accountSecurityWrapper_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"kgBASA,MAAMA,EAAW,4BAajB,MAAMC,UAA+BC,EAAAA,EAAuCC,cAAA,SAAAC,YAAAC,EAAAA,EAAAA,GAAA,sBAS1DC,UACd,GAAKC,GAASA,EAAKC,OAAnB,CAIAC,KAAKC,SAAS,CAACC,SAAS,IAExB,UACQF,KAAKG,IAAIC,eAAgB,GAAEb,IAAWO,EAAKC,UAAW,CAACM,OAAQ,WACrEL,KAAKM,kBACP,CAAE,MAAOC,GACPP,KAAKC,SAAS,CAACC,SAAS,KACxBM,EAAAA,EAAAA,KAAgBC,EAAAA,EAAAA,GAAE,qBAAsBX,EAAKY,MAC/C,CAVA,CAUA,KACDd,EAAAA,EAAAA,GAAA,oCAE6BC,UAC5BG,KAAKC,SAAS,CAACC,SAAS,IAExB,UACQF,KAAKG,IAAIC,eAAgB,GAAEb,IAAWS,KAAKW,MAAMC,OAAOb,UAAW,CACvEM,OAAQ,QAEVL,KAAKM,kBACP,CAAE,MAAOC,GACPP,KAAKC,SAAS,CAACC,SAAS,KACxBM,EAAAA,EAAAA,KAAgBC,EAAAA,EAAAA,GAAE,mCACpB,MACDb,EAAAA,EAAAA,GAAA,sBAEe,KACdI,KAAKa,WAAW,GACjB,CAxCDC,eACE,MAAO,CACL,CAAC,iBAAkBvB,GACnB,CAAC,gBAAiB,mBAClB,CAAC,SAAU,qBAEf,CAoCAwB,aACE,MAAM,SAACC,GAAYhB,KAAKW,OAClB,eAACM,EAAc,cAAEC,EAAa,OAAEC,GAAUnB,KAAKoB,MAG/CC,GADJJ,GAAgBK,QAAOxB,GAAQA,EAAKyB,aAAezB,EAAK0B,qBAAsB,IACjDC,OACzBC,EAAiBR,GAAeI,QAAOK,GAAOA,EAAIC,cAAe,GACjEC,EAAiBH,EAAeD,OAAS,GAAuB,IAAlBJ,EAC9CS,IAAqBX,GAAQY,MAAKC,IAAA,IAAC,WAACC,GAAWD,EAAA,OAAKC,CAAU,IAKpE,OAAKC,EAAAA,EAAAA,IAAQlB,IAINmB,EAAAA,EAAAA,cAAanC,KAAKW,MAAMK,SAAU,CACvCoB,UAAWpC,KAAKqC,cAChBC,wBAAyBtC,KAAKuC,4BAC9BtB,iBACAY,iBACAH,iBACAL,gBACAS,mBACAU,cAAexC,KAAKwC,gBAXb,IAaX,EAGF,S","sources":["webpack:///./app/views/settings/account/accountSecurity/accountSecurityWrapper.tsx"],"sourcesContent":["import {cloneElement} from 'react';\nimport {RouteComponentProps} from 'react-router';\n\nimport {addErrorMessage} from 'sentry/actionCreators/indicator';\nimport DeprecatedAsyncComponent from 'sentry/components/deprecatedAsyncComponent';\nimport {t} from 'sentry/locale';\nimport {Authenticator, OrganizationSummary, UserEmail} from 'sentry/types';\nimport {defined} from 'sentry/utils';\n\nconst ENDPOINT = '/users/me/authenticators/';\n\ntype Props = {\n  children: React.ReactElement;\n} & RouteComponentProps<{authId: string}, {}> &\n  DeprecatedAsyncComponent['props'];\n\ntype State = {\n  emails: UserEmail[];\n  authenticators?: Authenticator[] | null;\n  organizations?: OrganizationSummary[];\n} & DeprecatedAsyncComponent['state'];\n\nclass AccountSecurityWrapper extends DeprecatedAsyncComponent<Props, State> {\n  getEndpoints(): ReturnType<DeprecatedAsyncComponent['getEndpoints']> {\n    return [\n      ['authenticators', ENDPOINT],\n      ['organizations', '/organizations/'],\n      ['emails', '/users/me/emails/'],\n    ];\n  }\n\n  handleDisable = async (auth: Authenticator) => {\n    if (!auth || !auth.authId) {\n      return;\n    }\n\n    this.setState({loading: true});\n\n    try {\n      await this.api.requestPromise(`${ENDPOINT}${auth.authId}/`, {method: 'DELETE'});\n      this.remountComponent();\n    } catch (_err) {\n      this.setState({loading: false});\n      addErrorMessage(t('Error disabling %s', auth.name));\n    }\n  };\n\n  handleRegenerateBackupCodes = async () => {\n    this.setState({loading: true});\n\n    try {\n      await this.api.requestPromise(`${ENDPOINT}${this.props.params.authId}/`, {\n        method: 'PUT',\n      });\n      this.remountComponent();\n    } catch (_err) {\n      this.setState({loading: false});\n      addErrorMessage(t('Error regenerating backup codes'));\n    }\n  };\n\n  handleRefresh = () => {\n    this.fetchData();\n  };\n\n  renderBody() {\n    const {children} = this.props;\n    const {authenticators, organizations, emails} = this.state;\n    const enrolled =\n      authenticators?.filter(auth => auth.isEnrolled && !auth.isBackupInterface) || [];\n    const countEnrolled = enrolled.length;\n    const orgsRequire2fa = organizations?.filter(org => org.require2FA) || [];\n    const deleteDisabled = orgsRequire2fa.length > 0 && countEnrolled === 1;\n    const hasVerifiedEmail = !!emails?.find(({isVerified}) => isVerified);\n\n    // This happens when you switch between children views and the next child\n    // view is lazy loaded, it can potentially be `null` while the code split\n    // package is being fetched\n    if (!defined(children)) {\n      return null;\n    }\n\n    return cloneElement(this.props.children, {\n      onDisable: this.handleDisable,\n      onRegenerateBackupCodes: this.handleRegenerateBackupCodes,\n      authenticators,\n      deleteDisabled,\n      orgsRequire2fa,\n      countEnrolled,\n      hasVerifiedEmail,\n      handleRefresh: this.handleRefresh,\n    });\n  }\n}\n\nexport default AccountSecurityWrapper;\n"],"names":["ENDPOINT","AccountSecurityWrapper","DeprecatedAsyncComponent","constructor","arguments","_defineProperty","async","auth","authId","this","setState","loading","api","requestPromise","method","remountComponent","_err","addErrorMessage","t","name","props","params","fetchData","getEndpoints","renderBody","children","authenticators","organizations","emails","state","countEnrolled","filter","isEnrolled","isBackupInterface","length","orgsRequire2fa","org","require2FA","deleteDisabled","hasVerifiedEmail","find","_ref","isVerified","defined","cloneElement","onDisable","handleDisable","onRegenerateBackupCodes","handleRegenerateBackupCodes","handleRefresh"],"sourceRoot":""}