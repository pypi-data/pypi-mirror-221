{"version":3,"file":"chunks/app_components_modals_issueOwnershipRuleModal_tsx-app_utils_getRouteStringFromRoutes_tsx-app_-c36a5b.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/views/settings/project/projectOwnership/modal.tsx","webpack:///./app/components/modals/issueOwnershipRuleModal.tsx","webpack:///./app/utils/getRouteStringFromRoutes.tsx","webpack:///./app/utils/withProject.tsx","webpack:///../node_modules/lodash/findLastIndex.js","webpack:///../node_modules/lodash/uniq.js"],"sourcesContent":["import {Fragment} from 'react';\nimport styled from '@emotion/styled';\nimport uniq from 'lodash/uniq';\n\nimport DeprecatedAsyncComponent from 'sentry/components/deprecatedAsyncComponent';\nimport ExternalLink from 'sentry/components/links/externalLink';\nimport {t, tct} from 'sentry/locale';\nimport ConfigStore from 'sentry/stores/configStore';\nimport {space} from 'sentry/styles/space';\nimport {Frame, Organization, Project, TagWithTopValues} from 'sentry/types';\nimport type {Event} from 'sentry/types/event';\nimport OwnerInput from 'sentry/views/settings/project/projectOwnership/ownerInput';\n\ntype IssueOwnershipResponse = {\n  autoAssignment: boolean;\n  dateCreated: string;\n  fallthrough: boolean;\n  isActive: boolean;\n  lastUpdated: string;\n  raw: string;\n};\n\ntype Props = DeprecatedAsyncComponent['props'] & {\n  issueId: string;\n  onCancel: () => void;\n  organization: Organization;\n  project: Project;\n  eventData?: Event;\n};\n\ntype State = {\n  ownership: null | IssueOwnershipResponse;\n  urlTagData: null | TagWithTopValues;\n} & DeprecatedAsyncComponent['state'];\n\nfunction getFrameSuggestions(eventData?: Event) {\n  // pull frame data out of exception or the stacktrace\n  const entry = eventData?.entries?.find(({type}) =>\n    ['exception', 'stacktrace'].includes(type)\n  );\n\n  let frames: Frame[] = [];\n  if (entry?.type === 'exception') {\n    frames = entry?.data?.values?.[0]?.stacktrace?.frames ?? [];\n  } else if (entry?.type === 'stacktrace') {\n    frames = entry?.data?.frames ?? [];\n  }\n\n  // Only display in-app frames\n  frames = frames.filter(frame => frame && frame.inApp).reverse();\n\n  return uniq(frames.map(frame => frame.filename || frame.absPath || ''));\n}\n\n/**\n * Attempt to remove the origin from a URL\n */\nfunction getUrlPath(maybeUrl?: string) {\n  if (!maybeUrl) {\n    return '';\n  }\n\n  try {\n    const url = new URL(maybeUrl);\n    return `*${url.pathname}`;\n  } catch {\n    return maybeUrl;\n  }\n}\n\nfunction OwnershipSuggestions({\n  paths,\n  urls,\n  eventData,\n}: {\n  paths: string[];\n  urls: string[];\n  eventData?: Event;\n}) {\n  const email = ConfigStore.get('user')?.email;\n  if (!email) {\n    return null;\n  }\n\n  const pathSuggestion = paths.length ? `path:${paths[0]} ${email}` : null;\n  const urlSuggestion = urls.length ? `url:${getUrlPath(urls[0])} ${email}` : null;\n\n  const transactionTag = eventData?.tags?.find(({key}) => key === 'transaction');\n  const transactionSuggestion = transactionTag\n    ? `tags.transaction:${transactionTag.value} ${email}`\n    : null;\n\n  return (\n    <StyledPre>\n      # {t('Hereâ€™s some suggestions based on this issue')}\n      <br />\n      {[pathSuggestion, urlSuggestion, transactionSuggestion]\n        .filter(x => x)\n        .map(suggestion => (\n          <Fragment key={suggestion}>\n            {suggestion}\n            <br />\n          </Fragment>\n        ))}\n    </StyledPre>\n  );\n}\n\nclass ProjectOwnershipModal extends DeprecatedAsyncComponent<Props, State> {\n  getEndpoints(): ReturnType<DeprecatedAsyncComponent['getEndpoints']> {\n    const {organization, project, issueId} = this.props;\n    return [\n      ['ownership', `/projects/${organization.slug}/${project.slug}/ownership/`],\n      [\n        'urlTagData',\n        `/issues/${issueId}/tags/url/`,\n        {},\n        {\n          allowError: error =>\n            // Allow for 404s\n            error.status === 404,\n        },\n      ],\n    ];\n  }\n\n  renderBody() {\n    const {ownership, urlTagData} = this.state;\n    const {eventData, organization, project, onCancel} = this.props;\n    if (!ownership) {\n      return null;\n    }\n\n    const urls = urlTagData\n      ? urlTagData.topValues\n          .sort((a, b) => a.count - b.count)\n          .map(i => i.value)\n          .slice(0, 5)\n      : [];\n\n    const hasStreamlineTargetingFeature = organization.features.includes(\n      'streamline-targeting-context'\n    );\n    const paths = getFrameSuggestions(eventData);\n\n    return (\n      <Fragment>\n        {hasStreamlineTargetingFeature ? (\n          <Fragment>\n            <Description>\n              {tct(\n                'Assign issues based on custom rules. To learn more, [docs:read the docs].',\n                {\n                  docs: (\n                    <ExternalLink href=\"https://docs.sentry.io/product/issues/issue-owners/\" />\n                  ),\n                }\n              )}\n            </Description>\n            <OwnershipSuggestions paths={paths} urls={urls} eventData={eventData} />\n          </Fragment>\n        ) : (\n          <p>{t('Match against Issue Data: (globbing syntax *, ? supported)')}</p>\n        )}\n        <OwnerInput\n          organization={organization}\n          project={project}\n          initialText={ownership?.raw || ''}\n          urls={urls}\n          paths={paths}\n          dateUpdated={ownership.lastUpdated}\n          onCancel={onCancel}\n          page=\"issue_details\"\n        />\n      </Fragment>\n    );\n  }\n}\n\nconst Description = styled('p')`\n  margin-bottom: ${space(1)};\n`;\n\nconst StyledPre = styled('pre')`\n  word-break: break-word;\n  padding: ${space(2)};\n  line-height: 1.6;\n  color: ${p => p.theme.subText};\n`;\n\nexport default ProjectOwnershipModal;\n","import {Fragment, useEffect} from 'react';\nimport {css} from '@emotion/react';\n\nimport {ModalRenderProps} from 'sentry/actionCreators/modal';\nimport {t} from 'sentry/locale';\nimport type {Event, Organization, Project} from 'sentry/types';\nimport {trackIntegrationAnalytics} from 'sentry/utils/integrationUtil';\nimport theme from 'sentry/utils/theme';\nimport ProjectOwnershipModal from 'sentry/views/settings/project/projectOwnership/modal';\n\ninterface CreateOwnershipRuleProps extends ModalRenderProps {\n  issueId: string;\n  organization: Organization;\n  project: Project;\n  eventData?: Event;\n}\n\nfunction IssueOwnershipRuleModal({\n  Body,\n  Header,\n  Footer: _Footer,\n  organization,\n  project,\n  issueId,\n  eventData,\n  closeModal,\n}: CreateOwnershipRuleProps) {\n  useEffect(() => {\n    trackIntegrationAnalytics('project_ownership.modal_opened', {\n      page: 'issue_details',\n      organization,\n    });\n  }, [organization]);\n\n  return (\n    <Fragment>\n      <Header closeButton>\n        <h4>{t('Edit Ownership Rules')}</h4>\n      </Header>\n      <Body>\n        <ProjectOwnershipModal\n          organization={organization}\n          project={project}\n          issueId={issueId}\n          eventData={eventData}\n          onCancel={closeModal}\n        />\n      </Body>\n    </Fragment>\n  );\n}\n\nexport const modalCss = css`\n  @media (min-width: ${theme.breakpoints.small}) {\n    width: 80%;\n  }\n`;\n\nexport default IssueOwnershipRuleModal;\n","import {PlainRoute} from 'react-router';\nimport findLastIndex from 'lodash/findLastIndex';\n\ntype RouteWithPath = Omit<PlainRoute, 'path'> & Required<Pick<PlainRoute, 'path'>>;\n\n/**\n * Creates a route string from an array of `routes` from react-router\n *\n * It will look for the last route path that begins with a `/` and\n * concatenate all of the following routes. Skips any routes without a path\n *\n * @param {Array<{}>} routes An array of route objects from react-router\n * @return String Returns a route path\n */\nexport default function getRouteStringFromRoutes(routes?: PlainRoute[]): string {\n  if (!Array.isArray(routes)) {\n    return '';\n  }\n\n  const routesWithPaths = routes.filter((route): route is RouteWithPath => !!route.path);\n\n  const lastAbsolutePathIndex = findLastIndex(routesWithPaths, ({path}) =>\n    path.startsWith('/')\n  );\n\n  return routesWithPaths\n    .slice(lastAbsolutePathIndex)\n    .filter(({path}) => !!path)\n    .map(({path}) => path)\n    .join('');\n}\n","import {Component} from 'react';\n\nimport SentryTypes from 'sentry/sentryTypes';\nimport {Project} from 'sentry/types';\nimport getDisplayName from 'sentry/utils/getDisplayName';\n\ntype InjectedProjectProps = {\n  project?: Project;\n};\n\n/**\n * Currently wraps component with project from context\n */\nconst withProject = <P extends InjectedProjectProps>(\n  WrappedComponent: React.ComponentType<P>\n) =>\n  class extends Component<\n    Omit<P, keyof InjectedProjectProps> & Partial<InjectedProjectProps>\n  > {\n    static displayName = `withProject(${getDisplayName(WrappedComponent)})`;\n    static contextTypes = {\n      project: SentryTypes.Project,\n    };\n\n    render() {\n      const {project, ...props} = this.props;\n      return (\n        <WrappedComponent\n          {...({project: project ?? this.context.project, ...props} as P)}\n        />\n      );\n    }\n  };\n\nexport default withProject;\n","var baseFindIndex = require('./_baseFindIndex'),\n    baseIteratee = require('./_baseIteratee'),\n    toInteger = require('./toInteger');\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * This method is like `_.findIndex` except that it iterates over elements\n * of `collection` from right to left.\n *\n * @static\n * @memberOf _\n * @since 2.0.0\n * @category Array\n * @param {Array} array The array to inspect.\n * @param {Function} [predicate=_.identity] The function invoked per iteration.\n * @param {number} [fromIndex=array.length-1] The index to search from.\n * @returns {number} Returns the index of the found element, else `-1`.\n * @example\n *\n * var users = [\n *   { 'user': 'barney',  'active': true },\n *   { 'user': 'fred',    'active': false },\n *   { 'user': 'pebbles', 'active': false }\n * ];\n *\n * _.findLastIndex(users, function(o) { return o.user == 'pebbles'; });\n * // => 2\n *\n * // The `_.matches` iteratee shorthand.\n * _.findLastIndex(users, { 'user': 'barney', 'active': true });\n * // => 0\n *\n * // The `_.matchesProperty` iteratee shorthand.\n * _.findLastIndex(users, ['active', false]);\n * // => 2\n *\n * // The `_.property` iteratee shorthand.\n * _.findLastIndex(users, 'active');\n * // => 0\n */\nfunction findLastIndex(array, predicate, fromIndex) {\n  var length = array == null ? 0 : array.length;\n  if (!length) {\n    return -1;\n  }\n  var index = length - 1;\n  if (fromIndex !== undefined) {\n    index = toInteger(fromIndex);\n    index = fromIndex < 0\n      ? nativeMax(length + index, 0)\n      : nativeMin(index, length - 1);\n  }\n  return baseFindIndex(array, baseIteratee(predicate, 3), index, true);\n}\n\nmodule.exports = findLastIndex;\n","var baseUniq = require('./_baseUniq');\n\n/**\n * Creates a duplicate-free version of an array, using\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons, in which only the first occurrence of each element\n * is kept. The order of result values is determined by the order they occur\n * in the array.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Array\n * @param {Array} array The array to inspect.\n * @returns {Array} Returns the new duplicate free array.\n * @example\n *\n * _.uniq([2, 1, 2]);\n * // => [2, 1]\n */\nfunction uniq(array) {\n  return (array && array.length) ? baseUniq(array) : [];\n}\n\nmodule.exports = uniq;\n"],"names":["OwnershipSuggestions","_ref2","paths","urls","eventData","email","ConfigStore","get","pathSuggestion","length","urlSuggestion","maybeUrl","URL","pathname","getUrlPath","transactionTag","tags","find","_ref3","key","transactionSuggestion","value","_jsxs","StyledPre","children","t","_jsx","filter","x","map","suggestion","Fragment","displayName","ProjectOwnershipModal","DeprecatedAsyncComponent","getEndpoints","organization","project","issueId","this","props","slug","allowError","error","status","renderBody","ownership","urlTagData","state","onCancel","topValues","sort","a","b","count","i","slice","hasStreamlineTargetingFeature","features","includes","entry","entries","_ref","type","frames","data","values","stacktrace","frame","inApp","reverse","uniq","filename","absPath","getFrameSuggestions","Description","tct","docs","ExternalLink","href","OwnerInput","initialText","raw","dateUpdated","lastUpdated","page","_styled","target","space","p","theme","subText","IssueOwnershipRuleModal","Body","Header","Footer","_Footer","closeModal","useEffect","trackIntegrationAnalytics","closeButton","modalCss","css","breakpoints","small","getRouteStringFromRoutes","routes","Array","isArray","routesWithPaths","route","path","lastAbsolutePathIndex","findLastIndex","startsWith","join","WrappedComponent","_class","Component","render","context","_defineProperty","getDisplayName","SentryTypes","Project","baseFindIndex","baseIteratee","toInteger","nativeMax","Math","max","nativeMin","min","module","exports","array","predicate","fromIndex","index","undefined","baseUniq"],"sourceRoot":""}