"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_alerts_create_tsx"],{"./app/views/alerts/create.tsx":(e,t,s)=>{s.r(t),s.d(t,{default:()=>F});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=s("../node_modules/react/index.js"),o=s("./app/components/layouts/thirds.tsx"),n=s("./app/components/loadingIndicator.tsx"),l=s("./app/components/sentryDocumentTitle.tsx"),p=s("./app/locale.tsx"),u=s("./app/utils/discover/eventView.tsx"),d=s("./app/utils/guid.tsx"),c=s("./app/utils/routeAnalytics/withRouteAnalytics.tsx"),m=s("./app/utils/teams.tsx"),g=s("./app/utils/withDomainRequired.tsx"),h=s("./app/views/alerts/builder/builderBreadCrumbs.tsx"),w=s("./app/views/alerts/rules/issue/index.tsx"),v=(s("../node_modules/core-js/modules/es.array.push.js"),s("./app/utils/analytics.tsx")),y=s("./app/views/alerts/rules/metric/constants.tsx"),I=s("./app/views/alerts/rules/metric/ruleForm.tsx"),x=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function T(e){const{project:t,eventView:s,wizardTemplate:r,sessionId:a,userTeamIds:i,...o}=e,n=s?(0,y.H9)(s):r?(0,y.Q6)(r):(0,y.ep)(),l=new Set(t.teams.map((e=>{let{id:t}=e;return t}))),p=i.find((e=>l.has(e)))??null;return n.owner=p&&`team:${p}`,(0,x.tZ)(I.Z,{onSubmitSuccess:function(t){const{organization:s,project:r,router:a}=e,i=t?t.id:void 0;v.oF.endTransaction({name:"saveAlertRule"});const o=i?{pathname:`/organizations/${s.slug}/alerts/rules/details/${i}/`}:{pathname:`/organizations/${s.slug}/alerts/rules/`,query:{project:r.id}};a.push((0,g.D)(o))},rule:{...n,projects:[t.slug]},sessionId:a,project:t,userTeamIds:i,eventView:s,...o})}T.displayName="MetricRulesCreate";const j=T;var Z=s("../node_modules/lodash/pick.js"),b=s.n(Z),S=s("./app/views/deprecatedAsyncView.tsx");class z extends S.Z{constructor(){super(...arguments),(0,r.Z)(this,"handleSubmitSuccess",(e=>{const{router:t,organization:s,project:r}=this.props,a=e?e.id:void 0,i=a?{pathname:`/organizations/${s.slug}/alerts/rules/details/${a}/`}:{pathname:`/organizations/${s.slug}/alerts/rules/`,query:{project:r.id}};t.push((0,g.D)(i))}))}getEndpoints(){const{organization:e,location:{query:t}}=this.props;return[["duplicateTargetRule",`/organizations/${e.slug}/alert-rules/${t.duplicateRuleId}/`]]}renderBody(){const{project:e,sessionId:t,userTeamIds:s,...r}=this.props,{duplicateTargetRule:a}=this.state;return a?(0,x.tZ)(o.or,{children:(0,x.tZ)(I.Z,{onSubmitSuccess:this.handleSubmitSuccess,rule:{...b()(a,y.bp),triggers:a.triggers.map((e=>({...b()(e,y.XU),actions:e.actions.map((e=>({inputChannelId:null,integrationId:e.integrationId??void 0,options:null,sentryAppId:void 0,unsavedId:(0,d.E)(),unsavedDateCreated:(new Date).toISOString(),...b()(e,y.rQ)})))}))),name:a.name+" copy"},sessionId:t,project:e,userTeamIds:s,isDuplicateRule:!0,...r})}):this.renderLoading()}}const R=z;var _=s("./app/views/alerts/types.tsx"),D=s("./app/views/alerts/wizard/options.tsx"),C=s("./app/views/alerts/wizard/utils.tsx");class $ extends i.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",this.getInitialState()),(0,r.Z)(this,"sessionId",(0,d.E)())}getInitialState(){const{organization:e,location:t,project:s,params:r,router:a}=this.props,{aggregate:i,dataset:o,eventTypes:n,createFromDuplicate:l}=t?.query??{},p=r.alertType||_.ok.METRIC;return p!==_.ok.METRIC||i&&o&&n||l||a.replace((0,g.D)({...t,pathname:`/organizations/${e.slug}/alerts/new/${p}`,query:{...t.query,...D.F4,project:s.slug}})),{alertType:p}}componentDidMount(){const{project:e}=this.props;this.props.setRouteAnalyticsParams({project_id:e.id,session_id:this.sessionId,alert_type:this.state.alertType,duplicate_rule:this.isDuplicateRule?"true":"false",wizard_v3:"true"}),this.props.setEventNames("new_alert_rule.viewed","New Alert Rule: Viewed")}get isDuplicateRule(){const{location:e}=this.props;return"true"===e?.query.createFromDuplicate&&e?.query.duplicateRuleId}render(){const{hasMetricAlerts:e,organization:t,project:s,location:r,members:a}=this.props,{alertType:d}=this.state,{aggregate:c,dataset:g,eventTypes:v,createFromWizard:y,createFromDiscover:I}=r?.query??{},T={aggregate:c??D.F4.aggregate,dataset:g??D.F4.dataset,eventTypes:v??D.F4.eventTypes},Z=I?u.ZP.fromLocation(r):void 0;let b;y&&d===_.ok.METRIC&&(b=T?(0,C.k)(T):"issues");const S=(0,p.t)("New Alert Rule");return(0,x.BX)(i.Fragment,{children:[(0,x.tZ)(l.Z,{title:S,projectSlug:s.slug}),(0,x.tZ)(o.h4,{children:(0,x.BX)(o.oB,{children:[(0,x.tZ)(h.Z,{organization:t,alertName:(0,p.t)("Set Conditions"),title:b?(0,p.t)("Select Alert"):S,projectSlug:s.slug}),(0,x.tZ)(o.Dx,{children:b?`${(0,p.t)("Set Conditions for")} ${D.gb[b]}`:S})]})}),(0,x.tZ)(k,{children:(0,x.tZ)(m.Z,{provideUserTeams:!0,children:t=>{let{teams:r,initiallyLoaded:o}=t;return o?(0,x.BX)(i.Fragment,{children:[(!e||d===_.ok.ISSUE)&&(0,x.tZ)(w.Z,{...this.props,project:s,userTeamIds:r.map((e=>{let{id:t}=e;return t})),members:a}),e&&d===_.ok.METRIC&&(this.isDuplicateRule?(0,x.tZ)(R,{...this.props,eventView:Z,wizardTemplate:T,sessionId:this.sessionId,project:s,userTeamIds:r.map((e=>{let{id:t}=e;return t}))}):(0,x.tZ)(j,{...this.props,eventView:Z,wizardTemplate:T,sessionId:this.sessionId,project:s,userTeamIds:r.map((e=>{let{id:t}=e;return t}))}))]}):(0,x.tZ)(n.Z,{})}})})]})}}$.displayName="Create";const k=(0,a.Z)(o.uT,{target:"elqfs7c0"})("&&{padding:0;gap:0;}grid-template-rows:1fr;@media (min-width: ",(e=>e.theme.breakpoints.large),"){grid-template-columns:minmax(100px, auto) 400px;}"),F=(0,c.Z)($)}}]);
//# sourceMappingURL=../sourcemaps/app_views_alerts_create_tsx.72b822f2c018e03460633b0bcea48a4c.js.map