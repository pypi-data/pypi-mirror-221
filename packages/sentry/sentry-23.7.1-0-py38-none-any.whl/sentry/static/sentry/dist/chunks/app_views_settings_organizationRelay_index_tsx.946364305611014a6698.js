"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_settings_organizationRelay_index_tsx"],{"./app/components/confirmDelete.tsx":(e,t,i)=>{i.d(t,{Z:()=>p});var s=i("../node_modules/react/index.js"),a=i("./app/components/alert.tsx"),n=i("./app/components/confirm.tsx"),r=i("./app/components/forms/fieldGroup/index.tsx"),o=i("./app/components/input.tsx"),l=i("./app/locale.tsx"),d=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function c(e){let{message:t,confirmInput:i,...c}=e;return(0,d.tZ)(n.Z,{...c,bypass:!1,disableConfirmButton:!0,renderMessage:e=>{let{disableConfirmButton:n}=e;return(0,d.BX)(s.Fragment,{children:[(0,d.tZ)(a.bZ,{type:"error",children:t}),(0,d.tZ)(r.Z,{flexibleControlStateSize:!0,inline:!1,label:(0,l.t)("Please enter %s to confirm the deletion",(0,d.tZ)("code",{children:i})),children:(0,d.tZ)(o.Z,{type:"text",placeholder:i,onChange:e=>n(e.target.value!==i)})})]})}})}c.displayName="ConfirmDelete";const p=c},"./app/views/deprecatedAsyncView.tsx":(e,t,i)=>{i.d(t,{Z:()=>r});var s=i("./app/components/deprecatedAsyncComponent.tsx"),a=i("./app/components/sentryDocumentTitle.tsx"),n=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class r extends s.Z{getTitle(){return""}render(){return(0,n.tZ)(a.Z,{title:this.getTitle(),children:this.renderComponent()})}}r.displayName="DeprecatedAsyncView"},"./app/views/settings/organization/permissionAlert.tsx":(e,t,i)=>{i.d(t,{Z:()=>l});var s=i("./app/components/acl/access.tsx"),a=i("./app/components/alert.tsx"),n=i("./app/locale.tsx"),r=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function o(e){let{access:t=["org:write"],message:i=(0,n.t)("These settings can only be edited by users with the organization owner or manager role."),...o}=e;return(0,r.tZ)(s.Z,{access:t,children:e=>{let{hasAccess:t}=e;return!t&&(0,r.tZ)(a.bZ,{"data-test-id":"org-permission-alert",type:"warning",showIcon:!0,...o,children:i})}})}o.displayName="PermissionAlert";const l=o},"./app/views/settings/organizationRelay/index.tsx":(e,t,i)=>{i.r(t),i.d(t,{default:()=>De});var s=i("./app/components/acl/feature.tsx"),a=i("./app/utils/useOrganization.tsx"),n=i("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=i("../node_modules/react/index.js"),o=i("../node_modules/lodash/isEqual.js"),l=i.n(o),d=i("../node_modules/lodash/omit.js"),c=i.n(d),p=i("./app/actionCreators/indicator.tsx"),m=i("./app/actionCreators/modal.tsx"),u=i("./app/actionCreators/organizations.tsx"),h=i("./app/components/button.tsx"),y=i("./app/components/links/externalLink.tsx"),g=i("./app/icons/index.tsx"),b=i("./app/locale.tsx"),Z=i("./app/views/deprecatedAsyncView.tsx"),v=i("./app/views/settings/components/settingsPageHeader.tsx"),f=i("./app/views/settings/components/text/textBlock.tsx"),x=i("./app/views/settings/organization/permissionAlert.tsx"),w=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),k=i("./app/components/list/index.tsx"),S=i("./app/styles/space.tsx");i("../node_modules/core-js/modules/es.error.cause.js");var R=i("./app/components/forms/controls/textarea.tsx"),D=i("./app/components/forms/fieldGroup/index.tsx"),C=i("./app/components/forms/fieldGroup/fieldHelp.tsx"),z=i("./app/components/input.tsx"),K=i("./app/components/textCopyInput.tsx"),j=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function F(e){let{values:t,onChange:i,errors:s,onValidate:a,isFormValid:n,disables:r,onValidateKey:o,onSave:l}=e;const d=e=>t=>{i(e,t.target.value)};return(0,j.BX)("form",{onSubmit:()=>{n&&l()},id:"relay-form",children:[(0,j.tZ)(D.Z,{flexibleControlStateSize:!0,label:(0,b.t)("Display Name"),error:s.name,inline:!1,stacked:!0,required:!0,children:(0,j.tZ)(z.Z,{type:"text",name:"name",placeholder:(0,b.t)("Display Name"),onChange:d("name"),value:t.name,onBlur:a("name"),disabled:r.name})}),r.publicKey?(0,j.tZ)(D.Z,{flexibleControlStateSize:!0,label:(0,b.t)("Public Key"),inline:!1,stacked:!0,children:(0,j.tZ)(K.Z,{onCopy:(c=t.publicKey,()=>{navigator.clipboard.writeText(c).then((()=>{(0,p.S9)((0,b.t)("Copied to clipboard"))})).catch((()=>{(0,p.Iw)((0,b.t)("Error copying to clipboard"))}))}),children:t.publicKey})}):(0,j.BX)(B,{children:[(0,j.tZ)(V,{label:(0,b.t)("Public Key"),error:s.publicKey,flexibleControlStateSize:!0,inline:!1,stacked:!0,required:!0,children:(0,j.tZ)(z.Z,{type:"text",name:"publicKey",placeholder:(0,b.t)("Public Key"),onChange:d("publicKey"),value:t.publicKey,onBlur:o})}),(0,j.tZ)(C.Z,{children:(0,b.t)("Only enter the Public Key value from your credentials file. Never share the Secret key with Sentry or any third party")})]}),(0,j.tZ)(D.Z,{flexibleControlStateSize:!0,label:(0,b.t)("Description"),inline:!1,stacked:!0,children:(0,j.tZ)(R.Z,{name:"description",placeholder:(0,b.t)("Description"),onChange:d("description"),value:t.description,disabled:r.description,autosize:!0})})]});var c}F.displayName="Form";const N=F,B=(0,w.Z)("div",{target:"evtfjy71"})("padding-bottom:",(0,S.D)(2),";"),V=(0,w.Z)(D.Z,{target:"evtfjy70"})({name:"18g08sj",styles:"padding-bottom:0"});var _=i("./app/components/buttonBar.tsx");function T(e){let{title:t,onSave:i,content:s,disabled:a,Header:n,Body:o,Footer:l,closeModal:d,btnSaveLabel:c=(0,b.t)("Save")}=e;return(0,j.BX)(r.Fragment,{children:[(0,j.tZ)(n,{closeButton:!0,children:t}),(0,j.tZ)(o,{children:s}),(0,j.tZ)(l,{children:(0,j.BX)(_.ZP,{gap:1.5,children:[(0,j.tZ)(h.zx,{onClick:d,children:(0,b.t)("Cancel")}),(0,j.tZ)(h.zx,{onClick:e=>{e.preventDefault(),i()},disabled:a,type:"submit",priority:"primary",form:"relay-form",children:c})]})})]})}T.displayName="Modal";const A=T;class q extends r.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",this.getDefaultState()),(0,n.Z)(this,"handleChange",((e,t)=>{this.setState((i=>({values:{...i.values,[e]:t},errors:c()(i.errors,e)})))})),(0,n.Z)(this,"handleSave",(async()=>{const{onSubmitSuccess:e,closeModal:t,orgSlug:i,api:s}=this.props,a=this.getData().trustedRelays.map((e=>c()(e,["created","lastModified"])));try{e(await s.requestPromise(`/organizations/${i}/`,{method:"PUT",data:{trustedRelays:a}})),t()}catch(e){this.handleErrorResponse(function(e){const t=e.responseJSON?.trustedRelays[0];return t?"Bad structure received for Trusted Relays"===t?{type:"bad-structure",message:(0,b.t)("An invalid structure was sent.")}:"Relay key info with missing name in Trusted Relays"===t?{type:"missing-name",message:(0,b.t)("Field Required")}:"Relay key info with empty name in Trusted Relays"===t?{type:"empty-name",message:(0,b.t)("Invalid Field")}:t.startsWith("Missing public key for Relay key info with name:")?{type:"missing-key",message:(0,b.t)("Field Required")}:t.startsWith("Invalid public key for relay key info with name:")?{type:"invalid-key",message:(0,b.t)("Invalid Relay key")}:t.startsWith("Duplicated key in Trusted Relays:")?{type:"duplicated-key",message:(0,b.t)("Relay key already taken")}:{type:"unknown",message:(0,b.t)("An unknown error occurred while saving Relay public key.")}:{type:"unknown",message:(0,b.t)("An unknown error occurred while saving Relay public key.")}}(e))}})),(0,n.Z)(this,"handleValidate",(e=>()=>{const t=!this.state.values[e].replace(/\s/g,""),i=this.state.errors[e];t&&i||(!t||i?!t&&i&&this.clearError(e):this.setState((t=>({errors:{...t.errors,[e]:(0,b.t)("Field Required")}}))))})),(0,n.Z)(this,"handleValidateKey",(()=>{const{savedRelays:e}=this.props,{values:t,errors:i}=this.state;!e.find((e=>e.publicKey===t.publicKey))||i.publicKey?(i.publicKey&&this.setState({errors:c()(i,"publicKey")}),this.handleValidate("publicKey")()):this.setState({errors:{...i,publicKey:(0,b.t)("Relay key already taken")}})}))}componentDidMount(){this.validateForm()}componentDidUpdate(e,t){l()(t.values,this.state.values)||this.validateForm(),!l()(t.errors,this.state.errors)&&Object.keys(this.state.errors).length>0&&this.setValidForm(!1)}getDefaultState(){return{values:{name:"",publicKey:"",description:""},requiredValues:["name","publicKey"],errors:{},disables:{},isFormValid:!1,title:this.getTitle()}}getTitle(){return""}getData(){throw new Error("Not implemented")}getBtnSaveLabel(){}setValidForm(e){this.setState({isFormValid:e})}validateForm(){const{values:e,requiredValues:t,errors:i}=this.state,s=t.every((t=>!!e[t].replace(/\s/g,"")&&!i[t]));this.setValidForm(s)}clearError(e){this.setState((t=>({errors:c()(t.errors,e)})))}handleErrorResponse(e){switch(e.type){case"invalid-key":case"missing-key":this.setState((t=>({errors:{...t.errors,publicKey:e.message}})));break;case"empty-name":case"missing-name":this.setState((t=>({errors:{...t.errors,name:e.message}})));break;default:(0,p.Iw)(e.message)}}getForm(){const{values:e,errors:t,disables:i,isFormValid:s}=this.state;return(0,j.tZ)(N,{isFormValid:s,onSave:this.handleSave,onChange:this.handleChange,onValidate:this.handleValidate,onValidateKey:this.handleValidateKey,errors:t,values:e,disables:i})}getContent(){return this.getForm()}render(){const{title:e,isFormValid:t}=this.state,i=this.getBtnSaveLabel(),s=this.getContent();return(0,j.tZ)(A,{...this.props,title:e,onSave:this.handleSave,btnSaveLabel:i,disabled:!t,content:s})}}q.displayName="DialogManager";const E=q;var M=i("./app/components/list/listItem.tsx");const P=(0,w.Z)((e=>{let{title:t,subtitle:i,children:s,className:a}=e;return(0,j.BX)(M.Z,{className:a,children:[t,i&&(0,j.tZ)("small",{children:i}),(0,j.tZ)("div",{children:s})]})}),{target:"evrdse80"})("display:grid;gap:",(0,S.D)(1.5),";");function L(e){let{command:t}=e;return(0,j.BX)(I,{children:[(0,j.tZ)(O,{children:"$"}),t]})}L.displayName="Terminal";const X=L,I=(0,w.Z)("div",{target:"e1jmo0wm1"})("background:",(e=>e.theme.gray500),";padding:",(0,S.D)(1.5)," ",(0,S.D)(3),";font-family:",(e=>e.theme.text.familyMono),";color:",(e=>e.theme.white),";border-radius:",(e=>e.theme.borderRadius),";display:grid;grid-template-columns:max-content 1fr;gap:",(0,S.D)(.75),";"),O=(0,w.Z)("div",{target:"e1jmo0wm0"})("color:",(e=>e.theme.gray300),";"),U=class extends E{getTitle(){return(0,b.t)("Register Key")}getBtnSaveLabel(){return(0,b.t)("Register")}getData(){const{savedRelays:e}=this.props;return{trustedRelays:[...e,this.state.values]}}getContent(){return(0,j.BX)(W,{symbol:"colored-numeric",children:[(0,j.tZ)(P,{title:(0,b._N)("Initialize the configuration. [link: Learn how]",{link:(0,j.tZ)(y.Z,{href:"https://docs.sentry.io/product/relay/getting-started/#initializing-configuration"})}),subtitle:(0,b.t)("Within your terminal:"),children:(0,j.tZ)(X,{command:"relay config init"})}),(0,j.tZ)(P,{title:(0,b._N)("Go to the file [jsonFile: credentials.json] to find the public key and enter it below.",{jsonFile:(0,j.tZ)(y.Z,{href:"https://docs.sentry.io/product/relay/getting-started/#registering-relay-with-sentry"})}),children:super.getForm()})]})}},W=(0,w.Z)(k.Z,{target:"e1klwdjt0"})("display:grid;gap:",(0,S.D)(3),";"),G=class extends E{getDefaultState(){return{...super.getDefaultState(),values:{name:this.props.relay.name,publicKey:this.props.relay.publicKey,description:this.props.relay.description||""},disables:{publicKey:!0}}}getTitle(){return(0,b.t)("Edit Key")}getData(){const{savedRelays:e}=this.props,t=this.state.values;return{trustedRelays:e.map((e=>e.publicKey===t.publicKey?t:e))}}};var H=i("./app/components/emptyMessage.tsx"),$=i("./app/components/panels/panel.tsx");function Y(){return(0,j.tZ)($.Z,{children:(0,j.tZ)(H.Z,{children:(0,b.t)("No Keys Registered.")})})}Y.displayName="EmptyState";const J=Y;var Q=i("../node_modules/lodash/orderBy.js"),ee=i.n(Q),te=i("./app/components/dateTime.tsx"),ie=i("./app/components/panels/panelTable.tsx");function se(e){let{activities:t}=e;return(0,j.tZ)(ne,{headers:[(0,b.t)("Version"),(0,b.t)("First Used"),(0,b.t)("Last Used")],children:t.map((e=>{let{relayId:t,version:i,firstSeen:s,lastSeen:a}=e;return(0,j.BX)(r.Fragment,{children:[(0,j.tZ)(re,{children:i}),(0,j.tZ)(te.Z,{date:s,seconds:!1}),(0,j.tZ)(te.Z,{date:a,seconds:!1})]},t)}))})}se.displayName="ActivityList";const ae=se,ne=(0,w.Z)(ie.Z,{target:"e1jaq6n81"})("grid-template-columns:repeat(3, 2fr);@media (min-width: ",(e=>e.theme.breakpoints.large),"){grid-template-columns:2fr repeat(2, 1fr);}"),re=(0,w.Z)("div",{target:"e1jaq6n80"})({name:"kow0uz",styles:"font-variant-numeric:tabular-nums"});var oe=i("./app/components/confirmDelete.tsx"),le=i("./app/components/questionTooltip.tsx"),de=i("./app/utils/useCopyToClipboard.tsx");function ce(e){let{publicKey:t,name:i,description:s,created:a,disabled:n,onEdit:r,onDelete:o}=e;const{onClick:l}=(0,de.Z)({text:t}),d=(0,j.tZ)(h.zx,{size:"sm",icon:(0,j.tZ)(g.Fz,{}),"aria-label":(0,b.t)("Delete Key"),disabled:n,title:n?(0,b.t)("You do not have permission to delete keys"):void 0});return(0,j.BX)(ye,{children:[(0,j.BX)(me,{children:[i,s&&(0,j.tZ)(le.Z,{position:"top",size:"sm",title:s})]}),(0,j.tZ)(ue,{children:(0,b._N)("Created on [date]",{date:(0,j.tZ)(te.Z,{date:a})})}),(0,j.BX)(he,{gap:1,children:[(0,j.tZ)(h.zx,{size:"sm",icon:(0,j.tZ)(g.vU,{}),onClick:l,children:(0,b.t)("Copy Key")}),(0,j.tZ)(h.zx,{size:"sm",onClick:r(t),icon:(0,j.tZ)(g.yl,{}),"aria-label":(0,b.t)("Edit Key"),disabled:n,title:n?(0,b.t)("You do not have permission to edit keys"):void 0}),n?d:(0,j.tZ)(oe.Z,{message:(0,b.t)("After removing this Public Key, your Relay will no longer be able to communicate with Sentry and events will be dropped."),onConfirm:o(t),confirmInput:i,children:d})]})]})}ce.displayName="CardHeader";const pe=ce,me=(0,w.Z)("div",{target:"e210vq33"})("grid-row:1/2;grid-template-columns:repeat(2, max-content);display:flex;gap:",(0,S.D)(1),";align-items:center;"),ue=(0,w.Z)("div",{target:"e210vq32"})("grid-row:2/3;color:",(e=>e.theme.gray300),";font-size:",(e=>e.theme.fontSizeMedium),";"),he=(0,w.Z)(_.ZP,{target:"e210vq31"})("@media (min-width: ",(e=>e.theme.breakpoints.medium),"){grid-row:1/3;}"),ye=(0,w.Z)("div",{target:"e210vq30"})("display:grid;grid-row-gap:",(0,S.D)(.25),";margin-bottom:",(0,S.D)(1),";@media (min-width: ",(e=>e.theme.breakpoints.medium),"){grid-template-columns:1fr max-content;grid-template-rows:repeat(2, max-content);}");function ge(e){let{children:t}=e;return(0,j.tZ)(Ze,{children:t})}ge.displayName="CommandLine";const be=ge,Ze=(0,w.Z)("code",{target:"eey0se30"})("padding:",(0,S.D)(.5)," ",(0,S.D)(1),";color:",(e=>e.theme.pink400),";background:",(e=>e.theme.pink100),";border:1px solid ",(e=>e.theme.pink200),";font-family:",(e=>e.theme.text.familyMono),";font-size:",(e=>e.theme.fontSizeMedium),";white-space:nowrap;");function ve(e){let{onRefresh:t,disabled:i}=e;return(0,j.tZ)($.Z,{children:(0,j.tZ)(H.Z,{title:(0,b.t)("Waiting on Activity!"),description:i?void 0:(0,b._N)("Run relay in your terminal with [commandLine]",{commandLine:(0,j.tZ)(be,{children:"relay run"})}),action:(0,j.tZ)(h.zx,{icon:(0,j.tZ)(g.tr,{}),onClick:t,children:(0,b.t)("Refresh")})})})}ve.displayName="WaitingActivity";const fe=ve;function xe(e){let{relays:t,relayActivities:i,onRefresh:s,onDelete:a,onEdit:n,disabled:r}=e;const o=function(e,t){return e.reduce(((e,i)=>{const{name:s,description:a,created:n,publicKey:r}=i;return e.hasOwnProperty(r)||(e[r]={name:s,description:a,created:n,activities:[]}),e[r].activities.length||(e[r].activities=t.filter((e=>e.publicKey===r))),e}),{})}(ee()(t,(e=>e.created),["desc"]),i),l=e=>e.length?(0,j.tZ)(ae,{activities:e}):(0,j.tZ)(fe,{onRefresh:s,disabled:r});return(0,j.tZ)("div",{children:Object.keys(o).map((e=>{const{name:t,description:i,created:s,activities:d}=o[e];return(0,j.BX)("div",{children:[(0,j.tZ)(pe,{publicKey:e,name:t,description:i,created:s,onEdit:n,onDelete:a,disabled:r}),l(d)]},e)}))})}xe.displayName="List";const we=xe;class ke extends Z.Z{constructor(){super(...arguments),(0,n.Z)(this,"handleDelete",(e=>async()=>{const{relays:t}=this.state,i=t.filter((t=>t.publicKey!==e)).map((e=>c()(e,["created","lastModified"])));try{const e=await this.api.requestPromise(`/organizations/${this.props.organization.slug}/`,{method:"PUT",data:{trustedRelays:i}});(0,p.S9)((0,b.t)("Successfully deleted Relay public key")),this.setRelays(e.trustedRelays)}catch{(0,p.Iw)((0,b.t)("An unknown error occurred while deleting Relay public key"))}})),(0,n.Z)(this,"handleOpenEditDialog",(e=>()=>{const t=this.state.relays.find((t=>t.publicKey===e));t&&(0,m.openModal)((e=>(0,j.tZ)(G,{...e,savedRelays:this.state.relays,api:this.api,orgSlug:this.props.organization.slug,relay:t,onSubmitSuccess:e=>{this.successfullySaved(e,(0,b.t)("Successfully updated Relay public key"))}})))})),(0,n.Z)(this,"handleOpenAddDialog",(()=>{(0,m.openModal)((e=>(0,j.tZ)(U,{...e,savedRelays:this.state.relays,api:this.api,orgSlug:this.props.organization.slug,onSubmitSuccess:e=>{this.successfullySaved(e,(0,b.t)("Successfully added Relay public key"))}})))})),(0,n.Z)(this,"handleRefresh",(()=>{this.fetchData()}))}componentDidUpdate(e,t){l()(t.relays,this.state.relays)||(this.fetchData(),(0,u.FV)({...e.organization,trustedRelays:this.state.relays})),super.componentDidUpdate(e,t)}getTitle(){return(0,b.t)("Relay")}getDefaultState(){return{...super.getDefaultState(),relays:this.props.organization.trustedRelays}}getEndpoints(){const{organization:e}=this.props;return[["relayActivities",`/organizations/${e.slug}/relay_usage/`]]}setRelays(e){this.setState({relays:e})}successfullySaved(e,t){(0,p.S9)(t),this.setRelays(e.trustedRelays)}renderContent(e){const{relays:t,relayActivities:i,loading:s}=this.state;return s?this.renderLoading():t.length?(0,j.tZ)(we,{relays:t,relayActivities:i,onEdit:this.handleOpenEditDialog,onRefresh:this.handleRefresh,onDelete:this.handleDelete,disabled:e}):(0,j.tZ)(J,{})}renderBody(){const{organization:e}=this.props,t=!e.access.includes("org:write");return(0,j.BX)(r.Fragment,{children:[(0,j.tZ)(v.Z,{title:(0,b.t)("Relay"),action:(0,j.tZ)(h.zx,{title:t?(0,b.t)("You do not have permission to register keys"):void 0,priority:"primary",size:"sm",icon:(0,j.tZ)(g.N_,{size:"xs",isCircled:!0}),onClick:this.handleOpenAddDialog,disabled:t,children:(0,b.t)("Register Key")})}),(0,j.tZ)(x.Z,{}),(0,j.tZ)(f.Z,{children:(0,b._N)("Sentry Relay offers enterprise-grade data security by providing a standalone service that acts as a middle layer between your application and sentry.io. Go to [link:Relay Documentation] for setup and details.",{link:(0,j.tZ)(y.Z,{href:"https://getsentry.github.io/relay/"})})}),this.renderContent(t)]})}}const Se=ke;function Re(e){const t=(0,a.Z)();return(0,j.tZ)(s.Z,{organization:t,features:["relay"],hookName:"feature-disabled:relay",children:(0,j.tZ)(Se,{organization:t,...e})})}Re.displayName="OrganizationRelay";const De=Re}}]);
//# sourceMappingURL=../sourcemaps/app_views_settings_organizationRelay_index_tsx.a86466c4e78f327bbafbac9fcb65e0ff.js.map