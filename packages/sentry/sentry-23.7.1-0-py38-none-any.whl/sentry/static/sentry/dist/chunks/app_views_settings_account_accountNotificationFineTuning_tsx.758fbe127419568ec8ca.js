"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_settings_account_accountNotificationFineTuning_tsx"],{"./app/data/forms/accountNotificationSettings.tsx":(t,e,i)=>{i.r(e),i.d(e,{fields:()=>a,route:()=>o});var n=i("./app/locale.tsx");const o="/settings/account/notifications/",a={subscribeByDefault:{name:"subscribeByDefault",type:"boolean",label:(0,n.t)("Send Me Alerts"),help:(0,n.t)("Enable this to receive notifications for Alerts sent to your teams. You will always receive alerts configured to be sent directly to you.")},workflowNotifications:{name:"workflowNotifications",type:"radio",label:(0,n.t)("Send Me Workflow Notifications"),choices:[[0,(0,n.t)("Always")],[1,(0,n.t)("Only On Issues I Subscribe To")],[2,(0,n.t)("Never")]],help:(0,n.t)("E.g. changes in issue assignment, resolution status, and comments.")},weeklyReports:{name:"weeklyReports",type:"boolean",label:(0,n.t)("Send Me Weekly Reports"),help:(0,n.t)("Reports contain a summary of what's happened within your organization."),disabled:!0},deployNotifications:{name:"deployNotifications",type:"radio",label:(0,n.t)("Send Me Deploy Notifications"),choices:[[2,(0,n.t)("Always")],[3,(0,n.t)("Only On Deploys With My Commits")],[4,(0,n.t)("Never")]],help:(0,n.t)("Deploy emails include release, environment and commit overviews.")},personalActivityNotifications:{name:"personalActivityNotifications",type:"boolean",label:(0,n.t)("Notify Me About My Own Activity"),help:(0,n.t)("Enable this to receive notifications about your own actions on Sentry.")},selfAssignOnResolve:{name:"selfAssignOnResolve",type:"boolean",label:(0,n.t)("Claim Unassigned Issues I've Resolved"),help:(0,n.t)("You'll receive notifications about any changes that happen afterwards.")}}},"./app/views/deprecatedAsyncView.tsx":(t,e,i)=>{i.d(e,{Z:()=>s});var n=i("./app/components/deprecatedAsyncComponent.tsx"),o=i("./app/components/sentryDocumentTitle.tsx"),a=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class s extends n.Z{getTitle(){return""}render(){return(0,a.tZ)(o.Z,{title:this.getTitle(),children:this.renderComponent()})}}s.displayName="DeprecatedAsyncView"},"./app/views/settings/account/accountNotificationFineTuning.tsx":(t,e,i)=>{i.r(e),i.d(e,{default:()=>J});var n=i("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=(i("../node_modules/core-js/modules/es.array.push.js"),i("../node_modules/react/index.js")),s=i("./app/components/emptyMessage.tsx"),r=i("./app/components/forms/fields/selectField.tsx"),l=i("./app/components/forms/form.tsx"),c=i("./app/components/forms/jsonForm.tsx"),p=i("./app/components/pagination.tsx"),u=i("./app/components/panels/panel.tsx"),d=i("./app/components/panels/panelBody.tsx"),g=i("./app/components/panels/panelHeader.tsx"),h=i("./app/data/forms/accountNotificationSettings.tsx"),m=i("./app/locale.tsx"),f=i("./app/utils/withOrganizations.tsx"),y=i("./app/views/deprecatedAsyncView.tsx");const Z={alerts:{title:(0,m.t)("Issue Alert Notifications"),description:(0,m.t)("Notifications from Alert Rules that your team has setup. Youâ€™ll always receive notifications from Alerts configured to be sent directly to you."),type:"select",options:[{value:"-1",label:(0,m.t)("Default")},{value:"1",label:(0,m.t)("On")},{value:"0",label:(0,m.t)("Off")}],defaultValue:"-1",defaultFieldName:"subscribeByDefault"},workflow:{title:(0,m.t)("Workflow Notifications"),description:(0,m.t)("Control workflow notifications, e.g. changes in issue assignment, resolution status, and comments."),type:"select",options:[{value:"-1",label:(0,m.t)("Default")},{value:"0",label:(0,m.t)("Always")},{value:"1",label:(0,m.t)("Only on issues I subscribe to")},{value:"2",label:(0,m.t)("Never")}],defaultValue:"-1",defaultFieldName:"workflowNotifications"},deploy:{title:(0,m.t)("Deploy Notifications"),description:(0,m.t)("Control deploy notifications that include release, environment, and commit overviews."),type:"select",options:[{value:"-1",label:(0,m.t)("Default")},{value:"2",label:(0,m.t)("Always")},{value:"3",label:(0,m.t)("Only on deploys with my commits")},{value:"4",label:(0,m.t)("Never")}],defaultValue:"-1",defaultFieldName:"deployNotifications"},reports:{title:(0,m.t)("Weekly Reports"),description:(0,m.t)("Reports contain a summary of what's happened within the organization."),type:"select",defaultValue:"1",options:[{value:"1",label:(0,m.t)("On")},{value:"0",label:(0,m.t)("Off")}],defaultFieldName:"weeklyReports"},approval:{title:(0,m.t)("Approvals"),description:(0,m.t)("Notifications from teammates that require review or approval."),type:"select"},quota:{title:(0,m.t)("Quota Notifications"),description:(0,m.t)("Control the notifications you receive for error, transaction, and attachment quota limits."),type:"select"},spikeProtection:{title:(0,m.t)("Spike Protection Notifications"),description:(0,m.t)("Notifications about spikes on projects that you have enabled spike protection for."),type:"select",defaultValue:"1",options:[{value:"1",label:(0,m.t)("On")},{value:"0",label:(0,m.t)("Off")}],defaultFieldName:"spikeProtection"},email:{title:(0,m.t)("Email Routing"),description:(0,m.t)("On a per project basis, route emails to an alternative email address."),type:"select"}};var b=i("./app/components/deprecatedAsyncComponent.tsx"),v=i("./app/components/forms/controls/selectControl.tsx"),S=i("./app/components/sentryDocumentTitle.tsx"),w=i("./app/utils/analytics.tsx"),j=i("./app/views/settings/account/notifications/constants.tsx"),x=i("./app/views/settings/account/notifications/fields2.tsx"),z=i("./app/utils.tsx"),k=i("./app/views/settings/account/notifications/utils.tsx"),T=i("./app/views/settings/components/defaultSearchBar.tsx"),O=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class N extends b.Z{constructor(){super(...arguments),(0,n.Z)(this,"getProjectCount",(()=>{const{notificationType:t,notificationSettings:e}=this.props;return Object.values(e[t]?.project||{}).length})),(0,n.Z)(this,"getGroupedProjects",(()=>{const{projects:t}=this.state;return Object.fromEntries(Object.values((0,k.uI)((0,z.Mx)(t))).map((t=>{let{organization:e,projects:i}=t;return[`${e.name} Projects`,i]})))})),(0,n.Z)(this,"handleOrgChange",(t=>{this.props.handleOrgChange(t),setTimeout((()=>this.reloadData()),0)}))}getDefaultState(){return{...super.getDefaultState(),projects:[]}}getEndpoints(){return[["projects","/projects/",{query:{organizationId:this.props.organizationId}}]]}renderBody(){const{notificationType:t,notificationSettings:e,onChange:i,onSubmitSuccess:n}=this.props,{projects:o,projectsPageLinks:r}=this.state,c=this.getProjectCount()>=j.Zb,u=o.length>=j.sg;return(0,O.BX)(a.Fragment,{children:[(0,O.BX)(g.Z,{children:[(0,O.tZ)(V,{organizations:this.props.organizations,organizationId:this.props.organizationId,handleOrgChange:this.handleOrgChange}),c&&this.renderSearchInput({stateKey:"projects",url:`/projects/?organizationId=${this.props.organizationId}`,placeholder:(0,m.t)("Search Projects"),children:t=>{let{defaultSearchBar:e}=t;return(0,O.tZ)(P,{children:e})}})]}),(0,O.tZ)(d.Z,{children:(0,O.tZ)(l.Z,{saveOnBlur:!0,apiMethod:"PUT",apiEndpoint:"/users/me/notification-settings/",initialData:(0,k.tl)(t,e,o),onSubmitSuccess:n,children:0===o.length?(0,O.tZ)(s.Z,{children:(0,m.t)("No projects found")}):Object.entries(this.getGroupedProjects()).map((n=>{let[o,a]=n;return(0,O.tZ)(I,{collapsible:!0,fields:a.map((n=>(0,k.gw)(t,e,n,i)))},o)}))})}),c&&u&&(0,O.tZ)(p.Z,{pageLinks:r,...this.props})]})}}const D=N,P=(0,o.Z)(T._,{target:"e4ddg0o1"})({name:"1ekhw56",styles:"*{width:100%;}"}),I=(0,o.Z)(c.Z,{target:"e4ddg0o0"})(u.Z,"{border:0;margin-bottom:0;}");function B(t){let{notificationType:e,notificationSettings:i,onChange:n,onSubmitSuccess:o,organizations:a}=t;return(0,O.tZ)(l.Z,{saveOnBlur:!0,apiMethod:"PUT",apiEndpoint:"/users/me/notification-settings/",initialData:(0,k.tl)(e,i,a),onSubmitSuccess:o,children:(0,O.tZ)(I,{title:(0,m.t)("Organizations"),fields:a.map((t=>(0,k.gw)(e,i,t,n)))})})}B.displayName="NotificationSettingsByOrganization";const C=(0,f.Z)(B);var F=i("./app/components/alert.tsx");function _(t){let{organizations:e}=t;return(0,O.BX)(A,{type:"warning",showIcon:!0,children:[(0,m.t)("You've selected Slack as your delivery method, but do not have a linked account for the following organizations. You'll receive email notifications instead until you type \"/sentry link\" into your Slack workspace to link your account. If slash commands are not working, please re-install the Slack integration."),(0,O.tZ)("ul",{children:e.map((t=>(0,O.tZ)("li",{children:t.slug},t.id)))})]})}_.displayName="UnlinkedAlert";const A=(0,o.Z)(F.bZ,{target:"e1mzr5km0"})({name:"12jd8yt",styles:"margin:20px 0px"}),E=_;var q=i("./app/views/settings/components/settingsPageHeader.tsx"),M=i("./app/views/settings/components/text/textBlock.tsx");function V(t){let{handleOrgChange:e,organizationId:i,organizations:n}=t;return(0,O.BX)(a.Fragment,{children:[(0,m.t)("Settings for Organization"),(0,O.tZ)(v.Z,{options:n.map((t=>({label:t.name,value:t.id}))),onChange:e,value:i,styles:{container:t=>({...t,minWidth:"300px"})}})]})}V.displayName="OrganizationSelectHeader";const R={quota:["quotaErrors","quotaTransactions","quotaAttachments","quotaReplays","quotaWarnings","quotaSpendAllocations"]},U=t=>t in R?null:{type:t};class X extends b.Z{constructor(){super(...arguments),(0,n.Z)(this,"getStateToPutForProvider",(t=>{const{notificationType:e}=this.props,{notificationSettings:i}=this.state,n=(0,k.E2)(e,i,t);return this.setState({notificationSettings:(0,k.r_)(i,n)}),n})),(0,n.Z)(this,"getStateToPutForDependentSetting",((t,e)=>{const i=t[e],{notificationSettings:n}=this.state,o={[e]:{user:{me:j.rn.reduce(((t,e)=>(t[e]=i,t)),{})}}};return this.setState({notificationSettings:(0,k.r_)(n,o)}),o})),(0,n.Z)(this,"getStateToPutForDefault",(t=>{const{notificationType:e}=this.props,{notificationSettings:i}=this.state,n=(0,k.zD)(e,i,t,(0,k.Vy)(e,i));return this.setState({notificationSettings:(0,k.r_)(i,n)}),n})),(0,n.Z)(this,"getStateToPutForParent",((t,e)=>{const{notificationType:i}=this.props,{notificationSettings:n}=this.state,o=(0,k.O0)(i,n,t,e);return this.setState({notificationSettings:(0,k.r_)(n,o)}),o})),(0,n.Z)(this,"getUnlinkedOrgs",(()=>{const{organizations:t}=this.props,{identities:e,organizationIntegrations:i}=this.state,n=Object.fromEntries(i.map((t=>[t.organizationId,t.externalId]))),o=Object.fromEntries(e.map((t=>[t?.identityProvider?.externalId,t])));return t.filter((t=>{const e=n[t.id];return null==o[e]}))})),(0,n.Z)(this,"handleOrgChange",(t=>{this.setState({organizationId:t.value})}))}getDefaultState(){return{...super.getDefaultState(),notificationSettings:{},identities:[],organizationIntegrations:[],organizationId:null}}getEndpoints(){const{notificationType:t}=this.props;return[["notificationSettings","/users/me/notification-settings/",{query:U(t),v2:"serializer"}],["identities","/users/me/identities/",{query:{provider:"slack"}}],["organizationIntegrations","/users/me/organization-integrations/",{query:{provider:"slack"}}]]}componentDidMount(){super.componentDidMount(),(0,w.Gi)("notification_settings.tuning_page_viewed",{organization:null,notification_type:this.props.notificationType})}trackTuningUpdated(t){(0,w.Gi)("notification_settings.updated_tuning_setting",{organization:null,notification_type:this.props.notificationType,tuning_field_type:t})}getInitialData(){const{notificationType:t}=this.props,{notificationSettings:e}=this.state,i=(0,k.iy)(t,e)?["email","slack"]:(0,k.xy)(t,e),n=R[t]||[],o=Object.fromEntries(n.map((t=>[t,(0,k.hx)(t,e)])));return{[t]:(0,k.hx)(t,e),provider:i,...o}}getFields(){const{notificationType:t}=this.props,{notificationSettings:e}=this.state,i=(0,k.yB)(t)?(0,m.t)("This is the default for all projects."):(0,m.t)("This is the default for all organizations."),n=Object.assign({},x.u[t],{help:i,getData:t=>this.getStateToPutForDefault(t)});(0,k.Vi)(t,e)&&(n.confirm={never:j.Y5});const o=[n];return(0,k.iy)(t,e)||o.push(Object.assign({help:(0,m.t)("Where personal notifications will be sent."),getData:t=>this.getStateToPutForProvider(t)},x.u.provider)),"quota"!==t||(0,k.iy)(t,e)||o.push(...x.i.map((t=>({...t,type:"select",getData:e=>this.getStateToPutForDependentSetting(e,t.name)})))),o}renderBody(){const{notificationType:t}=this.props,{notificationSettings:e}=this.state,i=(0,k.xy)(t,e).includes("slack"),n=this.getUnlinkedOrgs(),{title:o,description:s}=Z[t];return(0,O.BX)(a.Fragment,{children:[(0,O.tZ)(S.Z,{title:o}),(0,O.tZ)(q.Z,{title:o}),s&&(0,O.tZ)(M.Z,{children:s}),i&&n.length>0&&(0,O.tZ)(E,{organizations:n}),(0,O.tZ)(l.Z,{saveOnBlur:!0,apiMethod:"PUT",apiEndpoint:"/users/me/notification-settings/",initialData:this.getInitialData(),onSubmitSuccess:()=>this.trackTuningUpdated("general"),children:(0,O.tZ)(c.Z,{title:(0,k.yB)(t)?(0,m.t)("All Projects"):(0,m.t)("All Organizations"),fields:this.getFields()})}),!(0,k.iy)(t,e)&&(0,O.tZ)(u.Z,{children:(0,k.yB)(t)?(0,O.tZ)(D,{notificationType:t,notificationSettings:e,onChange:this.getStateToPutForParent,onSubmitSuccess:()=>this.trackTuningUpdated("project"),organizations:this.props.organizations,organizationId:this.state.organizationId,handleOrgChange:this.handleOrgChange}):(0,O.tZ)(C,{notificationType:t,notificationSettings:e,onChange:this.getStateToPutForParent,onSubmitSuccess:()=>this.trackTuningUpdated("organization")})})]})}}const W=(0,f.Z)(X),$=(0,o.Z)(d.Z,{target:"e1a4qntk1"})("font-size:1rem;&:not(:last-child){border-bottom:1px solid ",(t=>t.theme.innerBorder),";}"),Y=["alerts","deploy","workflow","approval","quota","spikeProtection"];function G(t){let{projects:e,field:i}=t;const n=(0,k.uI)(e),{title:o,description:s,...l}=i,c=Object.values(n).map((t=>({name:t.organization.name,projects:t.projects.map((t=>({...l,name:t.id,label:t.slug})))})));return(0,O.tZ)(a.Fragment,{children:c.map((t=>{let{name:e,projects:i}=t;return(0,O.tZ)("div",{children:i.map((t=>(0,O.tZ)($,{children:(0,O.tZ)(r.Z,{defaultValue:t.defaultValue,name:t.name,options:t.options,label:t.label})},t.name)))},e)}))})}function L(t){let{organizations:e,field:i}=t;const{title:n,description:o,...s}=i,l=e.map((t=>({...s,name:t.id,label:t.slug})));return(0,O.tZ)(a.Fragment,{children:l.map((t=>(0,O.tZ)($,{children:(0,O.tZ)(r.Z,{defaultValue:t.defaultValue,name:t.name,options:t.options,label:t.label})},t.name)))})}G.displayName="AccountNotificationsByProject",L.displayName="AccountNotificationsByOrganization";const H=(0,f.Z)(L);class K extends y.Z{constructor(){super(...arguments),(0,n.Z)(this,"handleOrgChange",(t=>{this.setState({organizationId:t.value});const e=this;setTimeout((()=>{e.reloadData()}),0)}))}getDefaultState(){return{...super.getDefaultState(),emails:[],fineTuneData:null,notifications:[],projects:[],organizationId:null}}getEndpoints(){const{fineTuneType:t}=this.props.params,e=(0,k.$s)(t),i=[["notifications","/users/me/notifications/"],["fineTuneData",`/users/me/notifications/${e}/`]];if((0,k.yB)(e)&&this.props.organizations.length>0){const t=this.state?.organizationId||this.props.organizations[0].id;i.push(["projects",`/projects/?organization_id=${t}`])}return i.push(["emails","/users/me/emails/"]),"email"===e&&i.push(["emails","/users/me/emails/"]),i}get emailChoices(){return this.state.emails?.filter((t=>{let{isVerified:e}=t;return e}))?.sort(((t,e)=>t.isPrimary?-1:e.isPrimary?1:t.email<e.email?-1:1))??[]}renderBody(){const{params:t}=this.props,{fineTuneType:e}=t,i=(0,k.$s)(e);if(Y.includes(i))return(0,O.tZ)(W,{notificationType:i});const{notifications:n,projects:o,fineTuneData:r,projectsPageLinks:f}=this.state,y=(0,k.yB)(i)&&this.props.organizations.length>0,b=Z[i],{title:v,description:S}=b,[w,j]=y?this.getEndpoints()[2]:[],x=!!o?.length;return"email"===i&&(b.options=this.emailChoices.map((t=>{let{email:e}=t;return{value:e,label:e}}))),n&&r?(0,O.BX)("div",{children:[(0,O.tZ)(q.Z,{title:v}),S&&(0,O.tZ)(M.Z,{children:S}),b&&b.defaultFieldName&&"weeklyReports"!==b.defaultFieldName&&(0,O.tZ)(l.Z,{saveOnBlur:!0,apiMethod:"PUT",apiEndpoint:"/users/me/notifications/",initialData:n,children:(0,O.tZ)(c.Z,{title:`Default ${v}`,fields:[h.fields[b.defaultFieldName]]})}),(0,O.BX)(u.Z,{children:[(0,O.tZ)(g.Z,{hasButtons:y,children:y?(0,O.BX)(a.Fragment,{children:[(0,O.tZ)(V,{organizations:this.props.organizations,organizationId:this.state.organizationId||"",handleOrgChange:this.handleOrgChange}),this.renderSearchInput({placeholder:(0,m.t)("Search Projects"),url:j,stateKey:w})]}):(0,O.tZ)(Q,{children:(0,m.t)("Organizations")})}),(0,O.tZ)(d.Z,{children:(0,O.BX)(l.Z,{saveOnBlur:!0,apiMethod:"PUT",apiEndpoint:`/users/me/notifications/${i}/`,initialData:r,children:[y&&x&&(0,O.tZ)(G,{projects:o,field:b}),y&&!x&&(0,O.tZ)(s.Z,{children:(0,m.t)("No projects found")}),!y&&(0,O.tZ)(H,{field:b})]})})]}),o&&(0,O.tZ)(p.Z,{pageLinks:f,...this.props})]}):null}}const Q=(0,o.Z)("div",{target:"e1a4qntk0"})({name:"82a6rk",styles:"flex:1"}),J=(0,f.Z)(K)},"./app/views/settings/components/defaultSearchBar.tsx":(t,e,i)=>{i.d(e,{_:()=>a});var n=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=i("./app/styles/space.tsx");const a=(0,n.Z)("div",{target:"e1wlcrsk0"})("display:flex;grid-template-columns:1fr max-content;gap:",(0,o.D)(1.5),";margin-top:",(0,o.D)(4),";margin-bottom:",(0,o.D)(1.5),";position:relative;")}}]);
//# sourceMappingURL=../sourcemaps/app_views_settings_account_accountNotificationFineTuning_tsx.6202691f1b7d8a90f2fe53c48a200580.js.map