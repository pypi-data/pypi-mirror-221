"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_projectInstall_issueAlertOptions_tsx"],{"./app/views/projectInstall/issueAlertOptions.tsx":(t,e,s)=>{s.d(e,{AQ:()=>v,FZ:()=>y,Jw:()=>g,ZP:()=>w,rq:()=>_});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(s("../node_modules/core-js/modules/es.error.cause.js"),s("../node_modules/react/index.js")),r=s("../node_modules/@sentry/browser/node_modules/@sentry/core/esm/exports.js"),a=s("../node_modules/lodash/isEqual.js"),o=s.n(a),l=s("./app/components/deprecatedAsyncComponent.tsx"),d=s("./app/components/forms/controls/radioGroup.tsx"),c=s("./app/components/forms/controls/selectControl.tsx"),p=s("./app/components/input.tsx"),u=s("./app/components/layouts/thirds.tsx"),h=s("./app/locale.tsx"),E=s("./app/styles/space.tsx"),m=s("./app/utils/withOrganization.tsx"),S=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");let g,v;!function(t){t[t.ERRORS=0]="ERRORS",t[t.USERS=1]="USERS"}(g||(g={})),function(t){t[t.ALERT_ON_EVERY_ISSUE=0]="ALERT_ON_EVERY_ISSUE",t[t.CUSTOMIZED_ALERTS=1]="CUSTOMIZED_ALERTS",t[t.CREATE_ALERT_LATER=2]="CREATE_ALERT_LATER"}(v||(v={}));const R="sentry.rules.conditions.event_frequency.EventUniqueUserFrequencyCondition",A="sentry.rules.conditions.event_frequency.EventFrequencyCondition",_="sentry.rules.conditions.event_frequency.EventFrequencyPercentCondition",y="sentry.rules.conditions.reappeared_event.ReappearedEventCondition",f={id:"sentry.mail.actions.NotifyEmailAction",targetType:"IssueOwners"},b={[g.ERRORS]:A,[g.USERS]:R};function T(t,e,s){let n;switch(e){case g.ERRORS:n=A;break;case g.USERS:n=R;break;default:throw new RangeError("Supplied metric value is not handled")}return{interval:t,id:n,value:s}}class C extends l.Z{getDefaultState(){return{...super.getDefaultState(),conditions:[],intervalChoices:[],alertSetting:this.props.alertSetting??v.ALERT_ON_EVERY_ISSUE.toString(),metric:this.props.metric??g.ERRORS,interval:this.props.interval??"",threshold:this.props.threshold??""}}getAvailableMetricOptions(){return[{value:g.ERRORS,label:(0,h.t)("occurrences of")},{value:g.USERS,label:(0,h.t)("users affected by")}].filter((t=>{let{value:e}=t;return this.state.conditions?.some?.((t=>t?.id===b[e]))}))}getIssueAlertsChoices(t){const e=[v.CUSTOMIZED_ALERTS.toString(),(0,S.BX)(x,{onClick:t=>{t.preventDefault();const e=v.CUSTOMIZED_ALERTS.toString();this.setStateAndUpdateParents({alertSetting:e})},children:[(0,h.t)("When there are more than"),(0,S.tZ)(Z,{type:"number",min:"0",name:"",placeholder:"10",value:this.state.threshold,onChange:t=>this.setStateAndUpdateParents({threshold:t.target.value}),"data-test-id":"range-input"}),(0,S.tZ)(O,{value:this.state.metric,options:this.getAvailableMetricOptions(),onChange:t=>this.setStateAndUpdateParents({metric:t.value})}),(0,h.t)("a unique error in"),(0,S.tZ)(O,{value:this.state.interval,options:this.state.intervalChoices?.map((t=>{let[e,s]=t;return{value:e,label:s}})),onChange:t=>this.setStateAndUpdateParents({interval:t.value})})]},v.CUSTOMIZED_ALERTS)];return[[v.ALERT_ON_EVERY_ISSUE.toString(),(0,h.t)("Alert me on every new issue")],...t?[e]:[],[v.CREATE_ALERT_LATER.toString(),(0,h.t)("I'll create my own alerts later")]].map((t=>{let[e,s]=t;return[e,(0,S.tZ)(q,{children:s},e)]}))}getUpdatedData(){let t,e;switch(parseInt(this.state.alertSetting,10)){case v.ALERT_ON_EVERY_ISSUE:t=!0,e=!1;break;case v.CREATE_ALERT_LATER:t=!1,e=!1;break;case v.CUSTOMIZED_ALERTS:t=!1,e=!0;break;default:throw new RangeError("Supplied alert creation action is not handled")}return{defaultRules:t,shouldCreateCustomRule:e,name:"Send a notification for new issues",conditions:this.state.interval.length>0&&this.state.threshold.length>0?[T(this.state.interval,this.state.metric,this.state.threshold)]:void 0,actions:[{...f,...this.props.organization.features.includes("issue-alert-fallback-targeting")?{fallthroughType:"ActiveMembers"}:{}}],actionMatch:"all",frequency:5}}setStateAndUpdateParents(t){this.setState(t,(()=>{this.props.onChange(this.getUpdatedData())}))}getEndpoints(){return[["conditions",`/projects/${this.props.organization.slug}/rule-conditions/`]]}onLoadAllEndpointsSuccess(){const t=this.state.conditions?.filter?.((t=>Object.values(b).includes(t?.id)));if(!t||0===t.length)return void this.setStateAndUpdateParents({conditions:void 0});const{intervalChoices:e,interval:s}=function(t){const e=t.map((t=>t.formFields?.interval?.choices)).reduce(((t,e)=>t&&e&&o()(t,e)?t:null));return{intervalChoices:e,interval:e?.[0]?.[0]}}(t);if(!e||!s)return r.$e((t=>{t.setExtra("props",this.props),t.setExtra("state",this.state),r.Tb(new Error("Interval choices or sent from API endpoint is inconsistent or empty"))})),void this.setStateAndUpdateParents({conditions:void 0});const n=this.props.interval&&e.some((t=>t[0]===this.props.interval))?this.props.interval:s;this.setStateAndUpdateParents({conditions:t,intervalChoices:e,interval:n})}renderBody(){const t=this.getIssueAlertsChoices(this.state.conditions?.length>0);return(0,S.BX)(i.Fragment,{children:[(0,S.tZ)(L,{withMargins:!0,children:(0,h.t)("2. Set your alert frequency")}),(0,S.tZ)(U,{children:(0,S.tZ)(I,{choices:t,label:(0,h.t)("Options for creating an alert"),onChange:t=>this.setStateAndUpdateParents({alertSetting:t}),value:this.state.alertSetting})})]})}}const w=(0,m.Z)(C),U=(0,n.Z)("div",{target:"e1ypwq0i6"})("padding-top:",(0,E.D)(2),";padding-bottom:",(0,E.D)(4),";"),x=(0,n.Z)("div",{target:"e1ypwq0i5"})("display:grid;grid-template-columns:repeat(5, max-content);gap:",(0,E.D)(1),";align-items:center;"),Z=(0,n.Z)(p.Z,{target:"e1ypwq0i4"})({name:"m0jwvv",styles:"width:80px"}),O=(0,n.Z)(c.Z,{target:"e1ypwq0i3"})({name:"efbx4f",styles:"width:160px"}),I=(0,n.Z)(d.Z,{target:"e1ypwq0i2"})("margin-bottom:",(0,E.D)(2),";"),L=(0,n.Z)(u.Dx,{target:"e1ypwq0i1"})("margin-top:65px;margin-bottom:0;padding-bottom:",(0,E.D)(3),";border-bottom:1px solid rgba(0, 0, 0, 0.1);"),q=(0,n.Z)("div",{target:"e1ypwq0i0"})({name:"p9mutn",styles:"min-height:35px;display:flex;flex-direction:column;justify-content:center"})}}]);
//# sourceMappingURL=../sourcemaps/app_views_projectInstall_issueAlertOptions_tsx.492cbc754a5d43ea64b3ca049f0c8321.js.map