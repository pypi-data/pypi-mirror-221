"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_group_tagFacets_index_tsx"],{"./app/components/group/tagFacets/index.tsx":(e,t,a)=>{a.d(t,{$c:()=>b,Ix:()=>z,Pf:()=>k,Rj:()=>w,V6:()=>D,WN:()=>$,ZP:()=>j});var i=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=a("../node_modules/react/index.js"),s=a("../node_modules/lodash/keyBy.js"),n=a.n(s),r=a("./app/components/loadingError.tsx"),l=a("./app/components/placeholder.tsx"),d=a("./app/components/sidebarSection.tsx"),p=a("./app/components/tooltip.tsx"),c=a("./app/icons/index.tsx"),u=a("./app/locale.tsx"),g=a("./app/styles/space.tsx"),m=a("./app/utils/formatters.tsx"),h=a("./app/utils/queryString.tsx"),x=a("./app/utils/useLocation.tsx"),Z=a("./app/utils/useOrganization.tsx"),f=a("./app/views/issueDetails/utils.tsx"),y=a("./app/components/group/tagFacets/tagFacetsDistributionMeter.tsx"),v=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const b=["device","device.class","os","release","environment","transaction"],w=["browser","transaction","release","url","environment"],k=["transaction","url","user","release","organization.slug"],D=["transaction","environment","release"];function z(e){const t={};return Object.keys(e).forEach((a=>{t[a]="release"===a?{...e[a],topValues:e[a].topValues.map((e=>({...e,name:(0,m.ko)(e.name)})))}:"device"===a?{...e[a],topValues:e[a].topValues.map((e=>({...e,name:e.readable??e.name})))}:e[a]})),t}function j(e){let{tagKeys:t,environments:a,groupId:i,tagFormatter:s,project:d}=e;const p=(0,Z.Z)(),{isLoading:c,isError:g,data:m,refetch:h}=(0,f.by)({groupId:i,environment:a}),x=(0,o.useMemo)((()=>{if(!m)return{};const e=n()(m,"key"),t=s?.(e)??e;return p.features.includes("device-classification")||delete t["device.class"],t}),[m,s,p]),y=t.filter((e=>Object.keys(x).includes(e))),b=Object.keys(x).filter((e=>!t.includes(e))).sort();return c?(0,v.tZ)(_,{children:(0,v.BX)(O,{children:[(0,v.tZ)(l.Z,{height:"40px"}),(0,v.tZ)(l.Z,{height:"40px"}),(0,v.tZ)(l.Z,{height:"40px"}),(0,v.tZ)(l.Z,{height:"40px"})]})}):g?(0,v.tZ)(_,{children:(0,v.tZ)(r.Z,{message:(0,u.t)("There was an error loading tags for this issue."),onRetry:h})}):(0,v.tZ)(_,{children:(0,v.tZ)(o.Fragment,{children:0===Object.keys(x).length?(0,v.tZ)(S,{"data-test-id":"no-tags",children:a.length?(0,u.t)("No tags found in the selected environments"):(0,u.t)("No tags found")}):(0,v.BX)(T,{children:[(0,v.tZ)("span",{"data-test-id":"top-distribution-wrapper",children:(0,v.tZ)(F,{groupId:i,organization:p,project:d,tagKeys:y,tagsData:x,expandFirstTag:!0})}),(0,v.tZ)(F,{groupId:i,organization:p,project:d,tagKeys:b,tagsData:x})]})})})}function _(e){let{children:t}=e;return(0,v.BX)(d.Eq,{children:[(0,v.BX)(d.Dx,{children:[(0,u.t)("All Tags"),(0,v.tZ)(B,{children:(0,v.tZ)(p.u,{title:(0,u.t)("The tags associated with all events in this issue"),disableForVisualTest:!0,children:(0,v.tZ)(c.BS,{size:"sm",color:"gray200"})})})]}),t]})}function F(e){let{groupId:t,organization:a,project:i,tagKeys:o,tagsData:s,expandFirstTag:n}=e;const r=(0,x.T)(),l={...r.query};return(0,v.tZ)($,{children:o.map(((e,o)=>{const d=s[e],p=d?d.topValues:[],c=d?d.totalValues:0,u=`/organizations/${a.slug}/issues/${t}/tags/${e}/?referrer=tag-distribution-meter`,g=`/organizations/${a.slug}/issues/${t}/events/`,m=p?p.map((t=>{const a={...r,query:{...l,query:(0,h.os)(null,e,t.value)},pathname:g};return{...t,url:a}})):[];return(0,v.tZ)("li",{"aria-label":e,children:(0,v.tZ)(y.Z,{title:e,totalValues:c,segments:m,onTagClick:()=>{},project:i,expandByDefault:n&&0===o,otherUrl:u})},e)}))})}j.displayName="TagFacets",_.displayName="WrapperWithTitle",F.displayName="TagFacetsDistributionMeterWrapper";const O=(0,i.Z)("div",{target:"e1dti8s94"})("display:grid;gap:",(0,g.D)(1),";grid-auto-flow:row;margin-top:",(0,g.D)(1),";"),T=(0,i.Z)("div",{target:"e1dti8s93"})("margin-top:",(0,g.D)(2),";"),S=(0,i.Z)("p",{target:"e1dti8s92"})("margin-top:",(0,g.D)(.5),";"),$=(0,i.Z)("ol",{target:"e1dti8s91"})("list-style:none;padding:0;margin:0 0 ",(0,g.D)(2),";"),B=(0,i.Z)("span",{target:"e1dti8s90"})("vertical-align:middle;padding-left:",(0,g.D)(.5),";")},"./app/components/group/tagFacets/tagFacetsDistributionMeter.tsx":(e,t,a)=>{a.d(t,{Z:()=>z});var i=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(a("../node_modules/core-js/modules/es.array.push.js"),a("../node_modules/react/index.js")),s=a("../node_modules/@emotion/is-prop-valid/dist/is-prop-valid.browser.esm.js"),n=a("../node_modules/framer-motion/dist/es/render/dom/motion.mjs"),r=a("../node_modules/lodash/debounce.js"),l=a.n(r),d=a("./app/components/button.tsx"),p=a("./app/components/links/link.tsx"),c=a("./app/components/tooltip.tsx"),u=a("./app/icons/iconChevron.tsx"),g=a("./app/locale.tsx"),m=a("./app/styles/space.tsx"),h=a("./app/utils.tsx"),x=a("./app/utils/analytics.tsx"),Z=a("./app/utils/platform.tsx"),f=a("./app/utils/queryString.tsx"),y=a("./app/utils/useLocation.tsx"),v=a("./app/utils/useOrganization.tsx"),b=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const w=["#402A65","#694D99","#9A81C4","#BBA6DF","#EAE2F8"],k=l()((e=>{let{tag:t,value:a,platform:i,is_mobile:o,organization:s}=e;(0,x.Gi)("issue_group_details.tags.bar.hovered",{tag:t,value:a,platform:i,is_mobile:o,organization:s})}),300);function D(e){let{colors:t=w,segments:a,title:i,totalValues:s,onTagClick:n,project:r,expandByDefault:l,otherUrl:d}=e;const m=(0,y.T)(),D=(0,v.Z)(),[z,W]=(0,o.useState)(!!l),[L,K]=(0,o.useState)(null),P=a.slice(0,4),G=P.reduce(((e,t)=>e+t.count),0),Q=G<s,R=(0,f.u3)(m.query.query,i,P.map((e=>{let{value:t}=e;return t}))),U={...m,query:{...m.query,query:R}};return Q&&P.push({isOther:!0,name:(0,g.t)("Other"),value:"other",count:s-G,url:d??U??""}),(0,b.tZ)(j,{children:(0,b.BX)("details",{open:!0,"aria-expanded":z,onClick:e=>e.preventDefault(),children:[(0,b.tZ)(I,{children:(0,b.BX)(_,{clickable:!0,onClick:()=>W(!z),children:[!Array.isArray(a)||a.length<=0?(0,b.tZ)(O,{children:(0,b.tZ)(T,{children:i})}):(0,b.BX)(O,{children:[(0,b.tZ)(T,{children:i}),(0,b.tZ)(c.u,{skipWrapper:!0,delay:800,title:P[0].name||(0,g.t)("n/a"),children:(0,b.tZ)(S,{children:P[0].name||(0,g.t)("n/a")})}),(0,b.tZ)(X,{borderless:!0,size:"zero",icon:(0,b.tZ)(u.g,{direction:z?"up":"down",size:"xs"}),"aria-label":(0,g.t)("%s %s tag distribution",z?"Collapse":"Expand",i)})]}),0===s?(0,b.tZ)(F,{children:(0,b.tZ)("p",{children:(0,g.t)("No recent data.")})}):(0,b.tZ)(F,{children:P.map(((e,a)=>{const o=(0,h.aQ)(e.count,s),l=Math.floor(o),d={index:a,onClick:()=>((0,x.Gi)("issue_group_details.tags.bar.clicked",{tag:i,value:e.value,platform:r?.platform,is_mobile:(0,Z.an)(r?.platform),organization:D}),n?.(i,e))};return(0,b.tZ)("div",{style:{width:o+"%"},onMouseOver:()=>{K(e),k({tag:i,value:e.value,platform:r?.platform,is_mobile:(0,Z.an)(r?.platform),organization:D})},onMouseLeave:()=>K(null),children:e.isOther?(0,b.tZ)($,{"aria-label":(0,g.t)("Other segment"),color:t[t.length-1]}):(0,b.tZ)(B,{"aria-label":`${e.value} ${(0,g.t)("segment")}`,color:t[a],...d,children:0===a&&l>6?`${l}%`:null})},e.isOther?"other":`segment-${e.value}`)}))})]})}),(0,b.tZ)(M,{expanded:z,animate:z?{height:"100%",opacity:1}:{height:"0",opacity:0},children:(0,b.tZ)(V,{children:P.map(((e,a)=>{const o=Math.floor((0,h.aQ)(e.count,s)),n=!!L&&L.value!==e.value,r=L?.value===e.value,l=e.isOther?(0,g.t)("Other %s tag values, %s of all events. View other tags.",i,`${o}%`):(0,g.t)("%s, %s, %s of all events. View events with this tag value.",i,e.value,`${o}%`);return(0,b.tZ)("li",{children:(0,b.tZ)(p.Z,{to:e.url,"aria-label":l,children:(0,b.BX)(q,{onMouseOver:()=>K(e),onMouseLeave:()=>K(null),children:[(0,b.tZ)(C,{color:t[e.isOther?t.length-1:a],focus:r}),(0,b.tZ)(c.u,{skipWrapper:!0,delay:800,title:e.name,children:(0,b.tZ)(E,{unfocus:n,children:e.name??(0,b.tZ)(A,{children:(0,g.t)("n/a")})})}),(0,b.tZ)(N,{children:`${o}%`})]})})},`segment-${e.name}-${a}`)}))})})]})})}D.displayName="TagFacetsDistributionMeter";const z=D,j=(0,i.Z)("div",{target:"e1g8texm16"})("margin-bottom:",(0,m.D)(2),";"),_=(0,i.Z)("span",{target:"e1g8texm15"})((e=>e.clickable?"cursor: pointer":null),";"),F=(0,i.Z)("div",{target:"e1g8texm14"})({name:"andpxo",styles:"display:flex;overflow:hidden"}),O=(0,i.Z)("div",{target:"e1g8texm13"})("display:flex;font-size:",(e=>e.theme.fontSizeMedium),";justify-content:space-between;margin-bottom:",(0,m.D)(.25),";line-height:1.1;"),T=(0,i.Z)("div",{target:"e1g8texm12"})("flex:none;color:",(e=>e.theme.textColor),";font-weight:bold;font-size:",(e=>e.theme.fontSizeMedium),";margin-right:",(0,m.D)(1),";align-self:center;"),S=(0,i.Z)("div",{target:"e1g8texm11"})((e=>e.theme.overflowEllipsis),";display:flex;color:",(e=>e.theme.gray300),";text-align:right;font-size:",(e=>e.theme.fontSizeMedium),";",(e=>e.theme.overflowEllipsis),";align-self:center;"),$=(0,i.Z)("span",{target:"e1g8texm10"})("display:block;width:100%;height:",(0,m.D)(2),";color:inherit;outline:none;background-color:",(e=>e.color),";"),B=(0,i.Z)("span",{shouldForwardProp:s.Z,target:"e1g8texm9"})("&:hover{color:",(e=>e.theme.white),";}display:block;width:100%;height:",(0,m.D)(2),";color:",(e=>e.theme.white),";outline:none;background-color:",(e=>e.color),";text-align:right;font-size:",(e=>e.theme.fontSizeExtraSmall),";padding:1px ",(0,m.D)(.5)," 0 0;"),M=(0,i.Z)(n.E.div,{shouldForwardProp:e=>"animate"===e||"expanded"!==e&&(0,s.Z)(e),target:"e1g8texm8"})("height:0;opacity:0;",(e=>e.expanded?"":"overflow: hidden;"),";"),V=(0,i.Z)("ol",{target:"e1g8texm7"})("list-style:none;padding:0;margin:",(0,m.D)(1)," 0;"),q=(0,i.Z)("div",{target:"e1g8texm6"})("display:flex;align-items:center;cursor:pointer;padding:",(0,m.D)(.5)," 0;"),C=(0,i.Z)("span",{target:"e1g8texm5"})("padding:0;position:relative;width:11px;height:11px;text-indent:-9999em;display:inline-block;border-radius:50%;flex-shrink:0;background-color:",(e=>e.color),";&:after{content:'';border-radius:50%;position:absolute;top:0;left:0;width:100%;height:100%;outline:",(e=>e.theme.gray100)," ",(0,m.D)(.5)," solid;opacity:",(e=>e.focus?"1":"0"),";transition:opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);}"),E=(0,i.Z)("span",{target:"e1g8texm4"})("font-size:",(e=>e.theme.fontSizeSmall),";margin-left:",(0,m.D)(1),";overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:color 0.3s;color:",(e=>e.unfocus?e.theme.gray300:e.theme.gray400),";"),N=(0,i.Z)("span",{target:"e1g8texm3"})("font-size:",(e=>e.theme.fontSizeSmall),";margin-left:",(0,m.D)(1),";color:",(e=>e.theme.gray300),";text-align:right;flex-grow:1;"),X=(0,i.Z)(d.zx,{target:"e1g8texm2"})("color:",(e=>e.theme.gray300),";margin-left:",(0,m.D)(.5),";"),A=(0,i.Z)("span",{target:"e1g8texm1"})("color:",(e=>e.theme.gray300),";"),I=(0,i.Z)("summary",{target:"e1g8texm0"})({name:"l4bt0f",styles:"&::-webkit-details-marker{display:none;}"})}}]);
//# sourceMappingURL=../sourcemaps/app_components_group_tagFacets_index_tsx.24a730850d0e5bd2368bb8e790b14b7e.js.map