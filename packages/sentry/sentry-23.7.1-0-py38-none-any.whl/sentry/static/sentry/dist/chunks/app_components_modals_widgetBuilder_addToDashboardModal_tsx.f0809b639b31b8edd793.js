"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_modals_widgetBuilder_addToDashboardModal_tsx"],{"./app/components/modals/widgetBuilder/addToDashboardModal.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>T,modalCss:()=>P});var i=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(n("../node_modules/core-js/modules/es.array.push.js"),n("../node_modules/react/index.js")),a=n("./app/actionCreators/dashboards.tsx"),r=n("./app/actionCreators/indicator.tsx"),s=n("./app/components/button.tsx"),l=n("./app/components/buttonBar.tsx"),d=n("./app/components/forms/controls/selectControl.tsx"),c=n("./app/locale.tsx"),u=n("./app/styles/space.tsx"),m=n("./app/utils/performance/contexts/metricsCardinality.tsx"),p=n("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),h=n("./app/utils/useApi.tsx"),g=n("./app/utils/withDomainRequired.tsx"),y=n("./app/views/dashboards/types.tsx"),f=n("./app/views/dashboards/utils.tsx"),b=n("./app/views/dashboards/widgetBuilder/utils.tsx"),w=n("./app/views/dashboards/widgetCard/index.tsx"),x=n("./app/views/organizationContext.tsx"),v=n("./app/views/performance/landing/metricsDataSwitcher.tsx"),Z=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const C=(0,c.t)("Select a dashboard");function _(e){let{Header:t,Body:n,Footer:i,closeModal:l,location:u,organization:_,router:T,selection:P,widget:S,widgetAsQueryParams:q}=e;const O=(0,h.Z)(),[z,A]=(0,o.useState)(null),[N,L]=(0,o.useState)(null),[B,E]=(0,o.useState)(null);(0,o.useEffect)((()=>{let e=!1;return(0,a.j2)(O,_.slug).then((t=>{e||A(t)})),()=>{e=!0}}),[O,_.slug]),(0,o.useEffect)((()=>{let e=!1;return B===b.i0||null===B?L(null):(0,a.AK)(O,_.slug,B).then((t=>{e||L(t)})),()=>{e=!0}}),[O,_.slug,B]);const M=null!==B;return(0,Z.BX)(x.g.Provider,{value:_,children:[(0,Z.tZ)(t,{closeButton:!0,children:(0,Z.tZ)("h4",{children:(0,c.t)("Add to Dashboard")})}),(0,Z.BX)(n,{children:[(0,Z.tZ)(j,{children:(0,Z.tZ)(d.Z,{disabled:null===z,menuPlacement:"auto",name:"dashboard",placeholder:(0,c.t)("Select Dashboard"),value:B,options:z&&[{label:(0,c.t)("+ Create New Dashboard"),value:"new"},...z.map((e=>{let{title:t,id:n,widgetDisplay:i}=e;return{label:t,value:n,disabled:i.length>=y.ZU,tooltip:i.length>=y.ZU&&(0,c._N)("Max widgets ([maxWidgets]) per dashboard reached.",{maxWidgets:y.ZU}),tooltipOptions:{position:"right"}}}))],onChange:e=>{e.disabled||E(e.value)}})}),(0,Z.tZ)(j,{children:(0,c.t)("Any conflicting filters from this query will be overridden by Dashboard filters. This is a preview of how the widget will appear in your dashboard.")}),(0,Z.tZ)(m.BT,{organization:_,location:u,children:(0,Z.tZ)(v.d,{organization:_,eventView:(0,f.tT)(S.title,S.queries[0],P,S.displayType),location:u,hideLoadingIndicator:!0,children:e=>(0,Z.tZ)(p.kP,{location:u,forceTransactions:e.forceTransactionsOnly,children:(0,Z.tZ)(w.ZP,{organization:_,isEditing:!1,widgetLimitReached:!1,selection:N?(0,f.fK)(N):P,dashboardFilters:(0,f.lM)(u)??N?.filters,widget:S,showStoredAlert:!0})})})})]}),(0,Z.tZ)(i,{children:(0,Z.BX)(D,{gap:1.5,children:[(0,Z.tZ)(s.zx,{onClick:async function(){if(null===N)return;let e=S.queries[0].orderby;y.FO.AREA&&S.queries[0].columns.length||(e="");const t=S.queries[0],n={...S,title:""===S.title?(0,c.t)("All Events"):S.title,queries:[{...t,orderby:e}]},i={...N,widgets:[...N.widgets,n]};await(0,a.Y)(O,_.slug,i),l(),(0,r.S9)((0,c.t)("Successfully added widget to dashboard"))},disabled:!M||B===b.i0,title:M?void 0:C,children:(0,c.t)("Add + Stay in Discover")}),(0,Z.tZ)(s.zx,{priority:"primary",onClick:function(){const e=B===b.i0?`/organizations/${_.slug}/dashboards/new/widget/new/`:`/organizations/${_.slug}/dashboard/${B}/widget/new/`;T.push((0,g.D)({pathname:e,query:{...q,...N?(0,f.aq)(N):{}}})),l()},disabled:!M,title:M?void 0:C,children:(0,c.t)("Open in Widget Builder")})]})})]})}_.displayName="AddToDashboardModal";const T=_,j=(0,i.Z)("div",{target:"enumv91"})("margin-bottom:",(0,u.D)(2),";"),D=(0,i.Z)(l.ZP,{target:"enumv90"})("@media (max-width: ",(e=>e.theme.breakpoints.small),"){grid-template-rows:repeat(2, 1fr);gap:",(0,u.D)(1.5),";width:100%;>button{width:100%;}}"),P={name:"jzg5s9",styles:"max-width:700px;margin:70px auto"}},"./app/utils/performance/contexts/metricsCardinality.tsx":(e,t,n)=>{n.d(t,{BT:()=>Z,e0:()=>_});var i=n("../node_modules/react/index.js"),o=n("./app/utils/analytics.tsx"),a=n("./app/utils/dates.tsx"),r=n("./app/utils/discover/eventView.tsx"),s=n("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),l=n("../node_modules/lodash/omit.js"),d=n.n(l),c=n("./app/utils/discover/genericDiscoverQuery.tsx"),u=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function m(e){let{eventView:t,location:n}=e;return d()(t.getEventsAPIPayload(n),["field","sort","per_page","query"])}function p(e){let{children:t,...n}=e;return(0,u.tZ)(c.ZP,{route:"metrics-compatibility-sums",getRequestPayload:m,...n,children:e=>{let{tableData:n,...i}=e;return t({tableData:n,...i})}})}function h(e){let{eventView:t,location:n}=e;return d()(t.getEventsAPIPayload(n),["field","sort","per_page","query"])}function g(e){let{children:t,...n}=e;return(0,u.tZ)(c.ZP,{route:"metrics-compatibility",getRequestPayload:h,...n,children:e=>{let{tableData:n,...i}=e;return t({tableData:n,...i})}})}p.displayName="MetricsCompatibilityQuery",g.displayName="MetricsCompatibilitySumsQuery";var y=n("./app/utils/performance/contexts/utils.tsx");const f=.01,b=.01,[w,x,v]=(0,y.n)({name:"MetricsCardinalityContext",strict:!1});function Z(e){if(!(0,s.gp)(e.organization))return(0,u.tZ)(w,{value:{isLoading:!1,outcome:{forceTransactionsOnly:!0}},children:e.children});const t={location:e.location,orgSlug:e.organization.slug,cursor:"0:0:0"},n=r.ZP.fromLocation(e.location);n.fields=[{field:"tpm()"}];const o=function(e){const t=e.clone();return t.start||t.end||(t.statsPeriod?(0,a.YJ)(t.statsPeriod)>1&&(t.statsPeriod="1h",t.start=void 0,t.end=void 0):(t.statsPeriod="1h",t.start=void 0,t.end=void 0)),t}(n);return(0,u.tZ)(i.Fragment,{children:(0,u.tZ)(p,{eventView:o,...t,children:n=>(0,u.tZ)(g,{eventView:o,...t,children:t=>{const i=n.isLoading||t.isLoading,o=n.isLoading||t.isLoading?void 0:function(e,t,n){const i={forceTransactionsOnly:!0},o=n.features.includes("performance-mep-bannerless-ui");if(!e)return i;const a=e.compatible_projects;return t?i:e?function(e){return!T(e).metricsCount}(e)?i:function(e,t){const n=T(e);return t?n.nullCount/n.metricsCount>b:n.nullCount>0}(e,o)?{shouldWarnIncompatibleSDK:!0,forceTransactionsOnly:!0,compatibleProjects:a}:function(e){const t=T(e);return t.unparamCount>=t.metricsCount}(e)?{shouldNotifyUnnamedTransactions:!0,forceTransactionsOnly:!0,compatibleProjects:a}:function(e,t){const n=T(e);return t?n.unparamCount/n.metricsCount>f:n.unparamCount>0}(e,o)?{shouldNotifyUnnamedTransactions:!0,compatibleProjects:a,forceTransactionsOnly:!1}:{forceTransactionsOnly:!1}:i}(n.tableData&&t.tableData?{...n.tableData,...t.tableData}:null,!!n.error&&!!t.error,e.organization);return(0,u.tZ)(C,{sendOutcomeAnalytics:e.sendOutcomeAnalytics,organization:e.organization,value:{isLoading:i,outcome:o},children:e.children})}})})})}function C(e){const t=e.value.outcome?.shouldWarnIncompatibleSDK??!1,n=e.value.outcome?.shouldNotifyUnnamedTransactions??!1,a=!e.value.outcome?.forceTransactionsOnly;return(0,i.useEffect)((()=>{!e.value.isLoading&&e.sendOutcomeAnalytics&&(0,o.Gi)("performance_views.mep.metrics_outcome",{organization:e.organization,is_on_metrics:a,fallback_from_null:t,fallback_from_unparam:n})}),[e.organization,e.value.isLoading,a,n,t,e.sendOutcomeAnalytics]),(0,u.tZ)(w,{...e,children:e.children})}Z.displayName="MetricsCardinalityProvider",C.displayName="Provider",v.Consumer;const _=x;function T(e){let{sum:t}=e;try{const e=Number(t.metrics);return{metricsCount:e,unparamCount:Number(t.metrics_unparam),nullCount:Number(t.metrics_null)}}catch(e){return{metricsCount:0,unparamCount:0,nullCount:0}}}},"./app/views/performance/landing/metricsDataSwitcher.tsx":(e,t,n)=>{n.d(t,{d:()=>u});var i=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(n("../node_modules/core-js/modules/es.array.push.js"),n("../node_modules/react/index.js")),a=n("../node_modules/react-router/es/index.js"),r=n("./app/components/loadingIndicator.tsx"),s=n("./app/utils/performance/contexts/metricsCardinality.tsx"),l=n("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),d=n("./app/utils/queryString.tsx"),c=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function u(e){const t=(0,l.gp)(e.organization),n=(0,s.e0)();return t?n.isLoading&&!e.hideLoadingIndicator?(0,c.tZ)(o.Fragment,{children:(0,c.tZ)(p,{children:(0,c.tZ)(r.Z,{})})}):n.outcome?(0,c.tZ)(o.Fragment,{children:(0,c.tZ)(m,{eventView:e.eventView,location:e.location,outcome:n.outcome,switcherChildren:e.children})}):(0,c.tZ)(o.Fragment,{children:e.children({forceTransactionsOnly:!0})}):(0,c.tZ)(o.Fragment,{children:e.children({forceTransactionsOnly:!0})})}function m(e){let{switcherChildren:t,outcome:n,location:i,eventView:r}=e;const{query:s}=i,u=(0,d.ro)(s[l.tm],""),m=(0,d.ro)(s.query,""),p=u===l.oR.TRANSACTIONS_ONLY,h=m&&p&&!n.forceTransactionsOnly;return(0,o.useEffect)((()=>{h&&a.browserHistory.push({pathname:i.pathname,query:{...i.query,cursor:void 0,query:void 0,[l.tm]:void 0}})}),[h,i]),m&&p&&!n.forceTransactionsOnly&&(r.query=""),(0,c.tZ)(o.Fragment,{children:t(n)})}u.displayName="MetricsDataSwitcher",m.displayName="MetricsSwitchHandler";const p=(0,i.Z)("div",{target:"e11vcqhu0"})({name:"zl1inp",styles:"display:flex;justify-content:center"})}}]);
//# sourceMappingURL=../sourcemaps/app_components_modals_widgetBuilder_addToDashboardModal_tsx.b84fbfcaab4a730c031de25c8a4d4ec7.js.map