"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_versionHoverCard_tsx"],{"./app/actionCreators/release.tsx":(e,t,s)=>{s.d(t,{VE:()=>d,aQ:()=>c,dF:()=>p,o7:()=>l});var o=s("../node_modules/@sentry/browser/node_modules/@sentry/core/esm/exports.js"),r=s("./app/actionCreators/indicator.tsx"),i=s("./app/locale.tsx"),n=s("./app/stores/releaseStore.tsx"),a=s("./app/types/index.tsx");function l(e,t){const{orgSlug:s,projectSlug:r,releaseVersion:i}=t,a=`/projects/${s}/${r}/releases/${encodeURIComponent(i)}/`;return n.Z.state.releaseLoading[(0,n.p)(r,i)]=!0,n.Z.loadRelease(s,r,i),e.requestPromise(a,{method:"GET"}).then((e=>{n.Z.loadReleaseSuccess(r,i,e)})).catch((e=>{404!==e.status?(n.Z.loadReleaseError(r,i,e),o.$e((t=>{t.setLevel("warning"),t.setFingerprint(["getRelease-action-creator"]),o.Tb(e)}))):n.Z.loadReleaseSuccess(r,i,null)}))}function p(e,t){const{orgSlug:s,projectSlug:r,releaseVersion:i}=t,a=`/organizations/${s}/releases/${encodeURIComponent(i)}/deploys/`;return n.Z.state.deploysLoading[(0,n.p)(r,i)]=!0,n.Z.loadDeploys(s,r,i),e.requestPromise(a,{method:"GET"}).then((e=>{n.Z.loadDeploysSuccess(r,i,e)})).catch((e=>{404!==e.status?(n.Z.loadDeploysError(r,i,e),o.$e((t=>{t.setLevel("warning"),t.setFingerprint(["getReleaseDeploys-action-creator"]),o.Tb(e)}))):n.Z.loadDeploysSuccess(r,i,null)}))}function d(e,t){const{orgSlug:s,projectSlug:o,releaseVersion:l}=t;return n.Z.loadRelease(s,o,l),(0,r.E3)((0,i.t)("Archiving Release…")),e.requestPromise(`/organizations/${s}/releases/`,{method:"POST",data:{status:a.dE.ARCHIVED,projects:[],version:l}}).then((e=>{n.Z.loadReleaseSuccess(o,l,e),(0,r.S9)((0,i.t)("Release was successfully archived."))})).catch((e=>{throw n.Z.loadReleaseError(o,l,e),(0,r.Iw)(e.responseJSON?.detail??(0,i.t)("Release could not be be archived.")),e}))}function c(e,t){const{orgSlug:s,projectSlug:o,releaseVersion:l}=t;return n.Z.loadRelease(s,o,l),(0,r.E3)((0,i.t)("Restoring Release…")),e.requestPromise(`/organizations/${s}/releases/`,{method:"POST",data:{status:a.dE.ACTIVE,projects:[],version:l}}).then((e=>{n.Z.loadReleaseSuccess(o,l,e),(0,r.S9)((0,i.t)("Release was successfully restored."))})).catch((e=>{throw n.Z.loadReleaseError(o,l,e),(0,r.Iw)(e.responseJSON?.detail??(0,i.t)("Release could not be be restored.")),e}))}},"./app/components/versionHoverCard.tsx":(e,t,s)=>{s.d(t,{ZP:()=>B});var o=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=s("../node_modules/react/index.js"),n=s("./app/components/avatar/avatarList.tsx"),a=s("./app/components/button.tsx"),l=s("./app/components/copyToClipboardButton.tsx"),p=s("./app/components/hovercard.tsx"),d=s("./app/components/avatar/userAvatar.tsx"),c=s("./app/components/timeSince.tsx"),h=s("./app/locale.tsx"),u=s("./app/styles/space.tsx"),g=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const m={id:"",name:"",username:"??",email:"",avatarUrl:"",avatar:{avatarUuid:"",avatarType:"letter_avatar"},ip_address:""};function Z(e){let{commit:t,className:s}=e;const o=t?.author;return(0,g.BX)("div",{className:s,children:[(0,g.tZ)("h6",{children:"Last commit"}),(0,g.BX)(v,{children:[(0,g.tZ)(d.Z,{user:o||m}),(0,g.BX)("div",{children:[(0,g.tZ)(x,{children:function(e){if(!e)return(0,h.t)("No message provided");const t=e.split(/\n/)[0];if(t.length>100){let e=t.substring(0,90);const s=e.split(/ /);return s.length>1&&(s.pop(),e=s.join(" ")),`${e}…`}return t}(t.message)}),(0,g.BX)(b,{children:[(0,g.tZ)("strong",{children:o?.name||(0,h.t)("Unknown Author")})," ",(0,g.tZ)(c.Z,{date:t.dateCreated})]})]})]})]})}Z.displayName="LastCommit";const y=Z,v=(0,r.Z)("div",{target:"e1db647b2"})("display:grid;grid-template-columns:max-content minmax(0, 1fr);gap:",(0,u.D)(1),";margin-top:",(0,u.D)(1),";"),x=(0,r.Z)("div",{target:"e1db647b1"})((e=>e.theme.overflowEllipsis)," margin-bottom:",(0,u.D)(.5),";"),b=(0,r.Z)("div",{target:"e1db647b0"})("font-size:",(e=>e.theme.fontSizeSmall),";color:",(e=>e.theme.subText),";");var S=s("./app/components/loadingError.tsx"),f=s("./app/components/loadingIndicator.tsx");const w=(0,r.Z)("span",{target:"e1jr4nh0"})("font-weight:700;color:",(e=>e.theme.white),";text-align:center;white-space:nowrap;border-radius:0.25em;",(e=>e.theme.overflowEllipsis),";display:inline-block;vertical-align:text-bottom;line-height:1;background:",(e=>e.theme.gray200),";padding:3px;max-width:86px;font-size:",(e=>e.theme.fontSizeSmall),";");var R=s("./app/components/version.tsx"),j=s("./app/utils.tsx"),E=s("./app/utils/withApi.tsx"),z=s("./app/actionCreators/release.tsx"),C=s("./app/stores/releaseStore.tsx"),L=s("./app/utils/getDisplayName.tsx");var D=s("./app/utils/withRepositories.tsx");class V extends i.Component{constructor(){super(...arguments),(0,o.Z)(this,"state",{visible:!1})}toggleHovercard(){this.setState({visible:!0})}getRepoLink(){const{organization:e}=this.props,t=e.slug;return{header:null,body:(0,g.BX)(_,{children:[(0,g.tZ)("h5",{children:(0,h.t)("Releases are better with commit data!")}),(0,g.tZ)("p",{children:(0,h.t)("Connect a repository to see commit info, files changed, and authors involved in future releases.")}),(0,g.tZ)(a.zx,{href:`/organizations/${t}/repos/`,priority:"primary",children:(0,h.t)("Connect a repository")})]})}}getBody(){const{releaseVersion:e,release:t,deploys:s}=this.props;if(void 0===t||!(0,j.ri)(s))return{header:null,body:null};const{lastCommit:o}=t,r=s.reduce((function(e,t){const{dateFinished:s,environment:o}=t;return e.hasOwnProperty(o)||(e[o]=s),e}),{});let i=Object.keys(r);return Object.keys(r).length>3&&(i=Object.keys(r).slice(0,3)),{header:(0,g.tZ)(N,{releaseVersion:e}),body:(0,g.BX)("div",{children:[(0,g.BX)("div",{className:"row",children:[(0,g.BX)("div",{className:"col-xs-4",children:[(0,g.tZ)("h6",{children:(0,h.t)("New Issues")}),(0,g.tZ)(U,{children:t.newGroups})]}),(0,g.BX)("div",{className:"col-xs-8",children:[(0,g.BX)("h6",{style:{textAlign:"right"},children:[t.commitCount," ",1!==t.commitCount?(0,h.t)("commits "):(0,h.t)("commit ")," ",(0,h.t)("by ")," ",t.authors.length," ",1!==t.authors.length?(0,h.t)("authors"):(0,h.t)("author")," "]}),(0,g.tZ)(n.Z,{users:t.authors,avatarSize:25,tooltipOptions:{container:"body"},typeMembers:"authors"})]})]}),o&&(0,g.tZ)(I,{commit:o}),s.length>0&&(0,g.BX)("div",{children:[(0,g.tZ)(p.iz,{children:(0,g.tZ)("h6",{children:(0,h.t)("Deploys")})}),i.map(((e,t)=>{const s=r[e];return(0,g.BX)(O,{children:[(0,g.tZ)($,{children:e}),s&&(0,g.tZ)(T,{date:s})]},t)}))]})]})}}render(){const{deploysLoading:e,deploysError:t,release:s,releaseLoading:o,releaseError:r,repositories:i,repositoriesLoading:n,repositoriesError:a}=this.props;let l=null,d=null;const c=!!(e||o||n),h=t??r??a,u=i&&i.length>0;if(c)d=(0,g.tZ)(f.Z,{mini:!0});else if(h)d=(0,g.tZ)(S.Z,{});else{const e=u&&s?this.getBody():this.getRepoLink();l=e.header,d=e.body}return(0,g.tZ)(p.uI,{...this.props,header:l,body:d,children:this.props.children})}}V.displayName="VersionHoverCard";class N extends i.Component{render(){return(0,g.BX)(X,{children:[(0,h.t)("Release"),(0,g.BX)(k,{children:[(0,g.tZ)(P,{version:this.props.releaseVersion,truncate:!0,anchor:!1}),(0,g.tZ)(l.m,{borderless:!0,iconSize:"xs",size:"zero",text:this.props.releaseVersion})]})]})}}N.displayName="VersionHoverHeader";const B=(0,E.Z)(function(e){class t extends i.Component{constructor(e,t){super(e,t),(0,o.Z)(this,"unsubscribe",C.Z.listen((()=>this.onStoreUpdate()),void 0));const{projectSlug:s,releaseVersion:r}=this.props,i=C.Z.get(s,r);this.state={...i}}componentDidMount(){this.fetchRelease(),this.fetchDeploys()}componentWillUnmount(){this.unsubscribe()}fetchRelease(){const{api:e,organization:t,projectSlug:s,releaseVersion:o}=this.props,r=C.Z.get(s,o),i=t.slug;(!r.release&&!r.releaseLoading||r.releaseError)&&(0,z.o7)(e,{orgSlug:i,projectSlug:s,releaseVersion:o})}fetchDeploys(){const{api:e,organization:t,projectSlug:s,releaseVersion:o}=this.props,r=C.Z.get(s,o),i=t.slug;(!r.deploys&&!r.deploysLoading||r.deploysError)&&(0,z.dF)(e,{orgSlug:i,projectSlug:s,releaseVersion:o})}onStoreUpdate(){const{projectSlug:e,releaseVersion:t}=this.props,s=C.Z.get(e,t);this.setState({...s})}render(){return(0,g.tZ)(e,{...this.props,...this.state})}}return t.displayName="WithRelease",(0,o.Z)(t,"displayName",`withRelease(${(0,L.Z)(e)})`),t}((0,D.Z)(V))),_=(0,r.Z)("div",{target:"e18ynwc18"})("padding:",(0,u.D)(2),";text-align:center;"),$=(0,r.Z)(w,{target:"e18ynwc17"})({name:"1uxsuq0",styles:"width:86px"}),T=(0,r.Z)(c.Z,{target:"e18ynwc16"})("color:",(e=>e.theme.gray300),";font-size:",(e=>e.theme.fontSizeSmall),";"),X=(0,r.Z)("div",{target:"e18ynwc15"})({name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"}),k=(0,r.Z)("div",{target:"e18ynwc14"})({name:"8nnmo9",styles:"display:flex;flex:1;align-items:center;justify-content:flex-end"}),P=(0,r.Z)(R.Z,{target:"e18ynwc13"})("margin-right:",(0,u.D)(.5),";max-width:190px;"),U=(0,r.Z)("div",{target:"e18ynwc12"})("color:",(e=>e.theme.headingColor),";font-size:",(e=>e.theme.headerFontSize),";"),I=(0,r.Z)(y,{target:"e18ynwc11"})("margin-top:",(0,u.D)(2),";"),O=(0,r.Z)("div",{target:"e18ynwc10"})("display:grid;grid-template-columns:max-content minmax(0, 1fr);gap:",(0,u.D)(1),";justify-items:start;align-items:center;")},"./app/stores/repositoryStore.tsx":(e,t,s)=>{s.d(t,{Z:()=>r});const o={state:{orgSlug:void 0,repositories:void 0,repositoriesLoading:void 0,repositoriesError:void 0},init(){this.resetRepositories()},resetRepositories(){this.state={orgSlug:void 0,repositories:void 0,repositoriesLoading:void 0,repositoriesError:void 0},this.trigger(this.state)},loadRepositories(e){this.state={orgSlug:e,repositories:e===this.state.orgSlug?this.state.repositories:void 0,repositoriesLoading:!0,repositoriesError:void 0},this.trigger(this.state)},loadRepositoriesError(e){this.state={...this.state,repositories:void 0,repositoriesLoading:!1,repositoriesError:e},this.trigger(this.state)},loadRepositoriesSuccess(e){this.state={...this.state,repositories:e,repositoriesLoading:!1,repositoriesError:void 0},this.trigger(this.state)},get(){return{...this.state}}},r=(0,s("../node_modules/reflux/src/index.js").createStore)(o)},"./app/utils/withRepositories.tsx":(e,t,s)=>{s.d(t,{Z:()=>d});var o=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("../node_modules/react/index.js"),i=s("../node_modules/@sentry/browser/node_modules/@sentry/core/esm/exports.js"),n=s("./app/stores/repositoryStore.tsx"),a=s("./app/utils/getDisplayName.tsx"),l=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const p={repositories:void 0,repositoriesLoading:void 0,repositoriesError:void 0},d=function(e){class t extends r.Component{constructor(e,t){super(e,t),(0,o.Z)(this,"unsubscribe",n.Z.listen((()=>this.onStoreUpdate()),void 0));const s=n.Z.get();this.state=s.orgSlug===e.organization.slug?{...p,...s}:{...p}}componentDidMount(){const{organization:e}=this.props,t=e.slug;n.Z.get().orgSlug!==t&&n.Z.resetRepositories(),this.fetchRepositories()}componentWillUnmount(){this.unsubscribe()}fetchRepositories(){const{api:e,organization:t}=this.props,s=t.slug,o=n.Z.get();(!o.repositories&&!o.repositoriesLoading||o.repositoriesError)&&function(e,t){const{orgSlug:s}=t,o=`/organizations/${s}/repos/`;n.Z.state.repositoriesLoading=!0,n.Z.loadRepositories(s),e.requestPromise(o,{method:"GET"}).then((e=>{n.Z.loadRepositoriesSuccess(e)})).catch((e=>{n.Z.loadRepositoriesError(e),i.$e((t=>{t.setLevel("warning"),t.setFingerprint(["getRepositories-action-creator"]),i.Tb(e)}))}))}(e,{orgSlug:s})}onStoreUpdate(){const e=n.Z.get();this.setState({...e})}render(){return(0,l.tZ)(e,{...this.props,...this.state})}}return t.displayName="WithRepositories",(0,o.Z)(t,"displayName",`withRepositories(${(0,a.Z)(e)})`),t}}}]);
//# sourceMappingURL=../sourcemaps/app_components_versionHoverCard_tsx.0bd9ba0c4eccc20c71e8151742642111.js.map