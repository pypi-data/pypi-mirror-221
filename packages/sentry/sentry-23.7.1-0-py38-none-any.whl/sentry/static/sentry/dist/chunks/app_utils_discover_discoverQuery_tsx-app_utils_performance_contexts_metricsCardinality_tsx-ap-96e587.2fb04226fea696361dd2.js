"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_utils_discover_discoverQuery_tsx-app_utils_performance_contexts_metricsCardinality_tsx-ap-96e587"],{"./app/utils/discover/discoverQuery.tsx":(t,e,n)=>{n.d(e,{Z:()=>l,_:()=>a});var r=n("./app/utils/discover/genericDiscoverQuery.tsx"),o=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function s(t,e){return t.transactionName!==e.transactionName||t.transactionThreshold!==e.transactionThreshold||t.transactionThresholdMetric!==e.transactionThresholdMetric}function i(t){return(0,o.tZ)(r.ZP,{route:"events",shouldRefetchData:s,afterFetch:(t,e)=>{const{fields:n,...r}=t.meta??{};return{...t,meta:{...n,...r}}},...t})}function a(t){const e=(0,r.JC)({route:"events",shouldRefetchData:s,afterFetch:(t,e)=>{const{fields:n,...r}=t.meta??{};return{...t,meta:{...n,...r}}},...t}),n=e.response?.getResponseHeader("Link")??void 0;return{...e,pageLinks:n}}i.displayName="DiscoverQuery";const l=i},"./app/utils/performance/contexts/metricsCardinality.tsx":(t,e,n)=>{n.d(e,{BT:()=>C,e0:()=>j});var r=n("../node_modules/react/index.js"),o=n("./app/utils/analytics.tsx"),s=n("./app/utils/dates.tsx"),i=n("./app/utils/discover/eventView.tsx"),a=n("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),l=n("../node_modules/lodash/omit.js"),c=n.n(l),d=n("./app/utils/discover/genericDiscoverQuery.tsx"),u=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function p(t){let{eventView:e,location:n}=t;return c()(e.getEventsAPIPayload(n),["field","sort","per_page","query"])}function h(t){let{children:e,...n}=t;return(0,u.tZ)(d.ZP,{route:"metrics-compatibility-sums",getRequestPayload:p,...n,children:t=>{let{tableData:n,...r}=t;return e({tableData:n,...r})}})}function m(t){let{eventView:e,location:n}=t;return c()(e.getEventsAPIPayload(n),["field","sort","per_page","query"])}function g(t){let{children:e,...n}=t;return(0,u.tZ)(d.ZP,{route:"metrics-compatibility",getRequestPayload:m,...n,children:t=>{let{tableData:n,...r}=t;return e({tableData:n,...r})}})}h.displayName="MetricsCompatibilityQuery",g.displayName="MetricsCompatibilitySumsQuery";var f=n("./app/utils/performance/contexts/utils.tsx");const y=.01,v=.01,[b,x,T]=(0,f.n)({name:"MetricsCardinalityContext",strict:!1});function C(t){if(!(0,a.gp)(t.organization))return(0,u.tZ)(b,{value:{isLoading:!1,outcome:{forceTransactionsOnly:!0}},children:t.children});const e={location:t.location,orgSlug:t.organization.slug,cursor:"0:0:0"},n=i.ZP.fromLocation(t.location);n.fields=[{field:"tpm()"}];const o=function(t){const e=t.clone();return e.start||e.end||(e.statsPeriod?(0,s.YJ)(e.statsPeriod)>1&&(e.statsPeriod="1h",e.start=void 0,e.end=void 0):(e.statsPeriod="1h",e.start=void 0,e.end=void 0)),e}(n);return(0,u.tZ)(r.Fragment,{children:(0,u.tZ)(h,{eventView:o,...e,children:n=>(0,u.tZ)(g,{eventView:o,...e,children:e=>{const r=n.isLoading||e.isLoading,o=n.isLoading||e.isLoading?void 0:function(t,e,n){const r={forceTransactionsOnly:!0},o=n.features.includes("performance-mep-bannerless-ui");if(!t)return r;const s=t.compatible_projects;return e?r:t?function(t){return!_(t).metricsCount}(t)?r:function(t,e){const n=_(t);return e?n.nullCount/n.metricsCount>v:n.nullCount>0}(t,o)?{shouldWarnIncompatibleSDK:!0,forceTransactionsOnly:!0,compatibleProjects:s}:function(t){const e=_(t);return e.unparamCount>=e.metricsCount}(t)?{shouldNotifyUnnamedTransactions:!0,forceTransactionsOnly:!0,compatibleProjects:s}:function(t,e){const n=_(t);return e?n.unparamCount/n.metricsCount>y:n.unparamCount>0}(t,o)?{shouldNotifyUnnamedTransactions:!0,compatibleProjects:s,forceTransactionsOnly:!1}:{forceTransactionsOnly:!1}:r}(n.tableData&&e.tableData?{...n.tableData,...e.tableData}:null,!!n.error&&!!e.error,t.organization);return(0,u.tZ)(Z,{sendOutcomeAnalytics:t.sendOutcomeAnalytics,organization:t.organization,value:{isLoading:r,outcome:o},children:t.children})}})})})}function Z(t){const e=t.value.outcome?.shouldWarnIncompatibleSDK??!1,n=t.value.outcome?.shouldNotifyUnnamedTransactions??!1,s=!t.value.outcome?.forceTransactionsOnly;return(0,r.useEffect)((()=>{!t.value.isLoading&&t.sendOutcomeAnalytics&&(0,o.Gi)("performance_views.mep.metrics_outcome",{organization:t.organization,is_on_metrics:s,fallback_from_null:e,fallback_from_unparam:n})}),[t.organization,t.value.isLoading,s,n,e,t.sendOutcomeAnalytics]),(0,u.tZ)(b,{...t,children:t.children})}C.displayName="MetricsCardinalityProvider",Z.displayName="Provider",T.Consumer;const j=x;function _(t){let{sum:e}=t;try{const t=Number(e.metrics);return{metricsCount:t,unparamCount:Number(e.metrics_unparam),nullCount:Number(e.metrics_null)}}catch(t){return{metricsCount:0,unparamCount:0,nullCount:0}}}},"./app/views/performance/transactionSummary/transactionThresholdModal.tsx":(t,e,n)=>{n.d(e,{ZP:()=>A,b9:()=>j,fY:()=>w});var r=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=n("../node_modules/react/index.js"),i=n("../node_modules/lodash/cloneDeep.js"),a=n.n(i),l=n("../node_modules/lodash/set.js"),c=n.n(l),d=n("./app/actionCreators/indicator.tsx"),u=n("./app/components/button.tsx"),p=n("./app/components/buttonBar.tsx"),h=n("./app/components/forms/controls/selectControl.tsx"),m=n("./app/components/forms/fieldGroup/index.tsx"),g=n("./app/components/input.tsx"),f=n("./app/components/links/link.tsx"),y=n("./app/locale.tsx"),v=n("./app/styles/space.tsx"),b=n("./app/utils.tsx"),x=n("./app/utils/withApi.tsx"),T=n("./app/utils/withProjects.tsx"),C=n("./app/views/performance/transactionSummary/utils.tsx"),Z=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");let j;!function(t){t.TRANSACTION_DURATION="duration",t.LARGEST_CONTENTFUL_PAINT="lcp"}(j||(j={}));const _=[{label:(0,y.t)("Transaction Duration"),value:"duration"},{label:(0,y.t)("Largest Contentful Paint"),value:"lcp"}];class P extends s.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",{threshold:this.props.transactionThreshold,metric:this.props.transactionThresholdMetric,error:null}),(0,r.Z)(this,"handleApply",(t=>{t.preventDefault();const{api:e,closeModal:n,organization:r,transactionName:o,onApply:s}=this.props,i=this.getProject();if(!(0,b.ri)(i))return;const a=`/organizations/${r.slug}/project-transaction-threshold-override/`;e.requestPromise(a,{method:"POST",includeAllArgs:!0,query:{project:i.id},data:{transaction:o,threshold:this.state.threshold,metric:this.state.metric}}).then((()=>{n(),s&&s(this.state.threshold,this.state.metric)})).catch((t=>{this.setState({error:t});const e=t.responseJSON?.threshold??t.responseJSON?.non_field_errors??null;(0,d.Iw)(e)}))})),(0,r.Z)(this,"handleFieldChange",(t=>e=>{this.setState((n=>{const r=a()(n);return c()(r,t,e),{...r,errors:void 0}}))})),(0,r.Z)(this,"handleReset",(t=>{t.preventDefault();const{api:e,closeModal:n,organization:r,transactionName:o,onApply:s}=this.props,i=this.getProject();if(!(0,b.ri)(i))return;const a=`/organizations/${r.slug}/project-transaction-threshold-override/`;e.requestPromise(a,{method:"DELETE",includeAllArgs:!0,query:{project:i.id},data:{transaction:o}}).then((()=>{const t=`/projects/${r.slug}/${i.slug}/transaction-threshold/configure/`;this.props.api.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{project:i.id}}).then((t=>{let[e]=t;this.setState({threshold:e.threshold,metric:e.metric}),n(),s&&s(this.state.threshold,this.state.metric)})).catch((t=>{const e=t.responseJSON?.threshold??null;(0,d.Iw)(e)}))})).catch((t=>{this.setState({error:t})}))}))}getProject(){const{projects:t,eventView:e,project:n}=this.props;if((0,b.ri)(n))return t.find((t=>t.id===n));const r=String(e.project[0]);return t.find((t=>t.id===r))}renderModalFields(){return(0,Z.BX)(s.Fragment,{children:[(0,Z.tZ)(m.Z,{"data-test-id":"response-metric",label:(0,y.t)("Calculation Method"),inline:!1,help:(0,y.t)("This determines which duration metric is used for the Response Time Threshold."),showHelpInTooltip:!0,flexibleControlStateSize:!0,stacked:!0,required:!0,children:(0,Z.tZ)(h.Z,{required:!0,options:_.slice(),name:"responseMetric",label:(0,y.t)("Calculation Method"),value:this.state.metric,onChange:t=>{this.handleFieldChange("metric")(t.value)}})}),(0,Z.tZ)(m.Z,{"data-test-id":"response-time-threshold",label:(0,y.t)("Response Time Threshold (ms)"),inline:!1,help:(0,y.t)("The satisfactory response time for the calculation method defined above. This is used to calculate Apdex and User Misery scores."),showHelpInTooltip:!0,flexibleControlStateSize:!0,stacked:!0,required:!0,children:(0,Z.tZ)(g.Z,{type:"number",name:"threshold",required:!0,pattern:"[0-9]*(\\.[0-9]*)?",onChange:t=>{this.handleFieldChange("threshold")(t.target.value)},value:this.state.threshold,step:100,min:100})})]})}render(){const{Header:t,Body:e,Footer:n,organization:r,transactionName:o,eventView:i}=this.props,a=this.getProject(),l=i.clone();l.query=l.getQueryWithAdditionalConditions();const c=(0,C.e1)({orgSlug:r.slug,transaction:o,query:l.generateQueryStringObject(),projectID:a?.id});return(0,Z.BX)(s.Fragment,{children:[(0,Z.tZ)(t,{closeButton:!0,children:(0,Z.tZ)("h4",{children:(0,y.t)("Transaction Settings")})}),(0,Z.BX)(e,{children:[(0,Z.tZ)(S,{children:(0,y._N)("The changes below will only be applied to [transaction]. To set it at a more global level, go to [projectSettings: Project Settings].",{transaction:(0,Z.tZ)(f.Z,{to:c,children:o}),projectSettings:(0,Z.tZ)(f.Z,{to:`/settings/${r.slug}/projects/${a?.slug}/performance/`})})}),this.renderModalFields()]}),(0,Z.tZ)(n,{children:(0,Z.BX)(p.ZP,{gap:1,children:[(0,Z.tZ)(u.zx,{priority:"default",onClick:this.handleReset,"data-test-id":"reset-all",children:(0,y.t)("Reset All")}),(0,Z.tZ)(u.zx,{"aria-label":(0,y.t)("Apply"),priority:"primary",onClick:this.handleApply,"data-test-id":"apply-threshold",children:(0,y.t)("Apply")})]})})]})}}P.displayName="TransactionThresholdModal";const S=(0,o.Z)("div",{target:"e16m24dg0"})("margin-bottom:",(0,v.D)(4),";"),w={name:"1yumxzh",styles:"width:100%;max-width:650px"},A=(0,x.Z)((0,T.Z)(P))}}]);
//# sourceMappingURL=../sourcemaps/app_utils_discover_discoverQuery_tsx-app_utils_performance_contexts_metricsCardinality_tsx-ap-96e587.8b359d3d0d641469d685abd9acb1d488.js.map