"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_forms_jsonForm_tsx-app_utils_crashReports_tsx-app_views_settings_components_da-556e2d"],{"./app/components/confirmDelete.tsx":(e,t,s)=>{s.d(t,{Z:()=>u});var n=s("../node_modules/react/index.js"),i=s("./app/components/alert.tsx"),o=s("./app/components/confirm.tsx"),a=s("./app/components/forms/fieldGroup/index.tsx"),r=s("./app/components/input.tsx"),l=s("./app/locale.tsx"),d=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function c(e){let{message:t,confirmInput:s,...c}=e;return(0,d.tZ)(o.Z,{...c,bypass:!1,disableConfirmButton:!0,renderMessage:e=>{let{disableConfirmButton:o}=e;return(0,d.BX)(n.Fragment,{children:[(0,d.tZ)(i.bZ,{type:"error",children:t}),(0,d.tZ)(a.Z,{flexibleControlStateSize:!0,inline:!1,label:(0,l.t)("Please enter %s to confirm the deletion",(0,d.tZ)("code",{children:s})),children:(0,d.tZ)(r.Z,{type:"text",placeholder:s,onChange:e=>o(e.target.value!==s)})})]})}})}c.displayName="ConfirmDelete";const u=c},"./app/components/forms/formPanel.tsx":(e,t,s)=>{s.d(t,{Z:()=>h});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=s("../node_modules/react/index.js"),o=s("./app/components/forms/fieldFromConfig.tsx"),a=s("./app/components/panels/panel.tsx"),r=s("./app/components/panels/panelBody.tsx"),l=s("./app/components/panels/panelHeader.tsx"),d=s("./app/icons/index.tsx"),c=s("./app/utils/sanitizeQuerySelector.tsx"),u=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function p(e){let{additionalFieldProps:t={},title:s,fields:n,access:p,disabled:h,renderFooter:m,renderHeader:v,collapsible:f,initiallyCollapsed:b=!1,...y}=e;const[x,S]=(0,i.useState)(b),Z=(0,i.useCallback)((()=>S((e=>!e))),[]);return(0,u.BX)(a.Z,{id:"string"==typeof s?(0,c.m)(s):void 0,children:[s&&(0,u.BX)(l.Z,{children:[s,f&&(0,u.tZ)(g,{onClick:Z,children:(0,u.tZ)(d.g6,{"data-test-id":"form-panel-collapse-chevron",direction:x?"down":"up",size:"xs"})})]}),(0,u.BX)(r.Z,{hidden:x,children:["function"==typeof v&&v({title:s,fields:n}),n.map((e=>{if("function"==typeof e)return e();const{defaultValue:s,...n}=e;return!0===h&&(n.disabled=!0,n.disabledReason=void 0),(0,u.tZ)(o.Z,{access:p,disabled:h,...y,...t,field:n,highlighted:y.highlighted===`#${e.name}`},e.name)})),"function"==typeof m&&m({title:s,fields:n})]})]})}p.displayName="FormPanel";const h=p,g=(0,n.Z)("span",{target:"eovlw60"})({name:"e0dnmk",styles:"cursor:pointer"})},"./app/components/forms/jsonForm.tsx":(e,t,s)=>{s.d(t,{Z:()=>g});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=s("../node_modules/react/index.js"),o=s("../node_modules/@sentry/browser/node_modules/@sentry/core/esm/exports.js"),a=s("../node_modules/scroll-to-element/index.js"),r=s.n(a),l=s("./app/utils.tsx"),d=s("./app/utils/sanitizeQuerySelector.tsx"),c=s("./app/utils/withSentryRouter.tsx"),u=s("./app/components/forms/formPanel.tsx"),p=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class h extends i.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{highlighted:this.props.location?.hash})}componentDidMount(){this.scrollToHash()}componentDidUpdate(e){if(this.props.location&&this.props.location.hash!==e.location.hash){const e=this.props.location.hash;this.scrollToHash(e),this.setState({highlighted:e})}}scrollToHash(e){const t=e||this.props.location?.hash;if(t)try{r()((0,d.m)(decodeURIComponent(t)),{align:"middle",offset:-100})}catch(e){o.Tb(e)}}shouldDisplayForm(e){const t=e.filter((e=>"function"!=typeof e&&(0,l.ri)(e?.visible)));if(e.length===t.length){const{additionalFieldProps:e,...s}=this.props;return!t.every((t=>"function"==typeof t.visible?!t.visible({...s,...e}):!t.visible))}return!0}renderForm(e){let{fields:t,formPanelProps:s,title:n}=e;return this.shouldDisplayForm(t)||s?.renderFooter||s?.renderHeader?(0,p.tZ)(u.Z,{title:n,fields:t,...s}):null}render(){const{access:e,collapsible:t,initiallyCollapsed:s,fields:n,title:o,forms:a,disabled:r,features:l,additionalFieldProps:d,renderFooter:c,renderHeader:u,location:h,params:g,router:m,routes:v,...f}=this.props,b={access:e,disabled:r,features:l,additionalFieldProps:d,renderFooter:c,renderHeader:u,highlighted:this.state.highlighted,collapsible:t,initiallyCollapsed:s};return(0,p.BX)("div",{...f,children:[void 0!==a&&a.map(((e,t)=>(0,p.tZ)(i.Fragment,{children:this.renderForm({formPanelProps:b,...e})},t))),void 0===a&&void 0!==n&&this.renderForm({fields:n,formPanelProps:b,title:o})]})}}h.displayName="JsonForm";const g=(0,c.Z)(h)},"./app/components/panels/panelHeader.tsx":(e,t,s)=>{s.d(t,{Z:()=>r});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=s("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),o=s("./app/styles/space.tsx");const a=e=>{let{disablePadding:t,hasButtons:s}=e;return(0,i.iv)("padding:",s?(0,o.D)(1):(0,o.D)(2)," ",t?0:(0,o.D)(2),";","")},r=(0,n.Z)("div",{target:"e1dzfr4k0"})("display:flex;align-items:center;justify-content:space-between;color:",(e=>e.lightText?e.theme.gray300:e.theme.gray400),";font-size:",(e=>e.theme.fontSizeSmall),";font-weight:600;text-transform:uppercase;border-bottom:1px solid ",(e=>e.theme.border),";border-radius:calc(",(e=>e.theme.panelBorderRadius)," - 1px) calc(",(e=>e.theme.panelBorderRadius)," - 1px) 0 0;background:",(e=>e.theme.backgroundSecondary),";line-height:1;position:relative;",a,";")},"./app/utils/crashReports.tsx":(e,t,s)=>{s.d(t,{IS:()=>o,RF:()=>a,uk:()=>r}),s("../node_modules/core-js/modules/es.array.unshift.js");var n=s("./app/locale.tsx"),i=s("./app/utils.tsx");function o(e,t){return null===e&&(0,i.ri)(t)?(0,n._N)("Inherit organization settings ([organizationValue])",{organizationValue:o(t)}):-1===e?(0,n.t)("Unlimited"):0===e?(0,n.t)("Disabled"):(0,n._N)("[value] per issue",{value:e})}let a;function r(e){const t=[0,1,5,10,20,50,100,-1];return e===a.PROJECT&&t.unshift(null),t}!function(e){e[e.ORGANIZATION=0]="ORGANIZATION",e[e.PROJECT=1]="PROJECT"}(a||(a={}))},"./app/views/settings/components/dataScrubbing/index.tsx":(e,t,s)=>{s.d(t,{y:()=>Ue});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=s("../node_modules/react/index.js"),o=s("./app/actionCreators/indicator.tsx"),a=s("./app/actionCreators/modal.tsx"),r=s("./app/components/button.tsx"),l=s("./app/components/emptyMessage.tsx"),d=s("./app/components/links/externalLink.tsx"),c=s("./app/components/panels/panel.tsx"),u=s("./app/components/panels/panelAlert.tsx"),p=s("./app/components/panels/panelBody.tsx"),h=s("./app/components/panels/panelHeader.tsx"),g=s("./app/icons/index.tsx"),m=s("./app/locale.tsx"),v=s("./app/styles/space.tsx"),f=s("./app/utils.tsx"),b=s("./app/utils/useApi.tsx"),y=s("./app/utils/useNavigate.tsx"),x=s("./app/utils/useParams.tsx"),S=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),Z=(s("../node_modules/core-js/modules/es.array.push.js"),s("../node_modules/lodash/isEqual.js")),C=s.n(Z),I=s("../node_modules/lodash/omit.js"),R=s.n(I),w=s("./app/views/settings/components/dataScrubbing/types.tsx");function D(e){return e.type===w.SV.PATTERN&&e.method===w.Tr.REPLACE?{type:e.type,pattern:e.pattern,redaction:{method:e.method,text:e?.placeholder}}:e.type===w.SV.PATTERN?{type:e.type,pattern:e.pattern,redaction:{method:e.method}}:e.method===w.Tr.REPLACE?{type:e.type,redaction:{method:e.method,text:e?.placeholder}}:{type:e.type,redaction:{method:e.method}}}const E=function(e,t,s){const n={},i={};for(let e=0;e<s.length;e++){const t=s[e],o=String(e);i[o]=D(t),n[t.source]||(n[t.source]=[]),n[t.source].includes(o)||n[t.source].push(o)}const o={rules:i,applications:n};return e.requestPromise(t,{method:"PUT",data:{relayPiiConfig:JSON.stringify(o)}})};var k=s("./app/views/settings/components/dataScrubbing/utils.tsx"),N=s("../node_modules/lodash/sortBy.js"),T=s.n(N),F=s("./app/components/forms/fieldGroup/index.tsx"),A=s("./app/components/input.tsx"),X=s("../node_modules/@sentry/browser/node_modules/@sentry/core/esm/exports.js"),z=s("./app/utils/localStorage.tsx");const V="advanced-data-scrubbing";function j(e){try{z.Z.setItem(V,JSON.stringify(e))}catch(t){X.Tb(t),X.$e((s=>{s.setExtra("storage",e),X.Tb(t)}))}}function P(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.L4;switch(e.status){case w.X6.LOADING:break;case w.X6.LOADED:j({eventId:e.value,sourceSuggestions:t});break;default:j({eventId:"",sourceSuggestions:t})}}var L=s("./app/components/forms/fieldGroup/controlState.tsx"),O=s("./app/components/tooltip.tsx"),B=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const _=function(e){let{status:t,onClickIconClose:s}=e;switch(t){case w.X6.ERROR:case w.X6.INVALID:case w.X6.NOT_FOUND:return(0,B.tZ)(U,{onClick:s,children:(0,B.tZ)(O.u,{title:(0,m.t)("Clear event ID"),children:(0,B.tZ)($,{size:"xs"})})});case w.X6.LOADING:return(0,B.tZ)(L.Z,{isSaving:!0});case w.X6.LOADED:return(0,B.tZ)(g.DL,{color:"successText"});default:return null}},U=(0,n.Z)("div",{target:"espzglk1"})({name:"15o8flj",styles:":first-child{line-height:0;}"}),$=(0,n.Z)(g.bM,{target:"espzglk0"})("color:",(e=>e.theme.gray200),";:hover{color:",(e=>e.theme.gray300),";}cursor:pointer;");class H extends i.Component{constructor(){super(...arguments),(0,S.Z)(this,"state",{...this.props.eventId}),(0,S.Z)(this,"handleChange",(e=>{const t=e.target.value.replace(/-/g,"").trim();t!==this.state.value&&this.setState({value:t,status:w.X6.UNDEFINED})})),(0,S.Z)(this,"handleBlur",(e=>{e.preventDefault(),this.isEventIdValid()&&this.props.onUpdateEventId(this.state.value)})),(0,S.Z)(this,"handleKeyDown",(e=>{const{key:t}=e;"Enter"===t&&this.isEventIdValid()&&this.props.onUpdateEventId(this.state.value)})),(0,S.Z)(this,"handleClickIconClose",(()=>{this.setState({value:"",status:w.X6.UNDEFINED})}))}componentDidUpdate(e){C()(e.eventId,this.props.eventId)||this.loadState()}loadState(){this.setState({...this.props.eventId})}getErrorMessage(){const{status:e}=this.state;switch(e){case w.X6.INVALID:return(0,m.t)("This event ID is invalid");case w.X6.ERROR:return(0,m.t)("An error occurred while fetching the suggestions based on this event ID");case w.X6.NOT_FOUND:return(0,m.t)("The chosen event ID was not found in projects you have access to");default:return}}isEventIdValid(){const{value:e,status:t}=this.state;return!e||32===e.length||(t!==w.X6.INVALID&&(P({value:e,status:t}),this.setState({status:w.X6.INVALID})),!1)}render(){const{disabled:e}=this.props,{value:t,status:s}=this.state;return(0,B.tZ)(F.Z,{"data-test-id":"event-id-field",label:(0,m.t)("Event ID (Optional)"),help:(0,m.t)("Providing an event ID will automatically provide you a list of suggested sources"),inline:!1,error:this.getErrorMessage(),flexibleControlStateSize:!0,stacked:!0,showHelpInTooltip:!0,children:(0,B.BX)(K,{children:[(0,B.tZ)(G,{type:"text",name:"eventId",disabled:e,value:t,placeholder:(0,m.t)("XXXXXXXXXXXXXX"),onChange:this.handleChange,onKeyDown:this.handleKeyDown,onBlur:this.handleBlur}),(0,B.tZ)(q,{children:(0,B.tZ)(_,{onClickIconClose:this.handleClickIconClose,status:s})})]})})}}H.displayName="EventIdField";const M=H,G=(0,n.Z)(A.Z,{target:"e1e6d2372"})("flex:1;font-weight:400;input{padding-right:",(0,v.D)(1.5),";}margin-bottom:0;"),q=(0,n.Z)("div",{target:"e1e6d2371"})("height:100%;position:absolute;right:",(0,v.D)(1.5),";top:0;display:flex;align-items:center;"),K=(0,n.Z)("div",{target:"e1e6d2370"})({name:"9iujih",styles:"position:relative;display:flex;align-items:center"});var W=s("./app/components/forms/controls/selectControl.tsx");class Y extends i.Component{constructor(){super(...arguments),(0,S.Z)(this,"selectRef",(0,i.createRef)())}componentDidMount(){this.selectRef.current&&this.selectRef.current?.select?.inputRef&&(this.selectRef.current.select.inputRef.autocomplete="off")}render(){return(0,B.tZ)(W.Z,{...this.props,isSearchable:!1,options:this.props.options.map((e=>({...e,details:e.description?`(${e.description})`:void 0}))),ref:this.selectRef,openOnFocus:!0})}}Y.displayName="SelectField";const J=Y;var Q=s("./app/components/forms/fields/textField.tsx"),ee=s("./app/components/textOverflow.tsx"),te=s("./app/components/hovercard.tsx");function se(e){let{examples:t,sourceName:s}=e;return(0,B.tZ)(ae,{children:(0,B.tZ)(ie,{position:"right",header:(0,m.t)("Examples for %s in current event",(0,B.tZ)("code",{children:s})),body:t.map((e=>(0,B.tZ)("pre",{children:e},e))),children:(0,B.BX)(oe,{children:[(0,m.t)("See Example")," ",(0,B.tZ)(g.BS,{size:"xs"})]})})})}se.displayName="SourceSuggestionExamples";const ne=se,ie=(0,n.Z)(te.uI,{target:"eoxb9ts2"})({name:"75ukw4",styles:"width:400px;pre:last-child{margin:0;}"}),oe=(0,n.Z)("span",{target:"eoxb9ts1"})("display:inline-grid;grid-template-columns:repeat(2, max-content);align-items:center;gap:",(0,v.D)(.5),";color:",(e=>e.theme.gray400),";font-size:",(e=>e.theme.fontSizeSmall),";text-decoration:underline;text-decoration-style:dotted;"),ae=(0,n.Z)("div",{target:"eoxb9ts0"})({name:"nxv87c",styles:"grid-column:3/3"}),re=(0,m.t)("Where to look. In the simplest case this can be an attribute name.");class le extends i.Component{constructor(){super(...arguments),(0,S.Z)(this,"state",{suggestions:[],fieldValues:[],activeSuggestion:0,showSuggestions:!1,hideCaret:!1,help:re}),(0,S.Z)(this,"selectorField",(0,i.createRef)()),(0,S.Z)(this,"suggestionList",(0,i.createRef)()),(0,S.Z)(this,"handleChange",(e=>{this.loadFieldValues(e),this.props.onChange(e)})),(0,S.Z)(this,"handleClickOutside",(()=>{this.setState({showSuggestions:!1,hideCaret:!1})})),(0,S.Z)(this,"handleClickSuggestionItem",(e=>{const t=this.getNewFieldValues(e);this.setState({fieldValues:t,activeSuggestion:0,showSuggestions:!1,hideCaret:!1},this.changeParentValue)})),(0,S.Z)(this,"handleKeyDown",((e,t)=>{t.persist();const{key:s}=t,{activeSuggestion:n,suggestions:i}=this.state;if("Backspace"!==s&&" "!==s)if("Enter"!==s)if("ArrowUp"!==s)if("ArrowDown"!==s);else{if(n===i.length-1)return;this.setState({activeSuggestion:n+1},(()=>{this.scrollToSuggestion()}))}else{if(0===n)return;this.setState({activeSuggestion:n-1},(()=>{this.scrollToSuggestion()}))}else this.handleClickSuggestionItem(i[n]);else this.toggleSuggestions(!0)})),(0,S.Z)(this,"handleFocus",(()=>{this.toggleSuggestions(!0)}))}componentDidMount(){this.loadFieldValues(this.props.value),this.toggleSuggestions(!1)}componentDidUpdate(e){e.suggestions!==this.props.suggestions&&(this.loadFieldValues(this.props.value),this.toggleSuggestions(!1)),e.isRegExMatchesSelected===this.props.isRegExMatchesSelected&&e.value===this.props.value||this.checkPossiblyRegExMatchExpression(this.props.value)}getAllSuggestions(){return[...this.getValueSuggestions(),...k.Gx,...k.OL]}getValueSuggestions(){return this.props.suggestions||[]}getFilteredSuggestions(e,t){let s=[];switch(t){case w.LZ.BINARY:s=k.OL;break;case w.LZ.VALUE:s=this.getValueSuggestions();break;case w.LZ.UNARY:s=k.Gx;break;default:s=[...this.getValueSuggestions(),...k.Gx]}return s.filter((t=>t.value.toLowerCase().includes(e.toLowerCase())))}getNewSuggestions(e){const t=e[e.length-1],s=e[e.length-2];return Array.isArray(t)?this.getNewSuggestions(t):Array.isArray(s)?"binary"===t?.type?this.getFilteredSuggestions(t?.value,w.LZ.VALUE):this.getFilteredSuggestions("",w.LZ.BINARY):"value"===t?.type&&"unary"===s?.type?this.getFilteredSuggestions(t?.value,w.LZ.VALUE):"unary"===t?.type?this.getFilteredSuggestions("",w.LZ.VALUE):"string"===t?.type&&"value"===s?.type?this.getFilteredSuggestions("",w.LZ.BINARY):"string"!==t?.type||"string"!==s?.type||s?.value?"string"===s?.type&&!t?.value||"value"===s?.type&&!t?.value||"binary"===t?.type?this.getFilteredSuggestions(t?.value,w.LZ.BINARY):this.getFilteredSuggestions(t?.value,t?.type):this.getFilteredSuggestions("",w.LZ.STRING)}loadFieldValues(e){const t=[],s=e.split(" ");for(const e in s){const n=s[e],i=t[t.length-1];if(i&&!Array.isArray(i)&&!i.value&&!n)continue;if(n.includes("!")&&n.split("!")[1]){const e=n.split("!")[1],s=this.getAllSuggestions().find((t=>t.value===e));if(!s){t.push([k.Gx[0],{type:w.LZ.STRING,value:e}]);continue}t.push([k.Gx[0],s]);continue}const o=this.getAllSuggestions().find((e=>e.value===n));o?t.push(o):t.push({type:w.LZ.STRING,value:n})}const n=this.getNewSuggestions(t);this.setState({fieldValues:t,activeSuggestion:0,suggestions:n})}scrollToSuggestion(){const{activeSuggestion:e,hideCaret:t}=this.state;this.suggestionList?.current?.children[e].scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),t||this.setState({hideCaret:!0})}changeParentValue(){const{onChange:e}=this.props,{fieldValues:t}=this.state,s=[];for(const e in t){const n=t[e];Array.isArray(n)?(n[0]?.value||n[1]?.value)&&s.push(`${n[0]?.value??""}${n[1]?.value??""}`):s.push(n.value)}e(s.join(" "))}getNewFieldValues(e){const t=[...this.state.fieldValues],s=t[t.length-1];return(0,f.ri)(s)?Array.isArray(s)?(t[t.length-1]=[s[0],e],t):("unary"===s?.type&&(t[t.length-1]=[s,e]),"string"!==s?.type||s?.value?"value"===e.type&&s?.value!==e.value?[e]:t:(t[t.length-1]=e,t)):[e]}checkPossiblyRegExMatchExpression(e){const{isRegExMatchesSelected:t}=this.props,{help:s}=this.state;if(t)return void(s&&this.setState({help:""}));const n=RegExp("^/.*/g?$").test(e);s?n||this.setState({help:re}):n&&this.setState({help:(0,m.t)("You might want to change Data Type's value to 'Regex matches'")})}toggleSuggestions(e){this.setState({showSuggestions:e})}render(){const{error:e,value:t,onBlur:s}=this.props,{showSuggestions:n,suggestions:o,activeSuggestion:a,hideCaret:r,help:l}=this.state;return(0,B.BX)(ce,{ref:this.selectorField,hideCaret:r,children:[(0,B.tZ)(ue,{"data-test-id":"source-field",label:(0,m.t)("Source"),name:"source",placeholder:(0,m.t)("Enter a custom attribute, variable or header name"),onChange:this.handleChange,autoComplete:"off",value:t,error:e,help:l,onKeyDown:this.handleKeyDown,onBlur:s,onFocus:this.handleFocus,inline:!1,flexibleControlStateSize:!0,stacked:!0,required:!0,showHelpInTooltip:!0}),n&&o.length>0&&(0,B.BX)(i.Fragment,{children:[(0,B.tZ)(pe,{ref:this.suggestionList,error:e,"data-test-id":"source-suggestions",children:o.slice(0,50).map(((e,t)=>(0,B.BX)(he,{onClick:t=>{t.preventDefault(),this.handleClickSuggestionItem(e)},active:t===a,tabIndex:-1,children:[(0,B.tZ)(ee.Z,{children:e.value}),e.description&&(0,B.BX)(ge,{children:["(",(0,B.tZ)(ee.Z,{children:e.description}),")"]}),e.examples&&e.examples.length>0&&(0,B.tZ)(ne,{examples:e.examples,sourceName:e.value})]},e.value)))}),(0,B.tZ)(me,{onClick:this.handleClickOutside})]})]})}}le.displayName="SourceField";const de=le,ce=(0,n.Z)("div",{target:"edm47kj5"})("position:relative;width:100%;",(e=>e.hideCaret&&"caret-color: transparent;"),";"),ue=(0,n.Z)(Q.Z,{target:"edm47kj4"})({name:"1wsr984",styles:"z-index:1002;:focus{outline:none;}"}),pe=(0,n.Z)("ul",{target:"edm47kj3"})("position:absolute;width:",(e=>e.error?"calc(100% - 34px)":"100%"),";padding-left:0;list-style:none;margin-bottom:0;box-shadow:0 2px 0 rgba(37, 11, 54, 0.04);border:1px solid ",(e=>e.theme.border),";border-radius:0 0 ",(0,v.D)(.5)," ",(0,v.D)(.5),";background:",(e=>e.theme.background),";top:63px;left:0;z-index:1002;overflow:hidden;max-height:200px;overflow-y:auto;"),he=(0,n.Z)("li",{target:"edm47kj2"})("display:grid;grid-template-columns:auto 1fr max-content;gap:",(0,v.D)(1),";border-bottom:1px solid ",(e=>e.theme.border),";padding:",(0,v.D)(1)," ",(0,v.D)(2),";font-size:",(e=>e.theme.fontSizeMedium),";cursor:pointer;background:",(e=>e.active?e.theme.backgroundSecondary:e.theme.background),";:hover{background:",(e=>(e.active,e.theme.backgroundSecondary)),";}"),ge=(0,n.Z)("div",{target:"edm47kj1"})("display:flex;overflow:hidden;color:",(e=>e.theme.gray300),";line-height:1.2;"),me=(0,n.Z)("div",{target:"edm47kj0"})({name:"1ljbwes",styles:"position:fixed;top:0;left:0;right:0;bottom:0;z-index:1001"});class ve extends i.Component{constructor(){super(...arguments),(0,S.Z)(this,"state",{displayEventId:!!this.props.eventId?.value}),(0,S.Z)(this,"handleChange",(e=>t=>{this.props.onChange(e,t.target.value)})),(0,S.Z)(this,"handleToggleEventId",(()=>{this.setState((e=>({displayEventId:!e.displayEventId})))}))}render(){const{values:e,onChange:t,errors:s,onValidate:n,sourceSuggestions:o,onUpdateEventId:a,eventId:r}=this.props,{method:l,type:d,source:c}=e,{displayEventId:u}=this.state;return(0,B.BX)(i.Fragment,{children:[(0,B.BX)(be,{hasTwoColumns:e.method===w.Tr.REPLACE,children:[(0,B.tZ)(F.Z,{label:(0,m.t)("Method"),help:(0,m.t)("What to do"),inline:!1,flexibleControlStateSize:!0,stacked:!0,showHelpInTooltip:!0,children:(0,B.tZ)(J,{placeholder:(0,m.t)("Select method"),name:"method",options:T()(Object.values(w.Tr)).map((e=>({...(0,k.zk)(e),value:e}))),value:l,onChange:e=>t("method",e?.value)})}),e.method===w.Tr.REPLACE&&(0,B.tZ)(F.Z,{label:(0,m.t)("Custom Placeholder (Optional)"),help:(0,m.t)("It will replace the default placeholder [Filtered]"),inline:!1,flexibleControlStateSize:!0,stacked:!0,showHelpInTooltip:!0,children:(0,B.tZ)(A.Z,{type:"text",name:"placeholder",placeholder:`[${(0,m.t)("Filtered")}]`,onChange:this.handleChange("placeholder"),value:e.placeholder})})]}),(0,B.BX)(be,{hasTwoColumns:e.type===w.SV.PATTERN,children:[(0,B.tZ)(F.Z,{"data-test-id":"type-field",label:(0,m.t)("Data Type"),help:(0,m.t)("What to look for. Use an existing pattern or define your own using regular expressions."),inline:!1,flexibleControlStateSize:!0,stacked:!0,showHelpInTooltip:!0,children:(0,B.tZ)(J,{placeholder:(0,m.t)("Select type"),name:"type",options:T()(Object.values(w.SV)).map((e=>({label:(0,k.D2)(e),value:e}))),value:d,onChange:e=>t("type",e?.value)})}),e.type===w.SV.PATTERN&&(0,B.tZ)(F.Z,{label:(0,m.t)("Regex matches"),help:(0,m.t)("Custom regular expression (see documentation)"),inline:!1,id:"regex-matches",error:s?.pattern,flexibleControlStateSize:!0,stacked:!0,required:!0,showHelpInTooltip:!0,children:(0,B.tZ)(xe,{type:"text",name:"pattern",placeholder:(0,m.t)("[a-zA-Z0-9]+"),onChange:this.handleChange("pattern"),value:e.pattern,onBlur:n("pattern"),id:"regex-matches"})})]}),(0,B.tZ)(Se,{children:u?(0,B.BX)(Ze,{priority:"link",onClick:this.handleToggleEventId,children:[(0,m.t)("Hide event ID field"),(0,B.tZ)(g.g6,{direction:"up",size:"xs"})]}):(0,B.BX)(Ze,{priority:"link",onClick:this.handleToggleEventId,children:[(0,m.t)("Use event ID for auto-completion"),(0,B.tZ)(g.g6,{direction:"down",size:"xs"})]})}),(0,B.BX)(ye,{isExpanded:u,children:[u&&(0,B.tZ)(M,{onUpdateEventId:a,eventId:r}),(0,B.tZ)(de,{onChange:e=>t("source",e),value:c,error:s?.source,onBlur:n("source"),isRegExMatchesSelected:d===w.SV.PATTERN,suggestions:o})]})]})}}ve.displayName="Form";const fe=ve,be=(0,n.Z)("div",{target:"ev0zhvw4"})("display:grid;margin-bottom:",(0,v.D)(2),";@media (min-width: ",(e=>e.theme.breakpoints.small),"){gap:",(0,v.D)(2),";",(e=>e.hasTwoColumns&&"grid-template-columns: 1fr 1fr;")," margin-bottom:",(e=>e.hasTwoColumns?0:(0,v.D)(2)),";}"),ye=(0,n.Z)("div",{target:"ev0zhvw3"})("height:65px;transition:all 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition-property:height;",(e=>e.isExpanded&&`\n    border-radius: ${e.theme.borderRadius};\n    border: 1px solid ${e.theme.border};\n    box-shadow: ${e.theme.dropShadowMedium};\n    margin: ${(0,v.D)(2)} 0 ${(0,v.D)(3)} 0;\n    padding: ${(0,v.D)(2)};\n    height: 180px;\n  `),";"),xe=(0,n.Z)(A.Z,{target:"ev0zhvw2"})("font-family:",(e=>e.theme.text.familyMono),";"),Se=(0,n.Z)("div",{target:"ev0zhvw1"})({name:"skgbeu",styles:"display:flex;justify-content:flex-end"}),Ze=(0,n.Z)(r.zx,{target:"ev0zhvw0"})("font-weight:700;color:",(e=>e.theme.subText),";&:hover,&:focus{color:",(e=>e.theme.textColor),";}>*:first-child{display:grid;gap:",(0,v.D)(.5),";grid-template-columns:repeat(2, max-content);align-items:center;}");let Ce;!function(e){e.UNKNOWN="unknown",e.INVALID_SELECTOR="invalid-selector",e.REGEX_PARSE="regex-parse"}(Ce||(Ce={}));var Ie=s("./app/components/buttonBar.tsx");function Re(e){let{title:t,onSave:s,content:n,disabled:o,Header:a,Body:l,Footer:d,closeModal:c}=e;return(0,B.BX)(i.Fragment,{children:[(0,B.tZ)(a,{closeButton:!0,children:(0,B.tZ)("h5",{children:t})}),(0,B.tZ)(l,{children:n}),(0,B.tZ)(d,{children:(0,B.BX)(Ie.ZP,{gap:1.5,children:[(0,B.tZ)(r.zx,{onClick:c,children:(0,m.t)("Cancel")}),(0,B.tZ)(r.zx,{onClick:s,disabled:o,priority:"primary",children:(0,m.t)("Save Rule")})]})})]})}Re.displayName="Modal";const we=Re;class De extends i.Component{constructor(){super(...arguments),(0,S.Z)(this,"state",this.getDefaultState()),(0,S.Z)(this,"handleChange",((e,t)=>{const s={...this.state.values,[e]:t};s.type!==w.SV.PATTERN&&s.pattern&&(s.pattern=""),s.method!==w.Tr.REPLACE&&s.placeholder&&(s.placeholder=""),this.setState((t=>({values:s,requiredValues:this.getRequiredValues(s),errors:R()(t.errors,e)})))})),(0,S.Z)(this,"handleSave",(async()=>{const{endpoint:e,api:t,onSubmitSuccess:s,closeModal:n,onGetNewRules:i}=this.props,o=i(this.state.values);try{s(await E(t,e,o)),n()}catch(e){this.convertRequestError(function(e){const t=e.responseJSON?.relayPiiConfig[0];if(!t)return{type:Ce.UNKNOWN,message:(0,m.t)("Unknown error occurred while saving data scrubbing rule")};if(t.startsWith("invalid selector: "))for(const e of t.split("\n"))if(e.startsWith("1 | ")){const t=e.slice(3);return{type:Ce.INVALID_SELECTOR,message:(0,m.t)("Invalid source value: %s",t)}}if(t.startsWith("regex parse error:"))for(const e of t.split("\n"))if(e.startsWith("error:")){const t=e.slice(6).replace(/at line \d+ column \d+/,"");return{type:Ce.REGEX_PARSE,message:(0,m.t)("Invalid regex: %s",t)}}return{type:Ce.UNKNOWN,message:(0,m.t)("An unknown error occurred while saving data scrubbing rule")}}(e))}})),(0,S.Z)(this,"handleValidate",(e=>()=>{const t=!this.state.values[e].trim(),s=this.state.errors[e];t&&s||(!t||s?!t&&s&&this.clearError(e):this.setState((t=>({errors:{...t.errors,[e]:(0,m.t)("Field Required")}}))))})),(0,S.Z)(this,"handleUpdateEventId",(e=>{e!==this.state.eventId.value&&this.setState({eventId:{value:e,status:w.X6.UNDEFINED}})}))}componentDidMount(){this.handleValidateForm()}componentDidUpdate(e,t){C()(t.values,this.state.values)||this.handleValidateForm(),t.eventId.value!==this.state.eventId.value&&this.loadSourceSuggestions(),t.eventId.status!==this.state.eventId.status&&P(this.state.eventId,this.state.sourceSuggestions)}getDefaultState(){const{eventId:e,sourceSuggestions:t}=function(){const e=function(){const e=z.Z.getItem(V);if(e)try{return JSON.parse(e)}catch(t){return void X.$e((s=>{s.setExtra("storage",e),X.Tb(t)}))}}();if(!e){const e={eventId:"",sourceSuggestions:k.L4};return j(e),e}return e}(),s=this.getInitialValues();return{values:s,requiredValues:this.getRequiredValues(s),errors:{},isFormValid:!1,eventId:{value:e,status:e?w.X6.LOADED:w.X6.UNDEFINED},sourceSuggestions:t}}getInitialValues(){const{initialState:e}=this.props;return{type:e?.type??w.SV.CREDITCARD,method:e?.method??w.Tr.MASK,source:e?.source??"",placeholder:e?.placeholder??"",pattern:e?.pattern??""}}getRequiredValues(e){const{type:t}=e,s=["type","method","source"];return t===w.SV.PATTERN&&s.push("pattern"),s}clearError(e){this.setState((t=>({errors:R()(t.errors,e)})))}async loadSourceSuggestions(){const{orgSlug:e,projectId:t,api:s}=this.props,{eventId:n}=this.state;if(n.value){this.setState((e=>({sourceSuggestions:k.L4,eventId:{...e.eventId,status:w.X6.LOADING}})));try{const i={eventId:n.value};t&&(i.projectId=t);const o=(await s.requestPromise(`/organizations/${e}/data-scrubbing-selector-suggestions/`,{query:i})).suggestions;if(o&&o.length>0)return void this.setState((e=>({sourceSuggestions:o,eventId:{...e.eventId,status:w.X6.LOADED}})));this.setState((e=>({sourceSuggestions:k.L4,eventId:{...e.eventId,status:w.X6.NOT_FOUND}})))}catch{this.setState((e=>({eventId:{...e.eventId,status:w.X6.ERROR}})))}}else this.setState((e=>({sourceSuggestions:k.L4,eventId:{...e.eventId,status:w.X6.UNDEFINED}})))}convertRequestError(e){switch(e.type){case Ce.INVALID_SELECTOR:this.setState((t=>({errors:{...t.errors,source:e.message}})));break;case Ce.REGEX_PARSE:this.setState((t=>({errors:{...t.errors,pattern:e.message}})));break;default:(0,o.Iw)(e.message)}}handleValidateForm(){const{values:e,requiredValues:t}=this.state,s=t.every((t=>!!e[t]));this.setState({isFormValid:s})}render(){const{values:e,errors:t,isFormValid:s,eventId:n,sourceSuggestions:i}=this.state,{title:o}=this.props;return(0,B.tZ)(we,{...this.props,title:o,onSave:this.handleSave,disabled:!s,content:(0,B.tZ)(fe,{onChange:this.handleChange,onValidate:this.handleValidate,onUpdateEventId:this.handleUpdateEventId,eventId:n,errors:t,values:e,sourceSuggestions:i})})}}De.displayName="ModalManager";const Ee=De;function ke(e){let{savedRules:t,...s}=e;return(0,B.tZ)(Ee,{...s,savedRules:t,title:(0,m.t)("Add an advanced data scrubbing rule"),onGetNewRules:e=>[...t,{...e,id:t.length}]})}ke.displayName="Add";const Ne=ke;function Te(e){let{savedRules:t,rule:s,...n}=e;return(0,B.tZ)(Ee,{...n,savedRules:t,title:(0,m.t)("Edit an advanced data scrubbing rule"),initialState:s,onGetNewRules:e=>{const n={...e,id:s.id};return t.map((e=>e.id===n.id?n:e))}})}Te.displayName="Edit";const Fe=Te;var Ae=s("./app/views/settings/components/dataScrubbing/convertRelayPiiConfig.tsx"),Xe=s("./app/components/confirmDelete.tsx");const ze=(0,i.forwardRef)((function(e,t){let{rules:s,onEditRule:n,onDeleteRule:i,disabled:o}=e;return(0,B.tZ)(Ve,{ref:t,isDisabled:o,"data-test-id":"advanced-data-scrubbing-rules",children:s.map((e=>{const{id:t}=e,s=(0,k.x7)(e);return(0,B.BX)(je,{children:[(0,B.tZ)(ee.Z,{children:s}),n&&(0,B.tZ)(r.zx,{"aria-label":(0,m.t)("Edit Rule"),size:"sm",onClick:()=>n(t),icon:(0,B.tZ)(g.yl,{}),disabled:o,title:o?(0,m.t)("You do not have permission to edit rules"):void 0}),i&&(0,B.tZ)(Xe.Z,{message:(0,m.t)("Are you sure you wish to delete this rule?"),priority:"danger",onConfirm:()=>i(t),confirmInput:s,disabled:o,stopPropagation:!0,children:(0,B.tZ)(r.zx,{"aria-label":(0,m.t)("Delete Rule"),size:"sm",icon:(0,B.tZ)(g.Fz,{}),disabled:o,title:o?(0,m.t)("You do not have permission to delete rules"):void 0})})]},t)}))})})),Ve=(0,n.Z)("ul",{target:"etr6tm01"})("list-style:none;margin:0;padding:0;margin-bottom:0!important;",(e=>e.isDisabled&&`\n      color: ${e.theme.gray200};\n      background: ${e.theme.backgroundSecondary};\n  `),";"),je=(0,n.Z)("li",{target:"etr6tm00"})("display:grid;grid-template-columns:auto max-content max-content;grid-column-gap:",(0,v.D)(1),";align-items:center;padding:",(0,v.D)(1)," ",(0,v.D)(2),";border-bottom:1px solid ",(e=>e.theme.border),";&:hover{background-color:",(e=>e.theme.backgroundSecondary),";}&:last-child{border-bottom:0;}");class Pe extends i.Component{constructor(){super(...arguments),(0,S.Z)(this,"state",{isCollapsed:!0,rules:[]}),(0,S.Z)(this,"rulesRef",(0,i.createRef)()),(0,S.Z)(this,"handleToggleCollapsed",(()=>{this.setState((e=>({isCollapsed:!e.isCollapsed})))}))}componentDidMount(){this.loadRules()}componentDidUpdate(e){e.organization.relayPiiConfig===this.props.organization.relayPiiConfig?this.loadContentHeight():this.loadRules()}loadContentHeight(){if(!this.state.contentHeight){const e=this.rulesRef.current?.offsetHeight;e&&this.setState({contentHeight:`${e}px`})}}loadRules(){try{this.setState({rules:(0,Ae.O)(this.props.organization.relayPiiConfig)})}catch{(0,o.Iw)((0,m.t)("Unable to load data scrubbing rules"))}}render(){const{isCollapsed:e,contentHeight:t,rules:s}=this.state;return 0===s.length?(0,B.tZ)(Be,{children:(0,m.t)("There are no data scrubbing rules at the organization level")}):(0,B.BX)(Be,{isCollapsed:e,contentHeight:t,children:[(0,B.BX)(Oe,{onClick:this.handleToggleCollapsed,children:[(0,B.tZ)("div",{children:(0,m.t)("Organization Rules")}),(0,B.tZ)(r.zx,{title:e?(0,m.t)("Expand Organization Rules"):(0,m.t)("Collapse Organization Rules"),icon:(0,B.tZ)(g.g6,{size:"xs",direction:e?"down":"up"}),size:"xs","aria-label":(0,m.t)("Toggle Organization Rules")})]}),(0,B.tZ)(Le,{children:(0,B.tZ)(ze,{rules:s,ref:this.rulesRef,disabled:!0})})]})}}Pe.displayName="OrganizationRules";const Le=(0,n.Z)("div",{target:"e1tn02ai2"})({name:"ns4bq7",styles:"transition:height 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;height:0;overflow:hidden"}),Oe=(0,n.Z)("div",{target:"e1tn02ai1"})("cursor:pointer;display:grid;grid-template-columns:1fr auto;align-items:center;border-bottom:1px solid ",(e=>e.theme.border),";padding:",(0,v.D)(1)," ",(0,v.D)(2),";"),Be=(0,n.Z)("div",{target:"e1tn02ai0"})("color:",(e=>e.theme.gray200),";background:",(e=>e.theme.backgroundSecondary),";",(e=>!e.contentHeight&&`padding: ${(0,v.D)(1)} ${(0,v.D)(2)}`),";",(e=>!e.isCollapsed&&` border-bottom: 1px solid ${e.theme.border}`),";",(e=>!e.isCollapsed&&e.contentHeight&&`\n      ${Le} {\n        height: ${e.contentHeight};\n      }\n    `),";"),_e="https://docs.sentry.io/product/data-management-settings/scrubbing/advanced-datascrubbing/";function Ue(e){let{project:t,endpoint:s,organization:n,disabled:v,onSubmitSuccess:S,additionalContext:Z,relayPiiConfig:C}=e;const I=(0,b.Z)(),[R,w]=(0,i.useState)([]),D=(0,y.s)(),k=(0,x.U)(),N=(0,i.useCallback)(((e,t)=>{w((0,Ae.O)(e.relayPiiConfig)),(0,o.S9)(t),S?.(e)}),[S]),T=(0,i.useCallback)((()=>{const e=t?.slug?`/settings/${n.slug}/projects/${t.slug}/security-and-privacy/`:`/settings/${n.slug}/security-and-privacy/`;D(e)}),[D,n.slug,t?.slug]);return(0,i.useEffect)((()=>{(0,f.ri)(k.scrubbingId)&&R.some((e=>String(e.id)===k.scrubbingId))&&(0,a.openModal)((e=>(0,B.tZ)(Fe,{...e,rule:R[k.scrubbingId],projectId:t?.id,savedRules:R,api:I,endpoint:s,orgSlug:n.slug,onSubmitSuccess:e=>N(e,(0,m.t)("Successfully updated data scrubbing rule"))})),{onClose:T})}),[k.scrubbingId,R,t?.id,I,s,n.slug,N,T]),(0,i.useEffect)((()=>{!function(){try{w((0,Ae.O)(C))}catch{(0,o.Iw)((0,m.t)("Unable to load data scrubbing rules"))}}()}),[C]),(0,B.BX)(c.Z,{"data-test-id":"advanced-data-scrubbing",children:[(0,B.tZ)(h.Z,{children:(0,B.tZ)("div",{children:(0,m.t)("Advanced Data Scrubbing")})}),(0,B.BX)(u.Z,{type:"info",children:[Z," ",(0,m._N)("The new rules will only apply to upcoming events. For more details, see [linkToDocs].",{linkToDocs:(0,B.tZ)(d.Z,{href:_e,children:(0,m.t)("full documentation on data scrubbing")})})]}),(0,B.BX)(p.Z,{children:[t&&(0,B.tZ)(Pe,{organization:n}),R.length?(0,B.tZ)(ze,{rules:R,onDeleteRule:async function(e){try{const t=R.filter((t=>t.id!==e)),n=await E(I,s,t);n?.relayPiiConfig&&(w((0,Ae.O)(n.relayPiiConfig)),(0,o.S9)((0,m.t)("Successfully deleted data scrubbing rule")))}catch{(0,o.Iw)((0,m.t)("An unknown error occurred while deleting data scrubbing rule"))}},onEditRule:function(e){const s=t?`/settings/${n.slug}/projects/${t.slug}/security-and-privacy/advanced-data-scrubbing/${e}/`:`/settings/${n.slug}/security-and-privacy/advanced-data-scrubbing/${e}/`;D(s)},disabled:v}):(0,B.tZ)(l.Z,{icon:(0,B.tZ)(g.FC,{size:"xl"}),description:(0,m.t)("You have no data scrubbing rules")}),(0,B.BX)($e,{children:[(0,B.tZ)(r.zx,{href:_e,external:!0,children:(0,m.t)("Read Docs")}),(0,B.tZ)(r.zx,{disabled:v,onClick:function(){(0,a.openModal)((e=>(0,B.tZ)(Ne,{...e,projectId:t?.id,savedRules:R,api:I,endpoint:s,orgSlug:n.slug,onSubmitSuccess:e=>N(e,(0,m.t)("Successfully added data scrubbing rule"))})))},priority:"primary",children:(0,m.t)("Add Rule")})]})]})]})}Ue.displayName="DataScrubbing";const $e=(0,n.Z)("div",{target:"e1305fdd0"})("padding:",(0,v.D)(1)," ",(0,v.D)(2),";position:relative;display:grid;gap:",(0,v.D)(1),";grid-template-columns:auto auto;justify-content:flex-end;border-top:1px solid ",(e=>e.theme.border),";")}}]);
//# sourceMappingURL=../sourcemaps/app_components_forms_jsonForm_tsx-app_utils_crashReports_tsx-app_views_settings_components_da-556e2d.ff7cd224c3a2654ad43a632d858a3af6.js.map