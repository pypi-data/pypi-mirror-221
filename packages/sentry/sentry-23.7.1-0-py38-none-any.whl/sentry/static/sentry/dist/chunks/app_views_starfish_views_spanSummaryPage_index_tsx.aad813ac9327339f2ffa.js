"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_starfish_views_spanSummaryPage_index_tsx"],{"./app/utils/performance/contexts/pageError.tsx":(e,t,a)=>{a.d(t,{De:()=>d,V_:()=>o,YY:()=>l});var s=a("../node_modules/react/index.js"),n=a("./app/components/alert.tsx"),i=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const r=(0,s.createContext)({pageError:void 0,setPageError:e=>{}});function o(e){let{children:t}=e;const[a,n]=(0,s.useState)();return(0,i.tZ)(r.Provider,{value:{pageError:a,setPageError:n},children:t})}function l(){const{pageError:e}=(0,s.useContext)(r);return e?(0,i.tZ)(n.bZ,{type:"error","data-test-id":"page-error-alert",showIcon:!0,children:e}):null}o.displayName="PageErrorProvider",l.displayName="PageErrorAlert";const d=()=>(0,s.useContext)(r)},"./app/utils/useKeyPress.tsx":(e,t,a)=>{a.d(t,{Z:()=>n});var s=a("../node_modules/react/index.js");const n=(e,t)=>{const[a,n]=(0,s.useState)(!1),i=t??document.body;return(0,s.useEffect)((()=>{const t=t=>{let{key:a}=t;a===e&&n(!0)},a=t=>{let{key:a}=t;a===e&&n(!1)};return i.addEventListener("keydown",t),i.addEventListener("keyup",a),()=>{i.removeEventListener("keydown",t),i.removeEventListener("keyup",a)}}),[e,i]),a}},"./app/views/starfish/components/chartPanel.tsx":(e,t,a)=>{a.d(t,{Z:()=>l});var s=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(a("../node_modules/react/index.js"),a("./app/components/panels/panel.tsx")),i=a("./app/components/panels/panelBody.tsx"),r=a("./app/styles/space.tsx"),o=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function l(e){let{title:t,children:a,button:s}=e;return(0,o.tZ)(n.Z,{children:(0,o.BX)(i.Z,{withPadding:!0,children:[t&&(0,o.BX)(p,{children:[t&&(0,o.tZ)(d,{children:t}),s]}),a]})})}l.displayName="ChartPanel";const d=(0,s.Z)("p",{target:"e1tvnfsq1"})((e=>e.theme.text.cardTitle),";"),p=(0,s.Z)("div",{target:"e1tvnfsq0"})("padding:0 ",(0,r.D)(1)," 0 0;min-height:36px;width:100%;display:flex;align-items:center;justify-content:space-between;")},"./app/views/starfish/components/detailPanel.tsx":(e,t,a)=>{a.d(t,{Z:()=>Z});var s=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=a("../node_modules/react/index.js"),i=a("./app/components/button.tsx"),r=a("./app/icons/iconClose.tsx"),o=a("./app/locale.tsx"),l=a("./app/styles/space.tsx"),d=a("./app/utils/useKeyPress.tsx"),p=a("./app/utils/useOnClickOutside.tsx"),c=a("../node_modules/@emotion/is-prop-valid/dist/is-prop-valid.browser.esm.js"),m=a("../node_modules/framer-motion/dist/es/render/dom/motion.mjs"),u=a("./app/utils/analytics.tsx"),h=a("./app/utils/useLocation.tsx"),g=a("./app/utils/useOrganization.tsx"),S=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const v="50vw",f=(0,n.forwardRef)(y);function y(e,t){let{collapsed:a,children:s}=e;const{query:i}=(0,h.T)(),r=(0,g.Z)();return(0,n.useEffect)((()=>{a||(0,u.Gi)("starfish.panel.open",{organization:r})}),[i,a,r]),(0,S.tZ)(x,{ref:t,collapsed:a,initial:{opacity:0,x:v},animate:a?{opacity:0,x:v}:{opacity:1,x:0},transition:{type:"spring",stiffness:500,damping:50},children:s})}y.displayName="SlideOverPanel";const x=(0,s.Z)(m.E.div,{shouldForwardProp:e=>["animate","transition","initial"].includes(e)||"collapsed"!==e&&(0,c.Z)(e),target:"e1iwvxg00"})("width:",v,";position:fixed;top:0;bottom:0;right:0;background:",(e=>e.theme.background),";color:",(e=>e.theme.textColor),";border-left:1px solid ",(e=>e.theme.border),";text-align:left;z-index:",(e=>e.theme.zIndex.sidebar-1),";",(e=>e.collapsed?"overflow: hidden;":"overflow-x: hidden;\n  overflow-y: scroll;"),";");function Z(e){let{children:t,detailKey:a,onClose:s}=e;const[i,l]=(0,n.useState)({collapsed:!0}),c=(0,d.Z)("Escape");(0,n.useEffect)((()=>{l(a?{collapsed:!1}:{collapsed:!0})}),[a]);const m=(0,n.useRef)(null);return(0,p.Z)(m,(()=>{i.collapsed||(s?.(),l({collapsed:!0}))})),(0,n.useEffect)((()=>{c&&(i.collapsed||(s?.(),l({collapsed:!0})))}),[c]),(0,S.BX)(f,{collapsed:i.collapsed,ref:m,children:[(0,S.tZ)(_,{children:(0,S.tZ)(b,{priority:"link",size:"zero",borderless:!0,"aria-label":(0,o.t)("Close Details"),icon:(0,S.tZ)(r.b,{size:"sm"}),onClick:()=>{l({collapsed:!0}),s?.()}})}),(0,S.tZ)(P,{children:t})]})}Z.displayName="Detail";const b=(0,s.Z)(i.zx,{target:"e1clb2dw2"})("color:",(e=>e.theme.gray300),";&:hover{color:",(e=>e.theme.gray400),";}"),_=(0,s.Z)("div",{target:"e1clb2dw1"})("justify-content:flex-end;display:flex;padding:",(0,l.D)(2),";"),P=(0,s.Z)("div",{target:"e1clb2dw0"})("padding:0 ",(0,l.D)(4),";")},"./app/views/starfish/components/samplesTable/common.tsx":(e,t,a)=>{a.d(t,{f:()=>l,k:()=>d});var s=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=a("./app/locale.tsx"),i=a("./app/utils/formatters.tsx"),r=a("./app/views/starfish/components/textAlign.tsx"),o=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function l(e){let{duration:t,compareToDuration:a,containerProps:s}=e;const l=t-a;if(d(t,a))return(0,o.tZ)(r.Dq,{...s,children:(0,n.t)("Near baseline")});const c=(0,i.g9)(l/1e3,2,!0,!0),m=l>0?`+${c} above`:`${c} below`;return(0,o.tZ)(p,{...s,value:l,children:m})}l.displayName="DurationComparisonCell";const d=(e,t)=>{const a=.03*t;return Math.abs(e-t)<a},p=(0,s.Z)("span",{target:"e1tr2orr0"})("color:",(e=>0===e.value?e.theme.subText:e.value<0?e.theme.green400:e.theme.red400),";text-align:right;")},"./app/views/starfish/components/tableCells/throughputCell.tsx":(e,t,a)=>{a.d(t,{Z:()=>o});var s=a("./app/locale.tsx"),n=a("./app/utils/discover/styles.tsx"),i=a("./app/utils/formatters.tsx"),r=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function o(e){let{throughputPerSecond:t,containerProps:a}=e;const o=t?(0,i.Du)(t):"--";return(0,r.BX)(n.Hw,{...a,children:[o,"/",(0,s.t)("s")]})}o.displayName="ThroughputCell"},"./app/views/starfish/utils/extractRoute.tsx":(e,t,a)=>{function s(e){return e.pathname.match(/^\/starfish\/api\//)?"api":e.pathname.match(/^\/starfish\/database\//)?"database":e.pathname.match(/^\/starfish\/endpoint-overview\//)?"endpoint-overview":null}a.d(t,{G:()=>s})},"./app/views/starfish/utils/getDateConditions.tsx":(e,t,a)=>{a.d(t,{x:()=>o});var s=a("./app/components/organizations/pageFilters/parse.tsx"),n=a("../node_modules/moment/moment.js"),i=a.n(n);const r=/^(\d+)([h,d])$/,o=e=>{const{startTime:t,endTime:a,statsPeriod:n}=function(e){const[t,a,s]=e.datetime.period?.match(r)??[];return{startTime:a&&s?i()().subtract(a,s):i()(e.datetime.start),endTime:i()(e.datetime.end??void 0),statsPeriod:e.datetime.period}}(e),{start:o,end:l}=(0,s.fK)({start:t.toDate(),end:a.toDate()});return n?{statsPeriod:n}:{start:o,end:l}}},"./app/views/starfish/utils/routeNames.tsx":(e,t,a)=>{a.d(t,{m:()=>n});var s=a("./app/locale.tsx");const n={api:(0,s.t)("API Calls"),database:(0,s.t)("Database"),"endpoint-overview":(0,s.t)("Endpoint Overview"),"span-summary":(0,s.t)("Span Summary"),"web-service":(0,s.t)("Web Service")}},"./app/views/starfish/views/spanSummaryPage/index.tsx":(e,t,a)=>{a.r(t),a.d(t,{Block:()=>ct,BlockContainer:()=>gt,default:()=>xt});var s=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(a("../node_modules/core-js/modules/es.array.push.js"),a("../node_modules/query-string/index.js")),i=a("./app/components/breadcrumbs.tsx"),r=a("./app/components/layouts/thirds.tsx"),o=a("./app/components/panels/panel.tsx"),l=a("./app/components/panels/panelBody.tsx"),d=a("./app/components/questionTooltip.tsx"),p=a("./app/components/sentryDocumentTitle.tsx"),c=a("./app/locale.tsx"),m=a("./app/styles/space.tsx"),u=a("./app/utils/discover/eventView.tsx"),h=a("./app/utils/performance/contexts/pageError.tsx"),g=a("./app/utils/useOrganization.tsx"),S=a("./app/utils/withDomainRequired.tsx"),v=a("./app/views/starfish/colours.tsx"),f=a("./app/views/starfish/components/chart.tsx"),y=a("./app/views/starfish/components/chartPanel.tsx"),x=a("./app/views/starfish/components/datePicker.tsx");const Z=(0,s.Z)("div",{target:"e1enucjs0"})("padding:",(0,m.D)(1),";border-radius:",(e=>e.theme.borderRadius),";overflow-x:auto;white-space:pre-wrap;");var b=a("./app/views/starfish/types.tsx"),_=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const P=(e,t)=>{let a="";return e.split("").map(((s,n)=>{a+=s;let i=null;if(a===t.action?i=(0,_.BX)(N,{children:[t.action," "]},n):a===t.domain?i=(0,_.BX)(M,{children:[t.domain," "]},n):w.has(a)?i=(0,_.tZ)(T,{children:a},n):["(",")"].includes(a)?i=(0,_.tZ)(F,{children:a},n):" "===s||"\n"===s||")"===e[n+1]?i=a:"%s"===a?i=(0,_.tZ)(E,{children:a}):n===e.length-1&&(i=a),i){a="";const e=i;return i=null,e}return null}))},w=new Set(["ADD","ALL","ALTER","COLUMN","TABLE","AND","ANY","AS","ASC","BACKUP","DATABASE","BETWEEN","CASE","CHECK","CONSTRAINT","CREATE","DATABASE","DEFAULT","DELETE","DESC","DISTINCT","DROP","EXEC","EXISTS","FOREIGN","KEY","FROM","FULL","OUTER","INNER","LEFT","RIGHT","ORDER","ON","LIMIT","WHERE","COUNT","JOIN","GROUP","BY","HAVING","UPDATE"]),N=(0,s.Z)("b",{target:"e1sm9bxn4"})("color:",(e=>e.theme.blue400),";"),M=(0,s.Z)("b",{target:"e1sm9bxn3"})("color:",(e=>e.theme.green400),";margin-right:-",(0,m.D)(.5),";"),E=(0,s.Z)("b",{target:"e1sm9bxn2"})("color:",(e=>e.theme.red400),";margin-right:-",(0,m.D)(.5),";"),T=(0,s.Z)("b",{target:"e1sm9bxn1"})("color:",(e=>e.theme.yellow400),";"),F=(0,s.Z)("b",{target:"e1sm9bxn0"})("color:",(e=>e.theme.pink400),";"),{SPAN_DESCRIPTION:A,SPAN_ACTION:C,SPAN_DOMAIN:L}=b.SpanMetricsFields;function D(e){let{spanMeta:t}=e;return t["span.op"].startsWith("db")?(0,_.tZ)(k,{spanMeta:t}):(0,_.tZ)(I,{children:t[A]})}function k(e){let{spanMeta:t}=e;return(0,_.tZ)($,{children:(0,_.tZ)(Z,{children:P(t[A]||"",{action:t[C]||"",domain:t[L]||""})})})}D.displayName="SpanDescription",k.displayName="DatabaseSpanDescription";const $=(0,s.Z)("div",{target:"elfaq7i1"})("font-size:",(e=>e.theme.fontSizeMedium),";"),I=(0,s.Z)("div",{target:"elfaq7i0"})({name:"1sdjnkx",styles:"word-break:break-word"});var O=a("./app/views/starfish/components/starfishPageFiltersContainer.tsx"),j=a("./app/utils/discover/styles.tsx"),B=a("./app/utils/formatters.tsx");function R(e){let{count:t,containerProps:a}=e;return(0,_.tZ)(j.Hw,{...a,children:(0,B.Du)(t)})}R.displayName="CountCell";var z=a("./app/views/starfish/components/tableCells/durationCell.tsx"),q=a("./app/views/starfish/components/tableCells/throughputCell.tsx"),X=a("./app/views/starfish/components/tableCells/timeSpentCell.tsx"),W=a("./app/utils/discover/types.tsx"),G=a("./app/utils/useLocation.tsx"),U=a("./app/views/starfish/utils/useSpansQuery.tsx");const{SPAN_GROUP:V}=b.SpanMetricsFields,Y=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"span-metrics";const n=(0,G.T)(),i=e?function(e,t,a){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return u.ZP.fromNewQueryWithLocation({name:"",query:`${V}:${e}${a?.transactionName?` transaction:"${a?.transactionName}"`:""}${a?.["transaction.method"]?` transaction.method:${a?.["transaction.method"]}`:""}`,fields:s,dataset:W.as.SPANS_METRICS,version:2},t)}(e,n,t,a):void 0,r=Boolean(e)&&Object.values(t).every((e=>Boolean(e))),o=(0,U.bB)({eventView:i,initialData:[],enabled:r,referrer:s});return{...o,data:o?.data?.[0]??{},isEnabled:r}};var Q=a("../node_modules/lodash/keyBy.js"),H=a.n(Q),K=a("./app/components/charts/utils.tsx"),J=a("./app/utils/usePageFilters.tsx"),ee=a("./app/views/starfish/utils/constants.tsx");const{SPAN_GROUP:te}=b.SpanMetricsFields,ae=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"span-metrics-series";const n=(0,J.Z)(),i=e?function(e,t,a,s){return u.ZP.fromNewQueryWithPageFilters({name:"",query:`${te}:${e}${s?.transactionName?` transaction:"${s?.transactionName}"`:""}${s?.["transaction.method"]?` transaction.method:${s?.["transaction.method"]}`:""}`,fields:[],yAxis:a,dataset:W.as.SPANS_METRICS,interval:(0,K.ZS)(t.datetime,ee.R),version:2},t)}(e,n.selection,a,t):void 0,r=Boolean(e)&&Object.values(t).every((e=>Boolean(e))),o=(0,U.bB)({eventView:i,initialData:[],referrer:s,enabled:r}),l=H()(a.map((e=>({seriesName:e,data:(o?.data??[]).map((t=>({value:t[e],name:t.interval})))}))),"seriesName");return{...o,data:l}};var se=a("./app/views/starfish/utils/chartValueFormatters/formatThroughput.ts"),ne=a("./app/views/starfish/utils/extractRoute.tsx"),ie=a("./app/views/starfish/utils/routeNames.tsx"),re=a("./app/views/starfish/views/queryParameters.tsx"),oe=a("./app/views/starfish/views/spans/types.tsx"),le=a("../node_modules/react/index.js"),de=a("../node_modules/lodash/omit.js"),pe=a.n(de),ce=a("./app/utils/useRouter.tsx"),me=a("./app/views/starfish/components/detailPanel.tsx"),ue=a("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),he=a("./app/views/starfish/components/samplesTable/common.tsx"),ge=a("../node_modules/moment/moment.js"),Se=a.n(ge),ve=a("./app/utils/queryClient.tsx"),fe=a("./app/utils/tokenizeSearch.tsx"),ye=a("./app/utils/useApi.tsx"),xe=a("./app/views/starfish/utils/getDateConditions.tsx");const{SPAN_SELF_TIME:Ze,SPAN_GROUP:be}=b.SpanIndexedFields,_e=e=>{const t=`/api/0/organizations/${(0,g.Z)().slug}/spans-samples/`,a=(0,ye.Z)(),s=(0,J.Z)(),{groupId:i,transactionName:r,transactionMethod:o}=e,l=(0,G.T)(),d=new fe.MY([`${be}:${i}`,`transaction:"${r}"`,`transaction.method:${o}`]),p=(0,xe.x)(s.selection),{isLoading:c,data:m}=ae(i,{transactionName:r,"transaction.method":o},[`p95(${Ze})`],"api.starfish.sidebar-span-metrics"),u=(0,f.yX)([m?.[`p95(${Ze})`]]),h=Boolean(i&&r&&!c);return{...(0,ve.aM)({queryKey:["span-samples",i,r,p.statsPeriod,p.start,p.end],queryFn:async()=>{const{data:e}=await a.requestPromise(`${t}?${n.stringify({...p,utc:l.query.utc,lowerBound:0,firstBound:u*(1/3),secondBound:u*(2/3),upperBound:u,query:d.formatString()})}`);return e?.map((e=>({...e,timestamp:Se()(e.timestamp).format(U.zT)}))).sort(((e,t)=>t[Ze]-e[Ze]))},refetchOnWindowFocus:!1,enabled:h,initialData:[]}),isEnabled:h}},{SPAN_SELF_TIME:Pe,SPAN_OP:we}=b.SpanMetricsFields;function Ne(e){let{groupId:t,transactionName:a,onClickSample:s,onMouseLeaveSample:n,onMouseOverSample:i,highlightedSpanId:r,transactionMethod:o}=e;const l=(0,ue.u)(),{setPageError:d}=(0,h.De)(),p=(e,t)=>(0,he.k)(e,t)?{symbol:"path://M 0 0 V -8 L 5 0 L 0 8 L -5 0 L 0 -8",color:l.gray300}:e>t?{symbol:"path://M 5 4 L 0 -4 L -5 4 L 5 4",color:l.red300}:{symbol:"path://M -5 -4 L 0 4 L 5 -4 L -5 -4",color:l.green300},{isLoading:m,data:u,error:g}=ae(t,{transactionName:a,"transaction.method":o},[`avg(${Pe})`],"api.starfish.sidebar-span-metrics-chart"),{data:S,error:y}=Y(t,{transactionName:a,"transaction.method":o},[`avg(${Pe})`,we],"api.starfish.span-summary-panel-samples-table-avg"),x=S?.[`avg(${Pe})`]||0,{data:Z,isLoading:b,isRefetching:P}=_e({groupId:t,transactionName:a,transactionMethod:o}),w={seriesName:"Baseline Average",data:[],markLine:{data:[{valueDim:"x",yAxis:x}],symbol:["none","none"],lineStyle:{color:l.gray400},emphasis:{disabled:!0},label:{fontSize:11,position:"insideEndBottom",formatter:()=>"Baseline Average"}}},N=Z.map((e=>{let{timestamp:t,[Pe]:a,"transaction.id":s,span_id:n}=e;return{data:[{name:t,value:a}],symbol:p(a,x).symbol,color:p(a,x).color,symbolSize:n===r?15:10,seriesName:s.substring(0,8)}})),M=(e,t)=>Z.find((a=>a.timestamp===e&&a[Pe]===t));return(g||y)&&d((0,c.t)("An error has occured while loading chart data")),(0,_.BX)("div",{onMouseLeave:()=>{n&&n()},children:[(0,_.tZ)("h5",{children:oe.FS.avg}),(0,_.tZ)(f.ZP,{height:140,onClick:e=>{if("scatter"===e?.componentSubType&&s){const[t,a]=e.value,n=M(t,a);n&&s(n)}},onHighlight:e=>{const{seriesIndex:t}=e.batch[0],a=t>1;if(a&&i){const e=N?.[t-2]?.data[0],{name:a,value:s}=e,n=M(a,s);n&&i(n)}!a&&n&&n()},aggregateOutputFormat:"duration",data:[u?.[`avg(${Pe})`],w],loading:m,scatterPlot:b||P?void 0:N,utc:!1,chartColors:[v.VG,"black"],isLineChart:!0,definedAxisTicks:4})]})}Ne.displayName="DurationChart";const Me=Ne,{SPAN_SELF_TIME:Ee,SPAN_OP:Te}=b.SpanMetricsFields;function Fe(e){const{groupId:t,transactionName:a,transactionMethod:s}=e,{setPageError:n}=(0,h.De)(),{data:i,error:r}=Y(t,{transactionName:a,"transaction.method":s},[Te,"sps()",`sum(${Ee})`,`avg(${Ee})`,"time_spent_percentage(local)"],"api.starfish.span-summary-panel-metrics"),o={textAlign:"left"};return r&&n(r.message),(0,_.BX)(gt,{children:[(0,_.tZ)(ct,{title:(0,oe.RY)(i?.[Te]),children:(0,_.tZ)(q.Z,{containerProps:{style:o},throughputPerSecond:i?.["sps()"]})}),(0,_.tZ)(ct,{title:oe.FS.avg,children:(0,_.tZ)(z.Z,{containerProps:{style:o},milliseconds:i?.[`avg(${Ee})`]})})]})}Fe.displayName="SampleInfo";const Ae=Fe;var Ce=a("./app/components/button.tsx"),Le=a("./app/utils/analytics.tsx"),De=a("./app/utils/performanceForSentry/index.tsx"),ke=a("../node_modules/react-router/es/index.js"),$e=a("./app/components/gridEditable/index.tsx"),Ie=a("./app/views/starfish/components/textAlign.tsx");const Oe=[{key:"transaction_id",name:"Event ID",width:200},{key:"duration",name:"Span Duration",width:200},{key:"avg_comparison",name:"Compared to baseline",width:200}];function je(e){let{isLoading:t,data:a,avg:s,highlightedSpanId:n,onMouseLeaveSample:i,onMouseOverSample:r}=e;const o=(0,G.T)();return(0,_.tZ)("div",{onMouseLeave:function(){i&&i()},children:(0,_.tZ)($e.ZP,{isLoading:t,data:a,columnOrder:Oe,columnSortBy:[],grid:{renderHeadCell:function(e){return"p95_comparison"===e.key||"avg_comparison"===e.key||"duration"===e.key?(0,_.tZ)(Ie.Dq,{children:(0,_.tZ)(Ie._F,{children:e.name})}):(0,_.tZ)(Ie._F,{children:e.name})},renderBodyCell:function(e,t){const a={style:t.span_id===n?{fontWeight:"bold"}:{},onMouseEnter:()=>function(e){r&&r(e)}(t)};return"transaction_id"===e.key?(0,_.tZ)(ke.Link,{to:`/performance/${t.project}:${t["transaction.id"]}#span-${t.span_id}`,...a,children:t["transaction.id"].slice(0,8)}):"duration"===e.key?(0,_.tZ)(z.Z,{containerProps:a,milliseconds:t["span.self_time"]}):"avg_comparison"===e.key?(0,_.tZ)(he.f,{containerProps:a,duration:t["span.self_time"],compareToDuration:s}):(0,_.tZ)("span",{...a,children:t[e.key]})}},location:o})})}je.displayName="SpanSamplesTable";var Be=a("./app/utils/discover/discoverQuery.tsx"),Re=a("./app/views/starfish/utils/retryHandlers.tsx");const{SPAN_SELF_TIME:ze,SPAN_OP:qe}=b.SpanMetricsFields;function Xe(e){let{groupId:t,transactionName:a,highlightedSpanId:s,onMouseLeaveSample:n,onMouseOverSample:i,transactionMethod:r}=e;const{data:o,isFetching:l}=Y(t,{transactionName:a,"transaction.method":r},[`avg(${ze})`,qe],"api.starfish.span-summary-panel-samples-table-avg"),d=(0,g.Z)(),{setPageError:p}=(0,h.De)(),{data:m,isFetching:S,isEnabled:v,error:f,refetch:y}=_e({groupId:t,transactionName:a,transactionMethod:r}),{data:x,isFetching:Z,isEnabled:b,error:P}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"use-transactions";const a=(0,G.T)(),{slug:s}=(0,g.Z)(),n=u.ZP.fromNewQueryWithLocation({fields:["id","timestamp","project.name","transaction.duration"],name:"Transactions",version:2,query:`id:[${e.join(",")}]`},a),i=Boolean(e.length),r=(0,Be._)({eventView:n,location:a,orgSlug:s,referrer:t,options:{enabled:i,refetchOnWindowFocus:!1,retry:Re.V,retryDelay:Re.P,staleTime:1/0}}),o=r.data?.data??[];return i?{...r,isEnabled:i,data:o}:{isFetching:!1,isLoading:!1,error:null,data:[],isEnabled:i}}(m.map((e=>e["transaction.id"])),"api.starfish.span-summary-panel-samples-table-transactions"),[w,N]=(0,le.useState)(!1);(0,le.useEffect)((()=>{Z||S?N(!1):w||((0,Le.Gi)("starfish.samples.loaded",{organization:d,count:x?.length??0}),N(!0))}),[w,S,x,Z,d]);const M=H()(x,"id"),E=!S&&0===m.length,T=l||S||!v||!b||!E&&Z;return(f||P)&&p((0,c.t)("An error has occured while loading the samples table")),(0,_.BX)(le.Fragment,{children:[(0,_.tZ)(De.oF,{id:"SpanSummary.Samples.SampleTable",hasData:m.length>0,children:(0,_.tZ)(je,{onMouseLeaveSample:n,onMouseOverSample:i,highlightedSpanId:s,data:m.map((e=>({...e,op:o[qe],transaction:M[e["transaction.id"]]}))),isLoading:T,avg:o?.[`avg(${ze})`]})}),(0,_.tZ)(Ce.zx,{onClick:()=>y(),children:(0,c.t)("Load More Samples")})]})}Xe.displayName="SampleTable";const We=Xe;function Ge(e){let{groupId:t,transactionName:a,transactionMethod:s}=e;const n=(0,ce.Z)(),[i,r]=(0,le.useState)(void 0),o=t&&a&&s?`${t}:${a}:${s}`:void 0;return(0,_.tZ)(h.V_,{children:(0,_.BX)(me.Z,{detailKey:o,onClose:()=>{n.push({pathname:n.location.pathname,query:pe()(n.location.query,"transaction","transactionMethod")})},children:[(0,_.tZ)("h3",{children:`${s} ${a}`}),(0,_.tZ)(h.YY,{}),(0,_.tZ)(Ae,{groupId:t,transactionName:a,transactionMethod:s}),(0,_.tZ)(Me,{groupId:t,transactionName:a,transactionMethod:s,onClickSample:e=>{n.push(`/performance/${e.project}:${e["transaction.id"]}/#span-${e.span_id}`)},onMouseOverSample:e=>r(e.span_id),onMouseLeaveSample:()=>r(void 0),highlightedSpanId:i}),(0,_.tZ)(We,{highlightedSpanId:i,transactionMethod:s,onMouseLeaveSample:()=>r(void 0),onMouseOverSample:e=>r(e.span_id),groupId:t,transactionName:a})]})})}Ge.displayName="SampleList";var Ue=a("./app/components/links/link.tsx"),Ve=a("./app/components/pagination.tsx"),Ye=a("./app/components/truncate.tsx"),Qe=a("./app/utils/discover/fieldRenderers.tsx"),He=a("./app/views/starfish/components/tableCells/renderHeadCell.tsx");const{SPAN_SELF_TIME:Ke,SPAN_GROUP:Je}=b.SpanMetricsFields,et=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"api.starfish.span-transaction-metrics";const s=(0,G.T)(),{transactions:n,sorts:i}=t,r=function(e,t,a,s){const n=new fe.MY("");n.addFilterValues(Je,[e]),n.addFilterValues("transaction.op",["http.server"]),a.length>0&&n.addFilterValues("transaction",a);const i=u.ZP.fromNewQueryWithLocation({name:"",query:n.formatString(),fields:["transaction","transaction.method","sps()",`sum(${Ke})`,`avg(${Ke})`,"time_spent_percentage(local)","transaction.op","http_error_count()"],orderby:"-time_spent_percentage_local",dataset:W.as.SPANS_METRICS,version:2},t);return s&&(i.sorts=s),i}(e,s,n??[],i);return(0,U.RX)({eventView:r,initialData:[],enabled:Boolean(e),limit:25,referrer:a})},{SPAN_OP:tt}=b.SpanMetricsFields;function at(e){let{span:t,openSidebar:a,onClickTransaction:s,endpoint:n,endpointMethod:i,sort:r}=e;const o=(0,G.T)(),l=(0,g.Z)(),{data:d=[],meta:p,isLoading:m,pageLinks:u}=et(t[b.SpanMetricsFields.SPAN_GROUP],{transactions:n?[n]:void 0,sorts:[r]}),h=d.map((e=>({transaction:e.transaction,transactionMethod:e["transaction.method"],metrics:e})));return(0,_.BX)(le.Fragment,{children:[(0,_.tZ)(De.oF,{id:"SpanSummary.SpanTransactionsTable",hasData:d.length>0,children:(0,_.tZ)($e.ZP,{isLoading:m,data:h,columnOrder:nt(t),columnSortBy:[],grid:{renderHeadCell:e=>(0,He.WJ)({column:e,sort:r,location:o}),renderBodyCell:(e,r)=>"transaction"===e.key?(0,_.tZ)(st,{endpoint:n,endpointMethod:i,span:t,row:r,column:e,openSidebar:a,onClickTransactionName:s,location:o}):p&&p?.fields?(0,Qe.Js)(e.key,p.fields,!1)(r.metrics,{location:o,organization:l,unit:p.units?.[e.key]}):r[e.key]},location:o})}),(0,_.BX)(it,{children:[n&&(0,_.tZ)(Ce.zx,{to:{pathname:o.pathname,query:pe()(o.query,"endpoint")},children:(0,c.t)("View More Endpoints")}),(0,_.tZ)(rt,{pageLinks:u})]})]})}function st(e){let{span:t,row:a,endpoint:s,endpointMethod:i,location:r}=e;const o=a.transactionMethod?`${a.transactionMethod} ${a.transaction}`:a.transaction;return(0,_.tZ)(le.Fragment,{children:(0,_.tZ)(Ue.Z,{to:`/starfish/${(0,ne.G)(r)??"spans"}/span/${encodeURIComponent(t[b.SpanMetricsFields.SPAN_GROUP])}?${n.stringify({...r.query,endpoint:s,endpointMethod:i,transaction:a.transaction,transactionMethod:a.transactionMethod})}`,children:(0,_.tZ)(Ye.Z,{value:o,maxLength:75})})})}at.displayName="SpanTransactionsTable",st.displayName="TransactionCell";const nt=e=>[{key:"transaction",name:"Found In Endpoints",width:$e.z7},{key:"sps()",name:(0,oe.RY)(e[tt]),width:$e.z7},{key:`avg(${b.SpanMetricsFields.SPAN_SELF_TIME})`,name:oe.FS.avg,width:$e.z7},...e?.["span.op"]?.startsWith("http")?[{key:"http_error_count()",name:oe.FS.errorCount,width:$e.z7}]:[],{key:"time_spent_percentage(local)",name:oe.FS.timeSpent,width:$e.z7}],it=(0,s.Z)("div",{target:"eo6is321"})({name:"1eoy87d",styles:"display:flex;justify-content:space-between"}),rt=(0,s.Z)(Ve.Z,{target:"eo6is320"})({name:"1wh5xum",styles:"margin-top:0;margin-left:auto"});function ot(e){return He.qF.has(e.field)}const lt={kind:"desc",field:"time_spent_percentage(local)"};function dt(e){let{params:t,location:a}=e;const s=(0,g.Z)(),{groupId:l}=t,{transaction:d,transactionMethod:m,endpoint:Z,endpointMethod:P}=a.query,w=Z?{transactionName:Z,"transaction.method":P}:{},N=(0,u.vp)(a.query[re.o.SORT]).filter(ot)[0]??lt;P&&w&&(w["transaction.method"]=P);const{data:M,isLoading:E}=Y(l,w,[b.SpanMetricsFields.SPAN_OP,b.SpanMetricsFields.SPAN_DESCRIPTION,b.SpanMetricsFields.SPAN_ACTION,b.SpanMetricsFields.SPAN_DOMAIN,"count()","sps()",`sum(${b.SpanMetricsFields.SPAN_SELF_TIME})`,`avg(${b.SpanMetricsFields.SPAN_SELF_TIME})`,"time_spent_percentage()","http_error_count()"],"api.starfish.span-summary-page-metrics"),T={...M,[b.SpanMetricsFields.SPAN_GROUP]:l},{isLoading:F,data:A}=ae(l,w,[`avg(${b.SpanMetricsFields.SPAN_SELF_TIME})`,"sps()","http_error_count()"],"api.starfish.span-summary-page-metrics-chart");(0,f.K4)([!F]);const C={seriesName:T?.[b.SpanMetricsFields.SPAN_OP]?.startsWith("db")?"Queries":"Requests",data:A?.["sps()"].data},L=Zt(T[b.SpanMetricsFields.SPAN_OP],!0),k=Zt(T[b.SpanMetricsFields.SPAN_OP]),$=[];$.push({label:(0,c.t)("Web Service"),to:(0,S.D)(`/organizations/${s.slug}/starfish/`)});const I=(0,ne.G)(a);return I&&ie.m[I]&&$.push({label:ie.m[I],to:(0,S.D)(`/organizations/${s.slug}/starfish/${I??"spans"}/?${n.stringify({endpoint:Z,"http.method":P})}`)}),$.push({label:L}),(0,_.tZ)(p.Z,{title:L,orgSlug:s.slug,children:(0,_.tZ)(r.T3,{children:(0,_.tZ)(O.M,{children:(0,_.BX)(h.V_,{children:[(0,_.tZ)(r.h4,{children:(0,_.BX)(r.oB,{children:[!E&&(0,_.tZ)(i.Z,{crumbs:$}),(0,_.tZ)(r.Dx,{children:P&&Z?`${P} ${Z}`:!E&&L})]})}),(0,_.tZ)(r.uT,{children:(0,_.BX)(r.or,{fullWidth:!0,children:[(0,_.tZ)(h.YY,{}),(0,_.BX)(gt,{children:[(0,_.tZ)(pt,{children:(0,_.tZ)(x.Z,{})}),(0,_.BX)(gt,{children:[T?.[b.SpanMetricsFields.SPAN_OP]?.startsWith("db")&&"db.redis"!==T?.[b.SpanMetricsFields.SPAN_OP]&&(0,_.tZ)(ct,{title:(0,c.t)("Table"),children:T?.[b.SpanMetricsFields.SPAN_DOMAIN]}),(0,_.tZ)(ct,{title:(0,oe.RY)(T?.[b.SpanMetricsFields.SPAN_OP]),description:(0,c._N)("Throughput of this [spanType] per second",{spanType:k}),children:(0,_.tZ)(q.Z,{throughputPerSecond:M?.["sps()"]})}),(0,_.tZ)(ct,{title:oe.FS.avg,description:(0,c._N)("95% of [spanType] in the selected period have a lower duration than this value",{spanType:k.endsWith("y")?`${k.slice(0,-1)}ies`:`${k}s`}),children:(0,_.tZ)(z.Z,{milliseconds:M?.[`avg(${b.SpanMetricsFields.SPAN_SELF_TIME})`]})}),T?.[b.SpanMetricsFields.SPAN_OP]?.startsWith("http")&&(0,_.tZ)(ct,{title:(0,c.t)("5XX Responses"),description:(0,c.t)("5XX responses in this span"),children:(0,_.tZ)(R,{count:M?.["http_error_count()"]})}),(0,_.tZ)(ct,{title:(0,c.t)("Time Spent"),description:(0,c.t)("Time spent in this span as a proportion of total application time"),children:(0,_.tZ)(X.z,{timeSpentPercentage:M?.["time_spent_percentage()"],totalSpanTime:M?.[`avg(${b.SpanMetricsFields.SPAN_SELF_TIME})`]})})]})]}),T?.[b.SpanMetricsFields.SPAN_DESCRIPTION]&&(0,_.BX)(gt,{children:[(0,_.tZ)(ct,{children:(0,_.tZ)(o.Z,{children:(0,_.tZ)(vt,{children:(0,_.BX)(St,{children:[(0,_.tZ)(yt,{children:k}),(0,_.tZ)(D,{spanMeta:T})]})})})}),(0,_.tZ)(ct,{children:(0,_.tZ)(y.Z,{title:(0,oe.C3)(T?.[b.SpanMetricsFields.SPAN_OP]),children:(0,_.tZ)(f.ZP,{height:140,data:[C],loading:F,utc:!1,chartColors:[v.SQ],isLineChart:!0,definedAxisTicks:4,aggregateOutputFormat:"rate",tooltipFormatterOptions:{valueFormatter:e=>(0,se.Z)(e)}})})}),(0,_.tZ)(ct,{children:(0,_.tZ)(y.Z,{title:oe.FS.avg,children:(0,_.tZ)(f.ZP,{height:140,data:[A?.[`avg(${b.SpanMetricsFields.SPAN_SELF_TIME})`]],loading:F,utc:!1,chartColors:[v.VG],isLineChart:!0,definedAxisTicks:4})})}),T?.[b.SpanMetricsFields.SPAN_OP]?.startsWith("http")&&(0,_.tZ)(ct,{children:(0,_.tZ)(y.Z,{title:oe.FS.errorCount,children:(0,_.tZ)(f.ZP,{height:140,data:[A?.["http_error_count()"]],loading:F,utc:!1,chartColors:[v.eO],isLineChart:!0,definedAxisTicks:4})})})]}),T&&(0,_.tZ)(at,{span:T,sort:N,endpoint:Z,endpointMethod:P}),(0,_.tZ)(Ge,{groupId:T[b.SpanMetricsFields.SPAN_GROUP],transactionName:d,transactionMethod:m})]})})]})})})})}dt.displayName="SpanSummaryPage";const pt=(0,s.Z)("div",{target:"eby1jon8"})("display:flex;flex-direction:row;gap:",(0,m.D)(1),";align-items:center;flex:1;");function ct(e){let{title:t,description:a,children:s}=e;return(0,_.BX)(ft,{children:[(0,_.BX)(mt,{children:[t,a&&(0,_.tZ)(ht,{children:(0,_.tZ)(d.Z,{size:"sm",position:"right",title:a})})]}),(0,_.tZ)(ut,{children:s})]})}ct.displayName="Block";const mt=(0,s.Z)("h3",{target:"eby1jon7"})("color:",(e=>e.theme.gray300),";font-size:",(e=>e.theme.fontSizeMedium),";margin:0;margin-bottom:",(0,m.D)(1),";white-space:nowrap;display:flex;height:",(0,m.D)(3),";"),ut=(0,s.Z)("h4",{target:"eby1jon6"})({name:"3in70x",styles:"margin:0;font-weight:normal"}),ht=(0,s.Z)("span",{target:"eby1jon5"})("margin-left:",(0,m.D)(1),";"),gt=(0,s.Z)("div",{target:"eby1jon4"})("display:flex;&>div:last-child{padding-right:",(0,m.D)(1),";}padding-bottom:",(0,m.D)(2),";"),St=(0,s.Z)("div",{target:"eby1jon3"})("width:100%;padding:",(0,m.D)(1),";font-size:1rem;line-height:1.2;"),vt=(0,s.Z)(l.Z,{target:"eby1jon2"})("padding:",(0,m.D)(2),";height:208px;"),ft=(0,s.Z)("div",{target:"eby1jon1"})("padding-right:",(0,m.D)(4),";flex:1;"),yt=(0,s.Z)("h4",{target:"eby1jon0"})({name:"1qszq24",styles:"font-size:1rem;font-weight:600;line-height:1.2"}),xt=dt,Zt=(e,t)=>e?.startsWith("http")?t?(0,c.t)("URL Request Summary"):(0,c.t)("URL Request"):"db.redis"===e?t?(0,c.t)("Cache Query Summary"):(0,c.t)("Cache Query"):e?.startsWith("db")?t?(0,c.t)("Database Query Summary"):(0,c.t)("Database Query"):e?.startsWith("task")?t?(0,c.t)("Application Task Summary"):(0,c.t)("Application Task"):e?.startsWith("serialize")?t?(0,c.t)("Serializer Summary"):(0,c.t)("Serializer"):e?.startsWith("middleware")?t?(0,c.t)("Middleware Summary"):(0,c.t)("Middleware"):t?(0,c.t)("Request Summary"):(0,c.t)("Request")}}]);
//# sourceMappingURL=../sourcemaps/app_views_starfish_views_spanSummaryPage_index_tsx.ddc68a112c7c3f62fb8d2cd937b9c068.js.map