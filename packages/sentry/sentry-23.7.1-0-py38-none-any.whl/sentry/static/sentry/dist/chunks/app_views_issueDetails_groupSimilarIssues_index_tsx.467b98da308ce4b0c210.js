"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_issueDetails_groupSimilarIssues_index_tsx"],{"./app/components/panels/panelHeader.tsx":(e,t,s)=>{s.d(t,{Z:()=>o});var r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=s("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),n=s("./app/styles/space.tsx");const a=e=>{let{disablePadding:t,hasButtons:s}=e;return(0,i.iv)("padding:",s?(0,n.D)(1):(0,n.D)(2)," ",t?0:(0,n.D)(2),";","")},o=(0,r.Z)("div",{target:"e1dzfr4k0"})("display:flex;align-items:center;justify-content:space-between;color:",(e=>e.lightText?e.theme.gray300:e.theme.gray400),";font-size:",(e=>e.theme.fontSizeSmall),";font-weight:600;text-transform:uppercase;border-bottom:1px solid ",(e=>e.theme.border),";border-radius:calc(",(e=>e.theme.panelBorderRadius)," - 1px) calc(",(e=>e.theme.panelBorderRadius)," - 1px) 0 0;background:",(e=>e.theme.backgroundSecondary),";line-height:1;position:relative;",a,";")},"./app/stores/groupingStore.tsx":(e,t,s)=>{s.d(t,{Z:()=>c}),s("../node_modules/core-js/modules/es.array.push.js"),s("../node_modules/core-js/modules/es.error.cause.js");var r=s("../node_modules/lodash/pick.js"),i=s.n(r),n=s("../node_modules/reflux/src/index.js"),a=s("./app/actionCreators/group.tsx"),o=s("./app/actionCreators/indicator.tsx"),l=s("./app/api.tsx"),d=s("./app/utils/toArray.tsx");const m={api:new l.KU,init(){const e=this.getInitialState();Object.entries(e).forEach((e=>{let[t,s]=e;this[t]=s}))},getInitialState:()=>({mergedItems:[],unmergeList:new Map,unmergeState:new Map,unmergeDisabled:!0,unmergeLastCollapsed:!1,enableFingerprintCompare:!1,similarItems:[],filteredSimilarItems:[],similarLinks:"",mergeState:new Map,mergeList:[],mergedLinks:"",mergeDisabled:!1,loading:!0,error:!1}),setStateForId:(e,t,s)=>(0,d.Z)(t).map((t=>{const r={...e.has(t)&&e.get(t)||{},...s};return e.set(t,r),r})),isAllUnmergedSelected(){const e=Array.from(this.unmergeState.values()).filter((e=>{let{busy:t}=e;return t}))||[];return this.unmergeList.size===this.mergedItems.filter((e=>{let{latestEvent:t}=e;return!!t})).length-e.length},onFetch(e){const t=e||this.toFetchArray;this.init(),this.triggerFetchState();const s=t.map((e=>{let{endpoint:t,queryParams:s,dataKey:r}=e;return new Promise(((e,i)=>{this.api.request(t,{method:"GET",data:s,success:(t,s,i)=>{e({dataKey:r,data:t,links:i?i.getResponseHeader("Link"):null})},error:e=>{const t=e.responseJSON?.detail||!0;i(t)}})}))})),r={merged:e=>{const t={},s=[];return e.forEach((e=>{if(!t[e.id]){const r={eventCount:0,children:[],...e};this.setStateForId(this.unmergeState,e.id,{busy:"locked"===e.state}),t[e.id]=r,s.push(r)}const r=t[e.id],{childId:i,childLabel:n,eventCount:a,lastSeen:o,latestEvent:l}=e;a&&(r.eventCount+=a),i&&r.children.push({childId:i,childLabel:n,lastSeen:o,latestEvent:l,eventCount:a})})),s},similar:e=>{let[t,s]=e;const r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!Object.keys(e).map((t=>e[t])).find((e=>e>=.6))}(s),i=Object.keys(s).map((e=>[e,s[e]])).reduce(((e,t)=>{let[s,r]=t;const[i]=String(s).split(":");return e[i]||(e[i]=[]),e[i].push([s,r]),e}),{}),n=Object.keys(i).map((e=>[e,i[e]])).reduce(((e,t)=>{let[s,r]=t;const i=r.filter((e=>{let[,t]=e;return null!==t})),n=i.reduce(((e,t)=>{let[,s]=t;return e+s}),0)/i.length;return e[s]=n,e}),{});return{issue:t,score:s,scoresByInterface:i,aggregate:n,isBelowThreshold:r}}};return e&&(this.toFetchArray=e),Promise.all(s).then((e=>{e.forEach((e=>{let{dataKey:t,data:s,links:i}=e;const n="similar"===t?s.map(r[t]):r[t](s);this[`${t}Items`]=n,this[`${t}Links`]=i})),this.loading=!1,this.error=!1,this.triggerFetchState()}),(()=>{this.loading=!1,this.error=!0,this.triggerFetchState()}))},onToggleMerge(e){let t=!1;const s=this.mergeState.has(e)?this.mergeState.get(e):void 0;!0!==s?.busy&&(this.mergeList.includes(e)?this.mergeList=this.mergeList.filter((t=>t!==e)):(this.mergeList=[...this.mergeList,e],t=!0),this.setStateForId(this.mergeState,e,{checked:t}),this.triggerMergeState())},onToggleUnmerge(e){let[t,s]=e,r=!1;const i=this.unmergeState.get(t);!0!==i?.busy&&(this.unmergeList.has(t)?this.unmergeList.delete(t):(this.unmergeList.set(t,s),r=!0),this.setStateForId(this.unmergeState,t,{checked:r}),this.unmergeDisabled=this.mergedItems.size<=1||0===this.unmergeList.size||this.isAllUnmergedSelected(),this.enableFingerprintCompare=2===this.unmergeList.size,this.triggerUnmergeState())},onUnmerge(e){let{groupId:t,loadingMessage:s,successMessage:r,errorMessage:i}=e;const n=Array.from(this.unmergeList.keys());return new Promise(((e,a)=>{this.isAllUnmergedSelected()?a(new Error("Not allowed to unmerge ALL events")):(this.unmergeDisabled=!0,this.setStateForId(this.unmergeState,n,{checked:!1,busy:!0}),this.triggerUnmergeState(),(0,o.E3)(s),this.api.request(`/issues/${t}/hashes/`,{method:"DELETE",query:{id:n},success:()=>{(0,o.S9)(r),this.setStateForId(this.unmergeState,n,{checked:!1,busy:!0}),this.unmergeList.clear()},error:()=>{(0,o.Iw)(i),this.setStateForId(this.unmergeState,n,{checked:!0,busy:!1})},complete:()=>{this.unmergeDisabled=!1,e(this.triggerUnmergeState())}}))}))},onMerge(e){let{params:t,query:s,projectId:r}=e;if(!t)return;const i=this.mergeList;return this.mergeDisabled=!0,this.setStateForId(this.mergeState,i,{busy:!0}),this.triggerMergeState(),new Promise((e=>{const{orgId:n,groupId:o}=t;(0,a.fr)(this.api,{orgId:n,projectId:r,itemIds:[...i,o],query:s},{success:e=>{e?.merge?.parent&&this.trigger({mergedParent:e.merge.parent}),this.setStateForId(this.mergeState,i,{checked:!1,busy:!0}),this.mergeList=[]},error:()=>{this.setStateForId(this.mergeState,i,{checked:!0,busy:!1})},complete:()=>{this.mergeDisabled=!1,e(this.triggerMergeState())}})}))},onToggleCollapseFingerprints(){this.setStateForId(this.unmergeState,this.mergedItems.map((e=>{let{id:t}=e;return t})),{collapsed:!this.unmergeLastCollapsed}),this.unmergeLastCollapsed=!this.unmergeLastCollapsed,this.trigger({unmergeLastCollapsed:this.unmergeLastCollapsed,unmergeState:this.unmergeState})},onToggleCollapseFingerprint(e){const t=this.unmergeState.has(e)&&this.unmergeState.get(e).collapsed;this.setStateForId(this.unmergeState,e,{collapsed:!t}),this.trigger({unmergeState:this.unmergeState})},triggerFetchState(){const e={similarItems:this.similarItems.filter((e=>{let{isBelowThreshold:t}=e;return!t})),filteredSimilarItems:this.similarItems.filter((e=>{let{isBelowThreshold:t}=e;return t})),...i()(this,["mergedItems","mergedLinks","similarLinks","mergeState","unmergeState","loading","error","enableFingerprintCompare","unmergeList"])};return this.trigger(e),e},triggerUnmergeState(){const e=i()(this,["unmergeDisabled","unmergeState","unmergeList","enableFingerprintCompare","unmergeLastCollapsed"]);return this.trigger(e),e},triggerMergeState(){const e=i()(this,["mergeDisabled","mergeState","mergeList"]);return this.trigger(e),e},getState(){return{...i()(this,["enableFingerprintCompare","error","filteredSimilarItems","loading","mergeDisabled","mergeList","mergeState","mergeState","mergedItems","mergedLinks","similarItems","similarLinks","unmergeDisabled","unmergeLastCollapsed","unmergeList","unmergeState"])}}},c=(0,n.createStore)(m)},"./app/views/issueDetails/groupSimilarIssues/index.tsx":(e,t,s)=>{s.r(t),s.d(t,{default:()=>xe});var r=s("./app/components/acl/feature.tsx"),i=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(s("../node_modules/core-js/modules/es.array.push.js"),s("../node_modules/react/index.js")),a=s("../node_modules/query-string/index.js"),o=s("./app/components/alert.tsx"),l=s("./app/components/layouts/thirds.tsx"),d=s("./app/components/loadingError.tsx"),m=s("./app/components/loadingIndicator.tsx"),c=s("./app/components/replays/issuesReplayCountProvider.tsx"),g=s("./app/locale.tsx"),h=s("./app/stores/groupingStore.tsx"),p=s("./app/styles/space.tsx"),u=s("./app/utils/useNavigate.tsx"),y=s("./app/utils/usePrevious.tsx"),f=s("./app/components/button.tsx"),Z=s("./app/components/emptyStateWarning.tsx"),x=s("./app/components/pagination.tsx"),S=s("./app/components/panels/panel.tsx"),b=s("./app/components/panels/panelBody.tsx"),I=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function k(e){let{className:t}=e;return(0,I.BX)("div",{className:t,children:[(0,I.tZ)("span",{children:(0,g.t)("Similar")}),(0,I.tZ)(L,{colorIndex:4}),(0,I.tZ)(L,{colorIndex:3}),(0,I.tZ)(L,{colorIndex:2}),(0,I.tZ)(L,{colorIndex:1}),(0,I.tZ)(L,{colorIndex:0}),(0,I.tZ)("span",{children:(0,g.t)("Not Similar")})]})}k.displayName="BaseSimilarSpectrum";const v=(0,i.Z)(k,{target:"ewpkmhi1"})("display:flex;font-size:",(e=>e.theme.fontSizeSmall),";"),L=(0,i.Z)("span",{target:"ewpkmhi0"})("border-radius:2px;margin:5px;width:14px;",(e=>`background-color: ${e.theme.similarity.colors[e.colorIndex]};`),";"),w=v;var j=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),C=s("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),D=s("../node_modules/classnames/index.js"),F=s.n(D),M=s("./app/actionCreators/modal.tsx"),B=s("./app/components/checkbox.tsx"),E=s("./app/components/count.tsx"),T=s("./app/components/eventOrGroupExtraDetails.tsx"),N=s("./app/components/eventOrGroupHeader.tsx"),_=s("./app/components/hovercard.tsx"),z=s("./app/components/panels/panelItem.tsx"),X=s("./app/components/scoreBar.tsx");const U={"exception:message:character-shingles":(0,g.t)("Exception Message"),"exception:stacktrace:pairs":(0,g.t)("Stack Trace Frames"),"exception:stacktrace:application-chunks":(0,g.t)("In-App Frames"),"message:message:character-shingles":(0,g.t)("Log Message"),"similarity:*:type:character-5-shingle":(0,g.t)("Exception Type"),"similarity:*:value:character-5-shingle":(0,g.t)("Exception Message"),"similarity:*:stacktrace:frames-pairs":(0,g.t)("Stack Trace Frames"),"similarity:*:message:character-5-shingle":(0,g.t)("Log Message")};function q(e){let{scoreList:t=[]}=e;if(0===t.length)return null;let s=0,r=0;return(0,I.BX)(n.Fragment,{children:[t.map((e=>{let[t,i]=e;const n=U[t.replace(/similarity:\d\d\d\d-\d\d-\d\d/,"similarity:*")];return n?(0,I.BX)(A,{children:[(0,I.tZ)("div",{children:n}),(0,I.tZ)(P,{score:null===i?i:Math.round(4*i)})]},t):(null!==i&&(s+=i,r+=1),null)})),r>0&&s>0&&(0,I.BX)(A,{children:[(0,I.tZ)("div",{children:(0,g.t)("Other")}),(0,I.tZ)(P,{score:Math.round(4*s/r)})]})]})}q.displayName="SimilarScoreCard";const A=(0,i.Z)("div",{target:"evoahf71"})("display:flex;justify-content:space-between;margin:",(0,p.D)(.25)," 0;"),P=(0,i.Z)("div",{target:"evoahf70"})("height:16px;width:48px;border-radius:2px;background-color:",(e=>null===e.score?e.theme.similarity.empty:e.theme.similarity.colors[e.score]),";"),O=q,$={visible:!0,checked:!1,busy:!1};class G extends n.Component{constructor(){super(...arguments),(0,j.Z)(this,"state",$),(0,j.Z)(this,"listener",h.Z.listen((e=>this.onGroupChange(e)),void 0)),(0,j.Z)(this,"handleToggle",(()=>{const{issue:e}=this.props;this.state.busy||h.Z.onToggleMerge(e.id)})),(0,j.Z)(this,"handleShowDiff",(e=>{const{orgId:t,groupId:s,issue:r,project:i}=this.props,{id:n}=r;(0,M.openDiffModal)({baseIssueId:s,targetIssueId:n,project:i,orgId:t}),e.stopPropagation()})),(0,j.Z)(this,"handleCheckClick",(()=>{})),(0,j.Z)(this,"onGroupChange",(e=>{let{mergeState:t}=e;if(!t)return;const{issue:s}=this.props,r=t.has(s.id)&&t.get(s.id);r&&Object.keys(r).forEach((e=>{r[e]!==this.state[e]&&this.setState((t=>({...t,[e]:r[e]})))}))}))}componentWillUnmount(){this.listener?.()}render(){const{aggregate:e,scoresByInterface:t,issue:s}=this.props,{visible:r,busy:i}=this.state;if(!r)return null;const n=F()("group",{isResolved:"resolved"===s.status,busy:i});return(0,I.BX)(H,{"data-test-id":"similar-item-row",className:n,onClick:this.handleToggle,children:[(0,I.BX)(R,{children:[(0,I.tZ)(B.Z,{id:s.id,value:s.id,checked:this.state.checked,onChange:this.handleCheckClick}),(0,I.BX)(Y,{children:[(0,I.tZ)(N.Z,{data:s,size:"normal",source:"similar-issues"}),(0,I.tZ)(T.Z,{data:{...s,lastSeen:""},showAssignee:!0})]}),(0,I.tZ)(V,{children:(0,I.tZ)(f.zx,{onClick:this.handleShowDiff,size:"sm",children:(0,g.t)("Diff")})})]}),(0,I.BX)(K,{children:[(0,I.tZ)(Q,{value:s.count}),["exception","message"].map((s=>{const r=e?.[s],i=t?.[s]||[],n="number"!=typeof r||Number.isNaN(r)?0:r;return(0,I.tZ)(J,{children:(0,I.tZ)(_.uI,{body:i.length&&(0,I.tZ)(O,{scoreList:i}),children:(0,I.tZ)(X.Z,{vertical:!0,score:Math.round(5*n)})})},s)}))]})]})}}G.displayName="Item";const R=(0,i.Z)("div",{target:"e1h05snr6"})((e=>e.theme.overflowEllipsis),";display:grid;gap:",(0,p.D)(1),";grid-template-columns:max-content auto max-content;margin-left:",(0,p.D)(2),";"),H=(0,i.Z)(z.Z,{target:"e1h05snr5"})("padding:",(0,p.D)(1)," 0;"),K=(0,i.Z)("div",{target:"e1h05snr4"})({name:"yresjl",styles:"display:flex;align-items:center;flex-shrink:0;min-width:300px;width:300px"}),W=(0,C.iv)("flex:1;flex-shrink:0;display:flex;justify-content:center;padding:",(0,p.D)(.5)," 0;",""),J=(0,i.Z)("div",{target:"e1h05snr3"})(W,";"),Q=(0,i.Z)(E.Z,{target:"e1h05snr2"})(W," font-variant-numeric:tabular-nums;"),V=(0,i.Z)("div",{target:"e1h05snr1"})("display:flex;align-items:center;margin-right:",(0,p.D)(.25),";"),Y=(0,i.Z)("div",{target:"e1h05snr0"})("flex:1;",(e=>e.theme.overflowEllipsis),";"),ee=G;var te=s("./app/components/confirm.tsx"),se=s("./app/components/panels/panelHeader.tsx"),re=s("./app/components/toolbarHeader.tsx");const ie={mergeCount:0};class ne extends n.Component{constructor(){super(...arguments),(0,j.Z)(this,"state",ie),(0,j.Z)(this,"onGroupChange",(e=>{let{mergeList:t}=e;t?.length&&t.length!==this.state.mergeCount&&this.setState({mergeCount:t.length})})),(0,j.Z)(this,"listener",h.Z.listen(this.onGroupChange,void 0))}componentWillUnmount(){this.listener?.()}render(){const{onMerge:e}=this.props,{mergeCount:t}=this.state;return(0,I.BX)(se.Z,{hasButtons:!0,children:[(0,I.tZ)(te.Z,{disabled:0===t,message:(0,g.t)("Are you sure you want to merge these issues?"),onConfirm:e,children:(0,I.tZ)(f.zx,{size:"sm",title:(0,g.t)("Merging %s issues",t),children:(0,g.t)("Merge %s",`(${t||0})`)})}),(0,I.BX)(oe,{children:[(0,I.tZ)(le,{children:(0,g.t)("Events")}),(0,I.tZ)(le,{children:(0,g.t)("Exception")}),(0,I.tZ)(le,{children:(0,g.t)("Message")})]})]})}}ne.displayName="SimilarToolbar";const ae=ne,oe=(0,i.Z)("div",{target:"ezka4j81"})({name:"yresjl",styles:"display:flex;align-items:center;flex-shrink:0;min-width:300px;width:300px"}),le=(0,i.Z)(re.Z,{target:"ezka4j80"})("flex:1;flex-shrink:0;display:flex;justify-content:center;padding:",(0,p.D)(.5)," 0;");function de(){return(0,I.tZ)(S.Z,{children:(0,I.tZ)(b.Z,{children:(0,I.tZ)(Z.Z,{small:!0,withIcon:!1,children:(0,g.t)("No issues with a similar stack trace have been found.")})})})}function me(e){let{orgId:t,groupId:s,project:r,items:i,filteredItems:a=[],pageLinks:o,onMerge:l}=e;const[d,m]=(0,n.useState)(!1),c=!!a.length,h=i.length>0||c,p=i.concat(d?a:[]);return h?(0,I.BX)(n.Fragment,{children:[(0,I.tZ)(ge,{children:(0,I.tZ)(w,{})}),(0,I.BX)(S.Z,{children:[(0,I.tZ)(ae,{onMerge:l}),(0,I.BX)(b.Z,{children:[p.map((e=>(0,I.tZ)(ee,{orgId:t,groupId:s,project:r,...e},e.issue.id))),c&&!d&&(0,I.tZ)(he,{children:(0,I.tZ)(f.zx,{onClick:()=>m(!0),children:(0,g.t)("Show %s issues below threshold",a.length)})})]})]}),(0,I.tZ)(x.Z,{pageLinks:o})]}):(0,I.tZ)(de,{})}de.displayName="Empty",me.displayName="List";const ce=me,ge=(0,i.Z)("div",{target:"e1y5937t1"})("display:flex;justify-content:flex-end;margin-bottom:",(0,p.D)(1),";"),he=(0,i.Z)("div",{target:"e1y5937t0"})("display:flex;justify-content:center;padding:",(0,p.D)(1.5),";");function pe(e){let{params:t,location:s,project:r}=e;const{orgId:i,groupId:p}=t,[f,Z]=(0,n.useState)({similar:[],filtered:[],pageLinks:null}),[x,S]=(0,n.useState)("loading"),b=(0,u.s)(),k=(0,y.Z)(s.search),v=r.features.includes("similarity-view"),L=(0,n.useCallback)((()=>{S("loading");const e=[];v&&e.push({endpoint:`/issues/${p}/similar/?${a.stringify({...s.query,limit:50})}`,dataKey:"similar"}),h.Z.onFetch(e)}),[s.query,p,v]),w=(0,n.useCallback)((e=>{let{mergedParent:t,similarItems:s,filteredSimilarItems:r,similarLinks:n,loading:a,error:o}=e;if(s)return Z({similar:s,filtered:r,pageLinks:n}),void S(o?"error":a?"loading":"ready");t&&t!==p&&b(`/organizations/${i}/issues/${t}/similar/`)}),[b,p,i]);(0,n.useEffect)((()=>{L()}),[L]),(0,n.useEffect)((()=>{k!==s.search&&L()}),[L,k,s.search]),(0,n.useEffect)((()=>{const e=h.Z.listen(w,void 0);return()=>{e()}}),[w]);const j=(0,n.useCallback)((()=>{if(!t)return;const[e]=f.similar.length?f.similar:f.filtered;h.Z.onMerge({params:t,query:s.query,projectId:e.issue.project.slug})}),[t,s.query,f]),C=v&&(f.similar.length>0||f.filtered.length>0)&&"ready"===x,D=f.similar.concat(f.filtered).map((e=>{let{issue:t}=e;return t.id}));return(0,I.tZ)(l.uT,{children:(0,I.BX)(l.or,{fullWidth:!0,children:[(0,I.tZ)(o.bZ,{type:"warning",children:(0,g.t)("This is an experimental feature. Data may not be immediately available while we process merges.")}),(0,I.tZ)(fe,{children:(0,I.tZ)(ye,{children:(0,g.t)("Issues with a similar stack trace")})}),"loading"===x&&(0,I.tZ)(m.Z,{}),"error"===x&&(0,I.tZ)(d.Z,{message:(0,g.t)("Unable to load similar issues, please try again later"),onRetry:L}),C&&(0,I.tZ)(c.Z,{groupIds:D,children:(0,I.tZ)(ce,{items:f.similar,filteredItems:f.filtered,onMerge:j,orgId:i,project:r,groupId:p,pageLinks:f.pageLinks})})]})})}pe.displayName="SimilarStackTrace";const ue=pe,ye=(0,i.Z)("h4",{target:"eitepl1"})({name:"1ykowef",styles:"margin-bottom:0"}),fe=(0,i.Z)("div",{target:"eitepl0"})("display:flex;align-items:center;justify-content:space-between;margin-bottom:",(0,p.D)(2),";");function Ze(e){let{project:t,...s}=e;return(0,I.tZ)(r.Z,{features:["similarity-view"],project:t,children:(0,I.tZ)(ue,{project:t,...s})})}Ze.displayName="GroupSimilarIssues";const xe=Ze}}]);
//# sourceMappingURL=../sourcemaps/app_views_issueDetails_groupSimilarIssues_index_tsx.ffdf343bce58efad0b2dddd13d046df0.js.map