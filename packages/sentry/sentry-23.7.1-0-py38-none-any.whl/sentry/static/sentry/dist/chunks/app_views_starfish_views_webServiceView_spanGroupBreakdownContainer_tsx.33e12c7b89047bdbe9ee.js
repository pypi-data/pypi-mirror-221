"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_starfish_views_webServiceView_spanGroupBreakdownContainer_tsx"],{"./app/views/starfish/utils/useEventsStatsQuery.tsx":(e,t,a)=>{a.d(t,{z:()=>d});var s=a("./app/utils/discover/eventView.tsx"),i=a("./app/utils/discover/genericDiscoverQuery.tsx"),r=a("./app/utils/useLocation.tsx"),o=a("./app/utils/useOrganization.tsx"),n=a("./app/views/starfish/utils/retryHandlers.tsx");function d(e){let{eventView:t,enabled:a,referrer:d,initialData:p,excludeOther:l=!1}=e;const c=(0,r.T)(),u=(0,o.Z)(),g=(0,i.JC)({route:"events-stats",eventView:t,location:c,orgSlug:u.slug,getRequestPayload:()=>({...t.getEventsAPIPayload(c),yAxis:t.yAxis,topEvents:t.topEvents,excludeOther:!0===l?1:0,partial:1,orderby:t.sorts?.[0]?(0,s.uZ)(t.sorts?.[0]):void 0,interval:t.interval}),options:{enabled:a,refetchOnWindowFocus:!1,retry:n.V,retryDelay:n.P,staleTime:1/0},referrer:d});return{...g,data:g.isLoading?p:g.data}}},"./app/views/starfish/views/webServiceView/spanGroupBreakdownContainer.tsx":(e,t,a)=>{a.d(t,{Jg:()=>F,sZ:()=>G,_2:()=>I});var s=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(a("../node_modules/core-js/modules/es.array.push.js"),a("../node_modules/react/index.js")),r=a("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),o=a("./app/components/charts/utils.tsx"),n=a("./app/components/panels/panel.tsx"),d=a("./app/locale.tsx"),p=a("./app/styles/space.tsx"),l=a("./app/utils.tsx"),c=a("./app/utils/discover/discoverQuery.tsx"),u=a("./app/utils/discover/eventView.tsx"),g=a("./app/utils/discover/types.tsx"),m=a("./app/utils/useLocation.tsx"),h=a("./app/utils/useOrganization.tsx"),v=a("./app/utils/usePageFilters.tsx"),y=a("./app/views/starfish/types.tsx"),w=a("./app/views/starfish/utils/constants.tsx"),x=a("./app/views/starfish/utils/useEventsStatsQuery.tsx"),f=a("../node_modules/react-router/es/index.js"),b=a("../node_modules/lodash/cloneDeep.js"),E=a.n(b),_=a("../node_modules/query-string/index.js"),T=a("./app/components/compactSelect/index.tsx"),S=a("./app/utils/analytics.tsx"),P=a("./app/utils/discover/charts.tsx"),N=a("./app/utils/performanceForSentry/index.tsx"),C=a("./app/views/starfish/components/chart.tsx"),D=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const{SPAN_MODULE:A}=y.SpanMetricsFields;function Z(e){let{topSeriesData:t,transaction:a,isTimeseriesLoading:s,errored:i,options:r,dataDisplayType:o,onDisplayTypeChange:n}=e;const p=(0,h.Z)(),l=p.features.includes("starfish-wsv-chart-dropdown"),c=[];for(let e=0;e<t.length;e++){const a=t[e];a.emphasis={disabled:!1,focus:"series"},a.blur={areaStyle:{opacity:.3}},a.triggerLineEvent=!0,c.push(a)}const u=E()(c),g=t[0]?.data?.length??0;for(let e=0;e<g;e++){const a=t.reduce(((t,a)=>t+a.data[e].value),0);u.forEach((t=>{const s={...t.data[e]};s.value=0===a?0:s.value/a,t.data[e]=s}))}const m=Boolean(a);return(0,D.tZ)(L,{children:(0,D.BX)($,{children:[(0,D.BX)(O,{children:[(0,D.tZ)(k,{children:m?(0,d.t)("Endpoint Breakdown"):(0,d.t)("Time Spent Breakdown")}),l&&(0,D.tZ)(T.Z,{options:r,value:o,onChange:e=>{n(e.value),(0,S.Gi)("starfish.web_service_view.breakdown.display_change",{organization:p,display:e.value})}})]}),(0,D.tZ)(N.oF,{id:"WSV.SpanGroupBreakdown",hasData:t.length>0,children:(0,D.tZ)(C.ZP,{height:340,showLegend:!0,data:o===F.PERCENTAGE?u:t,dataMax:o===F.PERCENTAGE?1:void 0,durationUnit:o===F.PERCENTAGE?.25:void 0,errored:i,loading:s,utc:!1,onClick:e=>{let a;const s={};"db"===e.seriesName?a="/starfish/database/":"Other"===e.seriesName?(s[A]="other",s["!span.category"]=t.filter((e=>"Other"!==e.seriesName)).map((e=>e.seriesName))):(s[A]="other",s["span.category"]=e.seriesName),a||(a=`/starfish/spans/?${_.stringify(s)}`),f.browserHistory.push(a)},grid:{left:"0",right:"0",top:"20px",bottom:"0"},definedAxisTicks:6,stacked:!0,aggregateOutputFormat:o===F.PERCENTAGE?"percentage":"duration",tooltipFormatterOptions:{nameFormatter:e=>"db"===e?"database":e,valueFormatter:e=>o===F.PERCENTAGE?(0,P.Ew)(e,"percentage"):(0,P.Ew)(e,"duration")},onLegendSelectChanged:e=>{(0,S.Gi)("starfish.web_service_view.breakdown.legend_change",{organization:p,selected:Object.keys(e.selected).filter((t=>e.selected[t])),toggled:e.name})},legendFormatter:e=>"db"===e?"database":e})})]})})}Z.displayName="SpanGroupBreakdown";const $=(0,s.Z)("div",{target:"e1sx7q3i3"})("padding:0 ",(0,p.D)(2),";flex:2;"),k=(0,s.Z)("p",{target:"e1sx7q3i2"})((e=>e.theme.text.cardTitle),";"),O=(0,s.Z)("div",{target:"e1sx7q3i1"})("padding:0 ",(0,p.D)(1)," 0 0;min-height:36px;width:100%;display:flex;align-items:center;justify-content:space-between;margin-bottom:",(0,p.D)(1),";"),L=(0,s.Z)("div",{target:"e1sx7q3i0"})("display:flex;min-height:200px;padding-bottom:",(0,p.D)(2),";"),{SPAN_SELF_TIME:R}=y.SpanMetricsFields,j="Other",G=(0,d.t)("custom");let F;function I(e){let{transaction:t,transactionMethod:a}=e;const s=(0,v.Z)(),o=(0,h.Z)(),n=(0,m.T)(),{selection:d}=s,p=(0,r.u)(),u=[{label:"Percentages",value:F.PERCENTAGE},{label:"Duration (p95)",value:F.DURATION_P95},{label:"Total Duration",value:F.CUMULATIVE_DURATION}],[g,y]=(0,i.useState)(F.PERCENTAGE),{data:w,isLoading:f}=(0,c._)({eventView:B(d,`transaction.op:http.server ${t?`transaction:${t}`:""} ${a?`http.method:${a}`:""}`,["span.category"]),orgSlug:o.slug,referrer:"api.starfish-web-service.span-category-breakdown",location:n,limit:4}),{data:b,isLoading:E}=(0,c._)({eventView:B(d,`transaction.op:http.server ${t?`transaction:${t}`:""} ${a?`http.method:${a}`:""}`,[]),orgSlug:o.slug,referrer:"api.starfish-web-service.total-time",location:n}),{isLoading:_,data:T,isError:S}=(0,x.z)({eventView:U(d,`transaction.op:http.server ${t?`transaction:${t}`:""} ${a?`http.method:${a}`:""}`,["span.category"],g,!0),enabled:!0,referrer:"api.starfish-web-service.span-category-breakdown-timeseries",initialData:{}}),P=b?.data[0]?.[`sum(${R})`]?parseInt(b?.data[0][`sum(${R})`],10):0,N=w?.data.reduce(((e,t)=>e+parseInt(t[`sum(${R})`],10)),0)??0,C=P?P-N:0,A=[];if((0,l.ri)(w)){for(let e=0;e<w.data.length;e++){const t=w.data[e],a=t["span.category"];A.push({cumulativeTime:parseInt(t[`sum(${R})`],10),group:{"span.category":""===a?G:a}})}C>0&&T&&j in T&&A.push({cumulativeTime:C,group:{"span.category":j}})}const $={},k=p.charts.getColorPalette(A.length-2);(0,l.ri)(T)&&!_&&A.length>0&&(A.forEach(((e,t)=>{const a=e.group["span.category"],s=""===a?G:a;$[s]={seriesName:s,data:[],color:k[t]}})),Object.keys(T).forEach((e=>{const t=T?.[e];$[""===e?G:e].data=t?.data.map((e=>({name:1e3*e[0],value:e[1][0].count})))??[]})));const O=Object.values($);return(0,D.tZ)(V,{children:(0,D.tZ)(Z,{tableData:A,totalCumulativeTime:P,isTableLoading:f,topSeriesData:O,colorPalette:k,isTimeseriesLoading:_,isCumulativeTimeLoading:E,transaction:t,errored:S,options:u,dataDisplayType:g,onDisplayTypeChange:y})})}!function(e){e.DURATION_P95="duration_p95",e.CUMULATIVE_DURATION="cumulative_duration",e.PERCENTAGE="percentage"}(F||(F={})),I.displayName="SpanGroupBreakdownContainer";const V=(0,s.Z)(n.Z,{target:"eoo99dh0"})("padding-top:",(0,p.D)(2),";margin-bottom:0;"),U=(e,t,a,s,i)=>{const r=s===F.DURATION_P95?`p95(${R})`:`sum(${R})`;return u.ZP.fromNewQueryWithPageFilters({name:"",fields:[`sum(${R})`,`p95(${R})`,...a],yAxis:i?[r]:[],query:t,dataset:g.as.SPANS_METRICS,orderby:"-sum_span_self_time",version:2,topEvents:a.length>0?"4":void 0,interval:i?(0,o.ZS)(e.datetime,w.R):void 0},e)},B=(e,t,a)=>u.ZP.fromNewQueryWithPageFilters({name:"",fields:[`sum(${R})`,...a],query:t,dataset:g.as.SPANS_METRICS,orderby:"-sum_span_self_time",version:2,topEvents:a.length>0?"4":void 0},e)}}]);
//# sourceMappingURL=../sourcemaps/app_views_starfish_views_webServiceView_spanGroupBreakdownContainer_tsx.ab6f842536053defe9aa42cd7ba2d96d.js.map