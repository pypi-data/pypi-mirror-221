"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_dataExport_dataDownload_tsx"],{"./app/components/dataExport.tsx":(e,t,r)=>{r.d(t,{ZP:()=>y,tD:()=>h});var n=r("../node_modules/react/index.js"),o=r("../node_modules/lodash/debounce.js"),i=r.n(o),s=r("./app/actionCreators/indicator.tsx"),a=r("./app/components/acl/feature.tsx"),d=r("./app/components/button.tsx"),l=r("./app/locale.tsx"),p=r("./app/utils/withApi.tsx"),u=r("./app/utils/withOrganization.tsx"),c=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");let h;function m(e){let{api:t,children:r,disabled:o,organization:p,payload:u,icon:h}=e;const m=(0,n.useRef)(!1),[y,w]=(0,n.useState)(!1);(0,n.useEffect)((()=>{y&&w(!1)}),[u.queryType,u.queryInfo]),(0,n.useEffect)((()=>()=>{m.current=!0}),[]);const x=(0,n.useCallback)((()=>{w(!0),t.requestPromise(`/organizations/${p.slug}/data-export/`,{includeAllArgs:!0,method:"POST",data:{query_type:u.queryType,query_info:u.queryInfo}}).then((e=>{let[t,r,n]=e;m.current||(0,s.S9)(201===n?.status?(0,l.t)("Sit tight. We'll shoot you an email when your data is ready for download."):(0,l.t)("It looks like we're already working on it. Sit tight, we'll email you."))})).catch((e=>{if(m.current)return;const t=e?.responseJSON?.detail??(0,l.t)("We tried our hardest, but we couldn't export your data. Give it another go.");(0,s.Iw)(t),w(!1)}))}),[u.queryInfo,u.queryType,p.slug,t]);return(0,c.tZ)(a.Z,{features:["organizations:discover-query"],children:y?(0,c.tZ)(d.zx,{size:"sm",priority:"default",title:(0,l.t)("You can get on with your life. We'll email you when your data's ready."),disabled:!0,icon:h,children:(0,l.t)("We're working on it...")}):(0,c.tZ)(d.zx,{onClick:i()(x,500),disabled:o||!1,size:"sm",priority:"default",title:(0,l.t)("Put your data to work. Start your export and we'll email you when it's finished."),icon:h,children:r||(0,l.t)("Export All to CSV")})})}!function(e){e.ISSUES_BY_TAG="Issues-by-Tag",e.DISCOVER="Discover"}(h||(h={})),m.displayName="DataExport";const y=(0,p.Z)((0,u.Z)(m))},"./app/views/dataExport/dataDownload.tsx":(e,t,r)=>{r.r(t),r.d(t,{DownloadStatus:()=>x,default:()=>f});var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(r("../node_modules/core-js/modules/es.array.push.js"),r("../node_modules/react/index.js")),s=r("../node_modules/react-router/es/index.js"),a=r("./app/components/button.tsx"),d=r("./app/components/dataExport.tsx"),l=r("./app/components/dateTime.tsx"),p=r("./app/icons/index.tsx"),u=r("./app/locale.tsx"),c=r("./app/styles/space.tsx"),h=r("./app/utils/withDomainRequired.tsx"),m=r("./app/views/auth/layout.tsx"),y=r("./app/views/deprecatedAsyncView.tsx"),w=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");let x;!function(e){e.EARLY="EARLY",e.VALID="VALID",e.EXPIRED="EXPIRED"}(x||(x={}));class g extends y.Z{constructor(){super(...arguments),(0,n.Z)(this,"disableErrorReport",!1)}getTitle(){return(0,u.t)("Download Center")}getEndpoints(){const{orgId:e,dataExportId:t}=this.props.params;return[["download",`/organizations/${e}/data-export/${t}/`]]}getActionLink(e){const{orgId:t}=this.props.params;switch(e){case d.tD.ISSUES_BY_TAG:return`/organizations/${t}/issues/`;case d.tD.DISCOVER:return`/organizations/${t}/discover/queries/`;default:return"/"}}renderDate(e){if(!e)return null;const t=new Date(e);return(0,w.tZ)("strong",{children:(0,w.tZ)(l.Z,{date:t})})}renderEarly(){return(0,w.BX)(i.Fragment,{children:[(0,w.tZ)(Z,{children:(0,w.BX)("h3",{children:[(0,u.t)("What are"),(0,w.tZ)("i",{children:(0,u.t)(" you ")}),(0,u.t)("doing here?")]})}),(0,w.BX)(b,{children:[(0,w.tZ)("p",{children:(0,u.t)("Not that its any of our business, but were you invited to this page? It's just that we don't exactly remember emailing you about it.")}),(0,w.tZ)("p",{children:(0,u.t)("Close this window and we'll email you when your download is ready.")})]})]})}renderExpired(){const{query:e}=this.state.download,t=this.getActionLink(e.type);return(0,w.BX)(i.Fragment,{children:[(0,w.tZ)(Z,{children:(0,w.tZ)("h3",{children:(0,u.t)("This is awkward.")})}),(0,w.BX)(b,{children:[(0,w.tZ)("p",{children:(0,u.t)("That link expired, so your download doesn't live here anymore. Just picked up one day and left town.")}),(0,w.tZ)("p",{children:(0,u.t)("Make a new one with your latest data. Your old download will never see it coming.")}),(0,w.tZ)(D,{href:t,priority:"primary",children:(0,u.t)("Start a New Download")})]})]})}openInDiscover(){const{download:{query:{info:e}}}=this.state,{orgId:t}=this.props.params,r={pathname:`/organizations/${t}/discover/results/`,query:e};s.browserHistory.push((0,h.D)(r))}renderOpenInDiscover(){const{download:{query:e={type:d.tD.ISSUES_BY_TAG,info:{}}}}=this.state,{type:t=d.tD.ISSUES_BY_TAG}=e;return"Discover"===t?(0,w.BX)(i.Fragment,{children:[(0,w.tZ)("p",{children:(0,u.t)("Need to make changes?")}),(0,w.tZ)(a.zx,{priority:"primary",onClick:()=>this.openInDiscover(),children:(0,u.t)("Open in Discover")}),(0,w.tZ)("br",{})]}):null}renderValid(){const{download:{dateExpired:e,checksum:t}}=this.state,{orgId:r,dataExportId:n}=this.props.params;return(0,w.BX)(i.Fragment,{children:[(0,w.tZ)(Z,{children:(0,w.tZ)("h3",{children:(0,u.t)("All done.")})}),(0,w.BX)(b,{children:[(0,w.tZ)("p",{children:(0,u.t)("See, that wasn't so bad. Your data is all ready for download.")}),(0,w.tZ)(a.zx,{priority:"primary",icon:(0,w.tZ)(p.Dj,{}),href:`/api/0/organizations/${r}/data-export/${n}/?download=true`,children:(0,u.t)("Download CSV")}),(0,w.BX)("p",{children:[(0,u.t)("That link won't last forever â€” it expires:"),(0,w.tZ)("br",{}),this.renderDate(e)]}),this.renderOpenInDiscover(),(0,w.BX)("p",{children:[(0,w.tZ)("small",{children:(0,w.BX)("strong",{children:["SHA1:",t]})}),(0,w.tZ)("br",{}),(0,u._N)("Need help verifying? [link].",{link:(0,w.tZ)("a",{href:"https://docs.sentry.io/product/discover-queries/query-builder/#filter-by-table-columns",target:"_blank",rel:"noopener noreferrer",children:(0,u.t)("Check out our docs")})})]})]})]})}renderError(){const{errors:{download:e}}=this.state,t=e?.responseJSON?.detail;return(0,w.tZ)(m.Z,{children:(0,w.BX)("main",{children:[(0,w.tZ)(Z,{children:(0,w.BX)("h3",{children:[e.status," - ",e.statusText]})}),t&&(0,w.tZ)(b,{children:(0,w.tZ)("p",{children:t})})]})})}renderContent(){const{download:e}=this.state;switch(e.status){case x.EARLY:return this.renderEarly();case x.EXPIRED:return this.renderExpired();default:return this.renderValid()}}renderBody(){return(0,w.tZ)(m.Z,{children:(0,w.tZ)("main",{children:this.renderContent()})})}}const Z=(0,o.Z)("header",{target:"e1uugl3y2"})("border-bottom:1px solid ",(e=>e.theme.border),";padding:",(0,c.D)(3)," 40px 0;h3{font-size:24px;margin:0 0 ",(0,c.D)(3)," 0;}"),b=(0,o.Z)("div",{target:"e1uugl3y1"})("padding:",(0,c.D)(2)," 40px;max-width:500px;p{margin:",(0,c.D)(1.5)," 0;}"),D=(0,o.Z)(a.zx,{target:"e1uugl3y0"})("margin-bottom:",(0,c.D)(1.5),";"),f=g},"./app/views/deprecatedAsyncView.tsx":(e,t,r)=>{r.d(t,{Z:()=>s});var n=r("./app/components/deprecatedAsyncComponent.tsx"),o=r("./app/components/sentryDocumentTitle.tsx"),i=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class s extends n.Z{getTitle(){return""}render(){return(0,i.tZ)(o.Z,{title:this.getTitle(),children:this.renderComponent()})}}s.displayName="DeprecatedAsyncView"}}]);
//# sourceMappingURL=../sourcemaps/app_views_dataExport_dataDownload_tsx.f607df0700471e9567a263ab7721f192.js.map