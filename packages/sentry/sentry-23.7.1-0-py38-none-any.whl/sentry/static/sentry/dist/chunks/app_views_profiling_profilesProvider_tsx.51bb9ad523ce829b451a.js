"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_profiling_profilesProvider_tsx"],{"./app/components/profiling/profilingBreadcrumbs.tsx":(e,r,t)=>{t.d(r,{u:()=>p}),t("../node_modules/core-js/modules/es.error.cause.js");var o=t("../node_modules/react/index.js"),n=t("../node_modules/lodash/omit.js"),s=t.n(n),a=t("./app/components/breadcrumbs.tsx"),i=t("./app/locale.tsx"),l=t("./app/utils/profiling/routes.tsx"),u=t("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function p(e){let{organization:r,trails:t}=e;const n=(0,o.useMemo)((()=>t.map((e=>function(e,r){let{organization:t}=r;switch(e.type){case"landing":return{to:(0,l.XR)({query:s()(e.payload.query,["cursor","query"]),orgSlug:t.slug}),label:(0,i.t)("Profiling"),preservePageFilters:!0};case"profile summary":return{to:(0,l.R0)({query:s()(e.payload.query,["cursor","query"]),orgSlug:t.slug,projectSlug:e.payload.projectSlug,transaction:e.payload.transaction}),label:(0,i.t)("Profile Summary"),preservePageFilters:!0};case"flamechart":return{to:(0,l.TH)({query:e.payload.query,orgSlug:t.slug,projectSlug:e.payload.projectSlug,profileId:e.payload.profileId}),label:e.payload.transaction,preservePageFilters:!0};default:throw new Error(`Unknown breadcrumb type: ${JSON.stringify(e)}`)}}(e,{organization:r})))),[r,t]);return(0,u.tZ)(a.Z,{crumbs:n})}p.displayName="ProfilingBreadcrumbs"},"./app/utils/profiling/guards/profile.tsx":(e,r,t)=>{function o(e){return"object"==typeof e&&"profiles"in e&&Array.isArray(e.profiles)&&"shared"in e}function n(e){return"type"in e&&"evented"===e.type}function s(e){return"type"in e&&"sampled"===e.type}function a(e){return!("type"in e)&&Array.isArray(e.resources)}function i(e){return"profile"in e&&"samples"in e.profile&&"stacks"in e.profile&&"frames"in e.profile}t.d(r,{AN:()=>i,BE:()=>a,Us:()=>s,bf:()=>n,nN:()=>o})},"./app/views/profiling/profilesProvider.tsx":(e,r,t)=>{t.r(r),t.d(r,{ProfileContext:()=>w,ProfileTransactionContext:()=>_,ProfilesProvider:()=>T,default:()=>N,useProfileTransaction:()=>I,useProfiles:()=>q,useSetProfiles:()=>Z}),t("../node_modules/core-js/modules/es.error.cause.js");var o=t("../node_modules/react/index.js"),n=t("../node_modules/@sentry/browser/node_modules/@sentry/core/esm/exports.js"),s=t("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=t("./app/components/button.tsx"),i=t("./app/components/layouts/thirds.tsx"),l=t("./app/components/profiling/profilingBreadcrumbs.tsx"),u=t("./app/locale.tsx"),p=t("./app/styles/space.tsx"),d=t("./app/utils/analytics.tsx"),c=t("./app/utils/performance/urls.ts"),f=t("./app/utils/profiling/guards/profile.tsx"),m=t("./app/utils/useLocation.tsx"),y=t("./app/utils/useOrganization.tsx"),g=t("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function v(e){let{transaction:r,projectId:t,eventId:n}=e;const s=(0,m.T)(),p=(0,y.Z)(),v=q(),j="resolved"===v.type?(b=v.data,(0,f.nN)(b)?b.metadata.transactionName:(0,f.AN)(b)&&b.transaction.name||(0,u.t)("Unknown Transaction")):"";var b;const w=n??"",S=t??"",Z=r?.id?(0,c.D)(p.slug,`${S}:${r.id}`):null,_=(0,o.useCallback)((()=>{(0,d.Gi)("profiling_views.go_to_transaction",{organization:p,source:"transaction_details"})}),[p]),I=(0,o.useMemo)((()=>[{type:"landing",payload:{query:s.query}},{type:"profile summary",payload:{projectSlug:S,transaction:j,query:s.query}},{type:"flamechart",payload:{transaction:j,profileId:w,projectSlug:S,query:s.query}}]),[s,S,j,w]);return(0,g.BX)(h,{children:[(0,g.tZ)(P,{children:(0,g.tZ)(x,{children:(0,g.tZ)(l.u,{organization:p,trails:I})})}),(0,g.tZ)(i.kP,{children:Z&&(0,g.tZ)(a.zx,{size:"sm",onClick:_,to:Z,children:(0,u.t)("Go to Transaction")})})]})}v.displayName="ProfileHeader";const P=(0,s.Z)(i.oB,{target:"e1eqzoq72"})("margin-bottom:",(0,p.D)(1.5),";"),x=(0,s.Z)("div",{target:"e1eqzoq71"})("nav{padding-bottom:",(0,p.D)(1),";}"),h=(0,s.Z)(i.h4,{target:"e1eqzoq70"})("padding:",(0,p.D)(1)," ",(0,p.D)(2)," ",(0,p.D)(0)," ",(0,p.D)(2),"!important;");var j=t("./app/utils/useApi.tsx"),b=t("./app/utils/useParams.tsx");const w=(0,o.createContext)(null),S=(0,o.createContext)(null);function q(){const e=(0,o.useContext)(w);if(!e)throw new Error("useProfiles was called outside of ProfileProvider");return e}function Z(){const e=(0,o.useContext)(S);if(!e)throw new Error("useSetProfiles was called outside of SetProfileProvider");return e}const _=(0,o.createContext)(null);function I(){const e=(0,o.useContext)(_);if(!e)throw new Error("useProfileTransaction was called outside of ProfileTransactionContext");return e}function C(e){const r=(0,y.Z)(),t=(0,b.U)(),[n,s]=(0,o.useState)({type:"initial"}),a=function(e,r,t){const n=(0,j.Z)(),[s,a]=(0,o.useState)({type:"initial"});return(0,o.useEffect)((()=>{if(null!==t)return a({type:"loading"}),function(e,r,t,o){return e.requestPromise(`/projects/${r}/${t}/events/${o}/`)}(n,e,r,t).then((e=>{a({type:"resolved",data:e})})).catch((e=>{a({type:"errored",error:e})})),()=>{n.clear()}}),[n,e,r,t]),s}(r.slug,t.projectId,"resolved"===n.type?(i=n.data,(0,f.nN)(i)?i.metadata.transactionID:(0,f.AN)(i)?i.transaction.id:null):null);var i;return(0,g.tZ)(T,{onUpdateProfiles:s,orgSlug:r.slug,profileId:t.eventId,projectSlug:t.projectId,children:(0,g.tZ)(S.Provider,{value:s,children:(0,g.BX)(_.Provider,{value:a,children:[(0,g.tZ)(v,{eventId:t.eventId,projectId:t.projectId,transaction:"resolved"===a.type?a.data:null}),e.children]})})})}function T(e){let{children:r,onUpdateProfiles:t,orgSlug:s,projectSlug:a,profileId:i}=e;const l=(0,j.Z)(),[p,d]=(0,o.useState)({type:"initial"});return(0,o.useEffect)((()=>{if(i&&a&&s)return d({type:"loading"}),function(e,r,t,o){return e.requestPromise(`/projects/${o}/${t}/profiling/profiles/${r}/`,{method:"GET",includeAllArgs:!0}).then((e=>{let[r]=e;return r}))}(l,i,a,s).then((e=>{d({type:"resolved",data:e}),t?.({type:"resolved",data:e})})).catch((e=>{const r="[object Object]"===e.toString()?(0,u.t)("Error: Unable to load profiles"):e.toString();d({type:"errored",error:r}),t?.({type:"errored",error:r}),n.Tb(e)})),()=>{l.clear()}}),[l,t,s,a,i]),(0,g.tZ)(w.Provider,{value:p,children:r})}C.displayName="ProfilesAndTransactionProvider",T.displayName="ProfilesProvider";const N=C}}]);
//# sourceMappingURL=../sourcemaps/app_views_profiling_profilesProvider_tsx.2c1b1f41ec03e4f3c194a9ff2bffeb44.js.map