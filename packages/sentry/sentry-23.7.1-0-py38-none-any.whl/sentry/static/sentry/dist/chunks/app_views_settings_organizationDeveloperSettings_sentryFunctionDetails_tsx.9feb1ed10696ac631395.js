"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_settings_organizationDeveloperSettings_sentryFunctionDetails_tsx"],{"./app/components/forms/formPanel.tsx":(e,t,n)=>{n.d(t,{Z:()=>u});var s=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=n("../node_modules/react/index.js"),i=n("./app/components/forms/fieldFromConfig.tsx"),a=n("./app/components/panels/panel.tsx"),r=n("./app/components/panels/panelBody.tsx"),l=n("./app/components/panels/panelHeader.tsx"),d=n("./app/icons/index.tsx"),c=n("./app/utils/sanitizeQuerySelector.tsx"),p=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function m(e){let{additionalFieldProps:t={},title:n,fields:s,access:m,disabled:u,renderFooter:g,renderHeader:f,collapsible:v,initiallyCollapsed:y=!1,...b}=e;const[Z,x]=(0,o.useState)(y),F=(0,o.useCallback)((()=>x((e=>!e))),[]);return(0,p.BX)(a.Z,{id:"string"==typeof n?(0,c.m)(n):void 0,children:[n&&(0,p.BX)(l.Z,{children:[n,v&&(0,p.tZ)(h,{onClick:F,children:(0,p.tZ)(d.g6,{"data-test-id":"form-panel-collapse-chevron",direction:Z?"down":"up",size:"xs"})})]}),(0,p.BX)(r.Z,{hidden:Z,children:["function"==typeof f&&f({title:n,fields:s}),s.map((e=>{if("function"==typeof e)return e();const{defaultValue:n,...s}=e;return!0===u&&(s.disabled=!0,s.disabledReason=void 0),(0,p.tZ)(i.Z,{access:m,disabled:u,...b,...t,field:s,highlighted:b.highlighted===`#${e.name}`},e.name)})),"function"==typeof g&&g({title:n,fields:s})]})]})}m.displayName="FormPanel";const u=m,h=(0,s.Z)("span",{target:"eovlw60"})({name:"e0dnmk",styles:"cursor:pointer"})},"./app/components/forms/jsonForm.tsx":(e,t,n)=>{n.d(t,{Z:()=>h});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=n("../node_modules/react/index.js"),i=n("../node_modules/@sentry/browser/node_modules/@sentry/core/esm/exports.js"),a=n("../node_modules/scroll-to-element/index.js"),r=n.n(a),l=n("./app/utils.tsx"),d=n("./app/utils/sanitizeQuerySelector.tsx"),c=n("./app/utils/withSentryRouter.tsx"),p=n("./app/components/forms/formPanel.tsx"),m=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class u extends o.Component{constructor(){super(...arguments),(0,s.Z)(this,"state",{highlighted:this.props.location?.hash})}componentDidMount(){this.scrollToHash()}componentDidUpdate(e){if(this.props.location&&this.props.location.hash!==e.location.hash){const e=this.props.location.hash;this.scrollToHash(e),this.setState({highlighted:e})}}scrollToHash(e){const t=e||this.props.location?.hash;if(t)try{r()((0,d.m)(decodeURIComponent(t)),{align:"middle",offset:-100})}catch(e){i.Tb(e)}}shouldDisplayForm(e){const t=e.filter((e=>"function"!=typeof e&&(0,l.ri)(e?.visible)));if(e.length===t.length){const{additionalFieldProps:e,...n}=this.props;return!t.every((t=>"function"==typeof t.visible?!t.visible({...n,...e}):!t.visible))}return!0}renderForm(e){let{fields:t,formPanelProps:n,title:s}=e;return this.shouldDisplayForm(t)||n?.renderFooter||n?.renderHeader?(0,m.tZ)(p.Z,{title:s,fields:t,...n}):null}render(){const{access:e,collapsible:t,initiallyCollapsed:n,fields:s,title:i,forms:a,disabled:r,features:l,additionalFieldProps:d,renderFooter:c,renderHeader:p,location:u,params:h,router:g,routes:f,...v}=this.props,y={access:e,disabled:r,features:l,additionalFieldProps:d,renderFooter:c,renderHeader:p,highlighted:this.state.highlighted,collapsible:t,initiallyCollapsed:n};return(0,m.BX)("div",{...v,children:[void 0!==a&&a.map(((e,t)=>(0,m.tZ)(o.Fragment,{children:this.renderForm({formPanelProps:y,...e})},t))),void 0===a&&void 0!==s&&this.renderForm({fields:s,formPanelProps:y,title:i})]})}}u.displayName="JsonForm";const h=(0,c.Z)(u)},"./app/components/panels/panelHeader.tsx":(e,t,n)=>{n.d(t,{Z:()=>r});var s=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=n("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),i=n("./app/styles/space.tsx");const a=e=>{let{disablePadding:t,hasButtons:n}=e;return(0,o.iv)("padding:",n?(0,i.D)(1):(0,i.D)(2)," ",t?0:(0,i.D)(2),";","")},r=(0,s.Z)("div",{target:"e1dzfr4k0"})("display:flex;align-items:center;justify-content:space-between;color:",(e=>e.lightText?e.theme.gray300:e.theme.gray400),";font-size:",(e=>e.theme.fontSizeSmall),";font-weight:600;text-transform:uppercase;border-bottom:1px solid ",(e=>e.theme.border),";border-radius:calc(",(e=>e.theme.panelBorderRadius)," - 1px) calc(",(e=>e.theme.panelBorderRadius)," - 1px) 0 0;background:",(e=>e.theme.backgroundSecondary),";line-height:1;position:relative;",a,";")},"./app/views/settings/organizationDeveloperSettings/sentryFunctionDetails.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>R}),n("../node_modules/core-js/modules/es.array.push.js");var s=n("../node_modules/react/index.js"),o=n("../node_modules/react-router/es/index.js"),i=n("../node_modules/@monaco-editor/react/lib/es/index.js"),a=n("./app/actionCreators/indicator.tsx"),r=n("./app/components/acl/feature.tsx"),l=n("./app/components/deprecatedAsyncComponent.tsx"),d=n("./app/components/forms/form.tsx"),c=n("./app/components/forms/jsonForm.tsx"),p=n("./app/components/forms/model.tsx"),m=n("./app/components/panels/panel.tsx"),u=n("./app/components/panels/panelBody.tsx"),h=n("./app/components/panels/panelHeader.tsx"),g=n("./app/locale.tsx"),f=n("./app/utils/withDomainRequired.tsx"),v=n("./app/utils/withOrganization.tsx"),y=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),b=n("./app/components/button.tsx"),Z=n("./app/components/forms/fields/textField.tsx"),x=n("./app/icons/index.tsx"),F=n("./app/styles/space.tsx"),S=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function w(e){const{envVariables:t,setEnvVariables:n}=e;return(0,S.BX)("div",{children:[(0,S.BX)(h.Z,{children:[(0,g.t)("Environment Variables"),(0,S.tZ)(_,{size:"sm",icon:(0,S.tZ)(x.N_,{isCircled:!0}),"aria-label":(0,g.t)("Add Environment Variable"),onClick:()=>{n([...t,{name:"",value:""}])}})]}),(0,S.BX)(P,{children:[(0,S.BX)(D,{children:[(0,S.tZ)(C,{children:(0,g.t)("Name")}),(0,S.tZ)(B,{children:(0,g.t)("Value")})]}),t.map(((e,s)=>(0,S.BX)(D,{children:[(0,S.tZ)(Z.Z,{name:`env-variable-name-${s}`,required:!1,inline:!1,defaultValue:e.name,value:e.name,stacked:!0,onChange:e=>((e,s)=>{const o=[...t];for(;o.length<=s;)o.push({name:"",value:""});o[s]={...o[s],name:e},n(o)})(e,s)}),(0,S.tZ)(Z.Z,{name:`env-variable-value-${s}`,required:!1,inline:!1,defaultValue:e.value,value:e.value,stacked:!0,onChange:e=>((e,s)=>{const o=[...t];for(;o.length<=s;)o.push({name:"",value:""});o[s]={...o[s],value:e},n(o)})(e,s)}),(0,S.tZ)(z,{children:(0,S.tZ)(_,{size:"sm",icon:(0,S.tZ)(x.Fz,{}),"aria-label":(0,g.t)("Remove Environment Variable %s",s),onClick:()=>(e=>{const s=[...t];s.splice(e,1),n(s)})(s)})})]},s)))]})]})}w.displayName="SentryFunctionEnvironmentVariables";const j=w,D=(0,y.Z)("div",{target:"eeaybgs5"})({name:"1dre63g",styles:"display:grid;grid-template-columns:1fr 1.5fr min-content"}),_=(0,y.Z)(b.zx,{target:"eeaybgs4"})({name:"tjo4qw",styles:"float:right"}),C=(0,y.Z)("div",{target:"eeaybgs3"})("text-align:left;margin-top:",(0,F.D)(2),";margin-bottom:",(0,F.D)(1),";color:",(e=>e.theme.gray400),";"),B=(0,y.Z)(C,{target:"eeaybgs2"})("margin-left:-",(0,F.D)(2),";"),z=(0,y.Z)("div",{target:"eeaybgs1"})("align-items:center;display:flex;margin-bottom:",(0,F.D)(2),";"),P=(0,y.Z)(u.Z,{target:"eeaybgs0"})("padding:",(0,F.D)(2),";");var k=n("./app/views/settings/organizationDeveloperSettings/constants.tsx"),V=n("./app/views/settings/organizationDeveloperSettings/subscriptionBox.tsx");function E(e){const{events:t,setEvents:n}=e;function s(e,s){s&&!t.includes(e)?n(t.concat(e)):!s&&t.includes(e)&&n(t.filter((t=>t!==e)))}return(0,S.tZ)(q,{children:k.j.map((t=>(0,S.tZ)(V.Z,{disabledFromPermissions:!1,webhookDisabled:!1,checked:e.events.includes(t),resource:t,onChange:s,isNew:"comment"===t},t)))})}E.displayName="SentryFunctionSubscriptions";const $=E,q=(0,y.Z)("div",{target:"e13f5gqz0"})("display:grid;grid-template:auto/1fr 1fr 1fr;@media (max-width: ",(e=>e.theme.breakpoints.large),"){grid-template:1fr 1fr 1fr/auto;}");function H(e){const t=[];e.onIssue&&t.push("issue"),e.onError&&t.push("error"),e.onComment&&t.push("comment"),delete e.onIssue,delete e.onError,delete e.onComment,e.events=t;const n=[];let s=0;for(;e[`env-variable-name-${s}`];)e[`env-variable-value-${s}`]&&n.push({name:e[`env-variable-name-${s}`],value:e[`env-variable-value-${s}`]}),delete e[`env-variable-name-${s}`],delete e[`env-variable-value-${s}`],s++;e.envVariables=n;const{...o}=e;return o}const X=[{name:"name",type:"string",required:!0,placeholder:"e.g. My Sentry Function",label:"Name",help:"Human readable name of your Sentry Function"},{name:"author",type:"string",placeholder:"e.g. Acme Software",label:"Author",help:"The company or person who built and maintains this Sentry Function."},{name:"overview",type:"string",placeholder:"e.g. This Sentry Function does something useful",label:"Overview",help:"A short description of your Sentry Function."}];function T(e){const[t]=(0,s.useState)((()=>new p.Z({transformData:H}))),{functionSlug:n}=e.params,{organization:l,sentryFunction:v}=e,y=n?"PUT":"POST";let b=`/organizations/${l.slug}/functions/`;n&&(b+=`${n}/`);const Z=v?v.code:"exports.yourFunction = (req, res) => {\n    let message = req.query.message || req.body.message || 'Hello World!';\n    console.log('Query: ' + req.query);\n    console.log('Body: ' + req.body);\n    res.status(200).send(message);\n  };",[x,F]=(0,s.useState)(v?.events||[]);(0,s.useEffect)((()=>{t.setValue("onIssue",x.includes("issue")),t.setValue("onError",x.includes("error")),t.setValue("onComment",x.includes("comment"))}),[t,x]);const[w,D]=(0,s.useState)(v?.env_variables?.length?v?.env_variables:[{name:"",value:""}]);return(0,S.tZ)("div",{children:(0,S.BX)(r.Z,{features:["organizations:sentry-functions"],children:[(0,S.tZ)("h2",{children:v?(0,g.t)("Editing Sentry Function"):(0,g.t)("Create Sentry Function")}),(0,S.BX)(d.Z,{apiMethod:y,apiEndpoint:b,model:t,onPreSubmit:()=>{(0,a.E3)((0,g.t)("Saving changes.."))},initialData:{code:Z,events:x,envVariables:w,...e.sentryFunction},onSubmitError:e=>{let t=(0,g.t)("Unknown Error");e.status>=400&&e.status<500&&(t=e?.responseJSON.detail??t),(0,a.Iw)(t)},onSubmitSuccess:e=>{(0,a.S9)((0,g.t)("Sentry Function successfully saved.",e.name));const t=`/settings/${l.slug}/developer-settings/sentry-functions/${e.slug}/`;v?(0,a.S9)((0,g.t)("%s successfully saved.",e.name)):(0,a.S9)((0,g.t)("%s successfully created.",e.name)),o.browserHistory.push((0,f.D)(t))},children:[(0,S.tZ)(c.Z,{forms:[{title:(0,g.t)("Sentry Function Details"),fields:X}]}),(0,S.BX)(m.Z,{children:[(0,S.tZ)(h.Z,{children:(0,g.t)("Webhooks")}),(0,S.tZ)(u.Z,{children:(0,S.tZ)($,{events:x,setEvents:F})})]}),(0,S.tZ)(m.Z,{children:(0,S.tZ)(j,{envVariables:w,setEnvVariables:D})}),(0,S.BX)(m.Z,{children:[(0,S.tZ)(h.Z,{children:(0,g.t)("Write your Code Below")}),(0,S.tZ)(u.Z,{children:(0,S.tZ)(i.ZP,{height:"40vh",theme:"light",defaultLanguage:"javascript",defaultValue:Z,onChange:function(e,n){t.setValue("code",e)},options:{minimap:{enabled:!1},scrollBeyondLastLine:!1}})})]})]})]})})}T.displayName="SentryFunctionDetails";class N extends l.Z{getEndpoints(){const{functionSlug:e}=this.props.params,{organization:t}=this.props;return e?[["sentryFunction",`/organizations/${t.slug}/functions/${e}/`]]:[]}renderBody(){return(0,S.tZ)(T,{sentryFunction:this.state.sentryFunction,...this.props})}}const R=(0,v.Z)(N)}}]);
//# sourceMappingURL=../sourcemaps/app_views_settings_organizationDeveloperSettings_sentryFunctionDetails_tsx.ff71eab27801992e63747a5b608c9111.js.map