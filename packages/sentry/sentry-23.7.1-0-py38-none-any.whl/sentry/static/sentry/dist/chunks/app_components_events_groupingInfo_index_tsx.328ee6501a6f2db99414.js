"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_events_groupingInfo_index_tsx"],{"./app/components/events/groupingInfo/index.tsx":(e,t,n)=>{n.d(t,{c:()=>pe,B:()=>se});var i=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=n("../node_modules/react/index.js"),s=n("./app/components/button.tsx"),a=n("./app/components/deprecatedAsyncComponent.tsx"),p=n("./app/components/events/eventDataSection.tsx"),l=n("./app/components/featureFeedback/index.tsx"),c=n("./app/components/loadingIndicator.tsx"),d=n("./app/locale.tsx"),u=n("./app/styles/space.tsx"),h=n("./app/types/index.tsx"),g=n("./app/utils/withOrganization.tsx"),m=n("./app/components/dropdownAutoComplete/index.tsx"),f=n("./app/components/dropdownButton.tsx"),b=n("./app/components/tooltip.tsx"),y=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class Z extends a.Z{getDefaultState(){return{...super.getDefaultState(),configs:[]}}getEndpoints(){return[["configs","/grouping-configs/"]]}renderLoading(){return this.renderBody()}renderBody(){const{configId:e,eventConfigId:t,onSelect:n}=this.props,{configs:i}=this.state,o=i.map((e=>{let{id:n,hidden:i}=e;return{value:n,label:(0,y.tZ)(se,{isHidden:i,isActive:n===t,children:n})}}));return(0,y.tZ)(m.Z,{onSelect:n,items:o,children:n=>{let{isOpen:i}=n;return(0,y.tZ)(b.u,{title:(0,d.t)("Click here to experiment with other grouping configs"),children:(0,y.tZ)(v,{isOpen:i,size:"sm",children:(0,y.tZ)(se,{isActive:t===e,children:e})})})}})}}const v=(0,o.Z)(f.Z,{target:"ex5wfgx0"})({name:"18zed2t",styles:"font-weight:inherit"}),C=Z;n("../node_modules/core-js/modules/es.array.push.js");var x=n("../node_modules/lodash/capitalize.js"),w=n.n(x),k=n("./app/components/events/interfaces/keyValueList/index.tsx"),S=n("./app/components/questionTooltip.tsx"),O=n("./app/components/segmentedControl.tsx"),z=n("./app/icons/index.tsx"),N=n("../node_modules/lodash/isObject.js"),_=n.n(N);function D(e){if(void 0===e)return!1;if(!e.contributes)return!0;for(const t of e.values)if(_()(t)&&D(t))return!0;return!1}function I(e,t){if(_()(e)){if(!e.contributes&&!e.hint&&0===e.values.length)return!1;if(!t&&!e.contributes)return!1}return!0}function T(e){let{component:t,showNonContributing:n}=e;return(0,y.tZ)(r.Fragment,{children:t.values.filter((e=>I(e,n))).map(((e,i)=>(0,y.tZ)(A,{children:_()(e)?(0,y.tZ)(H,{component:e,showNonContributing:n}):(0,y.tZ)(R,{valueType:t.name||t.id,children:"string"==typeof e||"number"==typeof e?e:JSON.stringify(e,null,2)})},i)))})}T.displayName="GroupingComponentChildren";const B=T;class E extends r.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{collapsed:!0})}render(){const{items:e,maxVisibleItems:t}=this.props,{collapsed:n}=this.state,i=e.length>t;return(0,y.BX)(r.Fragment,{children:[e.map(((o,r)=>!n||r<t?(0,y.tZ)(A,{isCollapsible:i,children:o},r):r===t?(0,y.tZ)(A,{children:(0,y.tZ)(G,{size:"sm",priority:"link",icon:(0,y.tZ)(z.N_,{legacySize:"8px"}),onClick:()=>this.setState({collapsed:!1}),children:(0,d._N)("show [numberOfFrames] similar",{numberOfFrames:e.length-t})})},r):null)),!n&&e.length>t&&(0,y.tZ)(A,{children:(0,y.tZ)(G,{size:"sm",priority:"link",icon:(0,y.tZ)(z.JZ,{legacySize:"8px"}),onClick:()=>this.setState({collapsed:!0}),children:(0,d._N)("collapse [numberOfFrames] similar",{numberOfFrames:e.length-t})})})]})}}E.displayName="GroupingComponentFrames",(0,i.Z)(E,"defaultProps",{maxVisibleItems:2});const G=(0,o.Z)(s.zx,{target:"ea8pw820"})("margin:",(0,u.D)(.5)," 0;color:",(e=>e.theme.linkColor),";"),j=E;function F(e){let{component:t,showNonContributing:n}=e;return(0,y.tZ)(r.Fragment,{children:(()=>{const e=[];return t.values.filter((e=>I(e,n))).forEach((t=>{const i=t.values.filter((e=>I(e,n))).map((e=>e.id)).sort(((e,t)=>e.localeCompare(t))).join(""),o=e[e.length-1];o?.key===i?o.data.push(t):e.push({key:i,data:[t]})})),e})().map(((e,t)=>(0,y.tZ)(j,{items:e.data.map(((e,t)=>(0,y.tZ)(H,{component:e,showNonContributing:n},t)))},t)))})}F.displayName="GroupingComponentStacktrace";const X=F;function P(e){let{component:t,showNonContributing:n}=e;const i=function(e){return e.values.every((e=>!_()(e)))}(t),o="stacktrace"===t.id?X:B;return(0,y.BX)($,{isContributing:t.contributes,children:[(0,y.BX)("span",{children:[t.name||t.id,t.hint&&(0,y.tZ)(L,{children:` (${t.hint})`})]}),(0,y.tZ)(M,{isInline:i,children:(0,y.tZ)(o,{component:t,showNonContributing:n})})]})}P.displayName="GroupingComponent";const M=(0,o.Z)("ul",{target:"e9zkrn04"})("padding:0;margin:0;list-style:none;&,&>li{display:",(e=>e.isInline?"inline":"block"),";}"),A=(0,o.Z)("li",{target:"e9zkrn03"})("padding:0;margin:",(0,u.D)(.25)," 0 ",(0,u.D)(.25)," ",(0,u.D)(1.5),";",(e=>e.isCollapsible&&`\n    border-left: 1px solid ${e.theme.innerBorder};\n    margin: 0 0 -${(0,u.D)(.25)} ${(0,u.D)(1)};\n    padding-left: ${(0,u.D)(.5)};\n  `),";"),R=(0,o.Z)("code",{target:"e9zkrn02"})("display:inline-block;margin:",(0,u.D)(.25)," ",(0,u.D)(.5)," ",(0,u.D)(.25)," 0;font-size:",(e=>e.theme.fontSizeSmall),";padding:0 ",(0,u.D)(.25),";background:rgba(112, 163, 214, 0.1);color:",(e=>e.theme.textColor),";",(e=>{let{valueType:t}=e;return("function"===t||"symbol"===t)&&`\n    font-weight: bold;\n    color: ${e=>e.theme.textColor};\n  `}),";"),$=(0,o.Z)("div",{target:"e9zkrn01"})("color:",(e=>e.isContributing?null:e.theme.textColor),";",R,",button{opacity:1;}"),L=(0,o.Z)("small",{target:"e9zkrn00"})({name:"1rawn5e",styles:"font-size:0.8em"}),H=P;function V(e,t){"matched_rule"in t&&e.push([(0,d.t)("Fingerprint rule"),(0,y.BX)(Y,{children:[t.matched_rule,(0,y.tZ)(S.Z,{size:"xs",position:"top",title:(0,d.t)("The server-side fingerprinting rule that produced the fingerprint.")})]},"type")]),"values"in t&&e.push([(0,d.t)("Fingerprint values"),t.values]),"client_values"in t&&e.push([(0,d.t)("Client fingerprint values"),(0,y.BX)(Y,{children:[t.client_values,(0,y.tZ)(S.Z,{size:"xs",position:"top",title:(0,d.t)("The client sent a fingerprint that was overridden by a server-side fingerprinting rule.")})]},"type")])}class q extends r.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{showNonContributing:!1})}getVariantData(){const{event:e,variant:t,showGroupingConfig:n}=this.props,i=[];let o;if(!this.state.showNonContributing&&null===t.hash)return[i,o];switch(null!==t.hash&&i.push([(0,d.t)("Hash"),(0,y.BX)(Y,{children:[(0,y.tZ)(ee,{children:t.hash}),(0,y.tZ)(S.Z,{size:"xs",position:"top",title:(0,d.t)("Events with the same hash are grouped together")})]},"hash")]),t.hashMismatch&&i.push([(0,d.t)("Hash mismatch"),(0,d.t)("hashing algorithm produced a hash that does not match the event")]),t.type){case h.bo.COMPONENT:o=t.component,i.push([(0,d.t)("Type"),(0,y.BX)(Y,{children:[t.type,(0,y.tZ)(S.Z,{size:"xs",position:"top",title:(0,d.t)("Uses a complex grouping algorithm taking event data into account")})]},"type")]),n&&t.config?.id&&i.push([(0,d.t)("Grouping Config"),t.config.id]);break;case h.bo.CUSTOM_FINGERPRINT:i.push([(0,d.t)("Type"),(0,y.BX)(Y,{children:[t.type,(0,y.tZ)(S.Z,{size:"xs",position:"top",title:(0,d.t)("Overrides the default grouping by a custom fingerprinting rule")})]},"type")]),V(i,t);break;case h.bo.SALTED_COMPONENT:o=t.component,i.push([(0,d.t)("Type"),(0,y.BX)(Y,{children:[t.type,(0,y.tZ)(S.Z,{size:"xs",position:"top",title:(0,d.t)("Uses a complex grouping algorithm taking event data and a fingerprint into account")})]},"type")]),V(i,t),n&&t.config?.id&&i.push([(0,d.t)("Grouping Config"),t.config.id]);break;case h.bo.PERFORMANCE_PROBLEM:const r=Object.fromEntries(e.entries.find((e=>"spans"===e.type))?.data?.map((e=>[e.span_id,e.hash]))??[]);i.push([(0,d.t)("Type"),(0,y.BX)(Y,{children:[t.type,(0,y.tZ)(S.Z,{size:"xs",position:"top",title:(0,d.t)("Uses the evidence from performance issue detection to generate a fingerprint.")})]},"type")]),i.push(["Performance Issue Type",t.key]),i.push(["Span Operation",t.evidence.op]),i.push(["Parent Span Hashes",t.evidence?.parent_span_ids?.map((e=>r[e]))??[]]),i.push(["Source Span Hashes",t.evidence?.cause_span_ids?.map((e=>r[e]))??[]]),i.push(["Offender Span Hashes",[...new Set(t.evidence?.offender_span_ids?.map((e=>r[e])))]])}return o&&i.push([(0,d.t)("Grouping"),(0,y.tZ)(W,{children:(0,y.tZ)(H,{component:o,showNonContributing:this.state.showNonContributing})},o.id)]),[i,o]}renderTitle(){const{variant:e}=this.props,t=null!==e.hash;let n;if(t)n=(0,d.t)("Contributing variant");else{const t="component"in e?e.component?.hint:void 0;n=t?(0,d.t)("Non-contributing variant: %s",t):(0,d.t)("Non-contributing variant")}return(0,y.tZ)(b.u,{title:n,children:(0,y.BX)(K,{children:[(0,y.tZ)(Q,{isContributing:t}),(0,d.t)("By")," ",e.description?.split(" ").map((e=>w()(e))).join(" ")??(0,d.t)("Nothing")]})})}renderContributionToggle(){const{showNonContributing:e}=this.state;return(0,y.BX)(O.s,{"aria-label":(0,d.t)("Filter by contribution"),size:"xs",value:e?"all":"relevant",onChange:e=>this.setState({showNonContributing:"all"===e}),children:[(0,y.tZ)(O.s.Item,{children:(0,d.t)("Contributing values")},"relevant"),(0,y.tZ)(O.s.Item,{children:(0,d.t)("All values")},"all")]})}render(){const[e,t]=this.getVariantData();return(0,y.BX)(U,{children:[(0,y.BX)(J,{children:[this.renderTitle(),D(t)&&this.renderContributionToggle()]}),(0,y.tZ)(k.Z,{data:e.map((e=>({key:e[0],subject:e[0],value:e[1]}))),isContextData:!0,shouldSort:!1})]})}}q.displayName="GroupVariant";const U=(0,o.Z)("div",{target:"e1cf804i6"})("margin-bottom:",(0,u.D)(4),";"),J=(0,o.Z)("div",{target:"e1cf804i5"})("display:flex;align-items:center;justify-content:space-between;margin-bottom:",(0,u.D)(2),";@media (max-width: ",(e=>e.theme.breakpoints.small),"){display:block;}"),K=(0,o.Z)("h5",{target:"e1cf804i4"})("font-size:",(e=>e.theme.fontSizeMedium),";margin:0;display:flex;align-items:center;"),Q=(0,o.Z)((e=>{let{isContributing:t,...n}=e;return t?(0,y.tZ)(z.DL,{size:"sm",isCircled:!0,color:"successText",...n}):(0,y.tZ)(z.bM,{size:"sm",isCircled:!0,color:"dangerText",...n})}),{target:"e1cf804i3"})("margin-right:",(0,u.D)(1),";"),W=(0,o.Z)("div",{target:"e1cf804i2"})("color:",(e=>e.theme.textColor),";"),Y=(0,o.Z)("div",{target:"e1cf804i1"})("display:grid;align-items:center;grid-template-columns:auto 1fr;gap:",(0,u.D)(.5),";"),ee=(0,o.Z)("span",{target:"e1cf804i0"})("@media (max-width: ",(e=>e.theme.breakpoints.small),"){",(e=>e.theme.overflowEllipsis),";width:210px;}"),te=q,ne=[(0,d.t)("Too eager grouping"),(0,d.t)("Too specific grouping"),(0,d.t)("Other grouping issue")];class ie extends a.Z{constructor(){super(...arguments),(0,i.Z)(this,"toggle",(()=>{this.setState((e=>({isOpen:!e.isOpen,configOverride:e.isOpen?null:e.configOverride})))})),(0,i.Z)(this,"handleConfigSelect",(e=>{this.setState({configOverride:e.value},(()=>this.reloadData()))}))}getEndpoints(){const{organization:e,event:t,projectSlug:n,group:i}=this.props;if(t.occurrence&&i?.issueCategory===h.qE.PERFORMANCE&&"transaction"===t.type)return[];let o=`/projects/${e.slug}/${n}/events/${t.id}/grouping-info/`;return this.state?.configOverride&&(o=`${o}?config=${this.state.configOverride}`),[["groupInfo",o]]}getDefaultState(){return{...super.getDefaultState(),isOpen:!1,configOverride:null}}generatePerformanceGroupInfo(){const{group:e,event:t}=this.props,{occurrence:n}=t,{evidenceData:i}=n;return e?{[e.issueType]:{description:(0,d.t)("performance problem"),hash:n?.fingerprint[0]||"",hasMismatch:!1,key:e.issueType,type:"performance-problem",evidence:{op:i?.op,parent_span_ids:i?.parentSpanIds,cause_span_ids:i?.causeSpanIds,offender_span_ids:i?.offenderSpanIds}}}:null}renderGroupInfoSummary(){const{groupInfo:e}=this.state,{group:t,event:n}=this.props,i=t?.issueCategory===h.qE.PERFORMANCE&&n.occurrence&&"transaction"===n.type?this.generatePerformanceGroupInfo():e,o=i?Object.values(i).filter((e=>null!==e.hash&&null!==e.description)).map((e=>e.description)).sort(((e,t)=>e.toLowerCase().localeCompare(t.toLowerCase()))).join(", "):(0,d.t)("nothing");return(0,y.BX)("p",{"data-test-id":"loaded-grouping-info",children:[(0,y.tZ)("strong",{children:(0,d.t)("Grouped by:")})," ",o]})}renderGroupConfigSelect(){const{configOverride:e}=this.state,{event:t}=this.props;if(!t.groupingConfig)return null;const n=e??t.groupingConfig?.id;return(0,y.tZ)(C,{eventConfigId:t.groupingConfig.id,configId:n,onSelect:this.handleConfigSelect})}renderGroupInfo(){const{groupInfo:e,loading:t}=this.state,{event:n,showGroupingConfig:i,group:o}=this.props,s=o?.issueCategory===h.qE.PERFORMANCE&&n.occurrence&&"transaction"===n.type?this.generatePerformanceGroupInfo():e,a=s?Object.values(s).sort(((e,t)=>e.hash&&!t.hash?-1:e.description?.toLowerCase().localeCompare(t.description?.toLowerCase()??"")??1)):[];return(0,y.BX)(r.Fragment,{children:[(0,y.BX)(oe,{children:[(0,y.tZ)("div",{children:i&&this.renderGroupConfigSelect()}),(0,y.tZ)(l.z,{featureName:"grouping",feedbackTypes:ne,buttonProps:{size:"sm"}})]}),t?(0,y.tZ)(c.Z,{}):a.map(((e,t)=>(0,y.BX)(r.Fragment,{children:[(0,y.tZ)(te,{event:n,variant:e,showGroupingConfig:i}),t<a.length-1&&(0,y.tZ)(ae,{})]},e.key)))]})}renderLoading(){return this.renderBody()}renderBody(){const{isOpen:e}=this.state;return(0,y.tZ)(p.S,{type:"grouping-info",title:(0,d.t)("Event Grouping Information"),actions:(0,y.tZ)(re,{onClick:this.toggle,priority:"link",children:e?(0,d.t)("Hide Details"):(0,d.t)("Show Details")}),children:e?this.renderGroupInfo():this.renderGroupInfoSummary()})}}const oe=(0,o.Z)("div",{target:"e1yk3n033"})("display:flex;align-items:center;justify-content:space-between;gap:",(0,u.D)(1),";margin-bottom:",(0,u.D)(2),";"),re=(0,o.Z)(s.zx,{target:"e1yk3n032"})("font-weight:700;color:",(e=>e.theme.subText),";&:hover,&:focus{color:",(e=>e.theme.textColor),";}"),se=(0,o.Z)("span",{target:"e1yk3n031"})("font-family:",(e=>e.theme.text.familyMono),";opacity:",(e=>e.isHidden?.5:null),";font-weight:",(e=>e.isActive?"bold":null),";font-size:",(e=>e.theme.fontSizeSmall),";"),ae=(0,o.Z)("hr",{target:"e1yk3n030"})("padding-top:",(0,u.D)(1),";border-top:1px solid ",(e=>e.theme.border),";"),pe=(0,g.Z)(ie)}}]);
//# sourceMappingURL=../sourcemaps/app_components_events_groupingInfo_index_tsx.c77a967a0c1a6f24b8f8ed43bbc72a7a.js.map