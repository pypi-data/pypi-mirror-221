"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_avatarChooser_tsx-app_components_forms_jsonForm_tsx"],{"./app/components/avatarChooser.tsx":(e,t,s)=>{s.d(t,{Z:()=>N});var a=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(s("../node_modules/core-js/modules/es.array.push.js"),s("../node_modules/react/index.js")),n=s("./app/actionCreators/indicator.tsx"),r=s("./app/components/avatar/index.tsx");const l=(0,o.Z)("div",{target:"e1wagsbt0"})("border:1px solid ",(e=>e.theme.border),";box-shadow:none;background:",(e=>e.theme.backgroundSecondary),";padding:",(e=>e.hasImage?"80px 30px":"15px 20px"),";margin-bottom:20px;border-radius:3px;",(e=>e.centered&&"text-align: center"),";");var p=s("./app/constants/index.tsx"),d=s("./app/locale.tsx"),c=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const h=256,m=1024;function u(e,t){return(e-2*e+(t-2*t))/2}function g(e,t){return(e-2*e+t)/2}function f(e,t){return(e+(t-2*t))/2}function v(e,t){return(e+t)/2}const x={nw:["top","left"],ne:["top","right"],se:["bottom","right"],sw:["bottom","left"]};class b extends i.Component{constructor(){super(...arguments),(0,a.Z)(this,"state",{file:null,objectURL:null,mousePosition:{pageX:0,pageY:0},resizeDimensions:{top:0,left:0,size:0},resizeDirection:null}),(0,a.Z)(this,"file",(0,i.createRef)()),(0,a.Z)(this,"canvas",(0,i.createRef)()),(0,a.Z)(this,"image",(0,i.createRef)()),(0,a.Z)(this,"cropContainer",(0,i.createRef)()),(0,a.Z)(this,"onSelectFile",(e=>{const t=e.target.files?.[0];if(!t)return;if(!/^image\//.test(t.type))return void(0,n.Iw)((0,d.t)("That is not a supported file type."));this.revokeObjectUrl();const{updateDataUrlState:s}=this.props,a=window.URL.createObjectURL(t);this.setState({file:t,objectURL:a},(()=>s({savedDataUrl:null})))})),(0,a.Z)(this,"revokeObjectUrl",(()=>this.state.objectURL&&window.URL.revokeObjectURL(this.state.objectURL))),(0,a.Z)(this,"onImageLoad",(()=>{const e=this.validateImage();if(e)return this.revokeObjectUrl(),this.setState({objectURL:null}),void(0,n.Iw)(e);const t=this.image.current;if(!t)return;const s={resizeDimensions:{size:Math.min(t.clientHeight,t.clientWidth),top:0,left:0}};this.setState(s,this.drawToCanvas)})),(0,a.Z)(this,"updateDimensions",(e=>{const t=this.cropContainer.current;if(!t)return;const{mousePosition:s,resizeDimensions:a}=this.state;let o=e.pageY,i=e.pageX,n=a.top+(o-s.pageY),r=a.left+(i-s.pageX);n<0?(n=0,o=s.pageY):n+a.size>t.clientHeight&&(n=t.clientHeight-a.size,o=s.pageY),r<0?(r=0,i=s.pageX):r+a.size>t.clientWidth&&(r=t.clientWidth-a.size,i=s.pageX),this.setState((e=>({resizeDimensions:{...e.resizeDimensions,top:n,left:r},mousePosition:{pageX:i,pageY:o}})))})),(0,a.Z)(this,"onMouseDown",(e=>{e.preventDefault(),this.setState({mousePosition:{pageY:e.pageY,pageX:e.pageX}}),document.addEventListener("mousemove",this.updateDimensions),document.addEventListener("mouseup",this.onMouseUp)})),(0,a.Z)(this,"onMouseUp",(e=>{e.preventDefault(),document.removeEventListener("mousemove",this.updateDimensions),document.removeEventListener("mouseup",this.onMouseUp),this.drawToCanvas()})),(0,a.Z)(this,"startResize",((e,t)=>{t.stopPropagation(),t.preventDefault(),document.addEventListener("mousemove",this.updateSize),document.addEventListener("mouseup",this.stopResize),this.setState({resizeDirection:e,mousePosition:{pageY:t.pageY,pageX:t.pageX}})})),(0,a.Z)(this,"stopResize",(e=>{e.stopPropagation(),e.preventDefault(),document.removeEventListener("mousemove",this.updateSize),document.removeEventListener("mouseup",this.stopResize),this.setState({resizeDirection:null}),this.drawToCanvas()})),(0,a.Z)(this,"updateSize",(e=>{const t=this.cropContainer.current;if(!t)return;const{mousePosition:s}=this.state,a=e.pageY-s.pageY,o=e.pageX-s.pageX;this.setState({resizeDimensions:this.getNewDimensions(t,a,o),mousePosition:{pageX:e.pageX,pageY:e.pageY}})})),(0,a.Z)(this,"getNewDimensions",((e,t,s)=>{const{resizeDimensions:a,resizeDirection:o}=this.state,i={getDiffNE:g,getDiffNW:u,getDiffSE:v,getDiffSW:f}["getDiff"+o.toUpperCase()](t,s);let n=e.clientHeight-a.top,r=e.clientWidth-a.left;const l="nw"===o||"ne"===o,p="nw"===o||"sw"===o,d={top:a.top,left:a.left,size:a.size+i};l&&(d.top=a.top-i,n=e.clientHeight-d.top),p&&(d.left=a.left-i,r=e.clientWidth-d.left),d.top<0&&(d.size=d.size+d.top,p&&(d.left=d.left-d.top),d.top=0),d.left<0&&(d.size=d.size+d.left,l&&(d.top=d.top-d.left),d.left=0);const c=Math.min(r,n);return d.size>c?(l&&(d.top=d.top+d.size-c),p&&(d.left=d.left+d.size-c),d.size=c):d.size<h&&(l&&(d.top=d.top+d.size-h),p&&(d.left=d.left+d.size-h),d.size=h),{...a,...d}})),(0,a.Z)(this,"uploadClick",(e=>{e.preventDefault(),this.file.current&&this.file.current.click()}))}componentWillUnmount(){this.revokeObjectUrl()}validateImage(){const e=this.image.current;return e?e.naturalWidth<h||e.naturalHeight<h?(0,d._N)("Please upload an image larger than [size]px by [size]px.",{size:255}):e.naturalWidth>m||e.naturalHeight>m?(0,d._N)("Please upload an image smaller than [size]px by [size]px.",{size:m}):null:null}drawToCanvas(){const e=this.canvas.current;if(!e)return;const t=this.image.current;if(!t)return;const{left:s,top:a,size:o}=this.state.resizeDimensions,i=(t.naturalHeight/t.clientHeight+t.naturalWidth/t.clientWidth)/2;e.width=o*i,e.height=o*i,e.getContext("2d").drawImage(t,s*i,a*i,o*i,o*i,0,0,o*i,o*i),this.props.updateDataUrlState({dataUrl:e.toDataURL()})}get imageSrc(){const{savedDataUrl:e,model:t,type:s}=this.props,a=t.avatar?.avatarUuid,o=a&&`/${p.f6[s]||"avatar"}/${a}/`;return e||this.state.objectURL||o}renderImageCrop(){const e=this.imageSrc;if(!e)return null;const{resizeDimensions:t,resizeDirection:s}=this.state,a={top:t.top,left:t.left,width:t.size,height:t.size};return(0,c.tZ)(Z,{resizeDirection:s,children:(0,c.BX)(z,{ref:this.cropContainer,children:[(0,c.tZ)("img",{ref:this.image,src:e,onLoad:this.onImageLoad,onDragStart:e=>e.preventDefault()}),(0,c.tZ)(D,{style:a,onMouseDown:this.onMouseDown,children:Object.keys(x).map((e=>(0,c.tZ)(w,{position:e,onMouseDown:this.startResize.bind(this,e)},e)))})]})})}render(){const e=this.imageSrc,t=(0,c.tZ)("a",{onClick:this.uploadClick}),s=(0,c.tZ)(l,{hasImage:!0,centered:!0,children:(0,c.tZ)("p",{children:(0,d._N)("[upload:Upload an image] to get started.",{upload:t})})});return(0,c.BX)(i.Fragment,{children:[!e&&s,e&&(0,c.tZ)(S,{ref:this.canvas}),this.renderImageCrop(),(0,c.BX)("div",{className:"form-group",children:[e&&(0,c.tZ)("a",{onClick:this.uploadClick,children:(0,d.t)("Change Photo")}),(0,c.tZ)(y,{ref:this.file,type:"file",accept:"image/gif,image/jpeg,image/png",onChange:this.onSelectFile})]})]})}}b.displayName="AvatarUploader";const y=(0,o.Z)("input",{target:"e11xh6zl5"})({name:"1trwphv",styles:"position:absolute;opacity:0"}),Z=(0,o.Z)("div",{target:"e11xh6zl4"})("cursor:",(e=>e.resizeDirection?`${e.resizeDirection}-resize`:"default"),";text-align:center;margin-bottom:20px;background-size:20px 20px;background-position:0 0,0 10px,10px -10px,-10px 0px;background-color:",(e=>e.theme.background),";background-image:linear-gradient(\n      45deg,\n      ",(e=>e.theme.backgroundSecondary)," 25%,\n      rgba(0, 0, 0, 0) 25%\n    ),linear-gradient(-45deg, ",(e=>e.theme.backgroundSecondary)," 25%, rgba(0, 0, 0, 0) 25%),linear-gradient(45deg, rgba(0, 0, 0, 0) 75%, ",(e=>e.theme.backgroundSecondary)," 75%),linear-gradient(-45deg, rgba(0, 0, 0, 0) 75%, ",(e=>e.theme.backgroundSecondary)," 75%);"),z=(0,o.Z)("div",{target:"e11xh6zl3"})({name:"nycxdm",styles:"display:inline-block;position:relative;max-width:100%"}),D=(0,o.Z)("div",{target:"e11xh6zl2"})("position:absolute;border:2px dashed ",(e=>e.theme.gray300),";"),w=(0,o.Z)("div",{target:"e11xh6zl1"})("border-radius:5px;width:10px;height:10px;position:absolute;background-color:",(e=>e.theme.gray300),";cursor:",(e=>`${e.position}-resize`),";",(e=>x[e.position].map((e=>`${e}: -5px;`))),";"),S=(0,o.Z)("canvas",{target:"e11xh6zl0"})({name:"eivff4",styles:"display:none"});var U=s("./app/components/button.tsx"),C=s("./app/components/forms/controls/radioGroup.tsx"),j=s("./app/components/links/externalLink.tsx"),k=s("./app/components/loadingError.tsx"),_=s("./app/components/loadingIndicator.tsx"),P=s("./app/components/panels/panel.tsx"),R=s("./app/components/panels/panelBody.tsx"),X=s("./app/components/panels/panelHeader.tsx"),L=s("./app/styles/space.tsx"),F=s("./app/utils/withApi.tsx");class B extends i.Component{constructor(){super(...arguments),(0,a.Z)(this,"state",{model:this.props.model,savedDataUrl:null,dataUrl:null,hasError:!1}),(0,a.Z)(this,"handleSaveSettings",(e=>{const{endpoint:t,api:s,type:a}=this.props,{model:o,dataUrl:i}=this.state;e.preventDefault();const n=o?.avatar?.avatarType,r=i?.split(",")[1],l={avatar_type:n};"upload"===n&&(l.avatar_photo=r),a?.startsWith("sentryApp")&&(l.color="sentryAppColor"===a),s.request(t,{method:"PUT",data:l,success:e=>{this.setState({savedDataUrl:this.state.dataUrl}),this.handleSuccess(this.getModelFromResponse(e))},error:e=>{const t=e?.responseJSON?.avatar_photo||[];t.length?t.map(this.handleError):this.handleError.bind(this,(0,d.t)("There was an error saving your preferences."))}})})),(0,a.Z)(this,"handleChange",(e=>this.setState((t=>({model:{...t.model,avatar:{avatarUuid:t.model.avatar?.avatarUuid??"",avatarType:e}}})))))}componentDidUpdate(e){const{model:t}=this.props;void 0!==t&&t!==e.model&&this.setState({model:t})}getModelFromResponse(e){const{type:t}=this.props,s=t?.startsWith("sentryApp");if(!s)return e;const a="sentryAppColor"===t;return{avatar:e?.avatars?.find((e=>{let{color:t}=e;return t===a}))??void 0}}handleError(e){(0,n.Iw)(e)}handleSuccess(e){const{onSave:t}=this.props;this.setState({model:e}),t(e),(0,n.S9)((0,d.t)("Successfully saved avatar preferences"))}render(){const{allowGravatar:e,allowUpload:t,allowLetter:s,savedDataUrl:a,type:o,isUser:i,disabled:n,title:p,help:h,defaultChoice:m}=this.props,{hasError:u,model:g,dataUrl:f}=this.state;if(u)return(0,c.tZ)(k.Z,{});if(!g)return(0,c.tZ)(_.Z,{});const{allowDefault:v,preview:x,choiceText:y}=m||{},Z=g.avatar?.avatarType??"letter_avatar",z="letter_avatar"===Z,D=Boolean(x&&"default"===Z),w="team"===o,S="organization"===o,L=o?.startsWith("sentryApp"),F=[];return v&&x&&F.push(["default",y??(0,d.t)("Use default avatar")]),s&&F.push(["letter_avatar",(0,d.t)("Use initials")]),t&&F.push(["upload",(0,d.t)("Upload an image")]),e&&F.push(["gravatar",(0,d.t)("Use Gravatar")]),(0,c.BX)(P.Z,{children:[(0,c.tZ)(X.Z,{children:p||(0,d.t)("Avatar")}),(0,c.tZ)(R.Z,{children:(0,c.BX)(E,{children:[(0,c.BX)(T,{inline:z||D,children:[(0,c.tZ)(C.Z,{style:{flex:1},choices:F,value:Z,label:(0,d.t)("Avatar Type"),onChange:this.handleChange,disabled:n}),z&&(0,c.tZ)(r.Z,{gravatar:!1,style:{width:90,height:90},user:i?g:void 0,organization:S?g:void 0,team:w?g:void 0,sentryApp:L?g:void 0}),D&&x]}),(0,c.BX)(I,{children:[e&&"gravatar"===Z&&(0,c.BX)(l,{children:[(0,d.t)("Gravatars are managed through "),(0,c.tZ)(j.Z,{href:"http://gravatar.com",children:"Gravatar.com"})]}),g.avatar&&"upload"===Z&&(0,c.tZ)(b,{...this.props,type:o,model:g,savedDataUrl:a,updateDataUrlState:e=>this.setState(e)}),(0,c.BX)(W,{className:"form-actions",children:[h&&(0,c.tZ)(H,{children:h}),(0,c.tZ)(U.zx,{priority:"primary",onClick:this.handleSaveSettings,disabled:n||"upload"===Z&&!f,children:(0,d.t)("Save Avatar")})]})]})]})})]})}}B.displayName="AvatarChooser",(0,a.Z)(B,"defaultProps",{allowGravatar:!0,allowLetter:!0,allowUpload:!0,type:"user",onSave:()=>{},defaultChoice:{allowDefault:!1}});const H=(0,o.Z)("p",{target:"e7s5np24"})("margin-right:auto;color:",(e=>e.theme.gray300),";font-size:14px;width:50%;"),T=(0,o.Z)("div",{target:"e7s5np23"})("display:flex;flex-direction:",(e=>e.inline?"row":"column"),";"),E=(0,o.Z)("div",{target:"e7s5np22"})("line-height:",(0,L.D)(3),";padding:",(0,L.D)(1.5)," ",(0,L.D)(2),";margin:",(0,L.D)(1.5)," ",(0,L.D)(1)," ",(0,L.D)(.5),";"),W=(0,o.Z)("fieldset",{target:"e7s5np21"})("display:flex;align-items:center;margin-top:",(0,L.D)(4),";padding-top:",(0,L.D)(1.5),";"),I=(0,o.Z)("div",{target:"e7s5np20"})("margin-top:",(0,L.D)(1.5),";"),N=(0,F.Z)(B)},"./app/components/forms/formPanel.tsx":(e,t,s)=>{s.d(t,{Z:()=>m});var a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=s("../node_modules/react/index.js"),i=s("./app/components/forms/fieldFromConfig.tsx"),n=s("./app/components/panels/panel.tsx"),r=s("./app/components/panels/panelBody.tsx"),l=s("./app/components/panels/panelHeader.tsx"),p=s("./app/icons/index.tsx"),d=s("./app/utils/sanitizeQuerySelector.tsx"),c=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function h(e){let{additionalFieldProps:t={},title:s,fields:a,access:h,disabled:m,renderFooter:g,renderHeader:f,collapsible:v,initiallyCollapsed:x=!1,...b}=e;const[y,Z]=(0,o.useState)(x),z=(0,o.useCallback)((()=>Z((e=>!e))),[]);return(0,c.BX)(n.Z,{id:"string"==typeof s?(0,d.m)(s):void 0,children:[s&&(0,c.BX)(l.Z,{children:[s,v&&(0,c.tZ)(u,{onClick:z,children:(0,c.tZ)(p.g6,{"data-test-id":"form-panel-collapse-chevron",direction:y?"down":"up",size:"xs"})})]}),(0,c.BX)(r.Z,{hidden:y,children:["function"==typeof f&&f({title:s,fields:a}),a.map((e=>{if("function"==typeof e)return e();const{defaultValue:s,...a}=e;return!0===m&&(a.disabled=!0,a.disabledReason=void 0),(0,c.tZ)(i.Z,{access:h,disabled:m,...b,...t,field:a,highlighted:b.highlighted===`#${e.name}`},e.name)})),"function"==typeof g&&g({title:s,fields:a})]})]})}h.displayName="FormPanel";const m=h,u=(0,a.Z)("span",{target:"eovlw60"})({name:"e0dnmk",styles:"cursor:pointer"})},"./app/components/forms/jsonForm.tsx":(e,t,s)=>{s.d(t,{Z:()=>u});var a=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=s("../node_modules/react/index.js"),i=s("../node_modules/@sentry/browser/node_modules/@sentry/core/esm/exports.js"),n=s("../node_modules/scroll-to-element/index.js"),r=s.n(n),l=s("./app/utils.tsx"),p=s("./app/utils/sanitizeQuerySelector.tsx"),d=s("./app/utils/withSentryRouter.tsx"),c=s("./app/components/forms/formPanel.tsx"),h=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class m extends o.Component{constructor(){super(...arguments),(0,a.Z)(this,"state",{highlighted:this.props.location?.hash})}componentDidMount(){this.scrollToHash()}componentDidUpdate(e){if(this.props.location&&this.props.location.hash!==e.location.hash){const e=this.props.location.hash;this.scrollToHash(e),this.setState({highlighted:e})}}scrollToHash(e){const t=e||this.props.location?.hash;if(t)try{r()((0,p.m)(decodeURIComponent(t)),{align:"middle",offset:-100})}catch(e){i.Tb(e)}}shouldDisplayForm(e){const t=e.filter((e=>"function"!=typeof e&&(0,l.ri)(e?.visible)));if(e.length===t.length){const{additionalFieldProps:e,...s}=this.props;return!t.every((t=>"function"==typeof t.visible?!t.visible({...s,...e}):!t.visible))}return!0}renderForm(e){let{fields:t,formPanelProps:s,title:a}=e;return this.shouldDisplayForm(t)||s?.renderFooter||s?.renderHeader?(0,h.tZ)(c.Z,{title:a,fields:t,...s}):null}render(){const{access:e,collapsible:t,initiallyCollapsed:s,fields:a,title:i,forms:n,disabled:r,features:l,additionalFieldProps:p,renderFooter:d,renderHeader:c,location:m,params:u,router:g,routes:f,...v}=this.props,x={access:e,disabled:r,features:l,additionalFieldProps:p,renderFooter:d,renderHeader:c,highlighted:this.state.highlighted,collapsible:t,initiallyCollapsed:s};return(0,h.BX)("div",{...v,children:[void 0!==n&&n.map(((e,t)=>(0,h.tZ)(o.Fragment,{children:this.renderForm({formPanelProps:x,...e})},t))),void 0===n&&void 0!==a&&this.renderForm({fields:a,formPanelProps:x,title:i})]})}}m.displayName="JsonForm";const u=(0,d.Z)(m)},"./app/components/panels/panelHeader.tsx":(e,t,s)=>{s.d(t,{Z:()=>r});var a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=s("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),i=s("./app/styles/space.tsx");const n=e=>{let{disablePadding:t,hasButtons:s}=e;return(0,o.iv)("padding:",s?(0,i.D)(1):(0,i.D)(2)," ",t?0:(0,i.D)(2),";","")},r=(0,a.Z)("div",{target:"e1dzfr4k0"})("display:flex;align-items:center;justify-content:space-between;color:",(e=>e.lightText?e.theme.gray300:e.theme.gray400),";font-size:",(e=>e.theme.fontSizeSmall),";font-weight:600;text-transform:uppercase;border-bottom:1px solid ",(e=>e.theme.border),";border-radius:calc(",(e=>e.theme.panelBorderRadius)," - 1px) calc(",(e=>e.theme.panelBorderRadius)," - 1px) 0 0;background:",(e=>e.theme.backgroundSecondary),";line-height:1;position:relative;",n,";")}}]);
//# sourceMappingURL=../sourcemaps/app_components_avatarChooser_tsx-app_components_forms_jsonForm_tsx.62630e9bafe93331fea75deb94142a42.js.map