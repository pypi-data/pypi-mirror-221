(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_sentryAppExternalInstallation_index_tsx"],{"./app/actionCreators/sentryAppInstallations.tsx":(t,e,n)=>{"use strict";n.d(e,{G:()=>a,W:()=>i});var s=n("./app/actionCreators/indicator.tsx"),r=n("./app/locale.tsx");function a(t,e,n){(0,s.E3)();const a=t.requestPromise(`/organizations/${e}/sentry-app-installations/`,{method:"POST",data:{slug:n.slug}});return a.then((()=>(0,s.B8)()),(()=>(0,s.Iw)((0,r.t)("Unable to install %s",n.name)))),a}function i(t,e){(0,s.E3)();const n=t.requestPromise(`/sentry-app-installations/${e.uuid}/`,{method:"DELETE"}),a=e.app.slug.charAt(0).toUpperCase()+e.app.slug.slice(1);return n.then((()=>{(0,s.S9)((0,r.t)("%s successfully uninstalled.",a))}),(()=>(0,s.B8)())),n}},"./app/components/narrowLayout.tsx":(t,e,n)=>{"use strict";n.d(e,{Z:()=>g});var s=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=n("../node_modules/react/index.js"),a=n("./app/actionCreators/account.tsx"),i=n("./app/icons/index.tsx"),o=n("./app/locale.tsx"),l=n("./app/utils/useApi.tsx"),p=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function c(t){let{maxWidth:e,showLogout:n,children:s}=t;const c=(0,l.Z)();return(0,r.useEffect)((()=>(document.body.classList.add("narrow"),()=>document.body.classList.remove("narrow"))),[]),(0,p.BX)("div",{className:"app",children:[(0,p.tZ)("div",{className:"pattern-bg"}),(0,p.tZ)("div",{className:"container",style:{maxWidth:e},children:(0,p.BX)("div",{className:"box box-modal",children:[(0,p.BX)("div",{className:"box-header",children:[(0,p.tZ)("a",{href:"/",children:(0,p.tZ)(i.iW,{size:"lg"})}),n&&(0,p.tZ)("a",{className:"logout pull-right",onClick:async function(){await(0,a.kS)(c),window.location.assign("/auth/login")},children:(0,p.tZ)(d,{children:(0,o.t)("Sign out")})})]}),(0,p.tZ)("div",{className:"box-content with-padding",children:s})]})})]})}c.displayName="NarrowLayout";const d=(0,s.Z)("span",{target:"ezeisnw0"})("font-size:",(t=>t.theme.fontSizeLarge),";"),g=c},"./app/components/sentryAppIcon.tsx":(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var s=n("./app/components/avatar/sentryAppAvatar.tsx"),r=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function a(t){let{sentryApp:e,size:n}=t;return(0,r.tZ)(s.Z,{sentryApp:e,size:n,isColor:!0})}a.displayName="SentryAppIcon";const i=a},"./app/utils/consolidatedScopes.tsx":(t,e,n)=>{"use strict";n.d(e,{A:()=>y,m:()=>h});var s=n("../node_modules/lodash/groupBy.js"),r=n.n(s),a=n("../node_modules/lodash/invertBy.js"),i=n.n(a),o=n("../node_modules/lodash/pick.js"),l=n.n(o);const p={read:0,write:1,admin:2},c={project:"Project",team:"Team",release:"Release",event:"Event",org:"Organization",member:"Member"},d={Project:"no-access",Team:"no-access",Release:"no-access",Event:"no-access",Organization:"no-access",Member:"no-access"},g="project:releases",u=t=>{const e=t.split(":")[1];return p[e]},m=(t,e)=>u(t)-u(e);function h(t){const e={...d};let n=[...t];var s;return t.includes(g)&&(e.Release="admin",n=t.filter((t=>t!==g))),(s=n,Object.values(r()(s,(t=>t.split(":")[0]))).map((t=>t.sort(m))).map((t=>t.pop()))).forEach((t=>{if(t){const[n,s]=t.split(":");e[c[n]]=s}})),e}function y(t){const e=h(t);return{read:[],write:[],admin:[],...l()(i()(e),["read","write","admin"])}}},"./app/views/deprecatedAsyncView.tsx":(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var s=n("./app/components/deprecatedAsyncComponent.tsx"),r=n("./app/components/sentryDocumentTitle.tsx"),a=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class i extends s.Z{getTitle(){return""}render(){return(0,a.tZ)(r.Z,{title:this.getTitle(),children:this.renderComponent()})}}i.displayName="DeprecatedAsyncView"},"./app/views/sentryAppExternalInstallation/index.tsx":(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>G});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=n("./app/actionCreators/indicator.tsx"),i=n("./app/actionCreators/sentryAppInstallations.tsx"),o=n("./app/api.tsx"),l=n("./app/components/alert.tsx"),p=n("./app/components/avatar/organizationAvatar.tsx"),c=n("./app/components/forms/controls/selectControl.tsx"),d=n("./app/components/forms/fieldGroup/index.tsx"),g=n("../node_modules/react/index.js"),u=n("./app/components/acl/access.tsx"),m=n("./app/components/button.tsx"),h=n("./app/components/circleIndicator.tsx"),y=n("./app/components/deprecatedAsyncComponent.tsx"),x=n("./app/components/sentryAppIcon.tsx"),Z=n("./app/components/tag.tsx"),b=n("./app/icons/index.tsx"),v=n("./app/locale.tsx"),A=n("./app/styles/space.tsx"),w=n("./app/utils/consolidatedScopes.tsx"),z=n("./app/utils/integrationUtil.tsx"),f=n("./app/utils/marked.tsx"),_=n("./app/utils/recordSentryAppInteraction.tsx"),S=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class I extends y.Z{componentDidUpdate(t){this.props.organization.id!==t.organization.id&&this.trackOpened()}componentDidMount(){super.componentDidMount(),this.trackOpened()}trackOpened(){const{sentryApp:t,organization:e,isInstalled:n}=this.props;(0,_.E)(t.slug,"sentry_app_viewed"),(0,z.Db)("integrations.install_modal_opened",{integration_type:"sentry_app",integration:t.slug,already_installed:n,view:"external_install",integration_status:t.status,organization:e},{startSession:!0})}getEndpoints(){const{sentryApp:t}=this.props;return[["featureData",`/sentry-apps/${t.slug}/features/`]]}featureTags(t){return t.map((t=>{const e=t.featureGate.replace(/integrations/g,"");return(0,S.tZ)(M,{children:e.replace(/-/g," ")},e)}))}get permissions(){return(0,w.A)(this.props.sentryApp.scopes)}async onInstall(){const{onInstall:t}=this.props;try{await t()}catch(t){}}renderPermissions(){const t=this.permissions;return 0===Object.keys(t).filter((e=>t[e].length>0)).length?null:(0,S.BX)(g.Fragment,{children:[(0,S.tZ)(P,{children:"Permissions"}),t.read.length>0&&(0,S.BX)(E,{children:[(0,S.tZ)(T,{}),(0,S.tZ)(D,{children:(0,v._N)("[read] access to [resources] resources",{read:(0,S.tZ)("strong",{children:"Read"}),resources:t.read.join(", ")})},"read")]}),t.write.length>0&&(0,S.BX)(E,{children:[(0,S.tZ)(T,{}),(0,S.tZ)(D,{children:(0,v._N)("[read] and [write] access to [resources] resources",{read:(0,S.tZ)("strong",{children:"Read"}),write:(0,S.tZ)("strong",{children:"Write"}),resources:t.write.join(", ")})},"write")]}),t.admin.length>0&&(0,S.BX)(E,{children:[(0,S.tZ)(T,{}),(0,S.tZ)(D,{children:(0,v._N)("[admin] access to [resources] resources",{admin:(0,S.tZ)("strong",{children:"Admin"}),resources:t.admin.join(", ")})},"admin")]})]})}renderBody(){const{sentryApp:t,closeModal:e,isInstalled:n,organization:s}=this.props,{featureData:r}=this.state,a=(r||[]).map((t=>({featureGate:t.featureGate,description:(0,S.tZ)("span",{dangerouslySetInnerHTML:{__html:(0,f.A)(t.description)}})}))),{FeatureList:i,IntegrationFeatures:o}=(0,z.bh)(),l=t.overview||"",p={organization:s,features:a};return(0,S.BX)(g.Fragment,{children:[(0,S.BX)(j,{children:[(0,S.tZ)(x.Z,{sentryApp:t,size:50}),(0,S.BX)(O,{children:[(0,S.tZ)(k,{children:t.name}),!!a.length&&(0,S.tZ)(L,{children:this.featureTags(a)})]})]}),(0,S.tZ)(N,{dangerouslySetInnerHTML:{__html:(0,f.Z)(l)}}),(0,S.tZ)(i,{...p,provider:{...t,key:t.slug}}),(0,S.tZ)(o,{...p,children:r=>{let{disabled:a,disabledReason:i}=r;return(0,S.BX)(g.Fragment,{children:[!a&&this.renderPermissions(),(0,S.BX)(X,{children:[(0,S.tZ)(B,{children:(0,v.t)("Authored By %s",t.author)}),(0,S.BX)("div",{children:[a&&(0,S.tZ)(C,{reason:i}),(0,S.tZ)(m.zx,{size:"sm",onClick:e,children:(0,v.t)("Cancel")}),(0,S.tZ)(u.Z,{access:["org:integrations"],organization:s,children:t=>{let{hasAccess:e}=t;return e&&(0,S.tZ)(m.zx,{size:"sm",priority:"primary",disabled:n||a,onClick:()=>this.onInstall(),style:{marginLeft:(0,A.D)(1)},"data-test-id":"install",children:(0,v.t)("Accept & Install")})}})]})]})]})}})]})}}const j=(0,r.Z)("div",{target:"e1bmxevc12"})("display:grid;grid-template-columns:max-content 1fr;gap:",(0,A.D)(1),";align-items:center;margin-bottom:",(0,A.D)(2),";"),O=(0,r.Z)("div",{target:"e1bmxevc11"})({name:"4runny",styles:"display:grid;grid-template-rows:max-content max-content;align-items:start"}),k=(0,r.Z)("div",{target:"e1bmxevc10"})({name:"1k5apmu",styles:"font-weight:bold;font-size:1.4em"}),N=(0,r.Z)("div",{target:"e1bmxevc9"})("margin-bottom:",(0,A.D)(2),";li{margin-bottom:6px;}"),B=(0,r.Z)("div",{target:"e1bmxevc8"})("color:",(t=>t.theme.gray300),";"),C=(0,r.Z)((t=>{let{reason:e,...n}=t;return(0,S.BX)("div",{...n,children:[(0,S.tZ)(b.Gy,{color:"errorText",size:"md"}),e]})}),{target:"e1bmxevc7"})("display:grid;align-items:center;flex:1;grid-template-columns:max-content 1fr;color:",(t=>t.theme.errorText),";font-size:0.9em;"),D=(0,r.Z)("p",{target:"e1bmxevc6"})({name:"1x9ekz7",styles:"margin:0px 6px"}),E=(0,r.Z)("div",{target:"e1bmxevc5"})({name:"zjik7",styles:"display:flex"}),X=(0,r.Z)("div",{target:"e1bmxevc4"})({name:"1348q18",styles:"display:flex;padding:20px 30px;border-top:1px solid #e2dee6;margin:20px -30px -30px;justify-content:space-between"}),P=(0,r.Z)("p",{target:"e1bmxevc3"})("margin-bottom:",(0,A.D)(1),";font-weight:bold;"),T=(0,r.Z)((t=>(0,S.tZ)(h.Z,{size:7,...t})),{target:"e1bmxevc2"})("margin-top:7px;color:",(t=>t.theme.success),";"),L=(0,r.Z)("div",{target:"e1bmxevc1"})("margin:-",(0,A.D)(.5),";"),M=(0,r.Z)(Z.Z,{target:"e1bmxevc0"})("padding:",(0,A.D)(.5),";");var U=n("./app/components/narrowLayout.tsx"),q=n("./app/utils.tsx"),F=n("./app/utils/queryString.tsx"),R=n("./app/views/deprecatedAsyncView.tsx"),V=n("./app/views/organizationContext.tsx");class G extends R.Z{constructor(){super(...arguments),(0,s.Z)(this,"disableErrorReport",!1),(0,s.Z)(this,"controlSiloApi",new o.KU({baseUrl:(0,q.td)()+"/api/0"})),(0,s.Z)(this,"hasAccess",(t=>t.access.includes("org:integrations"))),(0,s.Z)(this,"onClose",(()=>{const{selectedOrgSlug:t}=this.state,e=document.referrer||`/settings/${t}/integrations/`;window.location.assign(e)})),(0,s.Z)(this,"onInstall",(async()=>{const{organization:t,sentryApp:e}=this.state;if(!t||!e)return;(0,z.Db)("integrations.installation_start",{integration_type:"sentry_app",integration:e.slug,view:"external_install",integration_status:e.status,organization:t});const n=await(0,i.G)(this.controlSiloApi,t.slug,e);if("installed"===n.status&&(0,z.Db)("integrations.installation_complete",{integration_type:"sentry_app",integration:e.slug,view:"external_install",integration_status:e.status,organization:t}),e.redirectUrl){const s={installationId:n.uuid,code:n.code,orgSlug:t.slug},r=(0,F.Yi)(e.redirectUrl,s);return window.location.assign(r)}return this.onClose()})),(0,s.Z)(this,"onSelectOrg",(async t=>{this.setState({selectedOrgSlug:t,reloading:!0});try{const[e,n]=await Promise.all([this.controlSiloApi.requestPromise(`/organizations/${t}/`),this.controlSiloApi.requestPromise(`/organizations/${t}/sentry-app-installations/`)]),s=n.map((t=>t.app.slug)).includes(this.sentryAppSlug);this.setState({organization:e,isInstalled:s,reloading:!1})}catch(t){(0,a.Iw)((0,v.t)("Failed to retrieve organization or integration details")),this.setState({reloading:!1})}})),(0,s.Z)(this,"onRequestSuccess",(t=>{let{stateKey:e,data:n}=t;"organizations"===e&&1===n.length&&this.onSelectOrg(n[0].slug)}))}getDefaultState(){return{...super.getDefaultState(),selectedOrgSlug:null,organization:null,organizations:[],reloading:!1}}getEndpoints(){return[["organizations","/organizations/"],["sentryApp",`/sentry-apps/${this.sentryAppSlug}/`]]}getTitle(){return(0,v.t)("Choose Installation Organization")}get sentryAppSlug(){return this.props.params.sentryAppSlug}get isSingleOrg(){return 1===this.state.organizations.length}get isSentryAppInternal(){const{sentryApp:t}=this.state;return t&&"internal"===t.status}get isSentryAppUnavailableForOrg(){const{sentryApp:t,selectedOrgSlug:e}=this.state;return e&&t?.owner?.slug!==e&&"unpublished"===t.status}get disableInstall(){const{reloading:t,isInstalled:e}=this.state;return e||t||this.isSentryAppUnavailableForOrg}getOptions(){return this.state.organizations.map((t=>({value:t.slug,label:(0,S.BX)("div",{children:[(0,S.tZ)(p.Z,{organization:t}),(0,S.tZ)(W,{children:t.slug})]},t.slug)})))}renderInternalAppError(){const{sentryApp:t}=this.state;return(0,S.tZ)(l.bZ,{type:"error",showIcon:!0,children:(0,v._N)("Integration [sentryAppName] is an internal integration. Internal integrations are automatically installed",{sentryAppName:(0,S.tZ)("strong",{children:t.name})})})}checkAndRenderError(){const{organization:t,selectedOrgSlug:e,isInstalled:n,sentryApp:s}=this.state;if(e&&t&&!this.hasAccess(t))return(0,S.BX)(l.bZ,{type:"error",showIcon:!0,children:[(0,S.tZ)("p",{children:(0,v._N)("You do not have permission to install integrations in\n          [organization]. Ask an organization owner or manager to\n          visit this page to finish installing this integration.",{organization:(0,S.tZ)("strong",{children:t.slug})})}),(0,S.tZ)($,{children:window.location.href})]});if(n&&t)return(0,S.tZ)(l.bZ,{type:"error",showIcon:!0,children:(0,v._N)("Integration [sentryAppName] already installed for [organization]",{organization:(0,S.tZ)("strong",{children:t.name}),sentryAppName:(0,S.tZ)("strong",{children:s.name})})});if(this.isSentryAppUnavailableForOrg){const t=s?.owner?.slug??"another organization";return(0,S.tZ)(l.bZ,{type:"error",showIcon:!0,children:(0,v._N)("Integration [sentryAppName] is an unpublished integration for [otherOrg]. An unpublished integration can only be installed on the organization which created it.",{sentryAppName:(0,S.tZ)("strong",{children:s.name}),otherOrg:(0,S.tZ)("strong",{children:t})})})}return null}renderMultiOrgView(){const{selectedOrgSlug:t,sentryApp:e}=this.state;return(0,S.BX)("div",{children:[(0,S.tZ)("p",{children:(0,v._N)("Please pick a specific [organization:organization] to install [sentryAppName]",{organization:(0,S.tZ)("strong",{}),sentryAppName:(0,S.tZ)("strong",{children:e.name})})}),(0,S.tZ)(d.Z,{label:(0,v.t)("Organization"),inline:!1,stacked:!0,required:!0,children:()=>(0,S.tZ)(c.Z,{onChange:t=>{let{value:e}=t;return this.onSelectOrg(e)},value:t,placeholder:(0,v.t)("Select an organization"),options:this.getOptions()})})]})}renderSingleOrgView(){const{organizations:t,sentryApp:e}=this.state,n=t[0].name;return(0,S.tZ)("div",{children:(0,S.tZ)("p",{children:(0,v._N)("You are installing [sentryAppName] for organization [organization]",{organization:(0,S.tZ)("strong",{children:n}),sentryAppName:(0,S.tZ)("strong",{children:e.name})})})})}renderMainContent(){const{organization:t,sentryApp:e}=this.state;return(0,S.BX)("div",{children:[(0,S.tZ)(H,{children:this.isSingleOrg?this.renderSingleOrgView():this.renderMultiOrgView()}),this.checkAndRenderError(),t&&(0,S.tZ)(V.g.Provider,{value:t,children:(0,S.tZ)(I,{sentryApp:e,organization:t,onInstall:this.onInstall,closeModal:this.onClose,isInstalled:this.disableInstall})})]})}renderBody(){return(0,S.tZ)(U.Z,{children:(0,S.BX)(Y,{children:[(0,S.tZ)("h3",{children:(0,v.t)("Finish integration installation")}),this.isSentryAppInternal?this.renderInternalAppError():this.renderMainContent()]})})}}const $=(0,r.Z)("pre",{target:"e1ky0sy73"})({name:"1iee5id",styles:"margin-bottom:0;background:#fbe3e1"}),W=(0,r.Z)("span",{target:"e1ky0sy72"})({name:"1qkltea",styles:"margin-left:5px"}),Y=(0,r.Z)("div",{target:"e1ky0sy71"})({name:"qkomnt",styles:"margin-bottom:40px"}),H=(0,r.Z)("div",{target:"e1ky0sy70"})({name:"1azpx8r",styles:"margin-bottom:20px"})},"../node_modules/lodash/groupBy.js":(t,e,n)=>{var s=n("../node_modules/lodash/_baseAssignValue.js"),r=n("../node_modules/lodash/_createAggregator.js"),a=Object.prototype.hasOwnProperty,i=r((function(t,e,n){a.call(t,n)?t[n].push(e):s(t,n,[e])}));t.exports=i},"../node_modules/lodash/invertBy.js":(t,e,n)=>{var s=n("../node_modules/lodash/_baseIteratee.js"),r=n("../node_modules/lodash/_createInverter.js"),a=Object.prototype,i=a.hasOwnProperty,o=a.toString,l=r((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=o.call(e)),i.call(t,e)?t[e].push(n):t[e]=[n]}),s);t.exports=l}}]);
//# sourceMappingURL=../sourcemaps/app_views_sentryAppExternalInstallation_index_tsx.f2b17b51dbd95e01ecc3d1375f4b11ff.js.map