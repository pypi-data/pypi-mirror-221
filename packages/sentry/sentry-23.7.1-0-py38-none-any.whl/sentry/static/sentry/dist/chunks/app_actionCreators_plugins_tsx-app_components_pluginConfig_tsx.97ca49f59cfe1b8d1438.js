"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_actionCreators_plugins_tsx-app_components_pluginConfig_tsx"],{"./app/actionCreators/plugins.tsx":(t,e,s)=>{s.d(e,{Cg:()=>u,MM:()=>d,rR:()=>g}),s("../node_modules/core-js/modules/es.error.cause.js");var n=s("./app/actionCreators/indicator.tsx"),i=s("./app/api.tsx"),a=s("./app/locale.tsx"),o=s("./app/stores/pluginsStore.tsx");const r={},l=new i.KU;function p(t){let{orgId:e,projectId:s,pluginId:n,update:i,...a}=t;o.Z.onUpdate(n,i);const r=l.requestPromise(`/projects/${e}/${s}/plugins/${n}/`,{...a});return r.then((()=>{o.Z.onUpdateSuccess(n)})).catch((t=>{const e=t&&t.responseJSON&&"string"==typeof t.responseJSON.detail?new Error(t.responseJSON.detail):new Error("Unable to update plugin");o.Z.onUpdateError(n,e)})),r}function d(t,e){let{orgId:s,projectId:n}=t;const i=`/projects/${s}/${n}/plugins/`;if(r[i])return r[i];o.Z.onFetchAll(e);const a=l.requestPromise(i,{method:"GET",includeAllArgs:!0});return r[i]=a,a.then((t=>{let[e,s,n]=t;return o.Z.onFetchAllSuccess(e,{pageLinks:n?.getResponseHeader("Link")??void 0}),e})).catch((t=>{throw o.Z.onFetchAllError(t),new Error("Unable to fetch plugins")})).then((()=>r[i]=null)),a}function u(t){return(0,n.E3)((0,a.t)("Enabling...")),p({...t,update:{enabled:!0},method:"POST"}).then((()=>(0,n.S9)((0,a.t)("Plugin was enabled")))).catch((()=>(0,n.Iw)((0,a.t)("Unable to enable plugin"))))}function g(t){return(0,n.E3)((0,a.t)("Disabling...")),p({...t,update:{enabled:!1},method:"DELETE"}).then((()=>(0,n.S9)((0,a.t)("Plugin was disabled")))).catch((()=>(0,n.Iw)((0,a.t)("Unable to disable plugin"))))}},"./app/components/panels/panelHeader.tsx":(t,e,s)=>{s.d(e,{Z:()=>r});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=s("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),a=s("./app/styles/space.tsx");const o=t=>{let{disablePadding:e,hasButtons:s}=t;return(0,i.iv)("padding:",s?(0,a.D)(1):(0,a.D)(2)," ",e?0:(0,a.D)(2),";","")},r=(0,n.Z)("div",{target:"e1dzfr4k0"})("display:flex;align-items:center;justify-content:space-between;color:",(t=>t.lightText?t.theme.gray300:t.theme.gray400),";font-size:",(t=>t.theme.fontSizeSmall),";font-weight:600;text-transform:uppercase;border-bottom:1px solid ",(t=>t.theme.border),";border-radius:calc(",(t=>t.theme.panelBorderRadius)," - 1px) calc(",(t=>t.theme.panelBorderRadius)," - 1px) 0 0;background:",(t=>t.theme.backgroundSecondary),";line-height:1;position:relative;",o,";")},"./app/components/pluginConfig.tsx":(t,e,s)=>{s.d(e,{Z:()=>P});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=s("../node_modules/react/index.js"),o=s("../node_modules/lodash/isEqual.js"),r=s.n(o),l=s("./app/actionCreators/indicator.tsx"),p=s("./app/components/acl/access.tsx"),d=s("./app/components/button.tsx"),u=s("./app/components/loadingIndicator.tsx"),g=s("./app/components/panels/panel.tsx"),c=s("./app/components/panels/panelAlert.tsx"),h=s("./app/components/panels/panelBody.tsx"),m=s("./app/components/panels/panelHeader.tsx"),b=s("./app/locale.tsx"),x=s("./app/plugins/index.tsx"),Z=s("./app/plugins/components/pluginIcon.tsx"),S=s("./app/styles/space.tsx"),f=s("./app/utils/withApi.tsx"),j=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class y extends a.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{loading:!x.ZP.isLoaded(this.props.data),testResults:""}),(0,n.Z)(this,"handleDisablePlugin",(()=>{this.props.onDisablePlugin(this.props.data)})),(0,n.Z)(this,"handleTestPlugin",(async()=>{this.setState({testResults:""}),(0,l.E3)((0,b.t)("Sending test..."));try{const t=await this.props.api.requestPromise(this.getPluginEndpoint(),{method:"POST",data:{test:!0}});this.setState({testResults:JSON.stringify(t.detail)}),(0,l.S9)((0,b.t)("Test Complete!"))}catch(t){(0,l.Iw)((0,b.t)("An unexpected error occurred while testing your plugin. Please try again."))}}))}componentDidMount(){this.loadPlugin(this.props.data)}UNSAFE_componentWillReceiveProps(t){this.loadPlugin(t.data)}shouldComponentUpdate(t,e){return!r()(e,this.state)||!r()(t.data,this.props.data)}loadPlugin(t){this.setState({loading:!0},(()=>{x.ZP.load(t,(()=>{this.setState({loading:!1})}))}))}getPluginEndpoint(){const{organization:t,project:e,data:s}=this.props;return`/projects/${t.slug}/${e.slug}/plugins/${s.id}/`}createMarkup(){return{__html:this.props.data.doc}}render(){const{data:t,organization:e,project:s}=this.props,n=void 0!==this.props.enabled?this.props.enabled:t.enabled,i=(0,p.d)(["project:write"],{organization:e,project:s});return(0,j.BX)(g.Z,{className:`plugin-config ref-plugin-config-${t.id}`,"data-test-id":"plugin-config",children:[(0,j.BX)(m.Z,{hasButtons:!0,children:[(0,j.BX)(w,{children:[(0,j.tZ)(k,{pluginId:t.id}),(0,j.tZ)("span",{children:t.name})]}),t.canDisable&&n&&(0,j.BX)(E,{children:[t.isTestable&&(0,j.tZ)(z,{onClick:this.handleTestPlugin,size:"sm",children:(0,b.t)("Test Plugin")}),(0,j.tZ)(d.zx,{size:"sm",onClick:this.handleDisablePlugin,disabled:!i,children:(0,b.t)("Disable")})]})]}),"beta"===t.status&&(0,j.tZ)(c.Z,{type:"warning",children:(0,b.t)("This plugin is considered beta and may change in the future.")}),""!==this.state.testResults&&(0,j.BX)(c.Z,{type:"info",children:[(0,j.tZ)("strong",{children:"Test Results"}),(0,j.tZ)("div",{children:this.state.testResults})]}),(0,j.BX)(_,{children:[(0,j.tZ)("div",{dangerouslySetInnerHTML:this.createMarkup()}),this.state.loading?(0,j.tZ)(u.Z,{}):x.ZP.get(t).renderSettings({organization:this.props.organization,project:this.props.project})]})]})}}y.displayName="PluginConfig",(0,n.Z)(y,"defaultProps",{onDisablePlugin:()=>{}});const P=(0,f.Z)(y),w=(0,i.Z)("div",{target:"e1snkajz4"})({name:"y37upr",styles:"display:flex;align-items:center;flex:1"}),k=(0,i.Z)(Z.ZP,{target:"e1snkajz3"})("margin-right:",(0,S.D)(1),";"),E=(0,i.Z)("div",{target:"e1snkajz2"})({name:"zjik7",styles:"display:flex"}),z=(0,i.Z)(d.zx,{target:"e1snkajz1"})("margin-right:",(0,S.D)(1),";"),_=(0,i.Z)(h.Z,{target:"e1snkajz0"})("padding:",(0,S.D)(2),";padding-bottom:0;")},"./app/stores/pluginsStore.tsx":(t,e,s)=>{s.d(e,{Z:()=>o});var n=s("../node_modules/reflux/src/index.js");const i={loading:!0,plugins:[],error:null,pageLinks:null},a={plugins:null,state:{...i},updating:new Map,reset(){return this.plugins=null,this.state={...i},this.updating=new Map,this.state},getInitialState(){return this.getState()},getState(){const{plugins:t,...e}=this.state;return{...e,plugins:this.plugins?Array.from(this.plugins.values()):[]}},init(){this.reset()},triggerState(){this.trigger(this.getState())},onFetchAll(){let{resetLoading:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t&&(this.state.loading=!0,this.state.error=null,this.plugins=null),this.triggerState()},onFetchAllSuccess(t,e){let{pageLinks:s}=e;this.plugins=new Map(t.map((t=>[t.id,t]))),this.state.pageLinks=s||null,this.state.loading=!1,this.triggerState()},onFetchAllError(t){this.plugins=null,this.state.loading=!1,this.state.error=t,this.triggerState()},onUpdate(t,e){if(!this.plugins)return;const s=this.plugins.get(t);if(!s)return;const n={...s,...e};this.plugins.set(t,n),this.updating.set(t,s),this.triggerState()},onUpdateSuccess(t){this.updating.delete(t)},onUpdateError(t,e){const s=this.updating.get(t);s&&this.plugins&&(this.plugins.set(t,s),this.updating.delete(t),this.state.error=e,this.triggerState())}},o=(0,n.createStore)(a)}}]);
//# sourceMappingURL=../sourcemaps/app_actionCreators_plugins_tsx-app_components_pluginConfig_tsx.dc2485b0ef8a379d1be4e7a3ec06c37a.js.map