import{a as w,u as q,b as _,r as x,j as B,aB as $,aC as R,W as T,ay as d,aD as C,aA as A,a6 as G,aE as U,aF as H,az as J,aG as K,e as Q}from"./index-37f7281c.js";function L(v){const o=v.files??[],D=v.directories??[];return[...o,...D.map(L).flat()]}const M=x.createContext({activeRange:new Set,setActiveRange:()=>{},selectArtifactsInRange:()=>{},createDirectory:()=>{},createFile:()=>{},renameArtifact:()=>{},removeArtifacts:()=>{},removeArtifactWithConfirmation:()=>{},moveArtifacts:()=>{}});function Z({children:v}){const o=w(e=>e.project),D=w(e=>e.files),E=w(e=>e.setSelectedFile),p=w(e=>e.setFiles),g=q(e=>e.addConfirmation),h=_(e=>e.tab),I=_(e=>e.closeTab),[y,c]=x.useState(!1),[F,S]=x.useState(new Set);x.useEffect(()=>{E(h==null?void 0:h.file)},[h]);function O(e){S(s=>{const t=s.size-1,i=o.allArtifacts,u=Array.from(s),n=u[0],m=u[t],r=i.indexOf(e),f=n==null?0:i.indexOf(n),a=m==null?t:i.indexOf(m),Y=r>f?f:r,k=r>a||r>f&&r<a?r:a;return new Set(i.slice(Y,k+1))})}function X(e){if(y)return;c(!0);const s=$("new_directory");R(`${e.path}/${s}`,{}).then(l=>{if(T(l.ok)){console.warn([`Directory: ${e.path}`,l.detail]);return}e.addDirectory(new d(l,e)),e.open()}).catch(l=>{console.log(l)}).finally(()=>{c(!1)})}function b(e,s=".py"){if(y)return;c(!0);const l=$("new_file",s);C(`${e.path}/${l}`,{content:""}).then(t=>{if(T(t.ok)){console.warn([`File: ${e.path}`,t.detail]);return}const i=new A(t,e);e.addFile(i),e.open(),E(i),p((o==null?void 0:o.allFiles)??[])}).catch(t=>{console.log(t)}).finally(()=>{c(!1)})}function z(e,s){if(y||G(s))return;c(!0);const l=e.name,t=e.path;e.rename(s.trim()),e instanceof d&&R(t,{new_path:e.path}).catch(i=>{console.log(i),e.rename(l)}).finally(()=>{c(!1),h!=null&&e.hasFile(h.file)&&E(h.file),p((o==null?void 0:o.allFiles)??[])}),e instanceof A&&C(t,{new_path:e.path}).then(i=>{e.update(i),D.set(e.path,e),D.delete(t)}).catch(i=>{console.log(i),e.rename(l)}).finally(()=>{c(!1),p((o==null?void 0:o.allFiles)??[])})}function P(e){if(y)return;c(!0);const s=Array.from(e),l=s.map(t=>t instanceof A?U(t.path):H(t.path));Promise.all(l).then(t=>{t.forEach((i,u)=>{var m,r;const n=s[u];n instanceof A&&(I(n),(m=n.parent)==null||m.removeFile(n)),n instanceof d&&(n.isNotEmpty&&L(n).forEach(a=>{I(a)}),(r=n.parent)==null||r.removeDirectory(n))}),S(new Set),p((o==null?void 0:o.allFiles)??[])}).catch(t=>{console.log(t)}).finally(()=>{c(!1)})}function W(e){F.has(e)?g({headline:"Removing Selected Files/Directories",description:`Are you sure you want to remove ${F.size} items?`,yesText:"Yes, Remove",noText:"No, Cancel",details:Array.from(F).map(s=>s.path),action:()=>{P(F)}}):g({headline:`Removing ${e instanceof d?"Directory":"File"}`,description:`Are you sure you want to remove the ${e instanceof d?"directory":"file"} "${e.name}"?`,yesText:"Yes, Remove",noText:"No, Cancel",action:()=>{J(e.parent)&&P(new Set([e]))}})}function N(e,s,l=!1){if(y)return;c(!0);const t=[],i=[],u=[];if(e.forEach(n=>{const m=s.containsName(n.name),r=n.path;if(m&&T(l))return u.push(n);l&&n.rename(n.copyName());const f=K.toPath(s.path,n.name);n instanceof d&&(t.push(()=>{var a;(a=n.parent)==null||a.removeDirectory(n),s.addDirectory(n)}),i.push(R(r,{new_path:f})),n.allArtifacts.forEach(a=>e.delete(a))),n instanceof A&&(t.push(()=>{var a;(a=n.parent)==null||a.removeFile(n),s.addFile(n)}),i.push(C(r,{new_path:f})))}),Q(u)){g({headline:"Moving Duplicates",description:"All duplicated names will be renamed!",yesText:"Yes, Rename",noText:"No, Cancel",details:u.map(n=>n.path),action:()=>{N(e,s,!0)}});return}Promise.all(i).then(n=>{n.forEach((m,r)=>{var f;return(f=t[r])==null?void 0:f.call(t)})}).catch(n=>{console.log(n)}).finally(()=>{c(!1),S(new Set),p((o==null?void 0:o.allFiles)??[])})}return B.jsx(M.Provider,{value:{activeRange:F,createDirectory:X,createFile:b,renameArtifact:z,removeArtifacts:P,removeArtifactWithConfirmation:W,moveArtifacts:N,selectArtifactsInRange:O,setActiveRange(e){S(()=>new Set(o.allArtifacts.filter(s=>e.has(s))))}},children:v})}function j(){return x.useContext(M)}export{M as FileExplorerContext,Z as default,j as useFileExplorer};
