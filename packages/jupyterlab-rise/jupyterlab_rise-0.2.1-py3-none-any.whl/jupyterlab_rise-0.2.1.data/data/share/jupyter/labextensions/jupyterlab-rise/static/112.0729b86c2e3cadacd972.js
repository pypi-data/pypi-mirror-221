"use strict";(self.webpackChunkjupyterlab_rise=self.webpackChunkjupyterlab_rise||[]).push([[112],{112:(e,t,n)=>{n.r(t),n.d(t,{IRisePreviewTracker:()=>w,default:()=>x});var o=n(638),a=n(303),i=n(344),r=n(127),l=n(299),s=n(720),c=n(918),d=n(745);const h=new d.LabIcon({name:"RISE",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 24 24" width="16" fill="none" stroke="#4f4f4f">\n    <path d="M15 14.25l3 6m-9-6l-3 6m-4-16h20-2v10H4v-10z" class="jp-icon3" stroke-width="2" />\n    <path d="M9.6 11.6v-1.5m-1.5 1.5V6.1m-1.5 5.5V8.1m5.5 3.5h3m-3-1.5h6m-6-1.5h6m-6-2h5" class="jp-icon3"\n        stroke-width="1.2" />\n</svg>'}),u=new d.LabIcon({name:"RISE:fullScreen",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 24 24" width="16" fill="#4f4f4f">\n    <path class="jp-icon3" d="M22 22v-6h-2v4h-4v2zM2 22h6v-2H4v-4H2zM22 2h-6v2h4v4h2zM2 2v6h2V4h4V2z" />\n</svg>'});var v=n(20),m=n(526),p=n(840),g=n(832);const w=new m.Token("jupyterlab-rise:IRisePreviewTracker");class f extends v.DocumentWidget{constructor(e){super({...e,content:new a.IFrame({sandbox:["allow-same-origin","allow-scripts","allow-downloads","allow-modals","allow-popups"]})}),this._ready=new m.PromiseDelegate;const{getRiseUrl:t,context:n,renderOnSave:o,translator:i}=e;this.getRiseUrl=t,this._path=n.path;const r=(null!=i?i:s.nullTranslator).load("rise");this.content.title.icon=h,this._renderOnSave=null!=o&&o,n.pathChanged.connect((()=>{this.path=n.path}));const l=new a.ToolbarButton({icon:d.refreshIcon,tooltip:r.__("Reload Preview"),onClick:()=>{this.reload()}}),c=new b.CheckBox({checked:this._renderOnSave,onChange:e=>{var t,n;this._renderOnSave=null!==(n=null===(t=e.target)||void 0===t?void 0:t.checked)&&void 0!==n&&n},translator:i});this.toolbar.addItem("fullscreen",new a.ToolbarButton({icon:u,tooltip:r.__("Open the slideshow in full screen"),onClick:()=>{e.commands.execute("RISE:fullscreen-plugin")}})),n&&(this.toolbar.addItem("renderOnSave",c),n.ready.then((()=>{this.setActiveCellIndex(0).then((()=>this._ready.resolve())).catch((e=>this._ready.reject(e))),n.fileChanged.connect((()=>{this.renderOnSave&&this.reload()}))}))),this.toolbar.addItem("spacer",a.Toolbar.createSpacerItem()),this.toolbar.addItem("reload",l)}get ready(){return this._ready.promise}get iframe(){return this.content.node.querySelector("iframe")}dispose(){this.isDisposed||(super.dispose(),p.Signal.clearData(this))}reload(){const e=this.content.node.querySelector("iframe");e.contentWindow&&e.contentWindow.location.reload()}get renderOnSave(){return this._renderOnSave}async setActiveCellIndex(e,t=!0){const n=this.iframe;if(!t)return n.contentWindow?(n.contentWindow.history.pushState(null,"",this.getRiseUrl(this.path,e)),Promise.resolve()):Promise.reject("No content.");this.content.url=this.getRiseUrl(this.path,e),await this._waitForIFrame(n)}get path(){return this._path}set path(e){e!==this._path&&(this._path=e,this.setActiveCellIndex(0))}async _waitForIFrame(e){var t;const n=new m.PromiseDelegate,o=()=>{e.contentWindow.removeEventListener("load",o);const t=setInterval((()=>{e.contentDocument.querySelector(".reveal")&&(clearInterval(t),n.resolve(!0))}),500)};return"complete"===(null===(t=e.contentDocument)||void 0===t?void 0:t.readyState)?o():e.contentWindow.addEventListener("load",o),n.promise}}class y extends v.ABCWidgetFactory{constructor(e,t,n){super(n),this.getRiseUrl=e,this.commands=t,this.defaultRenderOnSave=!1}createNewWidget(e){return new f({context:e,commands:this.commands,getRiseUrl:this.getRiseUrl,renderOnSave:this.defaultRenderOnSave})}}var b,_;!function(e){class t extends g.Widget{constructor(e={}){var t,n,o;const a=(null!==(t=e.translator)&&void 0!==t?t:s.nullTranslator).load("rise"),i=document.createElement("label");i.insertAdjacentHTML("afterbegin",`<input name="renderOnSave" type="checkbox"></input>${a.__("Render on Save")}`),super({node:i}),this.input=i.childNodes.item(0),this.checked=null!==(n=e.checked)&&void 0!==n&&n,this.onChange=null!==(o=e.onChange)&&void 0!==o?o:()=>{}}get checked(){return this.input.checked}set checked(e){this.input.checked=e}onAfterAttach(e){super.onAfterAttach(e),this.input.addEventListener("change",this.onChange)}onBeforeDetach(e){this.input.removeEventListener("change",this.onChange),super.onBeforeDetach(e)}}e.CheckBox=t,e.setupLog=function(){window.onmessage=e=>{var t,n,o,a,i,r,l,s,c;switch(null===(t=e.data)||void 0===t?void 0:t.level){case"debug":console.debug(...null!==(o=null===(n=e.data)||void 0===n?void 0:n.msg)&&void 0!==o?o:[]);break;case"info":console.info(...null!==(i=null===(a=e.data)||void 0===a?void 0:a.msg)&&void 0!==i?i:[]);break;case"warn":console.warn(...null!==(l=null===(r=e.data)||void 0===r?void 0:r.msg)&&void 0!==l?l:[]);break;case"error":console.error(...null!==(c=null===(s=e.data)||void 0===s?void 0:s.msg)&&void 0!==c?c:[]);break;default:console.log(e)}}}}(b||(b={})),function(e){e.openRise="RISE:slideshow",e.riseFullScreen="RISE:fullscreen-plugin",e.risePreview="RISE:preview",e.riseSetSlideType="RISE:set-slide-type"}(_||(_={}));const S={id:"jupyterlab-rise:plugin",autoStart:!0,requires:[s.ITranslator],optional:[r.INotebookTracker,a.ICommandPalette,o.ILayoutRestorer,l.ISettingRegistry],provides:w,activate:(e,t,n,o,r,l)=>{console.log("JupyterLab extension jupyterlab-rise is activated!");const s=new a.WidgetTracker({namespace:"rise"});if(!n)return s;const{commands:d,docRegistry:v,shell:m}=e,p=t.load("rise");let g=null;l&&l.load(S.id).then((e=>{g=e}));const w=new y(b,d,{name:"rise",fileTypes:["notebook"],modelName:"notebook"});function f(){return null!==(null==n?void 0:n.currentWidget)&&(null==n?void 0:n.currentWidget)===m.currentWidget}function b(e,t){let n=`${i.PageConfig.getBaseUrl()}rise/${e}`;return"number"==typeof t&&(n+=i.URLExt.objectToQueryString({activeCellIndex:t})),n}if(r&&r.restore(s,{command:"docmanager:open",args:e=>({path:e.context.path,factory:w.name}),name:e=>e.context.path,when:e.serviceManager.ready}),v.addWidgetFactory(w),w.widgetCreated.connect(((e,t)=>{t.context.pathChanged.connect((()=>{s.save(t)})),s.add(t)})),s.widgetAdded.connect(((e,t)=>{t.ready.then((()=>{var e;return null===(e=t.iframe)||void 0===e?void 0:e.focus()}))})),d.addCommand(_.openRise,{label:e=>e.toolbar?"":p.__("Open as Reveal Slideshow"),caption:p.__("Open the current notebook in a new browser tab as an RevealJS slideshow."),execute:async()=>{const e=n.currentWidget;e&&(await e.context.save(),window.open(b(e.context.path,e.content.activeCellIndex)))},isEnabled:f}),d.addCommand(_.risePreview,{label:e=>e.toolbar?"":p.__("Render as Reveal Slideshow"),caption:p.__("Render the current notebook as Reveal Slideshow"),icon:h,execute:async e=>{const t=function(e){var t;const o=null!==(t=null==n?void 0:n.currentWidget)&&void 0!==t?t:null;return!1!==e.activate&&o&&m.activateById(o.id),o}(e);let o;if(t){o=t.context,await o.save();const n=await d.execute("docmanager:open",{path:o.path,factory:"rise",options:{mode:"split-right"}}),i=e=>{n.setActiveCellIndex(e.activeCellIndex,!1)};n.setActiveCellIndex(t.content.activeCellIndex),t.content.activeCellChanged.connect(i),n.disposed.connect((()=>{t.content.activeCellChanged.disconnect(i)})),!0===e.fullscreen&&n.ready.then((()=>{(0,a.showDialog)({title:p.__("Switch to full screen"),body:p.__("The slideshow is set to automatically open in full screen. Your web browser requires your confirmation to do so.")}).then((e=>{e.button.accept&&d.execute(_.riseFullScreen,{id:n.id})}))})).catch((e=>{console.log(e)}))}},isEnabled:f}),d.addCommand(_.riseFullScreen,{label:p.__("Full screen slideshow"),caption:p.__("Toggle full screen the current active slideshow"),icon:u,execute:async t=>{var n;t.id&&e.shell.activateById(t.id);const o=t.id?(0,c.toArray)(e.shell.widgets("main")).find((e=>e.id===t.id)):e.shell.currentWidget;if(o&&s.has(o)){const e=o.iframe;e&&(document.fullscreenElement||(null===(n=e.contentDocument)||void 0===n?void 0:n.fullscreenElement)?document.exitFullscreen&&await document.exitFullscreen():o.ready.then((()=>{var t,n;null===(n=null===(t=null==e?void 0:e.contentWindow)||void 0===t?void 0:t.document.querySelector("div.reveal"))||void 0===n||n.requestFullscreen()})),e.focus())}},isEnabled:()=>!!e.shell.currentWidget&&s.has(e.shell.currentWidget)}),d.addCommand(_.riseSetSlideType,{label:e=>p.__("Toggle slideshow %1 type",e.type),caption:e=>p.__("(Un)set active cell as a %1 cell",e.type),execute:t=>{var o,a;const i=t.type,r=e.shell.currentWidget;if(r&&n.has(r)){const e=null===(o=r.content.activeCell)||void 0===o?void 0:o.model;if(e){const t=null!==(a=e.metadata.get("slideshow"))&&void 0!==a?a:{};if(i!==t.slide_type){const n={...t};i?n.slide_type=i:delete n.slide_type,Object.keys(n).length>0?e.metadata.set("slideshow",n):e.metadata.delete("slideshow")}}}},isToggled:t=>{var o,a;const i=t.type,r=e.shell.currentWidget;if(r&&n.has(r)){const e=null===(o=r.content.activeCell)||void 0===o?void 0:o.model;if(e)return(null!==(a=e.metadata.get("slideshow"))&&void 0!==a?a:{}).slide_type===i&&!!i}return!1},isEnabled:e=>{var t;return["slide","subslide","fragment","skip","notes"].includes(null!==(t=e.type)&&void 0!==t?t:"")}}),n.widgetAdded.connect((async(t,n)=>{var o,i,r;if(n.toolbar.insertBefore("kernelName","RISE-button",new a.CommandToolbarButton({commands:d,id:_.risePreview,args:{toolbar:!0}})),"Rise"!==e.name){await n.context.ready;let e=null!==(r=(null!==(i=null===(o=n.content.model)||void 0===o?void 0:o.metadata.get("rise"))&&void 0!==i?i:{}).autolaunch)&&void 0!==r&&r;g&&(e|=g.get("autolaunch").composite),e&&await d.execute(_.risePreview,{fullscreen:!0})}})),o){const e="Notebook Operations";[_.openRise,_.risePreview].forEach((t=>{o.addItem({command:t,category:e})}))}return s}},x=S}}]);