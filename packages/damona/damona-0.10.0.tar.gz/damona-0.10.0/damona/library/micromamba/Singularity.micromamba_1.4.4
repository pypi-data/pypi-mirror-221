BootStrap: docker
From: mambaorg/micromamba:1.4.4

%test
    micromamba --version > /dev/null


%post

    apt -y update && apt -y upgrade

    # Create a micromamba environment (based won't work)
    micromamba create -y -n main
    micromamba install -q -c conda-forge -n main -y python="3.10" pip

    # set anaconda path
    export PATH=$PATH:/usr/local/micromamba/bin

    #cleanup
    rm -rf /opt/conda/pkgs/
    export PATH=$PATH:/usr/local/micromamba/bin
    export PATH=$PATH:/opt/conda/envs/main/bin/

%environment

    export PATH=$PATH:/usr/local/micromamba/bin
    export PATH=$PATH:/opt/conda/envs/main/bin/
    export LANG=C   # prevents perl for raising warnings
    export LANG=C.UTF-8
    export LC_ALL=C.UTF-8

