
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "source/auto_examples/plot_hurricane_florence.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_source_auto_examples_plot_hurricane_florence.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_source_auto_examples_plot_hurricane_florence.py:


Example on integrating radar and HRRR data
------------------------------------------

This is an example of how to retrieve winds in Hurricane Florence.
In this example, we use data from 2 NEXRAD radars as well as from
the HRRR to retrieve the winds

This example has been updated to use _Herbie to retrieve the HRRR data.
In addition, _pooch is used to retrieve the gridded data for the example.
Herbie is not required to run PyDDA, but must be installed to run this example.

.. _Herbie: https://herbie.readthedocs.io/en/latest/ 
.. _pooch: https://www.fatiando.org/pooch/latest/index.html
.. image:: ../../hrrr_figure.png

Author: Robert C. Jackson

.. GENERATED FROM PYTHON SOURCE LINES 19-61



.. image-sg:: /source/auto_examples/images/sphx_glr_plot_hurricane_florence_001.png
   :alt:  2018-09-14T06:24:17Z winds at 0.5 km
   :srcset: /source/auto_examples/images/sphx_glr_plot_hurricane_florence_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    ✅ Found ┊ model=hrrr ┊ product=prs ┊ 2018-Sep-14 06:00 UTC F00 ┊ GRIB2 @ local ┊ IDX @ aws
    /Users/rjackson/pyart/pyart/io/cfradial.py:408: UserWarning: WARNING: valid_min not used since it
    cannot be safely cast to variable data type
      data = self.ncvar[:]
    /Users/rjackson/pyart/pyart/io/cfradial.py:408: UserWarning: WARNING: valid_max not used since it
    cannot be safely cast to variable data type
      data = self.ncvar[:]
    Calculating weights for radars 0 and 1
    Calculating weights for models...
    Starting solver 
    rmsVR = 21.543623
    Total points: 642309
    The max of w_init is 0.0
    Nfeval | Jvel    | Jmass   | Jsmooth |   Jbg   | Jvort   | Jmodel  | Jpoint  | Max w  
          0|643287.9375|   0.0000|   0.0000|   0.0000|   0.0000|2410000128.0000|   0.0000|   0.0000
    Iterations before filter: 10
    Applying low pass filter to wind field...
    Done! Time = 27.8
    /Users/rjackson/mambaforge/envs/pydda_env/lib/python3.10/site-packages/cartopy/mpl/geoaxes.py:1614: UserWarning: The following kwargs were not used by contour: 'color'
      result = super().contour(*args, **kwargs)
    /Users/rjackson/mambaforge/envs/pydda_env/lib/python3.10/site-packages/cartopy/mpl/geoaxes.py:1614: UserWarning: The following kwargs were not used by contour: 'color'
      result = super().contour(*args, **kwargs)






|

.. code-block:: default


    import urllib
    import pyart
    import pydda
    import matplotlib.pyplot as plt
    import cartopy.crs as ccrs
    import numpy as np
    import pooch

    from herbie import Herbie

    H = Herbie("2018-09-14 06:00", model="hrrr", product="prs", fxx=0)
    H.download()

    grid_mhx_path = pooch.retrieve(
        url="https://github.com/rcjackson/pydda-sample-data/raw/main/pydda-sample-data/grid_mhx.nc",
        known_hash=None)
    grid_ltx_path = pooch.retrieve(
        url="https://github.com/rcjackson/pydda-sample-data/raw/main/pydda-sample-data/grid_ltx.nc",
        known_hash=None)

    grid_mhx = pyart.io.read_grid(grid_mhx_path)
    grid_ltx = pyart.io.read_grid(grid_ltx_path)

    grid_mhx = pydda.constraints.add_hrrr_constraint_to_grid(grid_mhx,
                                                             H.grib)
    u_init, v_init, w_init = pydda.initialization.make_constant_wind_field(
        grid_mhx, (0.0, 0.0, 0.0))
    out_grids = pydda.retrieval.get_dd_wind_field(
        [grid_mhx, grid_ltx], u_init, v_init, w_init, Co=1.0, Cm=1.0, Cmod=1.0,
        mask_outside_opt=True, vel_name='corrected_velocity', engine="tensorflow",
        model_fields=["hrrr"])

    fig = plt.figure(figsize=(25, 15))
    ax = plt.axes(projection=ccrs.PlateCarree())
    ax = pydda.vis.plot_horiz_xsection_barbs_map(
        out_grids, ax=ax, bg_grid_no=-1, level=1, barb_spacing_x_km=20.0,
        barb_spacing_y_km=20.0, cmap='pyart_HomeyerRainbow')
    ax.set_xticks(np.arange(-80, -75, 0.5))
    ax.set_yticks(np.arange(33., 35.5, 0.5))
    plt.title(out_grids[0].time['units'][13:] + ' winds at 0.5 km')
    plt.show()


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 1 minutes  11.647 seconds)


.. _sphx_glr_download_source_auto_examples_plot_hurricane_florence.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example


    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_hurricane_florence.py <plot_hurricane_florence.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_hurricane_florence.ipynb <plot_hurricane_florence.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
