import{_ as v}from"./index.12198a8e.js";import{ah as a,o as d,c as h,V as s,P as n,a as p,T as y,U as g,F as $,a8 as V,az as L,aA as R,O as k,S as O,ar as T,a9 as U,Q as z}from"./vendor-vue.9e61e0af.js";import{F as x}from"./vendor-lib.76301fc3.js";import{C as A}from"./ConnectStatus.89654d5c.js";import"./element-icon.1ce1c350.js";import"./element-plus.30eb1cab.js";const B={domains:[{message:"\u57DF\u540D\u5217\u8868\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],status:[{message:"\u9A8C\u8BC1\u72B6\u6001\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],start_time:[{message:"SSL\u7B7E\u53D1\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],expire_time:[{message:"SSL\u8FC7\u671F\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],create_time_label:[{message:"\u521B\u5EFA\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}]},j={name:"",props:{row:{type:Object,default:null}},components:{},data(){return{rules:B,form:{domains:"",status:"",start_time:"",expire_time:"",create_time_label:""}}},computed:{},methods:{async getData(){if(this.row){let i={id:this.row.id};const e=await this.$http.function(i);if(e.code!=0)return;let t=e.data;this.form.domains=t.domains,this.form.status=t.status,this.form.start_time=t.start_time,this.form.expire_time=t.expire_time,this.form.create_time_label=t.create_time_label}},handleCancel(){this.$emit("on-cancel")},handleSubmit(){this.$refs.form.validate(i=>{if(i)this.confirmSubmit();else return!1})},async confirmSubmit(){let i=this.$loading({fullscreen:!0}),e={domains:this.form.domains.split(`
`)};this.row&&(e.id=this.row.id);const t=await this.$http.issueCertificate(e);t.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success",t.data)):this.$msg.error(t.msg),this.$nextTick(()=>{i.close()})}},created(){this.getData()}},E={class:"text-center"};function q(i,e,t,C,l,o){const r=a("el-input"),u=a("el-form-item"),m=a("el-form"),_=a("el-button");return d(),h("div",null,[s(m,{ref:"form",model:l.form,rules:l.rules,"label-width":"100px"},{default:n(()=>[s(u,{label:"id",prop:"id",style:{display:"none"}},{default:n(()=>[s(r,{type:"text",modelValue:l.form.id,"onUpdate:modelValue":e[0]||(e[0]=f=>l.form.id=f),rows:3,placeholder:"id"},null,8,["modelValue"])]),_:1}),s(u,{label:"\u57DF\u540D\u5217\u8868",prop:"domains"},{default:n(()=>[s(r,{type:"textarea",modelValue:l.form.domains,"onUpdate:modelValue":e[1]||(e[1]=f=>l.form.domains=f),rows:3,placeholder:"\u8BF7\u8F93\u5165\u57DF\u540D\u5217\u8868\uFF0C\u6BCF\u884C\u4E00\u4E2A"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),p("div",E,[s(_,{onClick:o.handleCancel},{default:n(()=>[y("\u53D6 \u6D88")]),_:1},8,["onClick"]),s(_,{type:"primary",onClick:o.handleSubmit},{default:n(()=>[y("\u786E \u5B9A")]),_:1},8,["onClick"])])])}const F=v(j,[["render",q]]);const K={name:"VerifyStep",props:{form:{type:Object}},components:{},data(){return{}},computed:{},methods:{async getData(){},async handleSubmit(){let i=this.$loading({fullscreen:!0}),e={issue_certificate_id:this.form.id};const t=await this.$http.verifyCertificateById(e);t.code==0?(this.$msg.success("\u9A8C\u8BC1\u6210\u529F"),this.$emit("on-success",t.data)):this.$msg.error(t.msg),this.$nextTick(()=>{i.close()})}},created(){this.getData()}},N=i=>(L("data-v-5e5bcfb1"),i=i(),R(),i),P={class:"mo-form-detail"},H=N(()=>p("span",null,"\u6587\u4EF6",-1)),J={class:"verify-step__value"},Q={class:"verify-step__value"},G=["href"],M={class:"text-center mt-md"};function W(i,e,t,C,l,o){const r=a("el-form-item"),u=a("el-form"),m=a("el-button");return d(),h("div",P,[s(u,{"label-width":"130px"},{default:n(()=>[s(r,{label:"\u57DF\u540D\u6388\u6743\u9A8C\u8BC1\u7C7B\u578B",prop:"domain"},{default:n(()=>[H]),_:1}),s(r,{label:"\u6587\u4EF6\u5185\u5BB9",prop:"create_time"},{default:n(()=>[p("span",J,g(t.form.validation),1)]),_:1}),s(r,{label:"\u670D\u52A1\u5668\u76EE\u5F55",prop:"create_time"},{default:n(()=>[p("span",Q,"/.well-known/acme-challenge/"+g(t.form.token),1)]),_:1}),s(r,{label:"HTTP\u5730\u5740",prop:"isp"},{default:n(()=>[(d(!0),h($,null,V(t.form.domain_validation_urls,_=>(d(),h("div",null,[p("a",{href:_,class:"verify-step__value mo-link",target:"_blank"},g(_),9,G)]))),256))]),_:1})]),_:1}),p("div",M,[s(m,{type:"primary",onClick:o.handleSubmit},{default:n(()=>[y("\u9A8C \u8BC1")]),_:1},8,["onClick"])])])}const X=v(K,[["render",W],["__scopeId","data-v-5e5bcfb1"]]);const Y={name:"VerifyStep",props:{form:{type:Object}},components:{},data(){return{}},computed:{},methods:{async getData(){},handleClose(){this.$emit("on-close")},async handleSubmit(){let i=this.$loading({fullscreen:!0}),e={issue_certificate_id:this.form.id};const t=await this.$http.renewCertificate(e);return t.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success",t.data)):this.$msg.error(t.msg),this.$nextTick(()=>{i.close()}),t},downloadSSLKeyFile(){console.log(JSON.stringify(this.form,null,2));let i=new Blob([this.form.ssl_certificate_key],{type:"text/plain;charset=utf-8"}),e=this.form.domains[0];x.saveAs(i,`${e}.key`)},async downloadSSLFile(){if(!this.form.ssl_certificate){const t=await this.handleSubmit();this.form.ssl_certificate=t.data.ssl_certificate}let i=new Blob([this.form.ssl_certificate],{type:"text/plain;charset=utf-8"}),e=this.form.domains[0];x.saveAs(i,`${e}.pem`)}},created(){this.getData()}},Z={class:"mo-form-detail"},ee={class:"text-center mt-md"};function te(i,e,t,C,l,o){const r=a("Download"),u=a("el-icon"),m=a("el-link"),_=a("el-form-item"),f=a("el-form"),b=a("el-button");return d(),h("div",Z,[s(f,{"label-width":"130px"},{default:n(()=>[s(_,{label:"\u79C1\u94A5",prop:"domain"},{default:n(()=>[s(m,{underline:!1,type:"primary",class:"mr-sm",onClick:o.downloadSSLKeyFile},{default:n(()=>[s(u,null,{default:n(()=>[s(r)]),_:1}),y("\u70B9\u51FB\u4E0B\u8F7D")]),_:1},8,["onClick"])]),_:1}),s(_,{label:"\u516C\u94A5",prop:"domain"},{default:n(()=>[s(m,{underline:!1,type:"primary",class:"mr-sm",onClick:o.downloadSSLFile},{default:n(()=>[s(u,null,{default:n(()=>[s(r)]),_:1}),y("\u70B9\u51FB\u4E0B\u8F7D")]),_:1},8,["onClick"])]),_:1})]),_:1}),p("div",ee,[s(b,{type:"primary",onClick:o.handleClose},{default:n(()=>[y("\u5173 \u95ED")]),_:1},8,["onClick"])])])}const se=v(Y,[["render",te],["__scopeId","data-v-bc5bd2e2"]]),ie={name:"IssueCertificateStep",props:{row:{type:Object}},components:{DataForm:F,VerifyStep:X,RenewStep:se},data(){return{activeStep:0,issue_certificate_id:null,form:{id:null,domains:[],domain_validation_urls:[],validation:"",token:"",status:"",ssl_certificate_key:"",ssl_certificate:""},setpList:[{title:"\u586B\u5199\u57DF\u540D"},{title:"\u90E8\u7F72\u9A8C\u8BC1\u6587\u4EF6"},{title:"\u4E0B\u8F7D\u8BC1\u4E66"}]}},computed:{},methods:{async getData(){if(!this.issue_certificate_id)return;let i={issue_certificate_id:this.issue_certificate_id};const e=await this.$http.getIssueCertificateById(i);if(!!e.ok){for(let t in this.form)this.form[t]=e.data[t];e.data.ssl_certificate?this.activeStep=3:e.data.status=="valid"?this.activeStep=2:e.data.status=="pending"?this.activeStep=1:this.activeStep=0}},handleIssueSuccess(i){this.issue_certificate_id=i.id,this.getData()},handleVerifySuccess(){this.getData()}},created(){this.row&&(this.issue_certificate_id=this.row.id),this.getData()}},ne={class:""},ae={class:"mt-md"};function le(i,e,t,C,l,o){const r=a("el-step"),u=a("el-steps"),m=a("el-divider"),_=a("DataForm"),f=a("VerifyStep"),b=a("RenewStep");return d(),h("div",ne,[s(u,{active:l.activeStep,"align-center":"","finish-status":"success"},{default:n(()=>[(d(!0),h($,null,V(l.setpList,S=>(d(),k(r,{title:S.title},null,8,["title"]))),256))]),_:1},8,["active"]),s(m),p("div",ae,[l.activeStep==0?(d(),k(_,{key:0,onOnSuccess:o.handleIssueSuccess,onOnCancel:e[0]||(e[0]=S=>i.$emit("on-cancel"))},null,8,["onOnSuccess"])):l.activeStep==1?(d(),k(f,{key:1,form:l.form,onOnSuccess:o.handleVerifySuccess},null,8,["form","onOnSuccess"])):l.activeStep==2||l.activeStep==3?(d(),k(b,{key:2,form:l.form,onOnClose:e[1]||(e[1]=S=>i.$emit("on-cancel"))},null,8,["form"])):O("",!0)])])}const oe=v(ie,[["render",le]]),re={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{DataForm:F,IssueCertificateStep:oe},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91":"\u7533\u8BF7SSL\u8BC1\u4E66"},dialogVisible:{get(){return this.visible},set(i){this.$emit("update:visible",i)}}},methods:{handleClose(){this.$emit("update:visible",!1)},handleOpen(){this.$emit("update:visible",!0)},handleSuccess(){this.handleClose(),this.$emit("on-success")}},created(){}};function ce(i,e,t,C,l,o){const r=a("IssueCertificateStep"),u=a("el-dialog");return d(),k(u,{title:"\u7533\u8BF7SSL\u8BC1\u4E66",modelValue:o.dialogVisible,"onUpdate:modelValue":e[0]||(e[0]=m=>o.dialogVisible=m),width:"900px",center:"","append-to-body":""},{default:n(()=>[o.dialogVisible?(d(),k(r,{key:0,row:t.row,onOnCancel:o.handleClose,onOnSuccess:o.handleSuccess},null,8,["row","onOnCancel","onOnSuccess"])):O("",!0)]),_:1},8,["modelValue"])}const I=v(re,[["render",ce]]),de={name:"",components:{DataFormDialog:I,ConnectStatus:A},props:{list:{type:Array}},computed:{},data(){return{currentRow:null,dialogVisible:!1}},methods:{handleEditRow(i){this.currentRow=i,this.dialogVisible=!0},async handleDeleteClick(i){let e={id:i.id};const t=await this.$http.function(e);t.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(t.msg)},async handleStatusChange(i){let e={id:i.id};const t=await this.$http.function(e);t.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(t.msg)},handleUpdateSuccess(){this.$emit("on-success")}},created(){}},ue={style:{"margin-left":"4px"}};function me(i,e,t,C,l,o){const r=a("el-table-column"),u=a("ConnectStatus"),m=a("Tickets"),_=a("el-icon"),f=a("el-link"),b=a("el-table"),S=a("DataFormDialog");return d(),h("div",null,[s(b,{data:t.list,stripe:"",border:""},{default:n(()=>[s(r,{label:"ID",align:"center",prop:"id",width:"60"},{default:n(c=>[p("span",null,g(c.row.id||"-"),1)]),_:1}),s(r,{label:"\u57DF\u540D","header-align":"center",align:"center",prop:"domains"},{default:n(c=>[(d(!0),h($,null,V(c.row.domains,D=>(d(),h("div",null,g(D),1))),256))]),_:1}),s(r,{label:"\u9A8C\u8BC1\u72B6\u6001","header-align":"center",align:"center",prop:"status",width:"80"},{default:n(c=>[s(u,{value:c.row.show_status,onOnClick:D=>i.handleShowAddressListgDialog(c.row)},null,8,["value","onOnClick"]),p("span",ue,g(c.row.status_label||"-"),1)]),_:1}),s(r,{label:"SSL\u7B7E\u53D1\u65F6\u95F4","header-align":"center",align:"center",prop:"start_time",width:"160"},{default:n(c=>[p("span",null,g(c.row.start_time||"-"),1)]),_:1}),s(r,{label:"SSL\u8FC7\u671F\u65F6\u95F4","header-align":"center",align:"center",prop:"expire_time",width:"160"},{default:n(c=>[p("span",null,g(c.row.expire_time||"-"),1)]),_:1}),s(r,{label:"\u521B\u5EFA\u65F6\u95F4","header-align":"center",align:"center",prop:"create_time_label"},{default:n(c=>[p("span",null,g(c.row.create_time_label||"-"),1)]),_:1}),s(r,{label:"\u67E5\u770B",width:"60","header-align":"center",align:"center"},{default:n(c=>[s(f,{underline:!1,type:"primary",onClick:D=>o.handleEditRow(c.row)},{default:n(()=>[s(_,null,{default:n(()=>[s(m)]),_:1})]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),s(S,{visible:l.dialogVisible,"onUpdate:visible":e[0]||(e[0]=c=>l.dialogVisible=c),row:l.currentRow,onOnSuccess:o.handleUpdateSuccess},null,8,["visible","row","onOnSuccess"])])}const _e=v(de,[["render",me]]),pe={name:"issue-certificate-list",props:{},components:{DataFormDialog:I,DataTable:_e},data(){return{list:[],total:0,page:1,size:20,keyword:"",loading:!0,dialogVisible:!1}},computed:{},methods:{resetData(){this.page=1,this.getData()},async getData(){this.loading=!0;let i={page:this.page,size:this.size,keyword:this.keyword};try{const e=await this.$http.getCertificateList(i);e.code==0&&(this.list=e.data.list.map(t=>(t.show_status=null,t.status_label="\u672A\u77E5",t.status=="pending"?(t.show_status=!1,t.status_label="\u672A\u9A8C\u8BC1"):t.status=="valid"&&(t.show_status=!0,t.status_label="\u5DF2\u9A8C\u8BC1"),t)),this.total=e.data.total)}catch(e){console.log(e)}finally{this.loading=!1}},handleAddRow(){this.dialogVisible=!0},handleAddSuccess(){this.resetData()},handleSearch(){this.resetData()}},created(){this.getData()}},fe={class:"app-container"},he={class:"margin-bottom--20"};function ge(i,e,t,C,l,o){const r=a("Plus"),u=a("el-icon"),m=a("el-button"),_=a("Search"),f=a("el-input"),b=a("DataTable"),S=a("el-pagination"),c=a("DataFormDialog"),D=T("loading");return d(),h("div",fe,[p("div",he,[s(m,{type:"primary",onClick:o.handleAddRow},{default:n(()=>[s(u,null,{default:n(()=>[s(r)]),_:1}),y("\u7533\u8BF7")]),_:1},8,["onClick"]),s(f,{class:"ml-sm",style:{width:"260px"},modelValue:l.keyword,"onUpdate:modelValue":e[0]||(e[0]=w=>l.keyword=w),placeholder:"\u8F93\u5165\u57DF\u540D",clearable:"",onKeypress:U(o.handleSearch,["enter"]),onClear:o.handleSearch},{append:n(()=>[s(m,{onClick:o.handleSearch},{default:n(()=>[s(u,null,{default:n(()=>[s(_)]),_:1})]),_:1},8,["onClick"])]),_:1},8,["modelValue","onKeypress","onClear"])]),z(s(b,{class:"mt-md",list:l.list,onOnSuccess:o.resetData,onOnEditRow:i.handleEditRow},null,8,["list","onOnSuccess","onOnEditRow"]),[[D,l.loading]]),s(S,{class:"mt-md justify-center",background:"",layout:"total, prev, pager, next",total:l.total,"page-size":l.size,"onUpdate:pageSize":e[1]||(e[1]=w=>l.size=w),"current-page":l.page,"onUpdate:currentPage":e[2]||(e[2]=w=>l.page=w),onCurrentChange:o.getData},null,8,["total","page-size","current-page","onCurrentChange"]),s(c,{visible:l.dialogVisible,"onUpdate:visible":e[3]||(e[3]=w=>l.dialogVisible=w),onOnSuccess:o.handleAddSuccess},null,8,["visible","onOnSuccess"])])}const ke=v(pe,[["render",ge]]);export{ke as default};
