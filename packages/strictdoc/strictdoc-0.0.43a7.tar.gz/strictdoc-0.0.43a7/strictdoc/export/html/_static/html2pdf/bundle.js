(()=>{"use strict";function e(e){let t={printUnits:"mm",printLeftMargin:"21",printRightMargin:"21",printTopMargin:"12",printBottomMargin:"12",printFontSize:"12pt",screenUnits:"px",headerMargin:"16",footerMargin:"16",virtualPagesGap:"16"};const i={printWidth:"210",printHeight:"297"},n={printWidth:"148.5",printHeight:"210"};switch(e.printPaperSize){case"A5":case"a5":t={...t,...n};break;default:t={...t,...i}}return t}const t={root:"#printTHIS",footerTemplate:"#printTHISfooter",headerTemplate:"#printTHISheader",frontpageTemplate:"#printTHISfrontpage",frontpageContent:".frontpageContent",headerContent:".headerContent",footerContent:".footerContent",paperBody:".paperBody",paperHeader:".paperHeader",paperFooter:".paperFooter",virtualPaper:".virtualPaper",virtualPaperTopMargin:".virtualPaperTopMargin",virtualPaperBottomMargin:".virtualPaperBottomMargin",virtualPaperGap:".virtualPaperGap",paperFlow:"#paperFlow",contentFlow:"#contentFlow",runningSafety:".runningSafety",pageNumberRoot:"[data-page-number-root]",pageNumberCurrent:"[data-page-number-current]",pageNumberTotal:"[data-page-number-total]",printIgnore:"[data-print-ignore]",printHide:"[data-print-hide]",printPageBreak:"[data-print-page-break]",printForcedPageBreak:"[data-print-forced-page-break]",printNoBreak:"[data-print-no-break]",neutral:"[data-neutral]",complexTextBlock:"html2pdf-complex-text-block"};class i{constructor(e){this.config=e}create(){return this._baseStyle()+this._testStyle()}_baseStyle(){return`\n\n@page {\n  size: A4;\n  /* 2 values: width then height */\n  size: ${this.config.printWidth+this.config.printUnits} ${this.config.printHeight+this.config.printUnits};\n\n  margin-left: ${this.config.printLeftMargin-1+this.config.printUnits};\n  margin-right: ${this.config.printRightMargin-1+this.config.printUnits};\n  margin-top: ${this.config.printTopMargin-0+this.config.printUnits};\n  margin-bottom: ${this.config.printBottomMargin-2+this.config.printUnits};\n}\n\n${t.root} {\n  /* reset user styles */\n  display: block;\n\n  /* for proper printable flow positioning */\n  position: relative;\n\n  /* to compensate for possible BG in the parent node */\n  z-index: 1;\n\n  /* set print styles: affects previews */\n  margin: 0 auto;\n  width: ${this.config.printWidth-this.config.printLeftMargin-this.config.printRightMargin}${this.config.printUnits};\n  font-size: ${this.config.printFontSize};\n\n  /* protection against unpredictability of margins */\n  padding-top: .1px;\n  padding-bottom: ${2*this.config.virtualPagesGap+this.config.screenUnits};\n}\n\n${t.virtualPaper} {\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: minmax(min-content, max-content) minmax(min-content, max-content) 1fr minmax(min-content, max-content) minmax(min-content, max-content);\n  place-items: stretch stretch;\n  place-content: stretch stretch;\n  width: ${this.config.printWidth-this.config.printLeftMargin-this.config.printRightMargin}${this.config.printUnits};\n  height: ${this.config.printHeight}${this.config.printUnits};\n  font-size: ${this.config.printFontSize};\n}\n\n${t.virtualPaper}::before {\n  position: absolute;\n  content: '';\n  width: ${this.config.printWidth}${this.config.printUnits};\n  height: ${this.config.printHeight}${this.config.printUnits};\n  left: -${this.config.printLeftMargin}${this.config.printUnits};\n  background-color: #fff;\n  box-shadow: rgba(0, 0, 0, 0.1) 2px 2px 12px 0px;\n  z-index: -1;\n}\n\n${t.headerContent} {\n  display: block;\n  padding-bottom: ${this.config.headerMargin}${this.config.screenUnits};\n}\n\n${t.footerContent} {\n  display: block;\n  padding-top: ${this.config.footerMargin}${this.config.screenUnits};\n}\n\n${t.paperFlow} {\n  position: absolute;\n  width: 100%;\n  z-index: -1;\n  /* affect only screen */\n  padding-bottom: 100px;\n}\n\n${t.runningSafety} {\n  display: block;\n  padding: .1px;\n}\n\n${t.virtualPaperTopMargin} {\n  display: block;\n  height: ${this.config.printTopMargin}${this.config.printUnits};\n}\n\n${t.virtualPaperBottomMargin} {\n  display: block;\n  height: ${this.config.printBottomMargin}${this.config.printUnits};\n}\n\n${t.virtualPaperGap} {\n  display: block;\n  padding-top: ${this.config.virtualPagesGap}${this.config.screenUnits};\n}\n\n${t.frontpageContent} {\n  display: block;\n  transform-origin: top center;\n  padding: .1px;\n  height: 100%;\n}\n\n${t.neutral},\n${t.neutral} span {\n  display: inline;\n  padding: 0;\n  margin: 0;\n  font: inherit;\n  color: inherit;\n  line-height: inherit;\n  background: none;\n  background-color: transparent;\n}\n\n${t.printForcedPageBreak} {\n  display: block;\n  visibility: hidden;\n  height: 0;\n  overflow: hidden;\n}\n\n@media print {\n  ${t.root} {\n    /* to prevent a blank last page */\n    padding: 0;\n  }\n\n  ${t.paperFlow} {\n    padding-bottom: 0;\n  }\n\n  ${t.contentFlow} {\n    -webkit-mask-image: none !important;\n            mask-image: none !important;\n  }\n\n  ${t.printIgnore},\n  ${t.virtualPaper} {\n    display: contents;\n  }\n\n  ${t.virtualPaper}::before,\n  ${t.printHide},\n  ${t.virtualPaperTopMargin},\n  ${t.virtualPaperBottomMargin},\n  ${t.virtualPaperGap} {\n    display: none;\n  }\n\n  ${t.printPageBreak} {\n    break-after: page;\n    padding: .1px;\n  }\n\n  ${t.printForcedPageBreak} {\n    /* JUST MANUAL! */\n    /* break-after: page; */\n  }\n\n  ${t.printNoBreak} {\n    /*\n    TODO: temporary commented!\n    When splitting blocks, printPageBreak falls INTO this element,\n    and in Firefox it causes a blank page.\n    FIX the split of complex blocks and check in Firefox.\n    */\n    /* break-inside: avoid-page; */\n  }\n}\n    `}_testStyle(){return this.config.debugMode&&`\n/* FOR TEST */\n${t.virtualPaperGap} {\n  background: #ff000020;\n}\n\n${t.paperFooter},\n${t.paperHeader} {\n  background: #fa96ff20;\n}\n${t.paperBody} {\n  background: #ffee0020;\n}\n${t.runningSafety} {\n  background: #f200ff;\n}\n${t.frontpageContent} {\n  background: #00fcff20;\n}\n\n${t.neutral} {\n  background: #00ffee10;\n}\n\n[filler] {\n  background:repeating-linear-gradient(\n    -45deg,\n    rgba(0, 175, 255, .1),\n    rgba(0, 175, 255, .1) 10px,\n    rgba(0, 175, 255, .15) 10px,\n    rgba(0, 175, 255, .15) 20px\n  );\n}\n    `}}class n{constructor({DOM:e,debugMode:t}){this.debugMode=t,this.DOM=e,this.body=e.body}insertStyle(e){const t=this.DOM.querySelector("head"),i=this.DOM.createElement("style");i.append(this.DOM.createTextNode(e)),i.setAttribute("data-printthis-inserted",""),t.append(i)}createDocumentFragment(){return this.DOM.createDocumentFragment()}getElement(e,t=this.DOM){return t.querySelector(e)}removeNode(e){e.remove()}cloneNode(e){return e?.cloneNode(!0)}cloneNodeWrapper(e){return e?.cloneNode(!1)}insertBefore(e,...t){e.before(...t)}insertAfter(e,...t){e.after(...t)}insertAtEnd(e,...t){e.append(...t)}insertAtStart(e,...t){e.prepend(...t)}insertInsteadOf(e,...t){e.before(...t),e.remove()}getRightNeighbor(e){return e.nextElementSibling}getLeftNeighbor(e){return e.previousElementSibling}getElementOffsetParent(e){return e.offsetParent}getDataId(e){return e.dataset.id}setAttribute(e,t){if(!e||!t)return void(console.warn&&console.warn("setAttribute() must have 2 params"));const i=t.charAt(0);if("."===i){const i=t.substring(1);e.classList.add(i)}if("#"===i){const i=t.substring(1);e.id=i}if("["===i){const i=t.substring(1,t.length-1);e.setAttribute(i,"")}}setPrintNoBreak(e){this.setAttribute(e,t.printNoBreak)}wrapTextNode(e){if(!this.isSignificantTextNode(e))return;const t=this.createNeutral();return e.before(t),t.append(e),t}createNeutral(){const e=this.DOM.createElement("span");return this.setAttribute(e,t.neutral),e}createTestNodeFrom(e){const t=e.cloneNode(!1);return t.classList="test-node",t.style.position="absolute",t.style.background="rgb(255 239 177)",t.style.width=this.getMaxWidth(e)+"px",t}getMaxWidth(e){const t=this.create();e.append(t);const i=this.getElementWidth(t);return t.remove(),i}getLineHeight(e){const t=this.createNeutral();t.innerHTML="!",e.append(t);const i=t.offsetHeight;return t.remove(),i}getEmptyNodeHeight(e){const t=this.create();t.style.padding="0.1px";const i=e.cloneNode(!1);t.append(i),e.before(t);const n=t.offsetHeight;return t.remove(),n}createComplexTextBlock(){const e=this.create();return e.className="complex-text-block",e.setAttribute(t.complexTextBlock,""),e}isComplexTextBlock(e){return e.hasAttribute(t.complexTextBlock)}getComputedStyle(e){return window.getComputedStyle(e)}isInline(e){const t=this.getComputedStyle(e).display;return"inline"===t||"inline-block"===t||"inline-table"===t||"inline-flex"===t||"inline-grid"===t}isInlineBlock(e){const t=this.getComputedStyle(e).display;return"inline-block"===t||"inline-table"===t||"inline-flex"===t||"inline-grid"===t}isGrid(e){return"grid"===this.getComputedStyle(e).display}isGridAutoFlowRow(e){const t=this.getComputedStyle(e).display,i=this.getComputedStyle(e).gridAutoFlow;return("grid"===t||"inline-grid"===t)&&"row"===i}isNeutral(e){return e.dataset?.hasOwnProperty("neutral")}isForcedPageBreak(e){return e.dataset?.hasOwnProperty("printForcedPageBreak")}insertForcedPageBreakBefore(e){const i=this.create();return this.setAttribute(i,t.neutral),this.setAttribute(i,t.printForcedPageBreak),this.insertBefore(e,i),i}findAllSelectorsInside(e,t){return"string"==typeof t&&(t=[t]),[...t].flatMap((t=>[...e.querySelectorAll(t)]))}isFirstChildOfFirstChild(e,t){if(!e||!e.parentElement)return!1;let i=e;for(;i.parentElement&&i!==t;){if(i.parentElement.firstElementChild!==i)return!1;i=i.parentElement}return i===t}findAllForcedPageBreakInside(e){return[...e.querySelectorAll(t.printForcedPageBreak)]}isNoBreak(e){return e.dataset?.hasOwnProperty("printNoBreak")}getElementTagName(e){return e.tagName}isDocumentBody(e){return"BODY"===e.tagName}isTextNode(e){return e.nodeType===Node.TEXT_NODE}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isSignificantTextNode(e){return!!this.isTextNode(e)&&e.nodeValue.trim().length>0}clearTemplates(e){e.querySelectorAll("template").forEach((e=>e.remove()))}getParentNode(e){return e.parentNode}getChildNodes(e){return e.childNodes}getChildren(e){return e.children}getInnerHTML(e){if("string"==typeof e){const t=this.DOM.querySelector(e);return t?t.innerHTML:void 0}return e.innerHTML}setInnerHTML(e,t){if("string"==typeof e){const i=this.DOM.querySelector(e);i&&(i.innerHTML=t)}e.innerHTML=t}setStyles(e,t){Object.entries(t).forEach((([t,i])=>e.style[t]=i))}create(e){if(!e)return this.DOM.createElement("div");const t=e.charAt(0);if("."===t){const t=e.substring(1),i=this.DOM.createElement("div");return i.classList.add(t),i}if("#"===t){const t=e.substring(1),i=this.DOM.createElement("div");return i.id=t,i}if("["===t){const t=e.substring(1,e.length-1),i=this.DOM.createElement("div");return i.setAttribute(t,""),i}return this.DOM.createElement(e)}createPrintPageBreak(){return this.create(t.printPageBreak)}createPrintNoBreak(e){const i=this.create(t.printNoBreak);return e&&(i.style=e),i}wrapNode(e,t){e.before(t),t.append(e)}wrapWithPrintNoBreak(e){const t=this.createPrintNoBreak();return e.before(t),t.append(e),t}fitElementWithinBoundaries({element:e,height:t,width:i,vspace:n,hspace:r}){const o=n/t,s=r/i,a=o<s?o:s,l=Math.trunc(t*a),h=Math.trunc(i*a);e.style.height=l+"px",e.style.width=h+"px",e.setAttribute("height",`${l}px`),e.setAttribute("width",`${h}px`)}getElementBCR(e){return e.getBoundingClientRect()}getElementTop(e){return e?.offsetTop}getElementLeft(e){return e?.offsetLeft}getElementHeight(e){return e?.offsetHeight}getElementWidth(e){return e?.offsetWidth}getElementRelativeTop(e){return e?.offsetTop}getElementRootedTop(e,t,i=0){if(!e)return void(this.debugMode&&console.warn("element must be provided, but was received:",e,"\nThe function returned:",void 0));if(!t)return void(this.debugMode&&console.warn("root must be provided, but was received:",e,"\nThe function returned:",void 0));const n=e.offsetParent;if(!n)return void(this.debugMode&&console.warn("element has no offset parent",e,"\nThe function returned:",void 0));const r=e.offsetTop;return n===t?r+i:this.getElementRootedTop(n,t,i+r)}getElementRelativeBottom(e){return e?.offsetTop+e?.offsetHeight||void 0}getElementRootedBottom(e,t){return this.getElementRootedTop(e,t)+this.getElementHeight(e)}getElementRootedRealBottom(e,t){const i=this.create();e&&e.after(i);const n=e?this.getElementRootedTop(i,t):void 0;return i.remove(),n}getElementRootedRealTop(e,t){const i=parseInt(this.getComputedStyle(e).marginTop);return this.getElementRootedTop(e,t)-i}isLineChanged(e,t){return this.getElementRelativeBottom(e)<=this.getElementRelativeTop(t)}isLineKept(e,t){return this.getElementRelativeBottom(e)>this.getElementRelativeTop(t)}splitByWordsGreedy(e){return e.innerHTML.split(/\s+/)}prepareSplittedNode(e){const t=e,i=this.splitByWordsGreedy(e),n=i.map((e=>{const t=this.DOM.createElement("span");return t.innerHTML=e+" ",t})),r=this.createTestNodeFrom(e);return r.append(...n),e.append(r),{splittedNode:t,nodeWords:i,nodeWordItems:n}}createSignpost(e,t=24){const i=this.create();return i.style.display="flex",i.style.flexWrap="nowrap",i.style.alignItems="center",i.style.justifyContent="center",i.style.textAlign="center",i.style.fontSize="8px",i.style.fontFamily="sans-serif",i.style.letterSpacing="1px",i.style.textTransform="uppercase",i.style.height=t+"px",e&&(i.innerHTML=e),i}createTable({wrapper:e,caption:t,thead:i,tfoot:n,tbody:r}){const o=e||this.create("table"),s=this.create("TBODY");return t&&o.append(t),i&&o.append(i),r&&s.append(...r),o.append(s),n&&o.append(n),o}}const r="border:1px solid #8888CC;background:#EEEEEE;color:#8888CC;";class o{constructor({config:e,DOM:t,selector:i}){this.debugMode=e.debugMode,this.DOM=t,this.selector=i,this.rootSelector=i?.root,this.paperFlowSelector=i?.paperFlow,this.contentFlowSelector=i?.contentFlow,this.printIgnoreElementSelector=i?.printIgnore,this.printHideElementSelector=i?.printHide,this.root=this._initRoot(),this.paperFlow=this._createPaperFlow(),this.contentFlow=this._createContentFlow()}create(){this.debugMode&&console.groupCollapsed("%c Layout ",r),this.DOM.setInnerHTML(this.root,""),this.DOM.insertAtEnd(this.root,this.paperFlow,this.contentFlow),this.root!==this.DOM.body&&this._ignorePrintingEnvironment(this.root),this.debugMode&&console.groupEnd("%c Layout ",r)}_initRoot(){let e=this.DOM.getElement(this.rootSelector);return this.debugMode&&console.log("%c Layout: init root ",r,e),e||(e=this.DOM.body,this.DOM.setAttribute(e,this.rootSelector),console.warn(`Add ${this.rootSelector} to the root element of the area you want to print. ${this.rootSelector} is now automatically added to the BODY tag.`)),e}_createPaperFlow(){return this.DOM.create(this.paperFlowSelector)}_createContentFlow(){const e=this.DOM.create(this.contentFlowSelector),t=this.DOM.getInnerHTML(this.root);return t.trim().length>0?(this.DOM.setInnerHTML(e,t),this.DOM.clearTemplates(e),this.DOM.insertAtEnd(e,this.DOM.create("[data-content-flow-end]"))):console.warn("It looks like you don't have any printable content."),e}_ignorePrintingEnvironment(e){let t=this.DOM.getParentNode(e);this.DOM.setAttribute(t,this.printIgnoreElementSelector),this.DOM.getChildNodes(t).forEach((t=>{if(t!==e&&this.DOM.isElementNode(t))this.DOM.setAttribute(t,this.printHideElementSelector);else{if(!this.DOM.isSignificantTextNode(t))return;this.DOM.setAttribute(this.DOM.wrapTextNode(t),this.printHideElementSelector)}})),this.DOM.isDocumentBody(t)||this._ignorePrintingEnvironment(t)}}const s="#66CC00",a=`color: ${s};font-weight:bold`,l=`border:1px solid ${s};background:#EEEEEE;color:${s};`;class h{constructor({config:e,DOM:t,layout:i,referenceWidth:n,referenceHeight:r}){this.debugMode=e.debugMode,this.debugToggler={_prepareForcedPageBreak:!1,_parseNode:!1,_splitPreNode:!1,_splitTableNode:!1,_splitGridNode:!1,_matchSelectors:!1,_canNotBeLast:!1},this.canNotBeLastSelector=this._prepareCanNotBeLastSelector(e.canNotBeLastSelector),this.forcedPageBreakSelector=this._prepareForcedPageBreakSelector(e.forcedPageBreakSelector),this.noBreakSelector=this._prepareNoBreakSelector(e.noBreakSelector),this.DOM=t,this.root=i.root,this.contentFlow=i.contentFlow,this.referenceWidth=n,this.referenceHeight=r,this.minLeftLines=2,this.minDanglingLines=2,this.minBreakableLines=this.minLeftLines+this.minDanglingLines,this.minLeftRows=2,this.minDanglingRows=2,this.minBreakableRows=this.minLeftRows+this.minDanglingRows,this.minPreFirstBlockLines=3,this.minPreLastBlockLines=3,this.minPreBreakableLines=this.minPreFirstBlockLines+this.minPreLastBlockLines,this.minBreakableGridRows=4,this.imageReductionRatio=.8,this.signpostHeight=24,this.pages=[],this.isFirefox="undefined"!=typeof InstallTrigger}calculate(){return this._prepareForcedPageBreakElements(),this._prepareNoBreakElements(),this._calculate(),this.debugMode&&console.log("%c ✔ Pages.calculate()",l,this.pages),this.pages}_prepareNoBreakElements(){this.noBreakSelector&&this.DOM.findAllSelectorsInside(this.contentFlow,this.noBreakSelector).forEach((e=>this.DOM.setPrintNoBreak(e)))}_prepareForcedPageBreakElements(){if(this.debugMode&&this.debugToggler._prepareForcedPageBreak&&console.group("_prepareForcedPageBreak"),this.forcedPageBreakSelector){const e=this.DOM.findAllSelectorsInside(this.contentFlow,this.forcedPageBreakSelector);this.debugMode&&this.debugToggler._prepareForcedPageBreak&&console.log("• step 1",[...e]),this.DOM.isFirstChildOfFirstChild(e[0],this.contentFlow)&&e.shift(),this.debugMode&&this.debugToggler._prepareForcedPageBreak&&console.log("• step 2",[...e]),e.forEach((e=>this.DOM.insertForcedPageBreakBefore(e)))}this.debugMode&&this.debugToggler._prepareForcedPageBreak&&console.groupEnd("_prepareForcedPageBreak")}_calculate(){if(this.debugMode&&console.log("%c ▼▼▼ Pages ▼▼▼ ",l),this.debugMode&&console.groupCollapsed("•• init data ••"),this.debugMode&&console.log("this.referenceHeight",this.referenceHeight,"\n","this.canNotBeLastSelector",this.canNotBeLastSelector,"\n","this.forcedPageBreakSelector",this.forcedPageBreakSelector,"\n","isFirefox",this.isFirefox),this.debugMode&&console.groupEnd("•• init data ••"),this.DOM.getElementRootedRealBottom(this.contentFlow,this.root)<this.referenceHeight){const e=this.DOM.create("[data-content-flow-start]");return this.DOM.insertAtStart(this.contentFlow,e),this._registerPageStart(e),void this.DOM.findAllForcedPageBreakInside(this.contentFlow).forEach((e=>this._registerPageStart(e)))}const e=this._getChildren(this.contentFlow);this.debugMode&&console.log("%c🚸 children(contentFlow)",l,e),this._registerPageStart(e[0]),this._parseNodes({array:e})}_registerPageStart(e){this.pages.push({pageStart:e,pageBottom:this.DOM.getElementRootedRealTop(e,this.root)+this.referenceHeight})}_parseNodes({array:e,previous:t,next:i,parent:n,parentBottom:r}){for(let o=0;o<e.length;o++)this._parseNode({i:o,previousElement:e[o-1]||t,currentElement:e[o],nextElement:e[o+1]||i,parent:n,parentBottom:o===e.length-1?r:void 0})}_parseNode({i:e,previousElement:t,currentElement:i,nextElement:n,parent:r,parentBottom:o}){const s=["%c_parseNode\n","color:white"];this.debugMode&&this.debugToggler._parseNode&&console.group("%c_parseNode",a,o?"★last★":""),this.debugMode&&this.debugToggler._parseNode&&console.log(...s,"3 nodes: ",{previousElement:t,currentElement:i,nextElement:n});const l=0==e&&r?r:i;if(this.debugMode&&this.debugToggler._parseNode&&o&&console.log(...s,"parent:",r,"\n","parentBottom:",o,"\n","currentPageStart:",l,"\n"),!n)return void(this.debugMode&&this.debugToggler._parseNode&&console.log(...s,"🏁 THE END"));if(this.DOM.isForcedPageBreak(i))return this._registerPageStart(i),void(this.debugMode&&this.debugToggler._parseNode&&console.log(...s,"🚩 FORCED BREAK"));this.debugMode&&console.assert(this.DOM.getElementOffsetParent(i),"it is expected that the element has an offset parent",i);const h=this.pages.at(-1).pageBottom,g=this.DOM.getElementRootedTop(n,this.root);if(this.debugMode&&this.debugToggler._parseNode&&console.log(...s,"• newPageBottom",h,"\n","• nextElementTop",g),g<=h)this.DOM.findAllForcedPageBreakInside(i).forEach((e=>this._registerPageStart(e)));else{if(this._canNotBeLast(i,"current"))return void this._registerPageStart(l);if(this._isSVG(i)||this._isIMG(i)){const e=this._isSVG(i)?this.DOM.wrapWithPrintNoBreak(i):i,t=h-this.DOM.getElementRootedTop(e,this.root),r=this.DOM.getElementHeight(e),o=this.DOM.getElementWidth(e);return r<this.referenceWidth&&this.debugMode&&this.debugToggler._parseNode&&console.warn("%c IMAGE is too wide","color: red"),r<t?void this._registerPageStart(n):t/r>this.imageReductionRatio?(this._registerPageStart(n),void this.DOM.fitElementWithinBoundaries({element:i,height:r,width:o,vspace:t,hspace:this.referenceWidth})):(this._registerPageStart(e),void(r>this.referenceHeight&&this.DOM.fitElementWithinBoundaries({element:i,height:r,width:o,vspace:this.referenceHeight,hspace:this.referenceWidth})))}const a=o||this.DOM.getElementRootedRealBottom(i,this.root);if(a<=h)return void this._registerPageStart(n);let g=[];this._doNotBreak(i)?(this.debugMode&&this.debugToggler._parseNode&&console.info(...s,"🧡 isNoBreak"),g=[]):this.DOM.isComplexTextBlock(i)?(this.debugMode&&this.debugToggler._parseNode&&console.info(...s,"💚 ComplexTextBlock"),g=this._splitComplexTextBlock(i)||[]):this._isTextNode(i)?(this.debugMode&&this.debugToggler._parseNode&&console.info(...s,"💚 TextNode"),g=this._splitComplexTextBlock(i)||[]):this._isPRE(i)?(this.debugMode&&this.debugToggler._parseNode&&console.info(...s,"💚 PRE"),g=this._splitPreNode(i,h)||[]):this._isTableNode(i)?(this.debugMode&&this.debugToggler._parseNode&&console.info(...s,"💚 TABLE"),g=this._splitTableNode(i,h)||[]):this.DOM.isGridAutoFlowRow(i)?(this.debugMode&&this.debugToggler._parseNode&&console.info(...s,"💜 GRID"),g=this._splitGridNode(i,h)||[]):(g=this._getChildren(i),this.debugMode&&this.debugToggler._parseNode&&console.info(...s,"🚸 get element children ",g)),this._isVerticalFlowDisrupted(g)&&(g=this._processInlineChildren(g));const d=g.length;this.debugMode&&this.debugToggler._parseNode&&console.log(...s,"childrenNumber ",d),this.debugMode&&this.debugToggler._parseNode&&console.log(...s,"currentElement ",i);const p=d<=1||0==e?r||i:void 0;this.debugMode&&this.debugToggler._parseNode&&console.log(...s,"set retainedParent",p),d?this._parseNodes({array:g,previous:t,next:n,parent:p,parentBottom:a}):this._canNotBeLast(t,"previous")?this._registerPageStart(t):(this._registerPageStart(l),this.debugMode&&this.debugToggler._parseNode&&console.log(...s,"_registerPageStart:",l))}this.debugMode&&this.debugToggler._parseNode&&console.groupEnd("%c_parseNode")}_processInlineChildren(e){let t=null;const i=[];return e.forEach((e=>{this.DOM.isInline(e)?(t||(t=this.DOM.createComplexTextBlock(),this.DOM.wrapNode(e,t),i.push(t)),this.DOM.insertAtEnd(t,e)):(t=null,i.push(e))})),i}_splitComplexTextBlock(e){const t=this._getChildren(e).map((e=>{const t=this.DOM.getLineHeight(e),i=this.DOM.getElementHeight(e);return{element:e,left:this.DOM.getElementLeft(e),top:this.DOM.getElementTop(e),lineHeight:t,lines:~~(i/t)}})).flatMap((e=>e.lines>1?this._breakItIntoLines(e):e.element)).reduce(((e,t,i,n)=>!e.length||this.DOM.isLineChanged(e.at(-1).at(-1),t)?(e.push([t]),e):e.length&&this.DOM.isLineKept(e.at(-1).at(-1),t)?(e.at(-1).push(t),e):void(this.debugMode&&console.assert(!0,"newComplexChildrenGroups: An unexpected case of splitting a complex paragraph into lines.","\nOn the element:",t))),[]);if(t.length<this.minBreakableLines)return[];const i=t.slice(0,this.minLeftLines).flat(),n=t.slice(-this.minDanglingLines).flat();return t.splice(0,this.minLeftLines,i),t.splice(-this.minDanglingLines,this.minDanglingLines,n),t.map(((e,t)=>{const i=this.DOM.createPrintNoBreak();return i.dataset.index=t,this.DOM.insertBefore(e[0],i),this.DOM.insertAtEnd(i,...e),i}))}_breakItIntoLines(e){const t=e.element,i=this.DOM.splitByWordsGreedy(t),n=i.map(((e,t)=>{const i=this.DOM.create("html2pdf-s");return i.dataset.index=t,i.innerHTML=e+" ",i}));t.innerHTML="",this.DOM.insertAtEnd(t,...n);const r=n.reduce(((e,t,i)=>(i>0&&n[i-1].offsetTop+n[i-1].offsetHeight<=t.offsetTop&&e.push(i),e)),[0]),o=r.reduce(((e,n,o)=>{const s=this.DOM.cloneNodeWrapper(t),a=r[o],l=r[o+1],h=i.slice(a,l).join(" ")+" ";return this.DOM.setInnerHTML(s,h),this.DOM.insertBefore(t,s),o>0&&s.removeAttribute("id"),e.push(s),e}),[]);return this.debugMode&&console.assert(o.length==e.lines,"The number of new lines is not equal to the expected number of lines when splitting.","\nNew lines:",o,e.lines),t.remove(),o}_isVerticalFlowDisrupted(e){return e.some(((e,t,i)=>{const n=e,r=i[t+1];return!!r&&this.DOM.getElementRelativeBottom(n)>this.DOM.getElementRelativeTop(r)}))}_splitPreNode(e,t){const i=["%c_splitPreNode\n","color:white"];this.debugMode&&this.debugToggler._splitPreNode&&console.group("%c_splitPreNode","background:cyan"),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"node",e);const n=this.DOM.getElementRootedTop(e,this.root),r=this.DOM.getElementHeight(e),o=this.DOM.getLineHeight(e),s=this.DOM.getEmptyNodeHeight(e),a=(r-s)/o;if(a<this.minPreBreakableLines)return[];let l=this.DOM.getInnerHTML(e);"\n"===l.charAt(l.length-1)&&(this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"LAST CHAR IS \\n"),l=l.slice(0,-1)),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"1 - preText");const h=l.split("\n");if(this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"#### 2 - preLines",h),h.length<this.minPreBreakableLines)return this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"< minPreBreakableLines => return []"),[];let g=t-n-s;const d=this.referenceHeight-s;this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"availableSpace: \n",`${g} = ${t} - ${n} - ${s}`);let p=Math.trunc(g/o);const c=Math.trunc(d/o);p<this.minPreFirstBlockLines&&(this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"availableSpace is too small \n (availableSpace = this.referenceHeight)"),g=this.referenceHeight,p=c);const u=a-p;this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"restLines:",u),Math.floor(u/c);const m=u%c;this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"lastPartLines:",m),m<this.minPreLastBlockLines&&(p-=this.minPreLastBlockLines-m,this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"firstPartLines:",p)),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"#### 3 - grouping lines");const b=h.reduce(((e,t,i,n)=>(""===t?e.push([]):e[e.length-1].push(t),e)),[[]]).filter((e=>e.length));this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"(3) raw preGroupedLines:",...b);let M="",f="";b[0].length<this.minPreFirstBlockLines&&(M=b.shift().join("\n")+"\n\n"),b[b.length-1].length<this.minPreLastBlockLines&&(f="\n"+b.pop().join("\n")),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"(3) split into groups of lines:"),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"veryStartGroup",M),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"preGroupedLines",b),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"veryEndGroup",f);const T=b.reduce(((e,t,n,r)=>{if(this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,`preBlocks block # ${n}`,t),t.length<this.minPreBreakableLines)e.push(t.join("\n")+"\n"),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"this block.length < this.minPreBreakableLines");else{const i=t.slice(0,this.minPreFirstBlockLines).join("\n")+"\n",n=t.slice(this.minPreFirstBlockLines,-this.minPreLastBlockLines).map((e=>e+"\n")),r=t.slice(-this.minPreLastBlockLines).join("\n")+"\n";e.push(i),n.length&&e.push(...n),e.push(r)}return e.push("\n"),e}),[]);if("\n"===T[T.length-1]&&T.pop(),M.length&&(T[0]=M+T[0]),f.length&&(T[T.length-1]=T[T.length-1]+f),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"#### 4 - preBlocks",T),1===T.length)return this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"DON'T SPLIT IT"),[];const P=T.map((e=>{const t=this.DOM.createNeutral();return this.DOM.setInnerHTML(t,e),t}));this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"blockAndLineElementsArray",P);const O=this.DOM.createTestNodeFrom(e);this.DOM.insertAtEnd(O,...P),this.DOM.insertAtEnd(e,O),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,`• availableSpace: ${g}`,"\n",`• pageSpace: ${d}`);let D=0,_=[],N=g;this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"Find starts of parts splitters\n","◆ page: #",D,"\n","◆ floater:",N);for(let e=0;e<P.length;e++){const t=P[e],n=this.DOM.getElementRootedBottom(t,O);this.debugMode&&this.debugToggler._splitPreNode&&console.log("currentBottom:",n),this.DOM.getElementRootedBottom(t,O)>N&&(e&&_.push(e),e&&(D+=1),N=this.DOM.getElementRootedTop(t,O)+d,this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"◆ page: #",D,"\n","◆ new floater:",N))}if(O.remove(),_.push(null),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"splitters",_),_.length<2)return[];const E=_.map(((t,i,n)=>{const r=this.DOM.cloneNodeWrapper(e);this.DOM.setPrintNoBreak(r);const o=n[i-1]||0,s=t||n[n.length];return this.DOM.insertAtEnd(r,...P.slice(o,s)),r}));return this.debugMode&&this.debugToggler._splitPreNode&&console.log(...i,"newPreElementsArray",E),this.DOM.setInnerHTML(e,""),this.DOM.insertAtEnd(e,...E),e.style.display="contents",e.setAttribute("slough-node",""),e.classList="",this.debugMode&&this.debugToggler._splitPreNode&&console.groupEnd("%c_splitPreNode","background:cyan"),E}_splitTableNode(e,t){const i=["%c_splitTableNode\n","color:white"];this.debugMode&&this.debugToggler._splitTableNode&&console.time("_splitTableNode"),this.debugMode&&this.debugToggler._splitTableNode&&console.group("%c_splitTableNode","background:cyan"),this.debugMode&&this.debugToggler._splitTableNode&&console.log(...i,"node",e);const n=this.DOM.getEmptyNodeHeight(e),r=[...e.children].reduce((function(e,t){const i=t.tagName;return"TBODY"===i?{...e,rows:[...e.rows,...t.children]}:"CAPTION"===i?{...e,caption:t}:"COLGROUP"===i?{...e,colgroup:t}:"THEAD"===i?{...e,thead:t}:"TFOOT"===i?{...e,tfoot:t}:"TR"===i?{...e,rows:[...e.rows,...t]}:{...e,unexpected:[...e.unexpected,...t]}}),{caption:null,thead:null,tfoot:null,rows:[],unexpected:[]});if(this.debugMode&&this.debugToggler._splitTableNode&&console.log(...i,"nodeEntries",r),r.unexpected.length>0&&this.debugMode&&this.debugToggler._splitTableNode&&console.warn(...i,"something unexpected is found in the table"),r.rows.length<this.minBreakableRows)return[];const o=this.DOM.getElementRootedTop(e,this.root),s=this.DOM.getElementHeight(e),a=t-o-this.signpostHeight-n,l=this.referenceHeight-(this.DOM.getElementHeight(r.thead)||0)-(this.DOM.getElementHeight(r.tfoot)||0)-(this.DOM.getElementHeight(r.caption)||0)-2*this.signpostHeight-n;this.debugMode&&this.debugToggler._splitTableNode&&console.log(...i,"pageBottom",t,"\n","- nodeTop",o,"\n","- tableWrapperHeight",n,"\n","- this.signpostHeight",this.signpostHeight,"\n","= firstPartHeight",a);const h=[...r.rows.map((t=>this.DOM.getElementRootedTop(t,e)+(this.DOM.getElementHeight(r.caption)??0)*(this.isFirefox??0))),this.DOM.getElementRootedTop(r.tfoot,e)||s];this.debugMode&&this.debugToggler._splitTableNode&&console.log(...i,"firstPartHeight",a),this.debugMode&&this.debugToggler._splitTableNode&&console.log(...i,"fullPagePartHeight",l),this.debugMode&&this.debugToggler._splitTableNode&&console.log(...i,"• topsArr",h);let g=[],d=a;for(let e=0;e<h.length;e++)h[e]>d&&(e>this.minLeftRows&&g.push(e-1),d=h[e-1]+l);if(this.debugMode&&this.debugToggler._splitTableNode&&console.log(...i,"splitsIds",g),!g.length)return[];const p=h.length-1-this.minDanglingRows;g[g.length-1]>p&&(g[g.length-1]=p);const c=(t,n)=>{this.debugMode&&this.debugToggler._splitTableNode&&console.log(...i,`=> insertTableSplit(${t}, ${n})`);const o=this.DOM.cloneNodeWrapper(e);o.style.width=`${this.DOM.getElementWidth(e)}px`;const s=r.rows.slice(t,n),a=this.DOM.createPrintNoBreak();return e.before(a),t&&this.DOM.insertAtEnd(a,this.DOM.createSignpost("(table continued)",this.signpostHeight)),this.DOM.insertAtEnd(a,this.DOM.createTable({wrapper:o,caption:this.DOM.cloneNode(r.caption),thead:this.DOM.cloneNode(r.thead),tbody:s}),this.DOM.createSignpost("(table continues on the next page)",this.signpostHeight)),a},u=g.map(((e,t,i)=>c(i[t-1]||0,e)));this.debugMode&&this.debugToggler._splitTableNode&&console.log(...i,"splits",u);const m=this.DOM.createPrintNoBreak();return e.before(m),this.DOM.insertAtEnd(m,this.DOM.createSignpost("(table continued)",this.signpostHeight),e),this.debugMode&&this.debugToggler._splitTableNode&&console.timeEnd("_splitTableNode"),[...u,m]}_splitGridNode(e,t){const i=["%c_splitGridNode\n","color:white"];this.debugMode&&this.debugToggler._splitGridNode&&console.group("_splitGridNode");const n=this._getChildren(e);this.debugMode&&this.debugToggler._splitGridNode&&console.log(...i,"children",n);const r=n.reduce(((e,t,n,r)=>{const o=this.DOM.getComputedStyle(t),s=o.getPropertyValue("grid-column-start"),a=o.getPropertyValue("grid-column-end"),l={element:t,start:"auto"===s?"auto":parseInt(o.getPropertyValue("grid-column-start")),end:"auto"===a?"auto":parseInt(o.getPropertyValue("grid-column-end")),top:this.DOM.getElementTop(t)};return this.debugMode&&this.debugToggler._splitGridNode&&console.log(...i,"{ ???",t,e),!e.length||e.at(-1).at(-1).start>=l.start||"auto"===e.at(-1).at(-1).start||"auto"===l.start?(e.at(-1)&&this._canNotBeLast(e.at(-1).at(-1).element,"in _splitGridNode")?(this.debugMode&&this.debugToggler._splitGridNode&&console.log("%cLAST","color:red"),e.at(-1).push(l)):e.push([l]),this.debugMode&&this.debugToggler._splitGridNode&&console.log(...i,"IF new:",l,[...e]),e):e.length&&e.at(-1).at(-1).start<l.start?(e.at(-1).push(l),this.debugMode&&this.debugToggler._splitGridNode&&console.log(...i,"IF new:",l,[...e]),e):void(this.debugMode&&console.assert(!0,"_splitGridNode: An unexpected case of splitting a grid.","\nOn the element:",t))}),[]);this.debugMode&&this.debugToggler._splitGridNode&&console.log(...i,"childrenGroups",r);const o=r.length,s=this.DOM.getElementHeight(e);if(o<this.minBreakableGridRows&&s<this.referenceHeight)return[];const a=[...r.map((e=>e.map((e=>e.top)).sort())).map((e=>e[0])),s];this.debugMode&&this.debugToggler._splitGridNode&&console.log(...i,"topRowPoints",a);const l=this.DOM.getElementRootedTop(e,this.root),h=this.DOM.getEmptyNodeHeight(e),g=t-l-h,d=this.referenceHeight-h;this.debugMode&&this.debugToggler._splitGridNode&&console.log("firstPartHeight",g),this.debugMode&&this.debugToggler._splitGridNode&&console.log("fullPagePartHeight",d);const p=a;let c=[],u=g;for(let e=0;e<p.length;e++)p[e]>u&&(e>this.minLeftRows&&c.push(e-1),u=p[e-1]+d);this.debugMode&&this.debugToggler._splitGridNode&&console.log("splitsIds",c);const m=(t,n)=>{this.debugMode&&this.debugToggler._splitGridNode&&console.log(...i,`=> insertGridSplit(${t}, ${n})`);const o=r.slice(t,n).flat().map((e=>e.element));this.debugMode&&this.debugToggler._splitGridNode&&console.log(...i,"partEntries",o);const s=this.DOM.cloneNodeWrapper(e);return s.style.width=`${this.DOM.getElementWidth(e)}px`,this.DOM.setPrintNoBreak(s),e.before(s),this.DOM.insertAtEnd(s,...o),s},b=c.map(((e,t,i)=>m(i[t-1]||0,e)));return this.debugMode&&this.debugToggler._splitGridNode&&console.log(...i,"splits",b),this.DOM.setPrintNoBreak(e),this.debugMode&&this.debugToggler._splitGridNode&&console.groupEnd("_splitGridNode"),[...b,e]}_splitTextNode(e,t){const i=this.DOM.getElementRootedTop(e,this.root),n=this.DOM.getElementHeight(e),r=this.DOM.getLineHeight(e),o=t-i,s=function({pageLines:e,nodeLines:t,firstPartLines:i,minBreakableLines:n,minLeftLines:r,minDanglingLines:o}){let s=[];if(t<n)return[];i<r&&(i=e),function n(r=0){const o=e*r+i,a=r?o-e*(r-1):i;if(t>o)return s=[...s,{endLine:o,splitter:o/t,partLines:a}],void n(r+1);const l=t-(o-e);s=[...s,{endLine:null,splitter:null,partLines:l}]}();const a=s.length-2,l=s.length-1;if(s[l].partLines<o){const e=o-s[l].partLines,i=s[a].endLine-e,n=i/t;s[a]={endLine:i,splitter:n,partLines:s[a].partLines-e},s[l].partLines=s[l].partLines+e}return s}({nodeLines:~~(n/r),pageLines:~~(this.referenceHeight/r),firstPartLines:~~(o/r),minBreakableLines:this.minBreakableLines,minLeftLines:this.minLeftLines,minDanglingLines:this.minDanglingLines});if(s.length<2)return[];const{splittedNode:a,nodeWords:l,nodeWordItems:h}=this.DOM.prepareSplittedNode(e),g=s.map((({endLine:e,splitter:t})=>t?function({arr:e,floater:t,topRef:i,getElementTop:n,root:r}){const o=(t,s)=>{const a=t+1,l=e[a],h=n(l,r);return s<h&&h>=i?a:o(a,h)},s=(t,o)=>{const a=t-1,l=e[a],h=n(l,r);return h<o&&o>=i?t:s(a,h)},a=~~(e.length*t),l=n(e[a],r);return l<i?o(a,l):s(a,l)}({arr:h,floater:t,topRef:e*r,getElementTop:this.DOM.getElementRelativeTop,root:this.root}):null)).map(((e,t,i)=>{const n=this.DOM.createPrintNoBreak(),r=i[t-1]||0,o=e||i[i.length];return this.DOM.setInnerHTML(n,l.slice(r,o).join(" ")+" "),n}));return this.DOM.insertInsteadOf(a,...g),g}_getChildren(e){return[...this.DOM.getChildNodes(e)].reduce(((e,t)=>{if(this.DOM.isSignificantTextNode(t))return e.push(this.DOM.wrapTextNode(t)),e;if(!this.DOM.getElementOffsetParent(t)){const i=this._getChildren(t);return i.length>0&&e.push(...i),e}return this.DOM.isElementNode(t)?(e.push(t),e):void 0}),[])}_isSignificantChild(e){const t=this.DOM.getElementTagName(e);return"A"!==t&&"TT"!==t&&this.DOM.getElementHeight(e)>0}_prepareCanNotBeLastSelector(e){const t=this._sortSelectors(e);return t.tags.push("H1","H2","H3","H4","H5","H6"),t}_prepareForcedPageBreakSelector(e){return e?.length?e?.split(/\s+/):[]}_prepareNoBreakSelector(e){return e?.length?e?.split(/\s+/):[]}_sortSelectors(e){const t={tags:[],classes:[],attributes:[]};return e?.split(/\s+/).forEach((e=>{const i=e.charAt(0);"["===i?t.attributes.push(e.slice(1,-1)):"."===i?t.classes.push(e.slice(1)):t.tags.push(e.toUpperCase())})),t}_matchSelectors(e,t,i){const n=["%c_matchSelectors\n","color:white"];this.debugMode&&this.debugToggler._matchSelectors&&console.group("_matchSelectors ?"),this.debugMode&&this.debugToggler._matchSelectors&&console.log(...n,e,`\n${i}`,"\nSelectors:",t);const r=this.DOM.getElementTagName(e),o=[...e.classList];this.debugMode&&this.debugToggler._matchSelectors&&console.log(...n,"Element:\n",`• tag: ${r} \n • class: ${o}`);const s=t.tags.includes(r),a=o.length&&t.classes.some((e=>o.includes(e))),l=t.attributes.some((t=>e.hasAttribute(t)));return this.debugMode&&this.debugToggler._matchSelectors&&console.log(...n,"Results:\n",`• by tag: ${s} \n • by class: ${a} \n • by attr: ${l}`,"\n",`=> ${s||a||l}`),this.debugMode&&this.debugToggler._matchSelectors&&console.groupEnd("_matchSelectors ?"),s||a||l}_canNotBeLast(e,t){this.debugMode&&this.debugToggler._canNotBeLast&&console.group(`_canNotBeLast ?\n[${t}]`);const i=!!e&&this._matchSelectors(e,this.canNotBeLastSelector,`_canNotBeLast in ${t}`);return this.debugMode&&this.debugToggler._canNotBeLast&&console.groupEnd(`_canNotBeLast ?\n[${t}]`),i}_isPRE(e){return"PRE"===this.DOM.getElementTagName(e)}_isIMG(e){return"IMG"===this.DOM.getElementTagName(e)}_isSVG(e){return"svg"===this.DOM.getElementTagName(e)}_isTextNode(e){return this.DOM.isNeutral(e)}_isTableNode(e){return"TABLE"===this.DOM.getElementTagName(e)}_isLiNode(e){return"LI"===this.DOM.getElementTagName(e)}_doNotBreak(e){return this.DOM.isNoBreak(e)||this.DOM.isInlineBlock(e)||this._notSolved(e)}_notSolved(e){return"OBJECT"===this.DOM.getElementTagName(e)}}class g{constructor({config:e,DOM:t,selector:i}){this.debugMode=e.debugMode,this.DOM=t,this.selector=i,this.frontpageTemplateSelector=i?.frontpageTemplate,this.headerTemplateSelector=i?.headerTemplate,this.footerTemplateSelector=i?.footerTemplate,this.paperBodySelector=i?.paperBody||".paperBody",this.paperHeaderSelector=i?.paperHeader||".paperHeader",this.paperFooterSelector=i?.paperFooter||".paperFooter",this.headerContentSelector=i?.headerContent||".headerContent",this.footerContentSelector=i?.footerContent||".footerContent",this.frontpageContentSelector=i?.frontpageContent||".frontpageContent",this.virtualPaperSelector=i?.virtualPaper||".virtualPaper",this.virtualPaperTopMarginSelector=i?.virtualPaperTopMargin||".virtualPaperTopMargin",this.virtualPaperBottomMarginSelector=i?.virtualPaperBottomMargin||".virtualPaperBottomMargin",this.pageNumberRootSelector=i?.pageNumberRoot||void 0,this.pageNumberCurrentSelector=i?.pageNumberCurrent||void 0,this.pageNumberTotalSelector=i?.pageNumberTotal||void 0,this.frontpageTemplate=this.DOM.getInnerHTML(this.frontpageTemplateSelector),this.headerTemplate=this.DOM.getInnerHTML(this.headerTemplateSelector),this.footerTemplate=this.DOM.getInnerHTML(this.footerTemplateSelector),this.paperHeight,this.headerHeight,this.footerHeight,this.bodyHeight,this.bodyWidth,this.frontpageFactor,this._calculatePaperParams()}create({currentPage:e,totalPages:t}){const i=this._createPaperBody(this.bodyHeight),n=this._createPaperHeader(this.headerTemplate),r=this._createPaperFooter(this.footerTemplate);return this._createPaper({header:n,body:i,footer:r,currentPage:e,totalPages:t})}createFrontpage({currentPage:e,totalPages:t}){const i=this._createFrontpageContent(this.frontpageTemplate,this.frontpageFactor),n=this._createPaperBody(this.bodyHeight,i),r=this._createPaperHeader(this.headerTemplate),o=this._createPaperFooter(this.footerTemplate);return this._createPaper({header:r,body:n,footer:o,currentPage:e,totalPages:t})}createVirtualTopMargin(){return this.DOM.create(this.virtualPaperTopMarginSelector)}createVirtualBottomMargin(){return this.DOM.create(this.virtualPaperBottomMarginSelector)}_createPaper({header:e,body:t,footer:i,currentPage:n,totalPages:r}){const o=this.DOM.create(this.virtualPaperSelector);return this.DOM.insertAtEnd(o,this.createVirtualTopMargin(),e,t,i,this.createVirtualBottomMargin()),n&&r&&(this._setPageNumber(e,n,r),this._setPageNumber(i,n,r)),o}_createFrontpageContent(e,t){const i=this.DOM.create(this.frontpageContentSelector);return e&&this.DOM.setInnerHTML(i,e),t&&this.DOM.setStyles(i,{transform:`scale(${t})`}),i}_createPaperBody(e,t){const i=this.DOM.create(this.paperBodySelector);return this.DOM.setStyles(i,{height:e+"px"}),t&&this.DOM.insertAtEnd(i,t),i}_createPaperHeader(e){const t=this.DOM.create(this.paperHeaderSelector);if(e){const i=this.DOM.create(this.headerContentSelector);this.DOM.setInnerHTML(i,e),this.DOM.insertAtEnd(t,i)}return t}_createPaperFooter(e){const t=this.DOM.create(this.paperFooterSelector);if(e){const i=this.DOM.create(this.footerContentSelector);this.DOM.setInnerHTML(i,e),this.DOM.insertAtEnd(t,i)}return t}_setPageNumber(e,t,i){const n=this.pageNumberRootSelector?this.DOM.getElement(this.pageNumberRootSelector,e):this.pageNumberRootSelector;if(n){const e=this.DOM.getElement(this.pageNumberCurrentSelector,n),r=this.DOM.getElement(this.pageNumberTotalSelector,n);this.DOM.setInnerHTML(e,t),this.DOM.setInnerHTML(r,i)}}_calculatePaperParams(){const e=this._createPaperBody(),t=this._createFrontpageContent(this.frontpageTemplate),i=this._createPaperHeader(this.headerTemplate),n=this._createPaperFooter(this.footerTemplate),r=this._createPaper({header:i,body:e,footer:n}),o=this.DOM.create("#workbench");this.DOM.setStyles(o,{position:"absolute",left:"-3000px"}),this.DOM.insertAtEnd(o,r),this.DOM.insertAtStart(this.DOM.body,o);const s=this.DOM.getElementBCR(r).height,a=this.DOM.getElementHeight(i)||0,l=this.DOM.getElementHeight(n)||0,h=this.DOM.getElementHeight(e),g=this.DOM.getElementWidth(e);this.DOM.insertAtStart(e,t);const d=this.DOM.getElementHeight(e),p=d>h?h/d:1;this.DOM.removeNode(o),a>.2*s&&console.warn("It seems that your custom header is too high"),l>.15*s&&console.warn("It seems that your custom footer is too high"),p<1&&console.warn("It seems that your frontpage content is too large. We made it smaller to fit on the page. Check out how it looks! It might make sense to fix this with styles or reduce the text amount."),this.paperHeight=s,this.headerHeight=a,this.footerHeight=l,this.bodyHeight=h,this.bodyWidth=g,this.frontpageFactor=p}}const d="border:1px solid #ee00ee;background:#EEEEEE;color:#ee00ee;";class p{constructor({config:e,DOM:t,selector:i,pages:n,layout:r,paper:o}){this.config=e,this.debugMode=e.debugMode,this.DOM=t,this.selector=i,this.virtualPaperGapSelector=i?.virtualPaperGap,this.runningSafetySelector=i?.runningSafety,this.printPageBreakSelector=i?.printPageBreak,this.virtualPaper=i?.virtualPaper,this.virtualPaperTopMargin=i?.virtualPaperTopMargin,this.paperBody=i?.paperBody,this.pages=n,this.root=r.root,this.contentFlow=r.contentFlow,this.paperFlow=r.paperFlow,this.paper=o}create(){this.debugMode&&console.groupCollapsed("%c Preview ",d),this._processFirstPage(),this._processOtherPages(),this._addMask(),this.debugMode&&console.groupEnd("%c Preview ",d)}_addMask(){const e=[...this.paperFlow.querySelectorAll(this.virtualPaper)],t=this.DOM.getElementTop(e.at(-1))/(e.length-1),i=this.DOM.getElementHeight(this.paperFlow.querySelector(this.virtualPaperTopMargin)),n=this.DOM.getElementHeight(this.paperFlow.querySelector(this.paperBody));!function({targetElement:e,maskHeight:t,maskWindow:i,maskTopPosition:n}){e.style=`\n    -webkit-mask-image: linear-gradient(\n      black 0,\n      black ${i}px,\n      transparent ${i}px,\n      transparent ${t}px\n    );\n            mask-image: linear-gradient(\n              black 0,\n              black ${i}px,\n              transparent ${i}px,\n              transparent ${t}px\n            );\n    -webkit-mask-repeat: no-repeat;\n            mask-repeat: no-repeat;\n    -webkit-mask-size: 100% ${t}px;\n            mask-size: 100% ${t}px;\n    -webkit-mask-position: 100% ${n}px;\n            mask-position: 100% ${n}px;\n    -webkit-mask-repeat: repeat-y;\n            mask-repeat: repeat-y;\n    -webkit-mask-origin: border-box;\n            mask-origin: border-box;\n    `}({targetElement:this.contentFlow,maskHeight:t,maskWindow:n,maskTopPosition:i})}_processFirstPage(){let e;if(this.paper.frontpageTemplate){const t=this._insertFrontpageSpacer(this.contentFlow,this.paper.bodyHeight);this.pages.unshift({pageStart:t}),e=this.paper.createFrontpage({currentPage:1,totalPages:this.pages.length})}else e=this.paper.create({currentPage:1,totalPages:this.pages.length});this._insertIntoPaperFlow(e),this._insertIntoContentFlow(this.pages[0].pageStart)}_processOtherPages(){for(let e=1;e<this.pages.length;e++){const t=this.paper.create({currentPage:e+1,totalPages:this.pages.length}),i=this._createVirtualPaperGap();this._insertIntoPaperFlow(t,i),this._insertIntoContentFlow(this.pages[e].pageStart,i)}}_insertIntoPaperFlow(e,t){this._insertPaper(this.paperFlow,e,t)}_insertIntoContentFlow(e,t){t&&this._insertFooterSpacer(e,this.paper.footerHeight,t),this._insertHeaderSpacer(e,this.paper.headerHeight)}_insertPaper(e,t,i){i?this.DOM.insertAtEnd(e,i,t):this.DOM.insertAtEnd(e,t)}_createVirtualPaperGap(){return this.DOM.create(this.virtualPaperGapSelector)}_createVirtualPaperTopMargin(){return this.paper.createVirtualTopMargin()}_createVirtualPaperBottomMargin(){return this.paper.createVirtualBottomMargin()}_insertFrontpageSpacer(e,t){const i=this.DOM.create();return this.DOM.setStyles(i,{paddingBottom:t+"px"}),this.DOM.setAttribute(i,".printFrontpageSpacer"),this.DOM.insertAtStart(e,i),i}_insertHeaderSpacer(e,t){const i=this.DOM.create(this.runningSafetySelector);t&&this.DOM.setStyles(i,{marginBottom:t+"px"});const n=this.DOM.createDocumentFragment();this.DOM.insertAtEnd(n,this._createVirtualPaperTopMargin(),i),this.DOM.insertBefore(e,n)}_insertFooterSpacer(e,t,i){const n=this.DOM.create(this.runningSafetySelector);t&&this.DOM.setStyles(n,{marginTop:t+"px"});const r=this._createVirtualPaperGap(),o=this.DOM.createDocumentFragment();this.DOM.insertAtEnd(o,n,this._createVirtualPaperBottomMargin(),this.DOM.create(this.printPageBreakSelector),r),this.DOM.insertBefore(e,o);const s=this.DOM.getElementRootedTop(i,this.root)-this.DOM.getElementRootedTop(r,this.root);this.DOM.setStyles(n,{marginBottom:s+"px"}),this.debugMode&&console.log("%c balancer ",d,s)}}const c="border:1px dashed #cccccc;background:#ffffff;color:#cccccc;",u=document.currentScript.dataset,m=new class{constructor(e){this.params=e,this.config=this._config()}_config(){return{...e(this.params),...this.params}}render(){this.config.debugMode&&console.time("printTHIS");const e=new n({DOM:window.document,debugMode:this.config.debugMode});e.insertStyle(new i(this.config).create());const r=new o({config:this.config,DOM:e,selector:t}),s=new g({config:this.config,DOM:e,selector:t});r.create();const a=new h({config:this.config,DOM:e,layout:r,referenceHeight:s.bodyHeight,referenceWidth:s.bodyWidth}).calculate();new p({config:this.config,DOM:e,selector:t,layout:r,paper:s,pages:a}).create(),this.config.debugMode&&console.timeEnd("printTHIS")}}(u),b=new class{constructor(e){this.debugMode=e.debugMode,this.preloader,this.preloaderTarget=document.querySelector(e.preloaderTarget)||document.body,this.preloaderBackground=e.preloaderBackground||"white"}create(){this.debugMode&&console.groupCollapsed("%c Preloader ",c),this._insertStyle(),this.preloader=document.createElement("div"),this.preloader.classList.add("lds-dual-ring"),this.preloaderTarget.append(this.preloader),this.debugMode&&console.groupEnd("%c Preloader ",c)}remove(){if(!this.preloader)return;let e=1;const t=setInterval((()=>{e<=.1&&(clearInterval(t),this.preloader.remove()),this.preloader.style.opacity=e,e-=.1*e}),50);this.debugMode&&console.log("%c Preloader removed ",c)}_insertStyle(){const e=document.querySelector("head"),t=document.createElement("style");t.append(document.createTextNode(this._css())),t.setAttribute("data-preloader-style",""),e.append(t)}_css(){return`\n    /* PRELOADER */\n    .lds-dual-ring {\n      position: absolute;\n      z-index: 99999;\n      top: 0; left: 0; bottom: 0; right: 0;\n      background: ${this.preloaderBackground};\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n    /*\n    .lds-dual-ring:after {\n      content: " ";\n      display: block;\n      width: 64px;\n      height: 64px;\n      margin: 8px;\n      border-radius: 50%;\n      border: 6px solid #eee;\n      border-color: #eee transparent #eee transparent;\n      animation: lds-dual-ring 1.2s linear infinite;\n    }\n    @keyframes lds-dual-ring {\n      0% {\n        transform: rotate(0deg);\n      }\n      100% {\n        transform: rotate(360deg);\n      }\n    }\n    */\n  `}}(u);window.addEventListener("load",(function(e){m.render()})),"true"===u.preloader&&(window.addEventListener("DOMContentLoaded",(function(e){b.create()})),window.addEventListener("load",(function(e){b.remove()})))})();