{% extends "base.html" %}
{% load static %}

{% block content %}
<div id="deleteLogs" deleteLogs={{deleteLogs}}></div>

<div class="container-fluid">
    <nav class="navbar navbar-expand-sm topbar fixed-top secondNavbarStyle">
        <div class="insertInlineBlock marginTop5px">
            {% for logCategory in logSelectionButtons %}
                <a href="#" logCategory="{{logCategory}}" onclick="getLogMessages(this)">{{logCategory}}</a>&emsp;
            {% endfor %}

            &emsp;
            <button class="btn btn-sm btn-outline-primary" type="button" style=" margin-bottom:5px" name='deleteLogsButton' onclick="deleteLogs(this)">
                Delete Logs
            </button>
        </div>
    </nav>

    <div class="row">
        <span class="mainFontSize marginTop10px" id="insertDeleteLogsNote"></span>
    </div> 
    <br>

    <div class="row">
        <!-- <table class="table table-sm table-bordered table-fixed tableFixHead" style=" autoflow:auto"> -->
        <!-- <table class="table table-sm table-bordered table-fixed tableFixHead tableMessages mt-3"> -->
        <table class="tableFixHead2 table-bordered">
            <thead>
                <tr>
                    <th class="col-2">Date/Time</th>
                    <th class="col-1">Users</th>
                    <th class="col-1">Actions</th>
                    <th class="col-1">MsgType</th>
                    <th class="col-md-auto">Messages</th>
                </tr>
            </thead>

            <tbody id="tableDataSystemLogs"></tbody>
        </table>
    </div>
</div>
{% endblock content %}

{% block extra_js %}
<script>
    var logCategory = '';

    document.addEventListener("DOMContentLoaded", function() {
        //var footerDiv = document.querySelector('#footer');
        //footerDiv.parentNode.removeChild(footerDiv);

        // margin-bottom: 200px; height: 500px;
        //var contentDiv = document.querySelector('#content');
        //contentDiv.setAttribute('margin-bottom', '0px');
        //contentDiv.removeAttribute('height');
        
        getDefaultLogMessages(logCategory='sessions');

        let deleteLogs = document.querySelector('#deleteLogs').getAttribute('deleteLogs');
        document.querySelector('#insertDeleteLogsNote').innerHTML = `removeLogsAfterDays=${deleteLogs}`
        getServerTime();
    })

    async function getLogMessages(buttonObj) {
        logCategory = buttonObj.getAttribute('logCategory');
        console.log(`systemLogs getLogMessages(): ${logCategory}`);
        const data = await postData("{% url "getLogMessages" %}", "{{csrf_token}}", 'POST', 
                                        {remoteController: sessionStorage.getItem("remoteController"), 
                                         'webPage':logCategory});
        document.querySelector('#tableDataSystemLogs').innerHTML = data.logs;
        document.querySelector('#topbarTitlePage').innerHTML = `SystemLogs: ${logCategory}`;
    }

    async function getDefaultLogMessages(logCategory) {
        console.log(`systemLogs getLogMessages(): ${logCategory}`);
        const data = await postData("{% url "getLogMessages" %}", "{{csrf_token}}", 'POST', 
                                        {remoteController: sessionStorage.getItem("remoteController"), 
                                         'webPage':logCategory});
        document.querySelector('#tableDataSystemLogs').innerHTML = data.logs;
        document.querySelector('#topbarTitlePage').innerHTML = `SystemLogs: ${logCategory}`;
    }

    async function deleteLogs(buttonObj) {
        console.log(`systemLogs deleteLogs(): ${logCategory}`);
        const data = await postData("{% url "deleteLogs" %}", "{{csrf_token}}", 'POST', 
                                            {remoteController: sessionStorage.getItem("remoteController"), 
                                             'webPage':logCategory});
        window.location.reload();
    }
</script>
{% endblock extra_js %}